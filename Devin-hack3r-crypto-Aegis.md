# Overview

# OverviewLink copied!
Relevant source files
- [README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md)
- [contracts/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md)

## Purpose and ScopeLink copied!

This document provides a high-level introduction to the Aegis system, a cross-chain circuit breaker designed to protect Uniswap v4 liquidity providers from Loss Versus Rebalancing (LVR) attacks. Aegis operates across three blockchain networks—Ethereum Layer 1, Reactive Network, and Unichain Layer 2—to autonomously detect market crashes and gate trading pools before arbitrage bots can exploit stale prices.

This page covers the system's purpose, architecture, and operational flow. For specific implementation details, see:

- [Smart Contracts](#2) for detailed contract documentation
- [System Architecture](#1.2) for in-depth architectural analysis
- [Cross-Chain Infrastructure](#3) for messaging protocols
- [Getting Started](#1.1) for development setup instructions

Sources: [README.md#1-15](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L1-L15)[README.md#17-23](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L17-L23)

---

## The Problem: Loss Versus Rebalancing (LVR)Link copied!

Liquidity providers on Layer 2 networks lose millions annually to toxic flow. When asset prices crash on Ethereum mainnet, automated market maker (AMM) pools on L2s continue trading at stale prices until oracle updates propagate. Arbitrage bots exploit this time window to trade against outdated liquidity, extracting value from LPs.

The core issue is information asymmetry with speed:

PhaseMainnet StateL2 Pool StateResultT+0msETH crashes 50%Still priced at $2000Arbitrageurs prepareT+500msOracle updatesPool still staleBots buy underpriced assetsT+2000ms-Pool finally updatesLPs realize losses

Traditional solutions require centralized bot infrastructure to monitor prices and manually pause pools—introducing trust assumptions and latency vulnerabilities.

Sources: [README.md#14-15](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L14-L15)

---

## The Solution: Autonomous Cross-Chain Circuit BreakerLink copied!

Aegis eliminates centralized infrastructure by deploying autonomous smart contracts that react to market conditions in real-time. The system leverages three technical innovations:

1. Uniswap v4 Hooks: Programmable pool gates via `beforeSwap` callbacks2. Reactive Network: Event-driven cross-chain execution without off-chain bots3. Unichain Flashblocks: 250ms block times enable front-running arbitrageurs

When volatility is detected on L1, the system automatically activates `panicMode` on the L2 hook, rejecting all swaps until markets stabilize.

Sources: [README.md#17-23](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L17-L23)[README.md#36-52](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L36-L52)

---

## System ArchitectureLink copied!

### Three-Chain DesignLink copied!

#mermaid-apfgmpb9se{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-apfgmpb9se .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-apfgmpb9se .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-apfgmpb9se .error-icon{fill:#a44141;}#mermaid-apfgmpb9se .error-text{fill:#ddd;stroke:#ddd;}#mermaid-apfgmpb9se .edge-thickness-normal{stroke-width:1px;}#mermaid-apfgmpb9se .edge-thickness-thick{stroke-width:3.5px;}#mermaid-apfgmpb9se .edge-pattern-solid{stroke-dasharray:0;}#mermaid-apfgmpb9se .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-apfgmpb9se .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-apfgmpb9se .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-apfgmpb9se .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-apfgmpb9se .marker.cross{stroke:lightgrey;}#mermaid-apfgmpb9se svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-apfgmpb9se p{margin:0;}#mermaid-apfgmpb9se .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-apfgmpb9se .cluster-label text{fill:#F9FFFE;}#mermaid-apfgmpb9se .cluster-label span{color:#F9FFFE;}#mermaid-apfgmpb9se .cluster-label span p{background-color:transparent;}#mermaid-apfgmpb9se .label text,#mermaid-apfgmpb9se span{fill:#ccc;color:#ccc;}#mermaid-apfgmpb9se .node rect,#mermaid-apfgmpb9se .node circle,#mermaid-apfgmpb9se .node ellipse,#mermaid-apfgmpb9se .node polygon,#mermaid-apfgmpb9se .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-apfgmpb9se .rough-node .label text,#mermaid-apfgmpb9se .node .label text,#mermaid-apfgmpb9se .image-shape .label,#mermaid-apfgmpb9se .icon-shape .label{text-anchor:middle;}#mermaid-apfgmpb9se .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-apfgmpb9se .rough-node .label,#mermaid-apfgmpb9se .node .label,#mermaid-apfgmpb9se .image-shape .label,#mermaid-apfgmpb9se .icon-shape .label{text-align:center;}#mermaid-apfgmpb9se .node.clickable{cursor:pointer;}#mermaid-apfgmpb9se .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-apfgmpb9se .arrowheadPath{fill:lightgrey;}#mermaid-apfgmpb9se .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-apfgmpb9se .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-apfgmpb9se .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-apfgmpb9se .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-apfgmpb9se .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-apfgmpb9se .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-apfgmpb9se .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-apfgmpb9se .cluster text{fill:#F9FFFE;}#mermaid-apfgmpb9se .cluster span{color:#F9FFFE;}#mermaid-apfgmpb9se div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-apfgmpb9se .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-apfgmpb9se rect.text{fill:none;stroke-width:0;}#mermaid-apfgmpb9se .icon-shape,#mermaid-apfgmpb9se .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-apfgmpb9se .icon-shape p,#mermaid-apfgmpb9se .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-apfgmpb9se .icon-shape rect,#mermaid-apfgmpb9se .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-apfgmpb9se .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-apfgmpb9se .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-apfgmpb9se :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Cross-Chain Registry

Unichain Sepolia (L2)

Reactive Network Lasna

Ethereum Sepolia (L1)

1.emit PriceUpdate(uint256)

2.react() → setPanicMode(bool)

3.beforeSwap() gate

4.recordIntervention()

5.emit NewFeedback()

6.boostReputation()

MockOracle.sol 0x1392...a7D8 Price Feed Simulator

AegisSentinel.sol 0x0B6a...b6B6 Autonomous Monitor

AegisHook.sol 0x1E2a...8080 Pool Gatekeeper

Uniswap v4 PoolManager

AegisGuardianRegistry.sol ERC-721 + ERC-8004

Diagram 1: Three-Chain Component Architecture

The system spans three blockchain networks, each serving a distinct role:

- Ethereum Sepolia (L1): Data source layer hosting the `MockOracle` contract that emits price updates
- Reactive Network: Execution layer running the `AegisSentinel` reactive smart contract
- Unichain Sepolia (L2): Enforcement layer where the `AegisHook` gates Uniswap v4 pools

The `AegisGuardianRegistry` operates across chains to track reputation for liquidity providers who assist during crises.

Sources: [README.md#55-76](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L55-L76)[contracts/README.md#8-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L8-L26)

---

### Core ComponentsLink copied!

The following table maps system responsibilities to specific smart contracts:

ComponentFile PathNetworkPrimary FunctionMockOracle[src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol)Ethereum SepoliaEmits `PriceUpdate(uint256 price)` events for monitoringAegisSentinel[src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol)Reactive NetworkSubscribes to L1 events, triggers `setPanicMode(bool)` on L2AegisHook[src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol)Unichain SepoliaImplements `beforeSwap()` hook, enforces `panicMode` gateAegisGuardianRegistry[src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol)Multi-chainTracks guardian NFTs (ERC-721) and reputation (ERC-8004)

Sources: [contracts/README.md#28-57](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L28-L57)

---

### Component Interaction MapLink copied!

#mermaid-9u0t3tk33as{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-9u0t3tk33as .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-9u0t3tk33as .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-9u0t3tk33as .error-icon{fill:#a44141;}#mermaid-9u0t3tk33as .error-text{fill:#ddd;stroke:#ddd;}#mermaid-9u0t3tk33as .edge-thickness-normal{stroke-width:1px;}#mermaid-9u0t3tk33as .edge-thickness-thick{stroke-width:3.5px;}#mermaid-9u0t3tk33as .edge-pattern-solid{stroke-dasharray:0;}#mermaid-9u0t3tk33as .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-9u0t3tk33as .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-9u0t3tk33as .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-9u0t3tk33as .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-9u0t3tk33as .marker.cross{stroke:lightgrey;}#mermaid-9u0t3tk33as svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-9u0t3tk33as p{margin:0;}#mermaid-9u0t3tk33as .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-9u0t3tk33as .cluster-label text{fill:#F9FFFE;}#mermaid-9u0t3tk33as .cluster-label span{color:#F9FFFE;}#mermaid-9u0t3tk33as .cluster-label span p{background-color:transparent;}#mermaid-9u0t3tk33as .label text,#mermaid-9u0t3tk33as span{fill:#ccc;color:#ccc;}#mermaid-9u0t3tk33as .node rect,#mermaid-9u0t3tk33as .node circle,#mermaid-9u0t3tk33as .node ellipse,#mermaid-9u0t3tk33as .node polygon,#mermaid-9u0t3tk33as .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-9u0t3tk33as .rough-node .label text,#mermaid-9u0t3tk33as .node .label text,#mermaid-9u0t3tk33as .image-shape .label,#mermaid-9u0t3tk33as .icon-shape .label{text-anchor:middle;}#mermaid-9u0t3tk33as .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-9u0t3tk33as .rough-node .label,#mermaid-9u0t3tk33as .node .label,#mermaid-9u0t3tk33as .image-shape .label,#mermaid-9u0t3tk33as .icon-shape .label{text-align:center;}#mermaid-9u0t3tk33as .node.clickable{cursor:pointer;}#mermaid-9u0t3tk33as .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-9u0t3tk33as .arrowheadPath{fill:lightgrey;}#mermaid-9u0t3tk33as .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-9u0t3tk33as .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-9u0t3tk33as .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-9u0t3tk33as .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-9u0t3tk33as .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-9u0t3tk33as .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-9u0t3tk33as .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-9u0t3tk33as .cluster text{fill:#F9FFFE;}#mermaid-9u0t3tk33as .cluster span{color:#F9FFFE;}#mermaid-9u0t3tk33as div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-9u0t3tk33as .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-9u0t3tk33as rect.text{fill:none;stroke-width:0;}#mermaid-9u0t3tk33as .icon-shape,#mermaid-9u0t3tk33as .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-9u0t3tk33as .icon-shape p,#mermaid-9u0t3tk33as .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-9u0t3tk33as .icon-shape rect,#mermaid-9u0t3tk33as .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-9u0t3tk33as .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-9u0t3tk33as .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-9u0t3tk33as :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Event/Function Interfaces

Smart Contract Layer

emits

subscribed by

calls

received by

implements

records to

emits

triggers

MockOracle setPrice(uint256)

AegisSentinel react() onNewFeedback()

AegisHook beforeSwap() setPanicMode(bool) boostReputation(address)

AegisGuardianRegistry mint() recordAction() getReputation()

event PriceUpdate(uint256)

function setPanicMode(bool)

function beforeSwap()

event NewFeedback(address)

Diagram 2: Code Entity Interaction Map

This diagram bridges natural language descriptions to actual code entities. Each node represents a contract name, function signature, or event signature that can be searched in the codebase. The solid arrows represent the critical path for circuit breaker activation, while dashed arrows show the reputation feedback loop.

Sources: [src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol)[src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol)[src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol)[src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol)

---

## Operational FlowLink copied!

### Normal Operation vs. Crisis ResponseLink copied!

The system operates in two distinct states, controlled by the `panicMode` boolean flag in [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol):

Normal State (`panicMode = false`):

1. Traders call `swap()` on Uniswap v4 `PoolManager`
2. `PoolManager` invokes `AegisHook.beforeSwap()`
3. Hook checks `panicMode == false`, returns execution to pool
4. Swap executes normally with standard fees

Crisis State (`panicMode = true`):

1. `MockOracle` price drops below `PANIC_THRESHOLD`
2. `AegisSentinel.react()` detects crash condition
3. Sentinel sends cross-chain call: `AegisHook.setPanicMode(true)`
4. All subsequent `beforeSwap()` calls revert with `PoolPaused()` error
5. Swaps are blocked until price stabilizes

Sources: [contracts/README.md#32-37](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L32-L37)

---

### Complete Crisis LifecycleLink copied!

"User/Bot""AegisHook (Unichain)""AegisSentinel (Reactive)""MockOracle (Sepolia)""Market Event""User/Bot""AegisHook (Unichain)""AegisSentinel (Reactive)""MockOracle (Sepolia)""Market Event"#mermaid-7vz1cx3fdlb{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-7vz1cx3fdlb .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-7vz1cx3fdlb .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-7vz1cx3fdlb .error-icon{fill:#a44141;}#mermaid-7vz1cx3fdlb .error-text{fill:#ddd;stroke:#ddd;}#mermaid-7vz1cx3fdlb .edge-thickness-normal{stroke-width:1px;}#mermaid-7vz1cx3fdlb .edge-thickness-thick{stroke-width:3.5px;}#mermaid-7vz1cx3fdlb .edge-pattern-solid{stroke-dasharray:0;}#mermaid-7vz1cx3fdlb .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-7vz1cx3fdlb .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-7vz1cx3fdlb .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-7vz1cx3fdlb .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-7vz1cx3fdlb .marker.cross{stroke:lightgrey;}#mermaid-7vz1cx3fdlb svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-7vz1cx3fdlb p{margin:0;}#mermaid-7vz1cx3fdlb .actor{stroke:#ccc;fill:#1f2020;}#mermaid-7vz1cx3fdlb text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-7vz1cx3fdlb .actor-line{stroke:#ccc;}#mermaid-7vz1cx3fdlb .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-7vz1cx3fdlb .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-7vz1cx3fdlb .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-7vz1cx3fdlb #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-7vz1cx3fdlb .sequenceNumber{fill:black;}#mermaid-7vz1cx3fdlb #sequencenumber{fill:lightgrey;}#mermaid-7vz1cx3fdlb #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-7vz1cx3fdlb .messageText{fill:lightgrey;stroke:none;}#mermaid-7vz1cx3fdlb .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-7vz1cx3fdlb .labelText,#mermaid-7vz1cx3fdlb .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-7vz1cx3fdlb .loopText,#mermaid-7vz1cx3fdlb .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-7vz1cx3fdlb .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-7vz1cx3fdlb .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-7vz1cx3fdlb .noteText,#mermaid-7vz1cx3fdlb .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-7vz1cx3fdlb .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-7vz1cx3fdlb .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-7vz1cx3fdlb .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-7vz1cx3fdlb .actorPopupMenu{position:absolute;}#mermaid-7vz1cx3fdlb .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-7vz1cx3fdlb .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-7vz1cx3fdlb .actor-man circle,#mermaid-7vz1cx3fdlb line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-7vz1cx3fdlb :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}Phase 1: Normal OperationPhase 2: Crash DetectionCRASH DETECTEDPhase 3: Protection ActivatedPhase 4: RecoveryPrice = $2000emit PriceUpdate(2000)2000 > PANIC_THRESHOLDswap()panicMode == falseSwap executedPrice = $1000 (-50%)emit PriceUpdate(1000)1000 < PANIC_THRESHOLDsetPanicMode(true)panicMode = trueswap()Check panicMode == truerevert PoolPaused()Price = $1800emit PriceUpdate(1800)1800 > PANIC_THRESHOLDsetPanicMode(false)swap()Swap executed

Diagram 3: Crisis Lifecycle Sequence

This sequence diagram illustrates the complete operational flow from crash detection to recovery. Note that no human intervention occurs—the system is fully autonomous after deployment.

Sources: [README.md#55-76](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L55-L76)

---

## Key FeaturesLink copied!

### 1. Autonomous OperationLink copied!

Unlike traditional circuit breakers requiring manual intervention, Aegis operates entirely on-chain through event-driven execution. The `AegisSentinel` contract on Reactive Network acts as an autonomous agent:

- Subscribes to `PriceUpdate` events from [src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol) on L1
- Evaluates crash conditions via internal threshold logic
- Triggers cross-chain callbacks to [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol) on L2 without external relayers

Sources: [README.md#19-22](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L19-L22)[contracts/README.md#39-44](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L39-L44)

---

### 2. Guardian Reputation System (ERC-8004)Link copied!

The `AegisGuardianRegistry` implements the ERC-8004 Trustless Agents standard alongside ERC-721 for unique identity:

FeatureImplementationPurposeNFT Identity`mint()` creates unique guardian profileEstablishes persistent on-chain identityIntervention Tracking`recordAction()` logs stabilization eventsImmutable history of heroic actionsVIP AccessGuardians with rep > 90 pay 0.01% feesIncentivizes liquidity during crisesAuto-SyncSentinel listens to `NewFeedback` eventsCross-chain reputation propagation

Sources: [README.md#24-33](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L24-L33)[contracts/README.md#52-57](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L52-L57)

---

### 3. Speed Advantage: FlashblocksLink copied!

Unichain's 250ms block times provide a critical temporal advantage:

Traditional L2 (2-second blocks):

- T+0ms: L1 price crashes
- T+500ms: Bots detect arbitrage opportunity
- T+1000ms: Bot transaction confirms, extracts value
- T+2000ms: Circuit breaker activates (too late)

Unichain with Aegis:

- T+0ms: L1 price crashes
- T+250ms: `AegisSentinel.react()` confirms on Reactive Network
- T+500ms: `AegisHook.setPanicMode(true)` confirms on Unichain
- T+750ms: Bot transaction arrives, reverts

The system "front-runs the front-runners" by activating protection before arbitrage bots can exploit stale prices.

Sources: [README.md#49-51](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L49-L51)

---

## Deployed AddressesLink copied!

The current testnet deployment spans three networks:

ContractNetworkAddressChain IDMockOracleEthereum Sepolia`0x1392C38921A818cEdb100cC3767e8f30deC3a7D8`11155111AegisSentinelReactive Lasna`0x0B6ae13119Fc3b61d6ABb115342A1A075e14b6B6`5318007AegisHookUnichain Sepolia`0x1E2aE114cF3B63779A1367eD704ccA51a0218080`1301

For complete deployment procedures, see [Deployment](#5). For network configuration details, see [Network Configuration](#10.2).

Sources: [README.md#138-142](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L138-L142)[contracts/README.md#99-104](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L99-L104)

---

## Production ReadinessLink copied!

### Oracle Migration PathLink copied!

The current implementation uses `MockOracle` for demonstration purposes. Production deployment requires substituting a live Chainlink price feed:

Migration Steps:

1. Deploy `AegisSentinel` with Chainlink Oracle address instead of `MockOracle`
2. Update subscription to monitor Chainlink's `AnswerUpdated(int256,uint256,uint256)` event
3. Adapt threshold logic to match Chainlink's 8-decimal price format
4. No changes required to `AegisHook` or `AegisGuardianRegistry`

The interface-agnostic design ensures zero code changes beyond address configuration.

Sources: [contracts/README.md#59-68](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L59-L68)

---

## Next StepsLink copied!

This overview establishes the foundational concepts of the Aegis system. For hands-on experience:

- [Getting Started](#1.1): Clone, build, and test the system locally
- [System Architecture](#1.2): Deep dive into cross-chain messaging protocols
- [Smart Contracts](#2): Explore individual contract implementations
- [Deployment](#5): Deploy your own instance across testnets

For conceptual background on key terms (LVR, toxic flow, circuit breaker, Flashblocks), see [Glossary](#10.3).

Sources: [README.md#104-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L104-L122)

---

# Smart-Contracts

# Smart ContractsLink copied!
Relevant source files
- [contracts/.gitignore](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitignore)
- [contracts/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md)

This page provides an overview of all smart contracts in the Aegis system and their roles within the three-chain architecture. For detailed implementation information about individual contracts, see [AegisHook](#2.1), [AegisSentinel](#2.2), [MockOracle](#2.3), and [Guardian Registry](#2.4). For deployment procedures, see [Deployment](#5).

## OverviewLink copied!

The Aegis system consists of four core smart contracts deployed across three blockchain networks. Each contract serves a specific role in the cross-chain circuit breaker mechanism that protects Uniswap v4 liquidity providers from Loss-Versus-Rebalancing (LVR) during market volatility.

Sources:[contracts/README.md#1-123](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L1-L123)

## Contract InventoryLink copied!

The following table lists all core contracts, their deployment networks, and primary functions:

Contract NameFile PathNetworkChain IDPrimary Role`MockOracle``src/MockOracle.sol`Ethereum Sepolia (L1)11155111Price feed simulation and event emission`AegisSentinel``src/AegisSentinel.sol`Reactive Network Lasna5318007Event monitoring and cross-chain control logic`AegisHook``src/AegisHook.sol`Unichain Sepolia (L2)1301Swap gating and circuit breaker enforcement`AegisGuardianRegistry``src/AegisGuardianRegistry.sol`Cross-chain (L1/L2)MultipleGuardian identity and reputation tracking

Sources:[contracts/README.md#99-103](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L99-L103)

## Contract ArchitectureLink copied!

The following diagram illustrates the contract structure and deployment topology:

Diagram: Contract Deployment and Responsibility Boundaries

#mermaid-kbdq6ptjfy{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-kbdq6ptjfy .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-kbdq6ptjfy .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-kbdq6ptjfy .error-icon{fill:#a44141;}#mermaid-kbdq6ptjfy .error-text{fill:#ddd;stroke:#ddd;}#mermaid-kbdq6ptjfy .edge-thickness-normal{stroke-width:1px;}#mermaid-kbdq6ptjfy .edge-thickness-thick{stroke-width:3.5px;}#mermaid-kbdq6ptjfy .edge-pattern-solid{stroke-dasharray:0;}#mermaid-kbdq6ptjfy .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-kbdq6ptjfy .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-kbdq6ptjfy .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-kbdq6ptjfy .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-kbdq6ptjfy .marker.cross{stroke:lightgrey;}#mermaid-kbdq6ptjfy svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-kbdq6ptjfy p{margin:0;}#mermaid-kbdq6ptjfy .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-kbdq6ptjfy .cluster-label text{fill:#F9FFFE;}#mermaid-kbdq6ptjfy .cluster-label span{color:#F9FFFE;}#mermaid-kbdq6ptjfy .cluster-label span p{background-color:transparent;}#mermaid-kbdq6ptjfy .label text,#mermaid-kbdq6ptjfy span{fill:#ccc;color:#ccc;}#mermaid-kbdq6ptjfy .node rect,#mermaid-kbdq6ptjfy .node circle,#mermaid-kbdq6ptjfy .node ellipse,#mermaid-kbdq6ptjfy .node polygon,#mermaid-kbdq6ptjfy .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-kbdq6ptjfy .rough-node .label text,#mermaid-kbdq6ptjfy .node .label text,#mermaid-kbdq6ptjfy .image-shape .label,#mermaid-kbdq6ptjfy .icon-shape .label{text-anchor:middle;}#mermaid-kbdq6ptjfy .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-kbdq6ptjfy .rough-node .label,#mermaid-kbdq6ptjfy .node .label,#mermaid-kbdq6ptjfy .image-shape .label,#mermaid-kbdq6ptjfy .icon-shape .label{text-align:center;}#mermaid-kbdq6ptjfy .node.clickable{cursor:pointer;}#mermaid-kbdq6ptjfy .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-kbdq6ptjfy .arrowheadPath{fill:lightgrey;}#mermaid-kbdq6ptjfy .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-kbdq6ptjfy .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-kbdq6ptjfy .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-kbdq6ptjfy .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-kbdq6ptjfy .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-kbdq6ptjfy .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-kbdq6ptjfy .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-kbdq6ptjfy .cluster text{fill:#F9FFFE;}#mermaid-kbdq6ptjfy .cluster span{color:#F9FFFE;}#mermaid-kbdq6ptjfy div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-kbdq6ptjfy .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-kbdq6ptjfy rect.text{fill:none;stroke-width:0;}#mermaid-kbdq6ptjfy .icon-shape,#mermaid-kbdq6ptjfy .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-kbdq6ptjfy .icon-shape p,#mermaid-kbdq6ptjfy .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-kbdq6ptjfy .icon-shape rect,#mermaid-kbdq6ptjfy .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-kbdq6ptjfy .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-kbdq6ptjfy .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-kbdq6ptjfy :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Unichain Sepolia (L2) Chain ID: 1301

Reactive Network Lasna Chain ID: 5318007

Ethereum Sepolia (L1) Chain ID: 11155111

emits PriceUpdate(price)

calls setPanicMode(bool)

writes intervention data

emits NewFeedback()

reads reputation scores

simulates Chainlink

implements BaseHook

ERC-721 + ERC-8004

ERC-721 + ERC-8004

MockOracle.sol 0x1392...a7D8

AegisGuardianRegistry.sol (L1 Instance)

AegisSentinel.sol 0x0B6a...b6B6

AegisHook.sol 0x1E2a...8080

AegisGuardianRegistry.sol (L2 Instance)

Sources:[contracts/README.md#11-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L11-L26)[contracts/README.md#99-103](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L99-L103)

## Core ContractsLink copied!

### MockOracleLink copied!

File:`src/MockOracle.sol`Network: Ethereum Sepolia (L1)Deployed Address:`0x1392C38921A818cEdb100cC3767e8f30deC3a7D8`

The `MockOracle` contract simulates a Chainlink-compatible price feed for demonstration and testing purposes. It emits standardized `PriceUpdate` events that the `AegisSentinel` monitors. The contract is designed to be interface-compatible with production Chainlink oracles, allowing seamless migration by changing only the contract address in the Sentinel configuration.

Key Functionality:

- Emits `PriceUpdate(uint256 price)` events
- Allows manual price manipulation via `setPrice()` for crash simulation
- Provides deterministic market conditions for testing

Sources:[contracts/README.md#46-50](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L46-L50)[contracts/README.md#59-68](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L59-L68)

### AegisSentinelLink copied!

File:`src/AegisSentinel.sol`Network: Reactive Network LasnaDeployed Address:`0x0B6ae13119Fc3b61d6ABb115342A1A075e14b6B6`

The `AegisSentinel` is an autonomous reactive smart contract that monitors L1 price feeds and triggers cross-chain panic mode activation. It eliminates the need for centralized keeper bots by functioning as its own execution agent. The Sentinel implements crash detection logic and manages the state synchronization between L1 and L2.

Key Functionality:

- Subscribes to `PriceUpdate` events from L1 oracles
- Evaluates price against configured `THRESHOLD` constant
- Sends cross-chain calls to L2 `AegisHook` via Reactive Network infrastructure
- Monitors `NewFeedback` events from Guardian Registry for reputation synchronization

Sources:[contracts/README.md#39-44](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L39-L44)

### AegisHookLink copied!

File:`src/AegisHook.sol`Network: Unichain Sepolia (L2)Deployed Address:`0x1E2aE114cF3B63779A1367eD704ccA51a0218080`

The `AegisHook` is a Uniswap v4 hook contract that implements the circuit breaker enforcement mechanism. It intercepts swap transactions via the `beforeSwap` callback and enforces panic mode by reverting transactions when the circuit breaker is active. The hook also implements VIP lane functionality for high-reputation Guardians.

Key Functionality:

- Implements Uniswap v4 `BaseHook` interface
- Checks `panicMode` boolean state in `beforeSwap` callback
- Reverts with custom `PoolPaused()` error during crisis
- Grants reduced fees (0.01%) to Guardians with reputation > 90
- Records intervention data for reputation updates

Sources:[contracts/README.md#32-37](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L32-L37)

### AegisGuardianRegistryLink copied!

File:`src/AegisGuardianRegistry.sol`Networks: Cross-chain deployment on both L1 and L2

The `AegisGuardianRegistry` implements both ERC-721 (for unique Guardian identity NFTs) and ERC-8004 (for trustless agent reputation tracking). It maintains immutable records of "Heroic Interventions" and enables cross-chain reputation synchronization via event emission.

Key Functionality:

- Mints unique Guardian NFT profiles (ERC-721)
- Tracks `totalStabilizedVolume` and `responseLatency` metrics
- Emits `NewFeedback` events consumed by `AegisSentinel`
- Enables automatic reputation promotion on L2 via cross-chain sync

Sources:[contracts/README.md#52-57](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L52-L57)

## Contract Interaction FlowLink copied!

The following diagram maps the operational flow to specific contract functions and events:

Diagram: Function-Level Interaction Sequence

AegisGuardianRegistry.sol (L2)PoolManager (Uniswap v4)AegisHook.sol (Unichain L2)AegisSentinel.sol (Reactive Network)MockOracle.sol (Sepolia L1)AegisGuardianRegistry.sol (L2)PoolManager (Uniswap v4)AegisHook.sol (Unichain L2)AegisSentinel.sol (Reactive Network)MockOracle.sol (Sepolia L1)#mermaid-dlajwnjym7p{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-dlajwnjym7p .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-dlajwnjym7p .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-dlajwnjym7p .error-icon{fill:#a44141;}#mermaid-dlajwnjym7p .error-text{fill:#ddd;stroke:#ddd;}#mermaid-dlajwnjym7p .edge-thickness-normal{stroke-width:1px;}#mermaid-dlajwnjym7p .edge-thickness-thick{stroke-width:3.5px;}#mermaid-dlajwnjym7p .edge-pattern-solid{stroke-dasharray:0;}#mermaid-dlajwnjym7p .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-dlajwnjym7p .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-dlajwnjym7p .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-dlajwnjym7p .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-dlajwnjym7p .marker.cross{stroke:lightgrey;}#mermaid-dlajwnjym7p svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-dlajwnjym7p p{margin:0;}#mermaid-dlajwnjym7p .actor{stroke:#ccc;fill:#1f2020;}#mermaid-dlajwnjym7p text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-dlajwnjym7p .actor-line{stroke:#ccc;}#mermaid-dlajwnjym7p .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-dlajwnjym7p .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-dlajwnjym7p .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-dlajwnjym7p #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-dlajwnjym7p .sequenceNumber{fill:black;}#mermaid-dlajwnjym7p #sequencenumber{fill:lightgrey;}#mermaid-dlajwnjym7p #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-dlajwnjym7p .messageText{fill:lightgrey;stroke:none;}#mermaid-dlajwnjym7p .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-dlajwnjym7p .labelText,#mermaid-dlajwnjym7p .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-dlajwnjym7p .loopText,#mermaid-dlajwnjym7p .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-dlajwnjym7p .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-dlajwnjym7p .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-dlajwnjym7p .noteText,#mermaid-dlajwnjym7p .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-dlajwnjym7p .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-dlajwnjym7p .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-dlajwnjym7p .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-dlajwnjym7p .actorPopupMenu{position:absolute;}#mermaid-dlajwnjym7p .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-dlajwnjym7p .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-dlajwnjym7p .actor-man circle,#mermaid-dlajwnjym7p line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-dlajwnjym7p :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}Crisis Detection PhaseSwap Interception PhaseRecovery PhaseReputation Update Phaseemit PriceUpdate(1000)react() callback triggeredcheck: price < THRESHOLDsetPanicMode(true)panicMode = truebeforeSwap() hook callbackrequire(!panicMode)revert PoolPaused()emit PriceUpdate(1800)react() callback triggeredcheck: price >= THRESHOLDsetPanicMode(false)panicMode = falsebeforeSwap() hook callbackreturn (success)recordIntervention()update totalStabilizedVolumeemit NewFeedback()boostReputation()

Sources:[contracts/README.md#11-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L11-L26)[contracts/README.md#88-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L88-L94)

## Contract File StructureLink copied!

The contracts are organized in a standard Foundry project structure:

```
contracts/
├── src/
│   ├── AegisHook.sol              # Uniswap v4 hook implementation
│   ├── AegisSentinel.sol          # Reactive Network listener
│   ├── MockOracle.sol             # Price feed simulator
│   └── AegisGuardianRegistry.sol  # ERC-721 + ERC-8004 registry
├── script/
│   ├── 04_DeployOracle.s.sol      # Oracle deployment script
│   ├── 05_DeploySentinel.s.sol    # Sentinel deployment script
│   └── 06_DeployHook.s.sol        # Hook deployment script
├── test/
│   └── *.t.sol                    # Foundry test suites
├── lib/
│   ├── forge-std/                 # Foundry standard library
│   ├── uniswap-hooks/             # Uniswap v4 dependencies
│   └── system-smart-contracts/    # Reactive Network SDK
├── foundry.toml                   # Foundry configuration
└── README.md                      # Contract documentation
```

Sources:[contracts/README.md#1-123](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L1-L123)[contracts/.gitignore#1-15](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitignore#L1-L15)

## Deployed Contract AddressesLink copied!

The following table provides the verified deployment addresses across all three networks:

ContractNetworkAddressDeployment Script`MockOracle`Sepolia L1`0x1392C38921A818cEdb100cC3767e8f30deC3a7D8``script/04_DeployOracle.s.sol``AegisSentinel`Reactive Lasna`0x0B6ae13119Fc3b61d6ABb115342A1A075e14b6B6``script/05_DeploySentinel.s.sol``AegisHook`Unichain Sepolia`0x1E2aE114cF3B63779A1367eD704ccA51a0218080``script/06_DeployHook.s.sol`

For detailed deployment procedures and verification steps, see [Deployment](#5).

Sources:[contracts/README.md#99-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L99-L122)

## Contract Standards and InterfacesLink copied!

The Aegis contracts implement and integrate with the following standards:

Standard/InterfaceImplementing ContractPurposeUniswap v4 `BaseHook``AegisHook`Swap lifecycle interceptionReactive Network `IReactive``AegisSentinel`Event subscription and reactionERC-721 (Non-Fungible Token)`AegisGuardianRegistry`Unique Guardian identityERC-8004 (Trustless Agents)`AegisGuardianRegistry`Immutable feedback recordsChainlink `PriceUpdate` event`MockOracle`Price feed compatibility

The `MockOracle` is designed to be interface-compatible with Chainlink oracles, enabling production migration by updating the oracle address in `AegisSentinel` without modifying the contract logic.

Sources:[contracts/README.md#32-57](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L32-L57)[contracts/README.md#59-68](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L59-L68)

## Build and CompilationLink copied!

All contracts are built using the Foundry toolchain:

```
forge build
```

Compilation artifacts are generated in the `out/` directory and excluded from version control via `.gitignore`. The build process compiles all contracts in the `src/` directory and resolves dependencies from the `lib/` submodules.

For detailed build instructions and testing procedures, see [Building and Testing](#4.2).

Sources:[contracts/README.md#75-77](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L75-L77)[contracts/.gitignore#1-3](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitignore#L1-L3)

## Access Control and SecurityLink copied!

The following table summarizes the access control mechanisms in each contract:

ContractProtected FunctionAccess RestrictionMechanism`AegisHook``setPanicMode()`Only `AegisSentinel`Address check`AegisHook``boostReputation()`Only `AegisSentinel`Address check`MockOracle``setPrice()`Owner/AdminOwnable pattern`AegisSentinel`Cross-chain callsOnly Reactive NetworkSystem contract

The `AegisHook` validates that panic mode state changes originate from the authorized `AegisSentinel` address, preventing unauthorized circuit breaker activation.

Sources:[contracts/README.md#88-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L88-L94)

## Testing VerificationLink copied!

The contracts have been validated through comprehensive integration tests covering the following scenarios:

Test CaseContract Under TestVerification MethodOracle Update`MockOracle`Price change emissionAccess Control`AegisHook`Unauthorized call rejectionPanic Trigger`AegisSentinel` → `AegisHook`Cross-chain state syncCircuit Breaker`AegisHook`Swap reversion during panic

All tests are executed using Foundry's test framework:

```
forge test --match-contract AegisIntegrationTest -vv
```

For complete testing documentation, see [Testing and CI/CD](#6).

Sources:[contracts/README.md#80-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L80-L94)

---

# Cross-Chain-Infrastructure

# Cross-Chain InfrastructureLink copied!
Relevant source files
- [README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md)
- [contracts/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md)

## Purpose and ScopeLink copied!

This document describes the cross-chain architecture that enables Aegis to coordinate security operations across three blockchain networks. It covers the overall network topology, contract distribution strategy, and communication patterns between chains.

For details on how the Reactive Network specifically enables autonomous monitoring, see [Reactive Network Integration](#3.1). For the technical implementation of cross-chain message passing, see [Cross-Chain Messaging](#3.2). For the fallback relay mechanism, see [Hybrid Relayer](#3.3).

---

## Three-Chain ArchitectureLink copied!

Aegis operates across three distinct blockchain networks, each serving a specialized role in the security system:

ChainNetwork NameChain IDRoleKey ContractL1Ethereum Sepolia`11155111`Data Source`MockOracle`MiddlewareReactive Network Lasna`5318007`Control Logic`AegisSentinel`L2Unichain Sepolia`1301`Enforcement Point`AegisHook`

### Architecture RationaleLink copied!

The three-chain design solves the "Inversion of Control" problem in cross-chain DeFi security:

1. L1 (Ethereum Sepolia): Hosts the price oracle because Ethereum mainnet has the most reliable price feeds (Chainlink) and highest security guarantees. The `MockOracle` simulates this for demonstration purposes.
2. Reactive Network: Provides autonomous, event-driven execution without requiring centralized bots or keeper infrastructure. The `AegisSentinel` contract runs persistently, monitoring L1 events and triggering L2 actions.
3. L2 (Unichain): The enforcement layer where actual trading occurs. Unichain's Flashblocks (250ms block times) enable the `AegisHook` to respond faster than arbitrage bots, creating a temporal moat for LP protection.

Sources: [README.md#36-52](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L36-L52)[contracts/README.md#8-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L8-L26)

---

### Deployment Topology DiagramLink copied!

#mermaid-ip8brpxrrk{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-ip8brpxrrk .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-ip8brpxrrk .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-ip8brpxrrk .error-icon{fill:#a44141;}#mermaid-ip8brpxrrk .error-text{fill:#ddd;stroke:#ddd;}#mermaid-ip8brpxrrk .edge-thickness-normal{stroke-width:1px;}#mermaid-ip8brpxrrk .edge-thickness-thick{stroke-width:3.5px;}#mermaid-ip8brpxrrk .edge-pattern-solid{stroke-dasharray:0;}#mermaid-ip8brpxrrk .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-ip8brpxrrk .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-ip8brpxrrk .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-ip8brpxrrk .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-ip8brpxrrk .marker.cross{stroke:lightgrey;}#mermaid-ip8brpxrrk svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-ip8brpxrrk p{margin:0;}#mermaid-ip8brpxrrk .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-ip8brpxrrk .cluster-label text{fill:#F9FFFE;}#mermaid-ip8brpxrrk .cluster-label span{color:#F9FFFE;}#mermaid-ip8brpxrrk .cluster-label span p{background-color:transparent;}#mermaid-ip8brpxrrk .label text,#mermaid-ip8brpxrrk span{fill:#ccc;color:#ccc;}#mermaid-ip8brpxrrk .node rect,#mermaid-ip8brpxrrk .node circle,#mermaid-ip8brpxrrk .node ellipse,#mermaid-ip8brpxrrk .node polygon,#mermaid-ip8brpxrrk .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-ip8brpxrrk .rough-node .label text,#mermaid-ip8brpxrrk .node .label text,#mermaid-ip8brpxrrk .image-shape .label,#mermaid-ip8brpxrrk .icon-shape .label{text-anchor:middle;}#mermaid-ip8brpxrrk .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-ip8brpxrrk .rough-node .label,#mermaid-ip8brpxrrk .node .label,#mermaid-ip8brpxrrk .image-shape .label,#mermaid-ip8brpxrrk .icon-shape .label{text-align:center;}#mermaid-ip8brpxrrk .node.clickable{cursor:pointer;}#mermaid-ip8brpxrrk .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-ip8brpxrrk .arrowheadPath{fill:lightgrey;}#mermaid-ip8brpxrrk .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-ip8brpxrrk .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-ip8brpxrrk .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-ip8brpxrrk .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-ip8brpxrrk .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-ip8brpxrrk .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-ip8brpxrrk .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-ip8brpxrrk .cluster text{fill:#F9FFFE;}#mermaid-ip8brpxrrk .cluster span{color:#F9FFFE;}#mermaid-ip8brpxrrk div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-ip8brpxrrk .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-ip8brpxrrk rect.text{fill:none;stroke-width:0;}#mermaid-ip8brpxrrk .icon-shape,#mermaid-ip8brpxrrk .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-ip8brpxrrk .icon-shape p,#mermaid-ip8brpxrrk .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-ip8brpxrrk .icon-shape rect,#mermaid-ip8brpxrrk .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-ip8brpxrrk .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-ip8brpxrrk .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-ip8brpxrrk :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Unichain Sepolia (Chain ID: 1301)

Reactive Network Lasna (Chain ID: 5318007)

Ethereum Sepolia (Chain ID: 11155111)

emit PriceUpdate(price)

setPanicMode(bool)

beforeSwap() callback

recordIntervention()

emit NewFeedback()

boostReputation()

MockOracle 0x1392C38921A818cEdb100cC3767e8f30deC3a7D8

AegisGuardianRegistry (ERC-721 + ERC-8004)

AegisSentinel 0x0B6ae13119Fc3b61d6ABb115342A1A075e14b6B6 (AbstractReactive)

AegisHook 0x1E2aE114cF3B63779A1367eD704ccA51a0218080 (BaseHook)

Uniswap v4 PoolManager

Diagram: Contract Deployment Across Three Chains

This diagram maps the physical deployment of contracts to their respective blockchains. Each contract address is the actual deployed instance on the corresponding testnet.

Sources: [README.md#138-142](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L138-L142)[contracts/README.md#99-103](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L99-L103)

---

## Network ConfigurationLink copied!

### RPC EndpointsLink copied!

The system uses the following RPC endpoints for cross-chain communication:

```
Ethereum Sepolia:
  RPC: https://eth-sepolia.g.alchemy.com/v2/{API_KEY}
  Explorer: https://sepolia.etherscan.io
  
Reactive Network Lasna:
  RPC: https://kopli-rpc.rkt.ink
  Explorer: https://kopli.reactive.network
  Note: Requires --legacy flag for transactions
  
Unichain Sepolia:
  RPC: https://sepolia.unichain.org
  Explorer: https://unichain-sepolia.blockscout.com
```

These endpoints are configured in the Foundry deployment scripts located at [script/04_DeployOracle.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/04_DeployOracle.s.sol)[script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol) and [script/06_DeployHook.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/06_DeployHook.s.sol)

Sources: [contracts/README.md#105-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L105-L122)

---

## Cross-Chain Data FlowLink copied!

The following sequence diagram illustrates the complete cross-chain message flow from price update detection to pool protection:

"External Trader""Uniswap v4 Pool""AegisHook (Unichain L2)""AegisSentinel (Reactive Network)""MockOracle (Sepolia L1)""External Trader""Uniswap v4 Pool""AegisHook (Unichain L2)""AegisSentinel (Reactive Network)""MockOracle (Sepolia L1)"#mermaid-7ya1v6mogz9{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-7ya1v6mogz9 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-7ya1v6mogz9 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-7ya1v6mogz9 .error-icon{fill:#a44141;}#mermaid-7ya1v6mogz9 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-7ya1v6mogz9 .edge-thickness-normal{stroke-width:1px;}#mermaid-7ya1v6mogz9 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-7ya1v6mogz9 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-7ya1v6mogz9 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-7ya1v6mogz9 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-7ya1v6mogz9 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-7ya1v6mogz9 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-7ya1v6mogz9 .marker.cross{stroke:lightgrey;}#mermaid-7ya1v6mogz9 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-7ya1v6mogz9 p{margin:0;}#mermaid-7ya1v6mogz9 .actor{stroke:#ccc;fill:#1f2020;}#mermaid-7ya1v6mogz9 text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-7ya1v6mogz9 .actor-line{stroke:#ccc;}#mermaid-7ya1v6mogz9 .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-7ya1v6mogz9 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-7ya1v6mogz9 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-7ya1v6mogz9 #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-7ya1v6mogz9 .sequenceNumber{fill:black;}#mermaid-7ya1v6mogz9 #sequencenumber{fill:lightgrey;}#mermaid-7ya1v6mogz9 #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-7ya1v6mogz9 .messageText{fill:lightgrey;stroke:none;}#mermaid-7ya1v6mogz9 .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-7ya1v6mogz9 .labelText,#mermaid-7ya1v6mogz9 .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-7ya1v6mogz9 .loopText,#mermaid-7ya1v6mogz9 .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-7ya1v6mogz9 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-7ya1v6mogz9 .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-7ya1v6mogz9 .noteText,#mermaid-7ya1v6mogz9 .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-7ya1v6mogz9 .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-7ya1v6mogz9 .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-7ya1v6mogz9 .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-7ya1v6mogz9 .actorPopupMenu{position:absolute;}#mermaid-7ya1v6mogz9 .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-7ya1v6mogz9 .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-7ya1v6mogz9 .actor-man circle,#mermaid-7ya1v6mogz9 line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-7ya1v6mogz9 :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}Normal Market State"No action taken"Market Crash Event"Crisis detected""Circuit breaker active"Market Recovery"setPrice(2000)""emit PriceUpdate(2000)""react() callback Check: 2000 > PANIC_THRESHOLD""setPrice(1000)""emit PriceUpdate(1000)""react() callback Check: 1000 < PANIC_THRESHOLD""Cross-chain call: setPanicMode(true)""panicMode = true""swap() via PoolManager""beforeSwap() checks panicMode""revert PoolPaused()""setPrice(1800)""emit PriceUpdate(1800)""react() callback Check: 1800 > PANIC_THRESHOLD""Cross-chain call: setPanicMode(false)""panicMode = false""swap() via PoolManager""Execute swap""Swap successful"

Diagram: Cross-Chain Crisis Response Sequence

This diagram shows the actual function calls and state changes that occur during a market crisis. The `react()` callback in `AegisSentinel` is automatically invoked by the Reactive Network when subscribed events are emitted.

Sources: [README.md#56-75](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L56-L75)[contracts/README.md#12-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L12-L26)

---

## Contract Communication PatternsLink copied!

### Event-Driven ArchitectureLink copied!

The Aegis system uses an event-driven architecture where contracts do not directly call each other across chains. Instead, contracts emit events that are monitored and acted upon:

Event NameSource ContractSource ChainListener ContractListener ChainTriggered Action`PriceUpdate(uint256)``MockOracle`Sepolia L1`AegisSentinel`Reactive`react()` invoked`NewFeedback(...)``GuardianRegistry`Sepolia L1`AegisSentinel`Reactive`react()` invoked

The `AegisSentinel` subscribes to these events using the Reactive Network's `subscribe()` function, which registers the contract as a listener for specific event signatures on specific chains.

### Cross-Chain Call MechanismLink copied!

When the `AegisSentinel` needs to trigger an action on Unichain, it uses the Reactive Network's `emit()` function:

```
emit(
    UNICHAIN_CHAIN_ID,      // Destination chain (1301)
    AEGIS_HOOK_ADDRESS,     // Target contract
    PANIC_THRESHOLD,        // Value (usually 0)
    abi.encodeWithSignature("setPanicMode(bool)", true)  // Calldata
)
```

This mechanism is implemented in [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) and abstracts the complexity of cross-chain message passing.

Sources: [README.md#19-22](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L19-L22)[README.md#77-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L77-L84)[contracts/README.md#39-44](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L39-L44)

---

## Deployment VerificationLink copied!

After deploying contracts across all three chains, the system's connectivity can be verified by checking:

1. Subscription Status: Query the Reactive Network to confirm `AegisSentinel` is subscribed to `MockOracle` events
2. Authorization: Verify that `AegisHook` recognizes `AegisSentinel` as an authorized caller
3. Event Emission: Trigger a test `PriceUpdate` event and observe cross-chain propagation

The deployment scripts automatically log contract addresses to JSON files:

- [broadcast/04_DeployOracle.s.sol/11155111/run-latest.json](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json)
- [broadcast/05_DeploySentinel.s.sol/5318007/run-latest.json](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/05_DeploySentinel.s.sol/5318007/run-latest.json)
- [broadcast/06_DeployHook.s.sol/1301/run-latest.json](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/06_DeployHook.s.sol/1301/run-latest.json)

These logs contain transaction hashes, deployed addresses, and gas costs for audit purposes.

Sources: [contracts/README.md#105-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L105-L122)

---

## Architectural Constraints and Trade-offsLink copied!

### Testnet StabilityLink copied!

The README notes that "public testnet relayers for Unichain Sepolia (Chain ID 1301) were not fully stable during the hackathon" [README.md#81-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L83) This constraint led to the development of the Hybrid Relayer (see [Hybrid Relayer](#3.3)) as a fallback mechanism.

### Block Time AsymmetryLink copied!

The three chains have different block times:

- Ethereum Sepolia: ~12 seconds
- Reactive Network: ~1 second
- Unichain: 250ms (Flashblocks)

This asymmetry creates a temporal hierarchy where the system's response speed is ultimately limited by Ethereum's 12-second block time for price updates. However, once a price update is confirmed on L1, the Reactive Network can propagate the panic signal to Unichain within ~1-2 seconds total latency.

### Interface AgnosticismLink copied!

The system is designed for production migration. The `AegisSentinel` listens for a generic `PriceUpdate(uint256)` event signature, which matches both the `MockOracle` and standard Chainlink oracle interfaces. Migrating to mainnet requires only updating the subscribed contract address in the Sentinel's configuration—no code changes are needed.

Sources: [README.md#49-51](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L49-L51)[contracts/README.md#59-68](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L59-L68)

---

## System Diagram: Natural Language to Code MappingLink copied!

#mermaid-gvedt1dlvq{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-gvedt1dlvq .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-gvedt1dlvq .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-gvedt1dlvq .error-icon{fill:#a44141;}#mermaid-gvedt1dlvq .error-text{fill:#ddd;stroke:#ddd;}#mermaid-gvedt1dlvq .edge-thickness-normal{stroke-width:1px;}#mermaid-gvedt1dlvq .edge-thickness-thick{stroke-width:3.5px;}#mermaid-gvedt1dlvq .edge-pattern-solid{stroke-dasharray:0;}#mermaid-gvedt1dlvq .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-gvedt1dlvq .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-gvedt1dlvq .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-gvedt1dlvq .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-gvedt1dlvq .marker.cross{stroke:lightgrey;}#mermaid-gvedt1dlvq svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-gvedt1dlvq p{margin:0;}#mermaid-gvedt1dlvq .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-gvedt1dlvq .cluster-label text{fill:#F9FFFE;}#mermaid-gvedt1dlvq .cluster-label span{color:#F9FFFE;}#mermaid-gvedt1dlvq .cluster-label span p{background-color:transparent;}#mermaid-gvedt1dlvq .label text,#mermaid-gvedt1dlvq span{fill:#ccc;color:#ccc;}#mermaid-gvedt1dlvq .node rect,#mermaid-gvedt1dlvq .node circle,#mermaid-gvedt1dlvq .node ellipse,#mermaid-gvedt1dlvq .node polygon,#mermaid-gvedt1dlvq .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-gvedt1dlvq .rough-node .label text,#mermaid-gvedt1dlvq .node .label text,#mermaid-gvedt1dlvq .image-shape .label,#mermaid-gvedt1dlvq .icon-shape .label{text-anchor:middle;}#mermaid-gvedt1dlvq .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-gvedt1dlvq .rough-node .label,#mermaid-gvedt1dlvq .node .label,#mermaid-gvedt1dlvq .image-shape .label,#mermaid-gvedt1dlvq .icon-shape .label{text-align:center;}#mermaid-gvedt1dlvq .node.clickable{cursor:pointer;}#mermaid-gvedt1dlvq .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-gvedt1dlvq .arrowheadPath{fill:lightgrey;}#mermaid-gvedt1dlvq .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-gvedt1dlvq .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-gvedt1dlvq .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-gvedt1dlvq .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-gvedt1dlvq .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-gvedt1dlvq .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-gvedt1dlvq .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-gvedt1dlvq .cluster text{fill:#F9FFFE;}#mermaid-gvedt1dlvq .cluster span{color:#F9FFFE;}#mermaid-gvedt1dlvq div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-gvedt1dlvq .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-gvedt1dlvq rect.text{fill:none;stroke-width:0;}#mermaid-gvedt1dlvq .icon-shape,#mermaid-gvedt1dlvq .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-gvedt1dlvq .icon-shape p,#mermaid-gvedt1dlvq .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-gvedt1dlvq .icon-shape rect,#mermaid-gvedt1dlvq .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-gvedt1dlvq .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-gvedt1dlvq .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-gvedt1dlvq :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Deployment Scripts

Code Entities

System Concepts

deployed by

deployed by

deployed by

Chain: 11155111

Chain: 5318007

Chain: 1301

Price Data Source (Oracle)

Autonomous Control Logic (Watcher)

Trading Enforcement (Circuit Breaker)

Identity & Reputation (Guardian System)

src/MockOracle.sol setPrice(uint256) emit PriceUpdate(uint256)

src/AegisSentinel.sol react(ChainId, Event) emit(ChainId, Address, Calldata)

src/AegisHook.sol setPanicMode(bool) beforeSwap(...)

src/AegisGuardianRegistry.sol mintGuardian(address) recordIntervention(...)

script/04_DeployOracle.s.sol

script/05_DeploySentinel.s.sol

script/06_DeployHook.s.sol

Diagram: Mapping System Concepts to Code Implementation

This diagram bridges the conceptual architecture to actual Solidity files and deployment scripts. Each high-level system concept (Oracle, Watcher, Circuit Breaker) maps to a specific `.sol` file with identifiable function signatures.

Sources: [contracts/README.md#28-57](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L28-L57)[README.md#36-52](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L36-L52)

---

## SummaryLink copied!

The Aegis cross-chain infrastructure achieves autonomous security coordination through:

1. Separation of Concerns: Each chain handles a distinct aspect (data, logic, enforcement)
2. Event-Driven Coordination: Contracts communicate via events and subscriptions, not direct calls
3. Speed Hierarchy: Unichain's sub-second blocks enable faster-than-bot response times
4. Production-Ready Interfaces: The `MockOracle` can be replaced with Chainlink without code changes

This architecture eliminates the need for centralized keeper bots while maintaining sub-second response times during market crises.

Sources: [README.md#1-52](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L1-L52)[contracts/README.md#1-123](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L1-L123)

---

# Reactive-Network-Integration

# Reactive Network IntegrationLink copied!
Relevant source files
- [README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md)
- [contracts/.gitmodules](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules)
- [contracts/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md)

## Purpose and ScopeLink copied!

This document explains how Aegis leverages Reactive Network to implement autonomous cross-chain monitoring and control. The AegisSentinel contract operates as a reactive smart contract that monitors L1 events and triggers L2 actions without requiring centralized bots or keeper infrastructure.

For information about the specific messages sent between chains, see [Cross-Chain Messaging](#3.2). For details about the hybrid relayer fallback system, see [Hybrid Relayer](#3.3). For the complete system architecture, see [System Architecture](#1.2).

---

## What is Reactive Network?Link copied!

Reactive Network is a blockchain middleware layer designed to enable smart contracts to autonomously respond to events across multiple chains. Unlike traditional architectures that require off-chain bots to monitor events and submit transactions, Reactive Network inverts this control by making contracts themselves event-driven.

### Key CapabilitiesLink copied!

CapabilityTraditional ArchitectureReactive NetworkEvent MonitoringOff-chain bot with RPC pollingOn-chain subscription built into contractCross-Chain CallsBot signs and submits transactionsContract directly emits cross-chain messagesInfrastructureRequires server, wallet management, gas managementFully decentralized, no external infrastructureReliabilitySingle point of failure (bot downtime)Network-level redundancy with relayer nodes

In Aegis, this eliminates the need for a centralized keeper to watch the MockOracle on Sepolia and trigger the AegisHook on Unichain. The AegisSentinel contract itself performs these operations autonomously.

Sources:[README.md#1-149](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L1-L149)[contracts/README.md#1-123](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L1-L123)

---

## Reactive Smart Contract PatternLink copied!

### The AbstractReactive Base ClassLink copied!

Reactive smart contracts inherit from `AbstractReactive`, which is provided by the `system-smart-contracts` library. This base class implements the `IReactive` interface and provides the core reactive functionality.

#mermaid-8zoqdy7t3ke{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-8zoqdy7t3ke .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-8zoqdy7t3ke .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-8zoqdy7t3ke .error-icon{fill:#a44141;}#mermaid-8zoqdy7t3ke .error-text{fill:#ddd;stroke:#ddd;}#mermaid-8zoqdy7t3ke .edge-thickness-normal{stroke-width:1px;}#mermaid-8zoqdy7t3ke .edge-thickness-thick{stroke-width:3.5px;}#mermaid-8zoqdy7t3ke .edge-pattern-solid{stroke-dasharray:0;}#mermaid-8zoqdy7t3ke .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-8zoqdy7t3ke .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-8zoqdy7t3ke .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-8zoqdy7t3ke .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-8zoqdy7t3ke .marker.cross{stroke:lightgrey;}#mermaid-8zoqdy7t3ke svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-8zoqdy7t3ke p{margin:0;}#mermaid-8zoqdy7t3ke .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-8zoqdy7t3ke .cluster-label text{fill:#F9FFFE;}#mermaid-8zoqdy7t3ke .cluster-label span{color:#F9FFFE;}#mermaid-8zoqdy7t3ke .cluster-label span p{background-color:transparent;}#mermaid-8zoqdy7t3ke .label text,#mermaid-8zoqdy7t3ke span{fill:#ccc;color:#ccc;}#mermaid-8zoqdy7t3ke .node rect,#mermaid-8zoqdy7t3ke .node circle,#mermaid-8zoqdy7t3ke .node ellipse,#mermaid-8zoqdy7t3ke .node polygon,#mermaid-8zoqdy7t3ke .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-8zoqdy7t3ke .rough-node .label text,#mermaid-8zoqdy7t3ke .node .label text,#mermaid-8zoqdy7t3ke .image-shape .label,#mermaid-8zoqdy7t3ke .icon-shape .label{text-anchor:middle;}#mermaid-8zoqdy7t3ke .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-8zoqdy7t3ke .rough-node .label,#mermaid-8zoqdy7t3ke .node .label,#mermaid-8zoqdy7t3ke .image-shape .label,#mermaid-8zoqdy7t3ke .icon-shape .label{text-align:center;}#mermaid-8zoqdy7t3ke .node.clickable{cursor:pointer;}#mermaid-8zoqdy7t3ke .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-8zoqdy7t3ke .arrowheadPath{fill:lightgrey;}#mermaid-8zoqdy7t3ke .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-8zoqdy7t3ke .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-8zoqdy7t3ke .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-8zoqdy7t3ke .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-8zoqdy7t3ke .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-8zoqdy7t3ke .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-8zoqdy7t3ke .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-8zoqdy7t3ke .cluster text{fill:#F9FFFE;}#mermaid-8zoqdy7t3ke .cluster span{color:#F9FFFE;}#mermaid-8zoqdy7t3ke div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-8zoqdy7t3ke .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-8zoqdy7t3ke rect.text{fill:none;stroke-width:0;}#mermaid-8zoqdy7t3ke .icon-shape,#mermaid-8zoqdy7t3ke .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-8zoqdy7t3ke .icon-shape p,#mermaid-8zoqdy7t3ke .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-8zoqdy7t3ke .icon-shape rect,#mermaid-8zoqdy7t3ke .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-8zoqdy7t3ke .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-8zoqdy7t3ke .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-8zoqdy7t3ke :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Reactive Network Core

Developer Implements

implements

inherited by

calls react()

emits Callback

IReactive (Interface)

AbstractReactive (Base Implementation)

AegisSentinel (Application Logic)

Reactive Network System Service

Diagram: Reactive Contract Inheritance Hierarchy

The key method that developers implement is `react()`, which is automatically invoked by Reactive Network's system service whenever a subscribed event is detected on the origin chain.

Sources:[contracts/.gitmodules#10-12](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L10-L12)[README.md#45-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L45-L47)

---

## AegisSentinel Contract ArchitectureLink copied!

### Contract StructureLink copied!

The AegisSentinel contract is located at [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) and serves as the autonomous control center for the Aegis system.

Diagram: AegisSentinel Internal Architecture

Sources:[contracts/README.md#39-44](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L39-L44)[README.md#19-22](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L19-L22)

---

## Event Subscription MechanismLink copied!

### How Subscriptions WorkLink copied!

Reactive contracts subscribe to events from origin chains by calling the `subscribe()` function during deployment. This creates a persistent binding between the reactive contract and the event emitter.

"MockOracle (Sepolia)""Reactive System Service""AegisSentinel (Reactive Network)""Contract Deployer""MockOracle (Sepolia)""Reactive System Service""AegisSentinel (Reactive Network)""Contract Deployer"#mermaid-n84390b96me{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-n84390b96me .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-n84390b96me .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-n84390b96me .error-icon{fill:#a44141;}#mermaid-n84390b96me .error-text{fill:#ddd;stroke:#ddd;}#mermaid-n84390b96me .edge-thickness-normal{stroke-width:1px;}#mermaid-n84390b96me .edge-thickness-thick{stroke-width:3.5px;}#mermaid-n84390b96me .edge-pattern-solid{stroke-dasharray:0;}#mermaid-n84390b96me .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-n84390b96me .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-n84390b96me .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-n84390b96me .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-n84390b96me .marker.cross{stroke:lightgrey;}#mermaid-n84390b96me svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-n84390b96me p{margin:0;}#mermaid-n84390b96me .actor{stroke:#ccc;fill:#1f2020;}#mermaid-n84390b96me text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-n84390b96me .actor-line{stroke:#ccc;}#mermaid-n84390b96me .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-n84390b96me .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-n84390b96me .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-n84390b96me #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-n84390b96me .sequenceNumber{fill:black;}#mermaid-n84390b96me #sequencenumber{fill:lightgrey;}#mermaid-n84390b96me #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-n84390b96me .messageText{fill:lightgrey;stroke:none;}#mermaid-n84390b96me .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-n84390b96me .labelText,#mermaid-n84390b96me .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-n84390b96me .loopText,#mermaid-n84390b96me .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-n84390b96me .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-n84390b96me .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-n84390b96me .noteText,#mermaid-n84390b96me .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-n84390b96me .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-n84390b96me .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-n84390b96me .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-n84390b96me .actorPopupMenu{position:absolute;}#mermaid-n84390b96me .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-n84390b96me .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-n84390b96me .actor-man circle,#mermaid-n84390b96me line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-n84390b96me :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}Deployment PhaseStore subscription mappingRuntime PhaseProcess event and respond"deploy(oracleAddr | hookAddr)""subscribe(ORIGIN_CHAIN_ID | ORACLE_ADDRESS | PriceUpdate topic)""setPrice(1000)""emit PriceUpdate(1000)""Check subscriptions for this event signature""react(chainId | senderAddress | topicCount | topic0 | ... | data)"

Diagram: Subscription and Event Delivery Flow

### Subscription ParametersLink copied!

When subscribing to an event, the reactive contract specifies:

ParameterValue in AegisPurposeOrigin Chain ID`11155111` (Sepolia)Identifies which blockchain to monitorContract Address`0x1392C38921A818cEdb100cC3767e8f30deC3a7D8`The MockOracle contract addressTopic 0`keccak256("PriceUpdate(uint256)")`The event signature to listen for

After subscription, the Reactive Network's system service automatically forwards matching events to the sentinel's `react()` function.

Sources:[contracts/README.md#41-44](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L41-L44)[README.md#46-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L46-L47)

---

## The React Function: Event Processing LogicLink copied!

### Function Signature and FlowLink copied!

The `react()` function is the heart of any reactive smart contract. It receives event data from the origin chain and processes it to determine what actions to take.

#mermaid-yvwjba399vr{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-yvwjba399vr .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-yvwjba399vr .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-yvwjba399vr .error-icon{fill:#a44141;}#mermaid-yvwjba399vr .error-text{fill:#ddd;stroke:#ddd;}#mermaid-yvwjba399vr .edge-thickness-normal{stroke-width:1px;}#mermaid-yvwjba399vr .edge-thickness-thick{stroke-width:3.5px;}#mermaid-yvwjba399vr .edge-pattern-solid{stroke-dasharray:0;}#mermaid-yvwjba399vr .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-yvwjba399vr .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-yvwjba399vr .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-yvwjba399vr .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-yvwjba399vr .marker.cross{stroke:lightgrey;}#mermaid-yvwjba399vr svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-yvwjba399vr p{margin:0;}#mermaid-yvwjba399vr .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-yvwjba399vr .cluster-label text{fill:#F9FFFE;}#mermaid-yvwjba399vr .cluster-label span{color:#F9FFFE;}#mermaid-yvwjba399vr .cluster-label span p{background-color:transparent;}#mermaid-yvwjba399vr .label text,#mermaid-yvwjba399vr span{fill:#ccc;color:#ccc;}#mermaid-yvwjba399vr .node rect,#mermaid-yvwjba399vr .node circle,#mermaid-yvwjba399vr .node ellipse,#mermaid-yvwjba399vr .node polygon,#mermaid-yvwjba399vr .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-yvwjba399vr .rough-node .label text,#mermaid-yvwjba399vr .node .label text,#mermaid-yvwjba399vr .image-shape .label,#mermaid-yvwjba399vr .icon-shape .label{text-anchor:middle;}#mermaid-yvwjba399vr .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-yvwjba399vr .rough-node .label,#mermaid-yvwjba399vr .node .label,#mermaid-yvwjba399vr .image-shape .label,#mermaid-yvwjba399vr .icon-shape .label{text-align:center;}#mermaid-yvwjba399vr .node.clickable{cursor:pointer;}#mermaid-yvwjba399vr .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-yvwjba399vr .arrowheadPath{fill:lightgrey;}#mermaid-yvwjba399vr .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-yvwjba399vr .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-yvwjba399vr .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-yvwjba399vr .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-yvwjba399vr .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-yvwjba399vr .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-yvwjba399vr .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-yvwjba399vr .cluster text{fill:#F9FFFE;}#mermaid-yvwjba399vr .cluster span{color:#F9FFFE;}#mermaid-yvwjba399vr div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-yvwjba399vr .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-yvwjba399vr rect.text{fill:none;stroke-width:0;}#mermaid-yvwjba399vr .icon-shape,#mermaid-yvwjba399vr .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-yvwjba399vr .icon-shape p,#mermaid-yvwjba399vr .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-yvwjba399vr .icon-shape rect,#mermaid-yvwjba399vr .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-yvwjba399vr .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-yvwjba399vr .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-yvwjba399vr :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

No

Yes

No

Yes

Yes (Crash)

No

Yes (Recovery)

No

System Service calls react(chainId, sender, topicCount, topics, data)

Is chainId == ORIGIN_CHAIN_ID?

Is sender == ORACLE_ADDRESS?

Decode data newPrice = abi.decode(data)

Is newPrice < PRICE_THRESHOLD?

emit Callback DESTINATION_CHAIN_ID, HOOK_ADDRESS, setPanicMode(true)

Is newPrice > PRICE_THRESHOLD?

emit Callback DESTINATION_CHAIN_ID, HOOK_ADDRESS, setPanicMode(false)

No action taken

Diagram: React Function Decision Logic

### Implementation DetailsLink copied!

The `react()` function performs several critical operations:

1. Validation: Ensures the event originates from the expected chain and contract
2. Decoding: Extracts the price value from the event data
3. Analysis: Compares the price against the configured threshold
4. Action: Emits a `Callback` event to trigger cross-chain state changes

The threshold value (typically `1500` for ETH price) represents the critical price below which panic mode should activate. If the price falls below this value, the sentinel immediately emits a callback to set `panicMode = true` on the AegisHook. When the price recovers above the threshold, a second callback resets `panicMode = false`.

Sources:[contracts/README.md#41-44](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L41-L44)[README.md#19-22](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L19-L22)

---

## Cross-Chain Callback MechanismLink copied!

### Callback Event StructureLink copied!

Reactive contracts trigger actions on destination chains by emitting `Callback` events. The Reactive Network's relayer infrastructure listens for these events and submits the corresponding transactions on the target chain.

#mermaid-zi49ptpzlk{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-zi49ptpzlk .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-zi49ptpzlk .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-zi49ptpzlk .error-icon{fill:#a44141;}#mermaid-zi49ptpzlk .error-text{fill:#ddd;stroke:#ddd;}#mermaid-zi49ptpzlk .edge-thickness-normal{stroke-width:1px;}#mermaid-zi49ptpzlk .edge-thickness-thick{stroke-width:3.5px;}#mermaid-zi49ptpzlk .edge-pattern-solid{stroke-dasharray:0;}#mermaid-zi49ptpzlk .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-zi49ptpzlk .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-zi49ptpzlk .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-zi49ptpzlk .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-zi49ptpzlk .marker.cross{stroke:lightgrey;}#mermaid-zi49ptpzlk svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-zi49ptpzlk p{margin:0;}#mermaid-zi49ptpzlk .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-zi49ptpzlk .cluster-label text{fill:#F9FFFE;}#mermaid-zi49ptpzlk .cluster-label span{color:#F9FFFE;}#mermaid-zi49ptpzlk .cluster-label span p{background-color:transparent;}#mermaid-zi49ptpzlk .label text,#mermaid-zi49ptpzlk span{fill:#ccc;color:#ccc;}#mermaid-zi49ptpzlk .node rect,#mermaid-zi49ptpzlk .node circle,#mermaid-zi49ptpzlk .node ellipse,#mermaid-zi49ptpzlk .node polygon,#mermaid-zi49ptpzlk .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-zi49ptpzlk .rough-node .label text,#mermaid-zi49ptpzlk .node .label text,#mermaid-zi49ptpzlk .image-shape .label,#mermaid-zi49ptpzlk .icon-shape .label{text-anchor:middle;}#mermaid-zi49ptpzlk .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-zi49ptpzlk .rough-node .label,#mermaid-zi49ptpzlk .node .label,#mermaid-zi49ptpzlk .image-shape .label,#mermaid-zi49ptpzlk .icon-shape .label{text-align:center;}#mermaid-zi49ptpzlk .node.clickable{cursor:pointer;}#mermaid-zi49ptpzlk .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-zi49ptpzlk .arrowheadPath{fill:lightgrey;}#mermaid-zi49ptpzlk .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-zi49ptpzlk .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-zi49ptpzlk .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-zi49ptpzlk .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-zi49ptpzlk .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-zi49ptpzlk .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-zi49ptpzlk .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-zi49ptpzlk .cluster text{fill:#F9FFFE;}#mermaid-zi49ptpzlk .cluster span{color:#F9FFFE;}#mermaid-zi49ptpzlk div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-zi49ptpzlk .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-zi49ptpzlk rect.text{fill:none;stroke-width:0;}#mermaid-zi49ptpzlk .icon-shape,#mermaid-zi49ptpzlk .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-zi49ptpzlk .icon-shape p,#mermaid-zi49ptpzlk .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-zi49ptpzlk .icon-shape rect,#mermaid-zi49ptpzlk .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-zi49ptpzlk .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-zi49ptpzlk .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-zi49ptpzlk :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Unichain Sepolia

Reactive Infrastructure

Reactive Network (Lasna)

emits

captured by

submits tx to chain 1301

executes

contains

AegisSentinel react() function

emit Callback( destinationChainId, destinationContract, calldata )

Reactive Relayer Node Network

AegisHook 0x1E2a...8080

setPanicMode(bool)

Callback Data: chainId: 1301 target: 0x1E2a...8080 data: setPanicMode(true)

Diagram: Cross-Chain Callback Execution Flow

### Callback ParametersLink copied!

The `Callback` event contains three critical parameters:

ParameterTypeExample ValuePurposechainId`uint256``1301`Identifies destination chain (Unichain Sepolia)_contract`address``0x1E2aE114cF3B63779A1367eD704ccA51a0218080`Target contract address (AegisHook)data`bytes``abi.encodeWithSelector(setPanicMode.selector, true)`Function call data to execute

When the Reactive Network relayer receives this event, it:

1. Validates the callback is from an authorized reactive contract
2. Constructs a transaction with the specified calldata
3. Submits the transaction to the destination chain using a system wallet
4. Pays gas on behalf of the reactive contract

This mechanism allows the AegisSentinel to autonomously control the AegisHook's state without requiring any external infrastructure.

Sources:[README.md#56-75](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L56-L75)[contracts/README.md#11-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L11-L26)

---

## Integration with system-smart-contracts LibraryLink copied!

### Dependency ManagementLink copied!

The Reactive Network integration depends on the `system-smart-contracts` repository, which is included as a git submodule:

[contracts/.gitmodules#10-12](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L10-L12)

This library provides:

- `AbstractReactive`: Base class for reactive contracts
- `IReactive`: Interface specification
- System constants and utilities
- Event signatures for subscriptions and callbacks

### Import Path ResolutionLink copied!

During development, the team encountered challenges with import paths due to SDK updates. The correct import statement for the reactive base class is:

```
import "system-smart-contracts/abstract/AbstractReactive.sol";
```

This path resolution issue is documented in the project's challenges section, where the team had to investigate the `node_modules` structure to find the correct path after SDK changes.

Sources:[README.md#77-78](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L77-L78)[contracts/.gitmodules#10-12](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L10-L12)

---

## Deployment on Reactive NetworkLink copied!

### Network ConfigurationLink copied!

Reactive Network runs a testnet called "Lasna" with the following parameters:

ParameterValueNetwork NameReactive Network LasnaChain ID`5318007`PurposeMiddleware layer for cross-chain reactivityBlock Explorer(Testnet-specific explorer)

### Deployment ProcessLink copied!

The AegisSentinel is deployed using the deployment script at [script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol) The deployment process is unique compared to standard contract deployments:

"Reactive System Service""AegisSentinel Contract""Reactive Network""05_DeploySentinel.s.sol""Reactive System Service""AegisSentinel Contract""Reactive Network""05_DeploySentinel.s.sol"#mermaid-0ue9ffueunrg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-0ue9ffueunrg .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-0ue9ffueunrg .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-0ue9ffueunrg .error-icon{fill:#a44141;}#mermaid-0ue9ffueunrg .error-text{fill:#ddd;stroke:#ddd;}#mermaid-0ue9ffueunrg .edge-thickness-normal{stroke-width:1px;}#mermaid-0ue9ffueunrg .edge-thickness-thick{stroke-width:3.5px;}#mermaid-0ue9ffueunrg .edge-pattern-solid{stroke-dasharray:0;}#mermaid-0ue9ffueunrg .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-0ue9ffueunrg .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-0ue9ffueunrg .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-0ue9ffueunrg .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-0ue9ffueunrg .marker.cross{stroke:lightgrey;}#mermaid-0ue9ffueunrg svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-0ue9ffueunrg p{margin:0;}#mermaid-0ue9ffueunrg .actor{stroke:#ccc;fill:#1f2020;}#mermaid-0ue9ffueunrg text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-0ue9ffueunrg .actor-line{stroke:#ccc;}#mermaid-0ue9ffueunrg .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-0ue9ffueunrg .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-0ue9ffueunrg .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-0ue9ffueunrg #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-0ue9ffueunrg .sequenceNumber{fill:black;}#mermaid-0ue9ffueunrg #sequencenumber{fill:lightgrey;}#mermaid-0ue9ffueunrg #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-0ue9ffueunrg .messageText{fill:lightgrey;stroke:none;}#mermaid-0ue9ffueunrg .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-0ue9ffueunrg .labelText,#mermaid-0ue9ffueunrg .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-0ue9ffueunrg .loopText,#mermaid-0ue9ffueunrg .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-0ue9ffueunrg .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-0ue9ffueunrg .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-0ue9ffueunrg .noteText,#mermaid-0ue9ffueunrg .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-0ue9ffueunrg .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-0ue9ffueunrg .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-0ue9ffueunrg .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-0ue9ffueunrg .actorPopupMenu{position:absolute;}#mermaid-0ue9ffueunrg .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-0ue9ffueunrg .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-0ue9ffueunrg .actor-man circle,#mermaid-0ue9ffueunrg line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-0ue9ffueunrg :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}Step 1: Deploy ContractStep 2: Subscribe to EventsStep 3: VerificationSystem is now autonomous"Deploy AegisSentinel (oracleAddr | hookAddr | threshold)""Contract created at 0x0B6a...b6B6""Call subscribe() (origin chain | oracle | topic)""Register subscription""Record deployment address in broadcast logs"

Diagram: AegisSentinel Deployment Sequence

### Post-Deployment SubscriptionLink copied!

A critical step after deployment is calling the `subscribe()` function to register the event subscription. This is typically done in the deployment script itself or as a separate transaction immediately after deployment. The subscription must be established before the sentinel can begin monitoring events.

The deployment command uses the `--legacy` flag due to specific requirements of the Reactive Network testnet:

```
forge script script/05_DeploySentinel.s.sol --rpc-url reactive --broadcast --legacy
```

Sources:[contracts/README.md#112-116](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L112-L116)

---

## Autonomous Operation LifecycleLink copied!

### End-to-End System FlowLink copied!

Once deployed and subscribed, the AegisSentinel operates completely autonomously. The following diagram shows the complete lifecycle from event emission to action execution:

"AegisHook (Unichain L2)""Reactive Relayer Infrastructure""AegisSentinel (Lasna)""Reactive Network System Service""MockOracle (Sepolia L1)""Market Event""AegisHook (Unichain L2)""Reactive Relayer Infrastructure""AegisSentinel (Lasna)""Reactive Network System Service""MockOracle (Sepolia L1)""Market Event"#mermaid-xx14fnr2w6s{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-xx14fnr2w6s .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-xx14fnr2w6s .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-xx14fnr2w6s .error-icon{fill:#a44141;}#mermaid-xx14fnr2w6s .error-text{fill:#ddd;stroke:#ddd;}#mermaid-xx14fnr2w6s .edge-thickness-normal{stroke-width:1px;}#mermaid-xx14fnr2w6s .edge-thickness-thick{stroke-width:3.5px;}#mermaid-xx14fnr2w6s .edge-pattern-solid{stroke-dasharray:0;}#mermaid-xx14fnr2w6s .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-xx14fnr2w6s .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-xx14fnr2w6s .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-xx14fnr2w6s .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-xx14fnr2w6s .marker.cross{stroke:lightgrey;}#mermaid-xx14fnr2w6s svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-xx14fnr2w6s p{margin:0;}#mermaid-xx14fnr2w6s .actor{stroke:#ccc;fill:#1f2020;}#mermaid-xx14fnr2w6s text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-xx14fnr2w6s .actor-line{stroke:#ccc;}#mermaid-xx14fnr2w6s .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-xx14fnr2w6s .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-xx14fnr2w6s .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-xx14fnr2w6s #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-xx14fnr2w6s .sequenceNumber{fill:black;}#mermaid-xx14fnr2w6s #sequencenumber{fill:lightgrey;}#mermaid-xx14fnr2w6s #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-xx14fnr2w6s .messageText{fill:lightgrey;stroke:none;}#mermaid-xx14fnr2w6s .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-xx14fnr2w6s .labelText,#mermaid-xx14fnr2w6s .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-xx14fnr2w6s .loopText,#mermaid-xx14fnr2w6s .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-xx14fnr2w6s .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-xx14fnr2w6s .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-xx14fnr2w6s .noteText,#mermaid-xx14fnr2w6s .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-xx14fnr2w6s .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-xx14fnr2w6s .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-xx14fnr2w6s .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-xx14fnr2w6s .actorPopupMenu{position:absolute;}#mermaid-xx14fnr2w6s .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-xx14fnr2w6s .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-xx14fnr2w6s .actor-man circle,#mermaid-xx14fnr2w6s line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-xx14fnr2w6s :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}Normal OperationCircuit Breaker ActiveRecovery PhaseNormal Operation Resumed"Price drops to 1000""setPrice(1000)""emit PriceUpdate(1000)""Match event to subscriptions""react(11155111 | oracleAddr | topics | data=1000)""Check: 1000 < 1500 CRASH DETECTED""emit Callback( 1301 | hookAddr | setPanicMode(true))""Detect Callback event""Submit tx: setPanicMode(true)""panicMode = true""Price recovers to 1800""emit PriceUpdate(1800)""react(11155111 | oracleAddr | topics | data=1800)""Check: 1800 > 1500 RECOVERY DETECTED""emit Callback( 1301 | hookAddr | setPanicMode(false))""Submit tx: setPanicMode(false)""panicMode = false"

Diagram: Complete Autonomous Operation Lifecycle

This lifecycle demonstrates the "Inversion of Control" benefit: no off-chain bot is required. The entire chain of events from price update to pool state change happens through on-chain smart contract logic.

Sources:[README.md#56-75](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L56-L75)[contracts/README.md#11-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L11-L26)

---

## Reactive Network vs. Traditional Bot ArchitectureLink copied!

### Architectural ComparisonLink copied!

The following table highlights the fundamental differences between the traditional keeper bot approach and Aegis's reactive architecture:

AspectTraditional Bot ArchitectureReactive Network ArchitectureMonitoringJavaScript script polling RPC endpointsOn-chain event subscription via `subscribe()`ExecutionBot signs transactions with private keyReactive relayer submits on contract's behalfState ManagementBot maintains state in database/memoryState stored on Reactive Network blockchainGas ManagementBot wallet requires constant ETH fundingReactive Network handles gas abstractionDeploymentDeploy contracts + deploy bot + maintain serverDeploy contracts onlyFailure ModesBot crashes, server downtime, wallet drainedNetwork-level redundancy with multiple relayersSecurityPrivate key exposure riskNo private key required in application layerLatencyPolling interval + network latencyNear-instant event propagation

The Reactive Network approach eliminates the need for the "Bot Infrastructure" layer entirely, reducing the attack surface and operational complexity.

Sources:[README.md#45-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L45-L47)[contracts/README.md#39-44](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L39-L44)

---

## Testnet Infrastructure ConsiderationsLink copied!

### Relayer Stability ChallengesLink copied!

During development, the team encountered infrastructure gaps with the public Reactive Network testnet. While the technology itself was sound, the public relayer infrastructure for Unichain Sepolia (Chain ID 1301) experienced intermittent stability issues:

Issue: The AegisSentinel correctly detected events on Sepolia and emitted `Callback` events, but these messages occasionally got "stuck" because the public relayer node wasn't forwarding them to Unichain with consistent reliability.

Response: The team built a hybrid architecture with a custom fallback relayer ([relay.ts](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/relay.ts)) that monitors the Oracle directly and ensures demo reliability. For the full rationale, see [Hybrid Relayer](#3.3).

Production Path: For mainnet deployment, Aegis would either:

1. Run dedicated relayer infrastructure
2. Use Reactive Network's production relayer SLA guarantees
3. Maintain the hybrid approach with monitoring and alerting

This challenge is common with early-stage blockchain infrastructure and demonstrates the team's ability to architect resilient systems that degrade gracefully.

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)[README.md#77-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L77-L84)

---

## Code ReferencesLink copied!

### Key Files for Reactive IntegrationLink copied!

File PathPurpose[src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol)Main reactive contract implementation[script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol)Deployment script for Reactive Network[contracts/.gitmodules#10-12](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L10-L12)Git submodule for system-smart-contracts library[lib/system-smart-contracts/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/lib/system-smart-contracts/)Reactive Network core libraries

### Related ContractsLink copied!

- MockOracle[src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol): Emits the `PriceUpdate` events that AegisSentinel subscribes to
- AegisHook[src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol): Receives the `setPanicMode` calls triggered by AegisSentinel

Sources:[contracts/README.md#32-57](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L32-L57)[contracts/.gitmodules#1-13](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L1-L13)

---

## SummaryLink copied!

The Reactive Network integration in Aegis demonstrates a novel approach to cross-chain automation that eliminates centralized keeper infrastructure. By leveraging the `AbstractReactive` base class and Reactive Network's event subscription system, the AegisSentinel operates as a fully autonomous control center that:

1. Monitors L1 price feeds via on-chain event subscriptions
2. Analyzes price data using the `react()` function's volatility detection logic
3. Responds by emitting cross-chain callbacks to control L2 pool state
4. Scales without requiring additional infrastructure as usage grows

This architecture represents a fundamental shift from "bot-driven" to "contract-driven" cross-chain systems, with implications beyond DeFi circuit breakers into any multi-chain coordination scenario.

Sources:[README.md#1-149](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L1-L149)[contracts/README.md#1-123](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L1-L123)

---

# Cross-Chain-Messaging

# Cross-Chain MessagingLink copied!
Relevant source files
- [README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md)
- [contracts/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md)

## Purpose and ScopeLink copied!

This document explains the cross-chain messaging architecture that enables Aegis to coordinate actions across Ethereum L1 (Sepolia), Reactive Network (Lasna), and Unichain L2 (Sepolia). It covers the event-driven communication protocol, message types, and the technical implementation of cross-chain callbacks.

For information about how the Reactive Network infrastructure is configured and initialized, see [Reactive Network Integration](#3.1). For details on the hybrid relayer fallback mechanism, see [Hybrid Relayer](#3.3).

---

## Message Flow ArchitectureLink copied!

The Aegis cross-chain messaging system operates as a three-stage pipeline: event emission on L1, event detection and processing on Reactive Network, and action execution on L2.

### End-to-End Communication FlowLink copied!

#mermaid-u0wqvle3f9{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-u0wqvle3f9 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-u0wqvle3f9 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-u0wqvle3f9 .error-icon{fill:#a44141;}#mermaid-u0wqvle3f9 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-u0wqvle3f9 .edge-thickness-normal{stroke-width:1px;}#mermaid-u0wqvle3f9 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-u0wqvle3f9 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-u0wqvle3f9 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-u0wqvle3f9 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-u0wqvle3f9 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-u0wqvle3f9 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-u0wqvle3f9 .marker.cross{stroke:lightgrey;}#mermaid-u0wqvle3f9 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-u0wqvle3f9 p{margin:0;}#mermaid-u0wqvle3f9 .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-u0wqvle3f9 .cluster-label text{fill:#F9FFFE;}#mermaid-u0wqvle3f9 .cluster-label span{color:#F9FFFE;}#mermaid-u0wqvle3f9 .cluster-label span p{background-color:transparent;}#mermaid-u0wqvle3f9 .label text,#mermaid-u0wqvle3f9 span{fill:#ccc;color:#ccc;}#mermaid-u0wqvle3f9 .node rect,#mermaid-u0wqvle3f9 .node circle,#mermaid-u0wqvle3f9 .node ellipse,#mermaid-u0wqvle3f9 .node polygon,#mermaid-u0wqvle3f9 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-u0wqvle3f9 .rough-node .label text,#mermaid-u0wqvle3f9 .node .label text,#mermaid-u0wqvle3f9 .image-shape .label,#mermaid-u0wqvle3f9 .icon-shape .label{text-anchor:middle;}#mermaid-u0wqvle3f9 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-u0wqvle3f9 .rough-node .label,#mermaid-u0wqvle3f9 .node .label,#mermaid-u0wqvle3f9 .image-shape .label,#mermaid-u0wqvle3f9 .icon-shape .label{text-align:center;}#mermaid-u0wqvle3f9 .node.clickable{cursor:pointer;}#mermaid-u0wqvle3f9 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-u0wqvle3f9 .arrowheadPath{fill:lightgrey;}#mermaid-u0wqvle3f9 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-u0wqvle3f9 .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-u0wqvle3f9 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-u0wqvle3f9 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-u0wqvle3f9 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-u0wqvle3f9 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-u0wqvle3f9 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-u0wqvle3f9 .cluster text{fill:#F9FFFE;}#mermaid-u0wqvle3f9 .cluster span{color:#F9FFFE;}#mermaid-u0wqvle3f9 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-u0wqvle3f9 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-u0wqvle3f9 rect.text{fill:none;stroke-width:0;}#mermaid-u0wqvle3f9 .icon-shape,#mermaid-u0wqvle3f9 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-u0wqvle3f9 .icon-shape p,#mermaid-u0wqvle3f9 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-u0wqvle3f9 .icon-shape rect,#mermaid-u0wqvle3f9 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-u0wqvle3f9 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-u0wqvle3f9 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-u0wqvle3f9 :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Unichain Sepolia (Chain ID: 1301)

Reactive Network Lasna (Chain ID: 5318007)

Ethereum Sepolia (Chain ID: 11155111)

emit PriceUpdate(uint256)

emit NewFeedback(address,uint256)

react() callback

vm.emit() cross-chain

boostReputation(address)

MockOracle 0x1392C38921A818cEdb100cC3767e8f30deC3a7D8

AegisGuardianRegistry ERC-721 + ERC-8004

AegisSentinel 0x0B6ae13119Fc3b61d6ABb115342A1A075e14b6B6

AbstractReactive Base Contract

AegisHook 0x1E2aE114cF3B63779A1367eD704ccA51a0218080

Sources:[README.md#56-75](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L56-L75)[contracts/README.md#11-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L11-L26)

---

## Event-Driven CommunicationLink copied!

Aegis uses a publish-subscribe model where contracts on L1 emit events, and the Sentinel on Reactive Network subscribes to these events to trigger cross-chain actions.

### L1 Event EmissionLink copied!

The `MockOracle` contract on Ethereum Sepolia emits standardized `PriceUpdate` events that serve as the primary trigger for panic mode activation.

#### PriceUpdate Event Structure

The event signature follows the standard oracle interface pattern:

```
event PriceUpdate(uint256 price, uint256 timestamp)
```

Event Topic 0 (Signature Hash):

```
keccak256("PriceUpdate(uint256,uint256)")
```

The event contains two indexed parameters:

- `price`: Current asset price (scaled to 18 decimals)
- `timestamp`: Block timestamp of the update

Sources:[contracts/README.md#46-50](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L46-L50)[src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol)

#### NewFeedback Event Structure

The `AegisGuardianRegistry` emits reputation feedback events that trigger automatic reputation synchronization:

```
event NewFeedback(address indexed guardian, uint256 volume)
```

This event captures Guardian interventions during crisis periods, enabling the Sentinel to autonomously boost reputation on L2.

Sources:[README.md#32-33](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L32-L33)[contracts/README.md#52-57](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L52-L57)

### Reactive Network Event SubscriptionLink copied!

The `AegisSentinel` contract inherits from `AbstractReactive` and subscribes to specific L1 events during initialization.

#### Subscription Configuration

The Sentinel registers subscriptions using the Reactive Network's subscription mechanism:

```
subscribe(
    chainId: 11155111,           // Ethereum Sepolia
    contractAddress: 0x1392C38921A818cEdb100cC3767e8f30deC3a7D8,  // MockOracle
    topic0: keccak256("PriceUpdate(uint256,uint256)"),
    topic1: 0x0,                  // No topic filter
    topic2: 0x0,
    topic3: 0x0
)
```

When a matching event is detected on L1, the Reactive Network triggers the Sentinel's `react()` callback function.

Sources:[contracts/README.md#39-44](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L39-L44)[README.md#46-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L46-L47)

---

## Cross-Chain Callback MechanismLink copied!

The Sentinel processes L1 events within its `react()` function and emits cross-chain calls to the Hook on L2.

### Message Transmission ProtocolLink copied!

"AegisHook (L2)""Reactive VM""AegisSentinel (Reactive)""MockOracle (L1)""AegisHook (L2)""Reactive VM""AegisSentinel (Reactive)""MockOracle (L1)"#mermaid-rip7004bw0c{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-rip7004bw0c .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-rip7004bw0c .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-rip7004bw0c .error-icon{fill:#a44141;}#mermaid-rip7004bw0c .error-text{fill:#ddd;stroke:#ddd;}#mermaid-rip7004bw0c .edge-thickness-normal{stroke-width:1px;}#mermaid-rip7004bw0c .edge-thickness-thick{stroke-width:3.5px;}#mermaid-rip7004bw0c .edge-pattern-solid{stroke-dasharray:0;}#mermaid-rip7004bw0c .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-rip7004bw0c .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-rip7004bw0c .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-rip7004bw0c .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-rip7004bw0c .marker.cross{stroke:lightgrey;}#mermaid-rip7004bw0c svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-rip7004bw0c p{margin:0;}#mermaid-rip7004bw0c .actor{stroke:#ccc;fill:#1f2020;}#mermaid-rip7004bw0c text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-rip7004bw0c .actor-line{stroke:#ccc;}#mermaid-rip7004bw0c .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-rip7004bw0c .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-rip7004bw0c .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-rip7004bw0c #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-rip7004bw0c .sequenceNumber{fill:black;}#mermaid-rip7004bw0c #sequencenumber{fill:lightgrey;}#mermaid-rip7004bw0c #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-rip7004bw0c .messageText{fill:lightgrey;stroke:none;}#mermaid-rip7004bw0c .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-rip7004bw0c .labelText,#mermaid-rip7004bw0c .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-rip7004bw0c .loopText,#mermaid-rip7004bw0c .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-rip7004bw0c .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-rip7004bw0c .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-rip7004bw0c .noteText,#mermaid-rip7004bw0c .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-rip7004bw0c .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-rip7004bw0c .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-rip7004bw0c .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-rip7004bw0c .actorPopupMenu{position:absolute;}#mermaid-rip7004bw0c .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-rip7004bw0c .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-rip7004bw0c .actor-man circle,#mermaid-rip7004bw0c line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-rip7004bw0c :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}"react() triggered""panicMode = true""panicMode = false"alt["price < 1500 (PANIC)"]["price >= 1500 (NORMAL)"]"PriceUpdate(1000 | timestamp)""Check: price < THRESHOLD""vm.emit() with PANIC payload""Cross-chain transaction""setPanicMode(true)""vm.emit() with RESUME payload""Cross-chain transaction""setPanicMode(false)"

Sources:[contracts/README.md#39-44](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L39-L44)[README.md#56-75](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L56-L75)

### Callback Payload StructureLink copied!

Cross-chain messages are encoded as contract calls with the following structure:

FieldTypeDescription`destinationChainId``uint256`Target chain (1301 for Unichain Sepolia)`destinationContract``address`AegisHook address (0x1E2a...8080)`functionSelector``bytes4`Target function (e.g., `setPanicMode(bool)`)`payload``bytes`ABI-encoded function arguments`gasLimit``uint256`Gas allocation for L2 execution

Sources:[README.md#78-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L78-L84)

---

## Message TypesLink copied!

The Aegis system implements two primary message types for cross-chain coordination.

### SET_PANIC MessageLink copied!

This message controls the circuit breaker state on the AegisHook.

#### Function Signature

```
function setPanicMode(bool _panic) external
```

#### Message Flow

#mermaid-0qigqium97pc{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-0qigqium97pc .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-0qigqium97pc .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-0qigqium97pc .error-icon{fill:#a44141;}#mermaid-0qigqium97pc .error-text{fill:#ddd;stroke:#ddd;}#mermaid-0qigqium97pc .edge-thickness-normal{stroke-width:1px;}#mermaid-0qigqium97pc .edge-thickness-thick{stroke-width:3.5px;}#mermaid-0qigqium97pc .edge-pattern-solid{stroke-dasharray:0;}#mermaid-0qigqium97pc .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-0qigqium97pc .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-0qigqium97pc .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-0qigqium97pc .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-0qigqium97pc .marker.cross{stroke:lightgrey;}#mermaid-0qigqium97pc svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-0qigqium97pc p{margin:0;}#mermaid-0qigqium97pc .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-0qigqium97pc .cluster-label text{fill:#F9FFFE;}#mermaid-0qigqium97pc .cluster-label span{color:#F9FFFE;}#mermaid-0qigqium97pc .cluster-label span p{background-color:transparent;}#mermaid-0qigqium97pc .label text,#mermaid-0qigqium97pc span{fill:#ccc;color:#ccc;}#mermaid-0qigqium97pc .node rect,#mermaid-0qigqium97pc .node circle,#mermaid-0qigqium97pc .node ellipse,#mermaid-0qigqium97pc .node polygon,#mermaid-0qigqium97pc .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-0qigqium97pc .rough-node .label text,#mermaid-0qigqium97pc .node .label text,#mermaid-0qigqium97pc .image-shape .label,#mermaid-0qigqium97pc .icon-shape .label{text-anchor:middle;}#mermaid-0qigqium97pc .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-0qigqium97pc .rough-node .label,#mermaid-0qigqium97pc .node .label,#mermaid-0qigqium97pc .image-shape .label,#mermaid-0qigqium97pc .icon-shape .label{text-align:center;}#mermaid-0qigqium97pc .node.clickable{cursor:pointer;}#mermaid-0qigqium97pc .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-0qigqium97pc .arrowheadPath{fill:lightgrey;}#mermaid-0qigqium97pc .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-0qigqium97pc .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-0qigqium97pc .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-0qigqium97pc .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-0qigqium97pc .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-0qigqium97pc .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-0qigqium97pc .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-0qigqium97pc .cluster text{fill:#F9FFFE;}#mermaid-0qigqium97pc .cluster span{color:#F9FFFE;}#mermaid-0qigqium97pc div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-0qigqium97pc .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-0qigqium97pc rect.text{fill:none;stroke-width:0;}#mermaid-0qigqium97pc .icon-shape,#mermaid-0qigqium97pc .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-0qigqium97pc .icon-shape p,#mermaid-0qigqium97pc .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-0qigqium97pc .icon-shape rect,#mermaid-0qigqium97pc .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-0qigqium97pc .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-0qigqium97pc .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-0qigqium97pc :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Yes

No

PriceUpdate(price)

price < THRESHOLD?

SET_PANIC(true)

SET_PANIC(false)

AegisHook.setPanicMode()

#### Payload Encoding

```
bytes memory payload = abi.encodeWithSignature("setPanicMode(bool)", true);
```

Parameters:

- `_panic`: Boolean flag indicating panic state

- `true`: Activate circuit breaker, reject all swaps
- `false`: Deactivate circuit breaker, resume normal operation

Access Control: Only the Sentinel contract on Reactive Network can invoke this function. The Hook verifies the sender address matches the authorized Sentinel.

Sources:[contracts/README.md#33-37](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L33-L37)[README.md#62-66](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L62-L66)

### BOOST_REP MessageLink copied!

This message synchronizes Guardian reputation from L1 to L2 based on intervention feedback.

#### Function Signature

```
function boostReputation(address guardian, uint256 amount) external
```

#### Message Flow

#mermaid-a3myby10cdv{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-a3myby10cdv .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-a3myby10cdv .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-a3myby10cdv .error-icon{fill:#a44141;}#mermaid-a3myby10cdv .error-text{fill:#ddd;stroke:#ddd;}#mermaid-a3myby10cdv .edge-thickness-normal{stroke-width:1px;}#mermaid-a3myby10cdv .edge-thickness-thick{stroke-width:3.5px;}#mermaid-a3myby10cdv .edge-pattern-solid{stroke-dasharray:0;}#mermaid-a3myby10cdv .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-a3myby10cdv .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-a3myby10cdv .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-a3myby10cdv .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-a3myby10cdv .marker.cross{stroke:lightgrey;}#mermaid-a3myby10cdv svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-a3myby10cdv p{margin:0;}#mermaid-a3myby10cdv .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-a3myby10cdv .cluster-label text{fill:#F9FFFE;}#mermaid-a3myby10cdv .cluster-label span{color:#F9FFFE;}#mermaid-a3myby10cdv .cluster-label span p{background-color:transparent;}#mermaid-a3myby10cdv .label text,#mermaid-a3myby10cdv span{fill:#ccc;color:#ccc;}#mermaid-a3myby10cdv .node rect,#mermaid-a3myby10cdv .node circle,#mermaid-a3myby10cdv .node ellipse,#mermaid-a3myby10cdv .node polygon,#mermaid-a3myby10cdv .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-a3myby10cdv .rough-node .label text,#mermaid-a3myby10cdv .node .label text,#mermaid-a3myby10cdv .image-shape .label,#mermaid-a3myby10cdv .icon-shape .label{text-anchor:middle;}#mermaid-a3myby10cdv .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-a3myby10cdv .rough-node .label,#mermaid-a3myby10cdv .node .label,#mermaid-a3myby10cdv .image-shape .label,#mermaid-a3myby10cdv .icon-shape .label{text-align:center;}#mermaid-a3myby10cdv .node.clickable{cursor:pointer;}#mermaid-a3myby10cdv .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-a3myby10cdv .arrowheadPath{fill:lightgrey;}#mermaid-a3myby10cdv .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-a3myby10cdv .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-a3myby10cdv .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-a3myby10cdv .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-a3myby10cdv .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-a3myby10cdv .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-a3myby10cdv .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-a3myby10cdv .cluster text{fill:#F9FFFE;}#mermaid-a3myby10cdv .cluster span{color:#F9FFFE;}#mermaid-a3myby10cdv div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-a3myby10cdv .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-a3myby10cdv rect.text{fill:none;stroke-width:0;}#mermaid-a3myby10cdv .icon-shape,#mermaid-a3myby10cdv .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-a3myby10cdv .icon-shape p,#mermaid-a3myby10cdv .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-a3myby10cdv .icon-shape rect,#mermaid-a3myby10cdv .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-a3myby10cdv .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-a3myby10cdv .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-a3myby10cdv :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Guardian provides liquidity during panic

AegisHook records intervention

Hook emits to Registry (L1)

NewFeedback event on L1

Sentinel.react() triggered

BOOST_REP message to L2

Hook updates local rep cache

#### Payload Encoding

```
bytes memory payload = abi.encodeWithSignature(
    "boostReputation(address,uint256)", 
    guardianAddress, 
    volumeAmount
);
```

Parameters:

- `guardian`: Ethereum address of the Guardian being promoted
- `amount`: Volume-based reputation boost (uint256)

Reputation Logic: The Hook maintains a local reputation cache for gas efficiency. The Sentinel synchronizes this cache automatically when `NewFeedback` events are detected on L1.

Sources:[README.md#28-33](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L28-L33)[README.md#70-74](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L70-L74)

---

## Event Signature DecodingLink copied!

The Sentinel must decode event data from L1 transactions to extract parameters for cross-chain calls.

### PriceUpdate DecodingLink copied!

#mermaid-qn9oa5aosy9{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-qn9oa5aosy9 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-qn9oa5aosy9 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-qn9oa5aosy9 .error-icon{fill:#a44141;}#mermaid-qn9oa5aosy9 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-qn9oa5aosy9 .edge-thickness-normal{stroke-width:1px;}#mermaid-qn9oa5aosy9 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-qn9oa5aosy9 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-qn9oa5aosy9 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-qn9oa5aosy9 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-qn9oa5aosy9 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-qn9oa5aosy9 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-qn9oa5aosy9 .marker.cross{stroke:lightgrey;}#mermaid-qn9oa5aosy9 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-qn9oa5aosy9 p{margin:0;}#mermaid-qn9oa5aosy9 .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-qn9oa5aosy9 .cluster-label text{fill:#F9FFFE;}#mermaid-qn9oa5aosy9 .cluster-label span{color:#F9FFFE;}#mermaid-qn9oa5aosy9 .cluster-label span p{background-color:transparent;}#mermaid-qn9oa5aosy9 .label text,#mermaid-qn9oa5aosy9 span{fill:#ccc;color:#ccc;}#mermaid-qn9oa5aosy9 .node rect,#mermaid-qn9oa5aosy9 .node circle,#mermaid-qn9oa5aosy9 .node ellipse,#mermaid-qn9oa5aosy9 .node polygon,#mermaid-qn9oa5aosy9 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-qn9oa5aosy9 .rough-node .label text,#mermaid-qn9oa5aosy9 .node .label text,#mermaid-qn9oa5aosy9 .image-shape .label,#mermaid-qn9oa5aosy9 .icon-shape .label{text-anchor:middle;}#mermaid-qn9oa5aosy9 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-qn9oa5aosy9 .rough-node .label,#mermaid-qn9oa5aosy9 .node .label,#mermaid-qn9oa5aosy9 .image-shape .label,#mermaid-qn9oa5aosy9 .icon-shape .label{text-align:center;}#mermaid-qn9oa5aosy9 .node.clickable{cursor:pointer;}#mermaid-qn9oa5aosy9 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-qn9oa5aosy9 .arrowheadPath{fill:lightgrey;}#mermaid-qn9oa5aosy9 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-qn9oa5aosy9 .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-qn9oa5aosy9 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-qn9oa5aosy9 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-qn9oa5aosy9 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-qn9oa5aosy9 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-qn9oa5aosy9 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-qn9oa5aosy9 .cluster text{fill:#F9FFFE;}#mermaid-qn9oa5aosy9 .cluster span{color:#F9FFFE;}#mermaid-qn9oa5aosy9 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-qn9oa5aosy9 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-qn9oa5aosy9 rect.text{fill:none;stroke-width:0;}#mermaid-qn9oa5aosy9 .icon-shape,#mermaid-qn9oa5aosy9 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-qn9oa5aosy9 .icon-shape p,#mermaid-qn9oa5aosy9 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-qn9oa5aosy9 .icon-shape rect,#mermaid-qn9oa5aosy9 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-qn9oa5aosy9 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-qn9oa5aosy9 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-qn9oa5aosy9 :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Raw Event Log

topic[0]: Event Signature

data field: ABI-encoded params

abi.decode()

uint256 price

uint256 timestamp

Decoding Steps:

1. Verify `topic[0]` matches `PriceUpdate` signature hash
2. Extract `data` field from transaction log
3. ABI-decode as `(uint256, uint256)`
4. Extract `price` and `timestamp` values

Sources:[contracts/README.md#46-50](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L46-L50)

### NewFeedback DecodingLink copied!

For reputation synchronization events:

FieldLocationTypeDescriptionEvent Signature`topic[0]``bytes32``NewFeedback(address,uint256)` hashGuardian Address`topic[1]``address`Indexed parameter (first param)Volume`data``uint256`ABI-encoded in data field

Sources:[contracts/README.md#52-57](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L52-L57)

---

## Gas ConsiderationsLink copied!

Cross-chain messaging incurs gas costs on both the source chain (Reactive Network) and the destination chain (L2).

### Gas Budget AllocationLink copied!

ComponentEstimated GasNotesSentinel `react()` execution~50,000Event processing on Reactive NetworkCross-chain message emission~21,000Base transaction costHook `setPanicMode()` execution~30,000State update on L2Total per message~101,000Full round-trip cost

### Optimization StrategiesLink copied!

The system implements several gas optimization techniques:

1. State Caching: The Hook maintains local reputation cache to avoid cross-chain reads
2. Batching: Multiple reputation updates can be batched in future versions
3. Minimal Storage: Only critical state (panic mode, reputation scores) is stored
4. Early Returns: Guard clauses prevent unnecessary computation in `react()`

Sources:[README.md#78-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L78-L84)[contracts/README.md#33-37](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L33-L37)

---

## Error Handling and ReliabilityLink copied!

The cross-chain messaging system implements multiple layers of fault tolerance.

### Message Delivery GuaranteesLink copied!

#mermaid-d7bu48ntsr9{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-d7bu48ntsr9 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-d7bu48ntsr9 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-d7bu48ntsr9 .error-icon{fill:#a44141;}#mermaid-d7bu48ntsr9 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-d7bu48ntsr9 .edge-thickness-normal{stroke-width:1px;}#mermaid-d7bu48ntsr9 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-d7bu48ntsr9 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-d7bu48ntsr9 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-d7bu48ntsr9 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-d7bu48ntsr9 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-d7bu48ntsr9 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-d7bu48ntsr9 .marker.cross{stroke:lightgrey;}#mermaid-d7bu48ntsr9 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-d7bu48ntsr9 p{margin:0;}#mermaid-d7bu48ntsr9 .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-d7bu48ntsr9 .cluster-label text{fill:#F9FFFE;}#mermaid-d7bu48ntsr9 .cluster-label span{color:#F9FFFE;}#mermaid-d7bu48ntsr9 .cluster-label span p{background-color:transparent;}#mermaid-d7bu48ntsr9 .label text,#mermaid-d7bu48ntsr9 span{fill:#ccc;color:#ccc;}#mermaid-d7bu48ntsr9 .node rect,#mermaid-d7bu48ntsr9 .node circle,#mermaid-d7bu48ntsr9 .node ellipse,#mermaid-d7bu48ntsr9 .node polygon,#mermaid-d7bu48ntsr9 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-d7bu48ntsr9 .rough-node .label text,#mermaid-d7bu48ntsr9 .node .label text,#mermaid-d7bu48ntsr9 .image-shape .label,#mermaid-d7bu48ntsr9 .icon-shape .label{text-anchor:middle;}#mermaid-d7bu48ntsr9 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-d7bu48ntsr9 .rough-node .label,#mermaid-d7bu48ntsr9 .node .label,#mermaid-d7bu48ntsr9 .image-shape .label,#mermaid-d7bu48ntsr9 .icon-shape .label{text-align:center;}#mermaid-d7bu48ntsr9 .node.clickable{cursor:pointer;}#mermaid-d7bu48ntsr9 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-d7bu48ntsr9 .arrowheadPath{fill:lightgrey;}#mermaid-d7bu48ntsr9 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-d7bu48ntsr9 .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-d7bu48ntsr9 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-d7bu48ntsr9 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-d7bu48ntsr9 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-d7bu48ntsr9 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-d7bu48ntsr9 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-d7bu48ntsr9 .cluster text{fill:#F9FFFE;}#mermaid-d7bu48ntsr9 .cluster span{color:#F9FFFE;}#mermaid-d7bu48ntsr9 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-d7bu48ntsr9 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-d7bu48ntsr9 rect.text{fill:none;stroke-width:0;}#mermaid-d7bu48ntsr9 .icon-shape,#mermaid-d7bu48ntsr9 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-d7bu48ntsr9 .icon-shape p,#mermaid-d7bu48ntsr9 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-d7bu48ntsr9 .icon-shape rect,#mermaid-d7bu48ntsr9 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-d7bu48ntsr9 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-d7bu48ntsr9 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-d7bu48ntsr9 :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Yes

No

Sentinel emits cross-chain call

Reactive relayer online?

Public relayer forwards

Hybrid relayer detects

Hybrid relayer forwards

Hook receives call

Failure Modes:

1. Reactive Network Downtime: Hybrid relayer monitors Oracle directly as fallback
2. Message Loss: Relayer retries with exponential backoff
3. L2 Congestion: Gas price escalation for priority execution
4. Invalid Sender: Hook rejects calls not from authorized Sentinel

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)[contracts/README.md#39-44](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L39-L44)

### Access Control VerificationLink copied!

The `AegisHook` implements strict sender validation:

```
modifier onlySentinel() {
    require(msg.sender == SENTINEL_ADDRESS, "Unauthorized");
    _;
}
 
function setPanicMode(bool _panic) external onlySentinel {
    panicMode = _panic;
}
```

This ensures that only the authorized Sentinel on Reactive Network can control the circuit breaker state.

Sources:[contracts/README.md#33-37](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L33-L37)[README.md#62-66](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L62-L66)

---

## Cross-Chain Message LatencyLink copied!

The system achieves sub-second response times through architecture optimization.

### Timing AnalysisLink copied!

#mermaid-eioer6ctt0s{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-eioer6ctt0s .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-eioer6ctt0s .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-eioer6ctt0s .error-icon{fill:#a44141;}#mermaid-eioer6ctt0s .error-text{fill:#ddd;stroke:#ddd;}#mermaid-eioer6ctt0s .edge-thickness-normal{stroke-width:1px;}#mermaid-eioer6ctt0s .edge-thickness-thick{stroke-width:3.5px;}#mermaid-eioer6ctt0s .edge-pattern-solid{stroke-dasharray:0;}#mermaid-eioer6ctt0s .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-eioer6ctt0s .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-eioer6ctt0s .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-eioer6ctt0s .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-eioer6ctt0s .marker.cross{stroke:lightgrey;}#mermaid-eioer6ctt0s svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-eioer6ctt0s p{margin:0;}#mermaid-eioer6ctt0s .mermaid-main-font{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}#mermaid-eioer6ctt0s .exclude-range{fill:hsl(52.9411764706, 28.813559322%, 48.431372549%);}#mermaid-eioer6ctt0s .section{stroke:none;opacity:0.2;}#mermaid-eioer6ctt0s .section0{fill:hsl(52.9411764706, 28.813559322%, 58.431372549%);}#mermaid-eioer6ctt0s .section2{fill:#EAE8D9;}#mermaid-eioer6ctt0s .section1,#mermaid-eioer6ctt0s .section3{fill:#333;opacity:0.2;}#mermaid-eioer6ctt0s .sectionTitle0{fill:#F9FFFE;}#mermaid-eioer6ctt0s .sectionTitle1{fill:#F9FFFE;}#mermaid-eioer6ctt0s .sectionTitle2{fill:#F9FFFE;}#mermaid-eioer6ctt0s .sectionTitle3{fill:#F9FFFE;}#mermaid-eioer6ctt0s .sectionTitle{text-anchor:start;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}#mermaid-eioer6ctt0s .grid .tick{stroke:lightgrey;opacity:0.8;shape-rendering:crispEdges;}#mermaid-eioer6ctt0s .grid .tick text{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;fill:#ccc;}#mermaid-eioer6ctt0s .grid path{stroke-width:0;}#mermaid-eioer6ctt0s .today{fill:none;stroke:#DB5757;stroke-width:2px;}#mermaid-eioer6ctt0s .task{stroke-width:2;}#mermaid-eioer6ctt0s .taskText{text-anchor:middle;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}#mermaid-eioer6ctt0s .taskTextOutsideRight{fill:hsl(28.5714285714, 17.3553719008%, 86.2745098039%);text-anchor:start;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}#mermaid-eioer6ctt0s .taskTextOutsideLeft{fill:hsl(28.5714285714, 17.3553719008%, 86.2745098039%);text-anchor:end;}#mermaid-eioer6ctt0s .task.clickable{cursor:pointer;}#mermaid-eioer6ctt0s .taskText.clickable{cursor:pointer;fill:#003163!important;font-weight:bold;}#mermaid-eioer6ctt0s .taskTextOutsideLeft.clickable{cursor:pointer;fill:#003163!important;font-weight:bold;}#mermaid-eioer6ctt0s .taskTextOutsideRight.clickable{cursor:pointer;fill:#003163!important;font-weight:bold;}#mermaid-eioer6ctt0s .taskText0,#mermaid-eioer6ctt0s .taskText1,#mermaid-eioer6ctt0s .taskText2,#mermaid-eioer6ctt0s .taskText3{fill:hsl(28.5714285714, 17.3553719008%, 86.2745098039%);}#mermaid-eioer6ctt0s .task0,#mermaid-eioer6ctt0s .task1,#mermaid-eioer6ctt0s .task2,#mermaid-eioer6ctt0s .task3{fill:hsl(180, 1.5873015873%, 35.3529411765%);stroke:#ffffff;}#mermaid-eioer6ctt0s .taskTextOutside0,#mermaid-eioer6ctt0s .taskTextOutside2{fill:lightgrey;}#mermaid-eioer6ctt0s .taskTextOutside1,#mermaid-eioer6ctt0s .taskTextOutside3{fill:lightgrey;}#mermaid-eioer6ctt0s .active0,#mermaid-eioer6ctt0s .active1,#mermaid-eioer6ctt0s .active2,#mermaid-eioer6ctt0s .active3{fill:#81B1DB;stroke:#ffffff;}#mermaid-eioer6ctt0s .activeText0,#mermaid-eioer6ctt0s .activeText1,#mermaid-eioer6ctt0s .activeText2,#mermaid-eioer6ctt0s .activeText3{fill:hsl(28.5714285714, 17.3553719008%, 86.2745098039%)!important;}#mermaid-eioer6ctt0s .done0,#mermaid-eioer6ctt0s .done1,#mermaid-eioer6ctt0s .done2,#mermaid-eioer6ctt0s .done3{stroke:grey;fill:lightgrey;stroke-width:2;}#mermaid-eioer6ctt0s .doneText0,#mermaid-eioer6ctt0s .doneText1,#mermaid-eioer6ctt0s .doneText2,#mermaid-eioer6ctt0s .doneText3{fill:hsl(28.5714285714, 17.3553719008%, 86.2745098039%)!important;}#mermaid-eioer6ctt0s .crit0,#mermaid-eioer6ctt0s .crit1,#mermaid-eioer6ctt0s .crit2,#mermaid-eioer6ctt0s .crit3{stroke:#E83737;fill:#E83737;stroke-width:2;}#mermaid-eioer6ctt0s .activeCrit0,#mermaid-eioer6ctt0s .activeCrit1,#mermaid-eioer6ctt0s .activeCrit2,#mermaid-eioer6ctt0s .activeCrit3{stroke:#E83737;fill:#81B1DB;stroke-width:2;}#mermaid-eioer6ctt0s .doneCrit0,#mermaid-eioer6ctt0s .doneCrit1,#mermaid-eioer6ctt0s .doneCrit2,#mermaid-eioer6ctt0s .doneCrit3{stroke:#E83737;fill:lightgrey;stroke-width:2;cursor:pointer;shape-rendering:crispEdges;}#mermaid-eioer6ctt0s .milestone{transform:rotate(45deg) scale(0.8,0.8);}#mermaid-eioer6ctt0s .milestoneText{font-style:italic;}#mermaid-eioer6ctt0s .doneCritText0,#mermaid-eioer6ctt0s .doneCritText1,#mermaid-eioer6ctt0s .doneCritText2,#mermaid-eioer6ctt0s .doneCritText3{fill:hsl(28.5714285714, 17.3553719008%, 86.2745098039%)!important;}#mermaid-eioer6ctt0s .vert{stroke:#00BFFF;}#mermaid-eioer6ctt0s .vertText{font-size:15px;text-anchor:middle;fill:#00BFFF!important;}#mermaid-eioer6ctt0s .activeCritText0,#mermaid-eioer6ctt0s .activeCritText1,#mermaid-eioer6ctt0s .activeCritText2,#mermaid-eioer6ctt0s .activeCritText3{fill:hsl(28.5714285714, 17.3553719008%, 86.2745098039%)!important;}#mermaid-eioer6ctt0s .titleText{text-anchor:middle;font-size:18px;fill:#F9FFFE;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}#mermaid-eioer6ctt0s :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}000 ms000 ms000 ms000 ms000 ms000 ms000 ms000 ms000 ms000 ms000 ms000 ms000 ms000 ms000 ms000 msOracle emits PriceUpdate End-to-end response Sentinel detects event Sentinel processes react() Sentinel emits cross-chain call Relayer forwards to L2 Hook executes setPanicMode() L1 EventReactive NetworkL2 ExecutionTotal Latency"Cross-Chain Message Latency Breakdown"

Latency Benchmarks:

StageDurationNotesL1 event emission~100msSepolia block time (12s) / 120 transactionsReactive detection~150msEvent indexing and processingSentinel logic~150msPrice threshold check and encodingRelayer forwarding~250msNetwork latency and relayer processingL2 execution~250msUnichain Flashblocks (250ms block time)Total~900msSub-second crisis response

Critical Path Optimization: Unichain's Flashblocks (250ms block times) enable the Hook to activate before arbitrage bots can exploit stale prices, creating a temporal advantage for LP protection.

Sources:[README.md#49-51](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L49-L51)[README.md#14-15](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L14-L15)

---

# Hybrid-Relayer

# Hybrid RelayerLink copied!
Relevant source files
- [README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md)

## Purpose and ScopeLink copied!

This page documents the custom hybrid relayer (`relay.ts`) built as a fallback mechanism to ensure reliable cross-chain message delivery between Ethereum Sepolia L1 and Unichain L2 during periods of testnet infrastructure instability. The hybrid relayer monitors the `MockOracle` contract directly and forwards panic mode signals to the `AegisHook` contract when the primary Reactive Network path experiences delays.

For information about the primary cross-chain messaging system, see [Cross-Chain Messaging](#3.2). For details on the Reactive Network integration, see [Reactive Network Integration](#3.1).

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)

---

## System ContextLink copied!

The Aegis system is designed to operate autonomously via the Reactive Network, which monitors L1 events and triggers L2 callbacks without centralized infrastructure. However, during the Uniswap Hook Incubator hackathon, the public Reactive Network relayers for Unichain Sepolia (Chain ID 1301) experienced intermittent latency issues. While the `AegisSentinel` contract on Reactive Network correctly detected price updates from Sepolia, messages occasionally stalled before reaching Unichain.

To ensure seamless operation for demonstrations and testing, a hybrid relayer was implemented to provide redundant message delivery.

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)

---

## Architecture OverviewLink copied!

### Dual-Path Message DeliveryLink copied!

#mermaid-mxcpfe1owp{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-mxcpfe1owp .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-mxcpfe1owp .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-mxcpfe1owp .error-icon{fill:#a44141;}#mermaid-mxcpfe1owp .error-text{fill:#ddd;stroke:#ddd;}#mermaid-mxcpfe1owp .edge-thickness-normal{stroke-width:1px;}#mermaid-mxcpfe1owp .edge-thickness-thick{stroke-width:3.5px;}#mermaid-mxcpfe1owp .edge-pattern-solid{stroke-dasharray:0;}#mermaid-mxcpfe1owp .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-mxcpfe1owp .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-mxcpfe1owp .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-mxcpfe1owp .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-mxcpfe1owp .marker.cross{stroke:lightgrey;}#mermaid-mxcpfe1owp svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-mxcpfe1owp p{margin:0;}#mermaid-mxcpfe1owp .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-mxcpfe1owp .cluster-label text{fill:#F9FFFE;}#mermaid-mxcpfe1owp .cluster-label span{color:#F9FFFE;}#mermaid-mxcpfe1owp .cluster-label span p{background-color:transparent;}#mermaid-mxcpfe1owp .label text,#mermaid-mxcpfe1owp span{fill:#ccc;color:#ccc;}#mermaid-mxcpfe1owp .node rect,#mermaid-mxcpfe1owp .node circle,#mermaid-mxcpfe1owp .node ellipse,#mermaid-mxcpfe1owp .node polygon,#mermaid-mxcpfe1owp .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-mxcpfe1owp .rough-node .label text,#mermaid-mxcpfe1owp .node .label text,#mermaid-mxcpfe1owp .image-shape .label,#mermaid-mxcpfe1owp .icon-shape .label{text-anchor:middle;}#mermaid-mxcpfe1owp .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-mxcpfe1owp .rough-node .label,#mermaid-mxcpfe1owp .node .label,#mermaid-mxcpfe1owp .image-shape .label,#mermaid-mxcpfe1owp .icon-shape .label{text-align:center;}#mermaid-mxcpfe1owp .node.clickable{cursor:pointer;}#mermaid-mxcpfe1owp .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-mxcpfe1owp .arrowheadPath{fill:lightgrey;}#mermaid-mxcpfe1owp .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-mxcpfe1owp .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-mxcpfe1owp .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-mxcpfe1owp .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-mxcpfe1owp .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-mxcpfe1owp .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-mxcpfe1owp .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-mxcpfe1owp .cluster text{fill:#F9FFFE;}#mermaid-mxcpfe1owp .cluster span{color:#F9FFFE;}#mermaid-mxcpfe1owp div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-mxcpfe1owp .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-mxcpfe1owp rect.text{fill:none;stroke-width:0;}#mermaid-mxcpfe1owp .icon-shape,#mermaid-mxcpfe1owp .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-mxcpfe1owp .icon-shape p,#mermaid-mxcpfe1owp .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-mxcpfe1owp .icon-shape rect,#mermaid-mxcpfe1owp .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-mxcpfe1owp .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-mxcpfe1owp .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-mxcpfe1owp :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Off-Chain Infrastructure

L2 - Unichain Sepolia

Middleware - Reactive Network

L1 - Ethereum Sepolia

1.Emit PriceUpdate

1.Monitor Events

2a. Cross-Chain Call (Primary Path)

3a. Forward Message

2b. Direct Call (Fallback Path)

MockOracle 0x1392C38921A818cEdb100cC3767e8f30deC3a7D8

AegisSentinel 0x0B6ae13119Fc3b61d6ABb115342A1A075e14b6B6

Reactive Network Public Relayer

AegisHook 0x1E2aE114cF3B63779A1367eD704ccA51a0218080

Hybrid Relayer relay.ts TypeScript Process

Dual-Path Message Delivery Architecture

The system operates with two parallel message delivery paths:

PathMechanismLatencyDecentralizationUse CasePrimaryReactive Network relayerVariable (testnet)Fully decentralizedProduction operationFallbackHybrid relayer (`relay.ts`)~1-2 secondsCentralized processTestnet/demo reliability

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)[README.md#56-75](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L56-L75)

---

## Implementation StrategyLink copied!

### Event Monitoring ApproachLink copied!

The hybrid relayer implements direct event monitoring of the `MockOracle` contract on Ethereum Sepolia:

"AegisSentinel (Reactive)""AegisHook (Unichain)""relay.ts (Off-Chain)""MockOracle (Sepolia)""AegisSentinel (Reactive)""AegisHook (Unichain)""relay.ts (Off-Chain)""MockOracle (Sepolia)"#mermaid-d9s6ccnf26e{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-d9s6ccnf26e .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-d9s6ccnf26e .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-d9s6ccnf26e .error-icon{fill:#a44141;}#mermaid-d9s6ccnf26e .error-text{fill:#ddd;stroke:#ddd;}#mermaid-d9s6ccnf26e .edge-thickness-normal{stroke-width:1px;}#mermaid-d9s6ccnf26e .edge-thickness-thick{stroke-width:3.5px;}#mermaid-d9s6ccnf26e .edge-pattern-solid{stroke-dasharray:0;}#mermaid-d9s6ccnf26e .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-d9s6ccnf26e .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-d9s6ccnf26e .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-d9s6ccnf26e .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-d9s6ccnf26e .marker.cross{stroke:lightgrey;}#mermaid-d9s6ccnf26e svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-d9s6ccnf26e p{margin:0;}#mermaid-d9s6ccnf26e .actor{stroke:#ccc;fill:#1f2020;}#mermaid-d9s6ccnf26e text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-d9s6ccnf26e .actor-line{stroke:#ccc;}#mermaid-d9s6ccnf26e .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-d9s6ccnf26e .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-d9s6ccnf26e .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-d9s6ccnf26e #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-d9s6ccnf26e .sequenceNumber{fill:black;}#mermaid-d9s6ccnf26e #sequencenumber{fill:lightgrey;}#mermaid-d9s6ccnf26e #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-d9s6ccnf26e .messageText{fill:lightgrey;stroke:none;}#mermaid-d9s6ccnf26e .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-d9s6ccnf26e .labelText,#mermaid-d9s6ccnf26e .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-d9s6ccnf26e .loopText,#mermaid-d9s6ccnf26e .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-d9s6ccnf26e .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-d9s6ccnf26e .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-d9s6ccnf26e .noteText,#mermaid-d9s6ccnf26e .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-d9s6ccnf26e .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-d9s6ccnf26e .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-d9s6ccnf26e .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-d9s6ccnf26e .actorPopupMenu{position:absolute;}#mermaid-d9s6ccnf26e .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-d9s6ccnf26e .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-d9s6ccnf26e .actor-man circle,#mermaid-d9s6ccnf26e line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-d9s6ccnf26e :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}Normal OperationTestnet Latency EventRelayer delay...Log intervention"Emit PriceUpdate(2000)""Detect PriceUpdate(2000)""setPanicMode(false)""Sentinel responsive No action needed""Emit PriceUpdate(1000)""Detect PriceUpdate(1000)""Price < THRESHOLD Wait 5 seconds""Check panicMode state""panicMode == false""setPanicMode(true) (Fallback Activation)"

Hybrid Relayer Intervention Logic

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)

---

## Operational ModesLink copied!

### Mode 1: Passive MonitoringLink copied!

In passive mode, the relayer observes events but does not intervene:

1. Subscribe to `PriceUpdate` events from `MockOracle` contract
2. Calculate whether price crosses the panic threshold (e.g., $1500 for ETH)
3. Wait for a configurable timeout period (default: 5 seconds)
4. Query the `AegisHook` contract's `panicMode` state
5. If state matches expected value, log success and continue monitoring

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)

### Mode 2: Active InterventionLink copied!

Active mode triggers when the Reactive Network path is delayed:

#mermaid-l6qm37frsv{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-l6qm37frsv .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-l6qm37frsv .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-l6qm37frsv .error-icon{fill:#a44141;}#mermaid-l6qm37frsv .error-text{fill:#ddd;stroke:#ddd;}#mermaid-l6qm37frsv .edge-thickness-normal{stroke-width:1px;}#mermaid-l6qm37frsv .edge-thickness-thick{stroke-width:3.5px;}#mermaid-l6qm37frsv .edge-pattern-solid{stroke-dasharray:0;}#mermaid-l6qm37frsv .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-l6qm37frsv .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-l6qm37frsv .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-l6qm37frsv .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-l6qm37frsv .marker.cross{stroke:lightgrey;}#mermaid-l6qm37frsv svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-l6qm37frsv p{margin:0;}#mermaid-l6qm37frsv defs #statediagram-barbEnd{fill:lightgrey;stroke:lightgrey;}#mermaid-l6qm37frsv g.stateGroup text{fill:#ccc;stroke:none;font-size:10px;}#mermaid-l6qm37frsv g.stateGroup text{fill:#ccc;stroke:none;font-size:10px;}#mermaid-l6qm37frsv g.stateGroup .state-title{font-weight:bolder;fill:#e0dfdf;}#mermaid-l6qm37frsv g.stateGroup rect{fill:#1f2020;stroke:#ccc;}#mermaid-l6qm37frsv g.stateGroup line{stroke:lightgrey;stroke-width:1;}#mermaid-l6qm37frsv .transition{stroke:lightgrey;stroke-width:1;fill:none;}#mermaid-l6qm37frsv .stateGroup .composit{fill:#333;border-bottom:1px;}#mermaid-l6qm37frsv .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px;}#mermaid-l6qm37frsv .state-note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-l6qm37frsv .state-note text{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;font-size:10px;}#mermaid-l6qm37frsv .stateLabel .box{stroke:none;stroke-width:0;fill:#1f2020;opacity:0.5;}#mermaid-l6qm37frsv .edgeLabel .label rect{fill:#1f2020;opacity:0.5;}#mermaid-l6qm37frsv .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-l6qm37frsv .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-l6qm37frsv .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-l6qm37frsv .edgeLabel .label text{fill:#ccc;}#mermaid-l6qm37frsv .label div .edgeLabel{color:#ccc;}#mermaid-l6qm37frsv .stateLabel text{fill:#e0dfdf;font-size:10px;font-weight:bold;}#mermaid-l6qm37frsv .node circle.state-start{fill:#f4f4f4;stroke:#f4f4f4;}#mermaid-l6qm37frsv .node .fork-join{fill:#f4f4f4;stroke:#f4f4f4;}#mermaid-l6qm37frsv .node circle.state-end{fill:#cccccc;stroke:#333;stroke-width:1.5;}#mermaid-l6qm37frsv .end-state-inner{fill:#333;stroke-width:1.5;}#mermaid-l6qm37frsv .node rect{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-l6qm37frsv .node polygon{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-l6qm37frsv #statediagram-barbEnd{fill:lightgrey;}#mermaid-l6qm37frsv .statediagram-cluster rect{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-l6qm37frsv .cluster-label,#mermaid-l6qm37frsv .nodeLabel{color:#e0dfdf;}#mermaid-l6qm37frsv .statediagram-cluster rect.outer{rx:5px;ry:5px;}#mermaid-l6qm37frsv .statediagram-state .divider{stroke:#ccc;}#mermaid-l6qm37frsv .statediagram-state .title-state{rx:5px;ry:5px;}#mermaid-l6qm37frsv .statediagram-cluster.statediagram-cluster .inner{fill:#333;}#mermaid-l6qm37frsv .statediagram-cluster.statediagram-cluster-alt .inner{fill:#555;}#mermaid-l6qm37frsv .statediagram-cluster .inner{rx:0;ry:0;}#mermaid-l6qm37frsv .statediagram-state rect.basic{rx:5px;ry:5px;}#mermaid-l6qm37frsv .statediagram-state rect.divider{stroke-dasharray:10,10;fill:#555;}#mermaid-l6qm37frsv .note-edge{stroke-dasharray:5;}#mermaid-l6qm37frsv .statediagram-note rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:hsl(180, 0%, 18.3529411765%);stroke-width:1px;rx:0;ry:0;}#mermaid-l6qm37frsv .statediagram-note rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:hsl(180, 0%, 18.3529411765%);stroke-width:1px;rx:0;ry:0;}#mermaid-l6qm37frsv .statediagram-note text{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);}#mermaid-l6qm37frsv .statediagram-note .nodeLabel{color:rgb(183.8476190475, 181.5523809523, 181.5523809523);}#mermaid-l6qm37frsv .statediagram .edgeLabel{color:red;}#mermaid-l6qm37frsv #dependencyStart,#mermaid-l6qm37frsv #dependencyEnd{fill:lightgrey;stroke:lightgrey;stroke-width:1;}#mermaid-l6qm37frsv .statediagramTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-l6qm37frsv :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

"Start relay.ts"

"PriceUpdate event"

"Parse price value"

"Price < THRESHOLD"

"Price >= THRESHOLD"

"Wait 5 seconds"

"Hook state correct"

"Hook state mismatch"

"Call setPanicMode()"

"Tx confirmed"

"Tx failed"

"Continue monitoring"

Monitoring

PriceDetected

ThresholdCheck

WaitingPrimary

StateCheck

Intervention

TxSubmit

AlertAdmin

Hybrid Relayer State Machine

Intervention Criteria:

- Price update detected on L1
- Panic threshold violated
- Timeout period elapsed (primary path assumed delayed)
- Hook state does not match expected panic mode
- Relayer has valid credentials for `AegisHook.setPanicMode()`

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)

---

## Configuration and DeploymentLink copied!

### Running the RelayerLink copied!

The relayer is executed as a background process during development and testing:

```
# From the frontend directory
npm run relay &
 
# Start the UI
npm run dev
```

Sources:[README.md#116-120](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L116-L120)

### Environment VariablesLink copied!

The hybrid relayer requires the following configuration:

VariableDescriptionExample Value`SEPOLIA_RPC_URL`Ethereum Sepolia RPC endpoint`https://sepolia.infura.io/v3/...``UNICHAIN_RPC_URL`Unichain Sepolia RPC endpoint`https://sepolia.unichain.org``ORACLE_ADDRESS`Deployed `MockOracle` address`0x1392C38921A818cEdb100cC3767e8f30deC3a7D8``HOOK_ADDRESS`Deployed `AegisHook` address`0x1E2aE114cF3B63779A1367eD704ccA51a0218080``PRIVATE_KEY`Authorized wallet for calling `setPanicMode()``0x...``PANIC_THRESHOLD`Price threshold for panic activation`1500` (USD cents)`TIMEOUT_SECONDS`Wait time before fallback activation`5`

Sources:[README.md#138-142](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L138-L142)

### Network ConfigurationLink copied!

#mermaid-auwwtrm1fwo{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-auwwtrm1fwo .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-auwwtrm1fwo .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-auwwtrm1fwo .error-icon{fill:#a44141;}#mermaid-auwwtrm1fwo .error-text{fill:#ddd;stroke:#ddd;}#mermaid-auwwtrm1fwo .edge-thickness-normal{stroke-width:1px;}#mermaid-auwwtrm1fwo .edge-thickness-thick{stroke-width:3.5px;}#mermaid-auwwtrm1fwo .edge-pattern-solid{stroke-dasharray:0;}#mermaid-auwwtrm1fwo .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-auwwtrm1fwo .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-auwwtrm1fwo .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-auwwtrm1fwo .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-auwwtrm1fwo .marker.cross{stroke:lightgrey;}#mermaid-auwwtrm1fwo svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-auwwtrm1fwo p{margin:0;}#mermaid-auwwtrm1fwo .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-auwwtrm1fwo .cluster-label text{fill:#F9FFFE;}#mermaid-auwwtrm1fwo .cluster-label span{color:#F9FFFE;}#mermaid-auwwtrm1fwo .cluster-label span p{background-color:transparent;}#mermaid-auwwtrm1fwo .label text,#mermaid-auwwtrm1fwo span{fill:#ccc;color:#ccc;}#mermaid-auwwtrm1fwo .node rect,#mermaid-auwwtrm1fwo .node circle,#mermaid-auwwtrm1fwo .node ellipse,#mermaid-auwwtrm1fwo .node polygon,#mermaid-auwwtrm1fwo .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-auwwtrm1fwo .rough-node .label text,#mermaid-auwwtrm1fwo .node .label text,#mermaid-auwwtrm1fwo .image-shape .label,#mermaid-auwwtrm1fwo .icon-shape .label{text-anchor:middle;}#mermaid-auwwtrm1fwo .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-auwwtrm1fwo .rough-node .label,#mermaid-auwwtrm1fwo .node .label,#mermaid-auwwtrm1fwo .image-shape .label,#mermaid-auwwtrm1fwo .icon-shape .label{text-align:center;}#mermaid-auwwtrm1fwo .node.clickable{cursor:pointer;}#mermaid-auwwtrm1fwo .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-auwwtrm1fwo .arrowheadPath{fill:lightgrey;}#mermaid-auwwtrm1fwo .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-auwwtrm1fwo .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-auwwtrm1fwo .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-auwwtrm1fwo .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-auwwtrm1fwo .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-auwwtrm1fwo .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-auwwtrm1fwo .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-auwwtrm1fwo .cluster text{fill:#F9FFFE;}#mermaid-auwwtrm1fwo .cluster span{color:#F9FFFE;}#mermaid-auwwtrm1fwo div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-auwwtrm1fwo .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-auwwtrm1fwo rect.text{fill:none;stroke-width:0;}#mermaid-auwwtrm1fwo .icon-shape,#mermaid-auwwtrm1fwo .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-auwwtrm1fwo .icon-shape p,#mermaid-auwwtrm1fwo .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-auwwtrm1fwo .icon-shape rect,#mermaid-auwwtrm1fwo .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-auwwtrm1fwo .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-auwwtrm1fwo .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-auwwtrm1fwo :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

L2 Connection

L1 Connection

Relayer Process

relay.ts Node.js Runtime

Environment Variables RPC URLs + Keys

Sepolia RPC WebSocket Provider

MockOracle Event Subscription

Unichain RPC HTTP Provider

AegisHook Transaction Sender

Network Configuration for relay.ts

Sources:[README.md#138-142](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L138-L142)

---

## Trade-offs and Design DecisionsLink copied!

### Why Not Rely Solely on Reactive Network?Link copied!

The Reactive Network is the intended production path for Aegis because it provides:

- Decentralization: No centralized points of failure
- Trustlessness: Events trigger callbacks without human intervention
- Composability: Other protocols can subscribe to the same event streams

However, during the hackathon, testnet infrastructure limitations required a pragmatic solution:

AspectReactive Network (Primary)Hybrid Relayer (Fallback)Decentralization✅ Fully decentralized❌ Requires running serverTestnet Reliability⚠️ Variable during hackathon✅ Direct controlProduction Readiness✅ Designed for mainnet❌ Not production-suitableMaintenance✅ No operational overhead❌ Requires monitoringSecurity Model✅ Trustless execution⚠️ Trust in relayer operator

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)

### Production Migration PathLink copied!

For mainnet deployment, the hybrid relayer should be phased out in favor of exclusive Reactive Network operation:

1. Testnet Phase: Run both paths concurrently, log all interventions
2. Mainnet Observation: Deploy with Reactive Network only, monitor delivery latency
3. Fallback Decision: If mainnet relayers prove unreliable, consider running a private Reactive Network node rather than a custom relayer
4. Redundancy: For mission-critical applications, run multiple independent Reactive Network subscriptions

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)[README.md#86-91](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L86-L91)

### When to Use the Hybrid ApproachLink copied!

The hybrid relayer pattern is appropriate for:

ScenarioRecommendationHackathon/Demo✅ Use hybrid relayer for reliabilityTestnet Development✅ Use hybrid relayer during integration testingMainnet Production❌ Rely on Reactive Network or private nodesHigh-Value Pools⚠️ Consider redundant Reactive subscriptions

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)

---

## Integration with Core SystemLink copied!

### Access Control RequirementsLink copied!

The hybrid relayer must have authorization to call `AegisHook.setPanicMode()`:

#mermaid-r6pg7jxnz4r{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-r6pg7jxnz4r .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-r6pg7jxnz4r .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-r6pg7jxnz4r .error-icon{fill:#a44141;}#mermaid-r6pg7jxnz4r .error-text{fill:#ddd;stroke:#ddd;}#mermaid-r6pg7jxnz4r .edge-thickness-normal{stroke-width:1px;}#mermaid-r6pg7jxnz4r .edge-thickness-thick{stroke-width:3.5px;}#mermaid-r6pg7jxnz4r .edge-pattern-solid{stroke-dasharray:0;}#mermaid-r6pg7jxnz4r .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-r6pg7jxnz4r .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-r6pg7jxnz4r .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-r6pg7jxnz4r .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-r6pg7jxnz4r .marker.cross{stroke:lightgrey;}#mermaid-r6pg7jxnz4r svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-r6pg7jxnz4r p{margin:0;}#mermaid-r6pg7jxnz4r .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-r6pg7jxnz4r .cluster-label text{fill:#F9FFFE;}#mermaid-r6pg7jxnz4r .cluster-label span{color:#F9FFFE;}#mermaid-r6pg7jxnz4r .cluster-label span p{background-color:transparent;}#mermaid-r6pg7jxnz4r .label text,#mermaid-r6pg7jxnz4r span{fill:#ccc;color:#ccc;}#mermaid-r6pg7jxnz4r .node rect,#mermaid-r6pg7jxnz4r .node circle,#mermaid-r6pg7jxnz4r .node ellipse,#mermaid-r6pg7jxnz4r .node polygon,#mermaid-r6pg7jxnz4r .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-r6pg7jxnz4r .rough-node .label text,#mermaid-r6pg7jxnz4r .node .label text,#mermaid-r6pg7jxnz4r .image-shape .label,#mermaid-r6pg7jxnz4r .icon-shape .label{text-anchor:middle;}#mermaid-r6pg7jxnz4r .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-r6pg7jxnz4r .rough-node .label,#mermaid-r6pg7jxnz4r .node .label,#mermaid-r6pg7jxnz4r .image-shape .label,#mermaid-r6pg7jxnz4r .icon-shape .label{text-align:center;}#mermaid-r6pg7jxnz4r .node.clickable{cursor:pointer;}#mermaid-r6pg7jxnz4r .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-r6pg7jxnz4r .arrowheadPath{fill:lightgrey;}#mermaid-r6pg7jxnz4r .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-r6pg7jxnz4r .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-r6pg7jxnz4r .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-r6pg7jxnz4r .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-r6pg7jxnz4r .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-r6pg7jxnz4r .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-r6pg7jxnz4r .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-r6pg7jxnz4r .cluster text{fill:#F9FFFE;}#mermaid-r6pg7jxnz4r .cluster span{color:#F9FFFE;}#mermaid-r6pg7jxnz4r div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-r6pg7jxnz4r .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-r6pg7jxnz4r rect.text{fill:none;stroke-width:0;}#mermaid-r6pg7jxnz4r .icon-shape,#mermaid-r6pg7jxnz4r .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-r6pg7jxnz4r .icon-shape p,#mermaid-r6pg7jxnz4r .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-r6pg7jxnz4r .icon-shape rect,#mermaid-r6pg7jxnz4r .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-r6pg7jxnz4r .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-r6pg7jxnz4r .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-r6pg7jxnz4r :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Call Sources

Authorization Model

setPanicMode() Authorized

setPanicMode() Authorized

AegisHook.sol

Authorized Sender: AegisSentinel Address

Authorized Sender: Relayer Wallet

AegisSentinel (Primary)

relay.ts (Fallback)

Multi-Source Authorization for setPanicMode

The `AegisHook` contract must whitelist both the `AegisSentinel` contract address (for Reactive Network calls) and the relayer's wallet address (for fallback calls). This dual authorization enables seamless failover without contract modifications.

Sources:[README.md#39-42](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L39-L42)[README.md#138-142](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L138-L142)

---

## Monitoring and ObservabilityLink copied!

### Logging StrategyLink copied!

The hybrid relayer should implement comprehensive logging for operational visibility:

Event TypeLog LevelInformation CapturedStartupINFORPC URLs, contract addresses, threshold valuesPrice Update DetectedDEBUGTimestamp, price value, threshold comparisonPrimary Path SuccessINFOSentinel delivery confirmed, no interventionTimeout TriggeredWARNPrimary path delay detected, initiating fallbackFallback ActivationERRORTransaction hash, gas used, state before/afterTransaction FailureCRITICALError message, RPC response, retry attempts

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)

### Metrics for Dashboard IntegrationLink copied!

The relayer can expose metrics for monitoring:

- Primary path success rate: Percentage of events delivered without fallback
- Average delivery latency: Time from L1 event to L2 state change
- Fallback intervention count: Number of times relayer had to act
- Transaction gas costs: Cumulative cost of fallback operations

Sources:[README.md#95-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L95-L101)

---

## Related DocumentationLink copied!

- [Cross-Chain Messaging](#3.2): Details on the primary Reactive Network message flow
- [Reactive Network Integration](#3.1): How the `AegisSentinel` subscribes to events
- [AegisHook](#2.1): The L2 contract that receives panic mode signals
- [Deployment Verification](#5.5): How to confirm cross-chain connectivity

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)[README.md#95-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L95-L101)

---

# Hybrid-Relayer-1

# Hybrid RelayerLink copied!
Relevant source files
- [README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md)

## Purpose and ScopeLink copied!

This page documents the custom hybrid relayer (`relay.ts`) built as a fallback mechanism to ensure reliable cross-chain message delivery between Ethereum Sepolia L1 and Unichain L2 during periods of testnet infrastructure instability. The hybrid relayer monitors the `MockOracle` contract directly and forwards panic mode signals to the `AegisHook` contract when the primary Reactive Network path experiences delays.

For information about the primary cross-chain messaging system, see [Cross-Chain Messaging](#3.2). For details on the Reactive Network integration, see [Reactive Network Integration](#3.1).

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)

---

## System ContextLink copied!

The Aegis system is designed to operate autonomously via the Reactive Network, which monitors L1 events and triggers L2 callbacks without centralized infrastructure. However, during the Uniswap Hook Incubator hackathon, the public Reactive Network relayers for Unichain Sepolia (Chain ID 1301) experienced intermittent latency issues. While the `AegisSentinel` contract on Reactive Network correctly detected price updates from Sepolia, messages occasionally stalled before reaching Unichain.

To ensure seamless operation for demonstrations and testing, a hybrid relayer was implemented to provide redundant message delivery.

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)

---

## Architecture OverviewLink copied!

### Dual-Path Message DeliveryLink copied!

#mermaid-mxcpfe1owp{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-mxcpfe1owp .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-mxcpfe1owp .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-mxcpfe1owp .error-icon{fill:#a44141;}#mermaid-mxcpfe1owp .error-text{fill:#ddd;stroke:#ddd;}#mermaid-mxcpfe1owp .edge-thickness-normal{stroke-width:1px;}#mermaid-mxcpfe1owp .edge-thickness-thick{stroke-width:3.5px;}#mermaid-mxcpfe1owp .edge-pattern-solid{stroke-dasharray:0;}#mermaid-mxcpfe1owp .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-mxcpfe1owp .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-mxcpfe1owp .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-mxcpfe1owp .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-mxcpfe1owp .marker.cross{stroke:lightgrey;}#mermaid-mxcpfe1owp svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-mxcpfe1owp p{margin:0;}#mermaid-mxcpfe1owp .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-mxcpfe1owp .cluster-label text{fill:#F9FFFE;}#mermaid-mxcpfe1owp .cluster-label span{color:#F9FFFE;}#mermaid-mxcpfe1owp .cluster-label span p{background-color:transparent;}#mermaid-mxcpfe1owp .label text,#mermaid-mxcpfe1owp span{fill:#ccc;color:#ccc;}#mermaid-mxcpfe1owp .node rect,#mermaid-mxcpfe1owp .node circle,#mermaid-mxcpfe1owp .node ellipse,#mermaid-mxcpfe1owp .node polygon,#mermaid-mxcpfe1owp .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-mxcpfe1owp .rough-node .label text,#mermaid-mxcpfe1owp .node .label text,#mermaid-mxcpfe1owp .image-shape .label,#mermaid-mxcpfe1owp .icon-shape .label{text-anchor:middle;}#mermaid-mxcpfe1owp .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-mxcpfe1owp .rough-node .label,#mermaid-mxcpfe1owp .node .label,#mermaid-mxcpfe1owp .image-shape .label,#mermaid-mxcpfe1owp .icon-shape .label{text-align:center;}#mermaid-mxcpfe1owp .node.clickable{cursor:pointer;}#mermaid-mxcpfe1owp .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-mxcpfe1owp .arrowheadPath{fill:lightgrey;}#mermaid-mxcpfe1owp .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-mxcpfe1owp .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-mxcpfe1owp .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-mxcpfe1owp .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-mxcpfe1owp .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-mxcpfe1owp .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-mxcpfe1owp .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-mxcpfe1owp .cluster text{fill:#F9FFFE;}#mermaid-mxcpfe1owp .cluster span{color:#F9FFFE;}#mermaid-mxcpfe1owp div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-mxcpfe1owp .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-mxcpfe1owp rect.text{fill:none;stroke-width:0;}#mermaid-mxcpfe1owp .icon-shape,#mermaid-mxcpfe1owp .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-mxcpfe1owp .icon-shape p,#mermaid-mxcpfe1owp .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-mxcpfe1owp .icon-shape rect,#mermaid-mxcpfe1owp .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-mxcpfe1owp .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-mxcpfe1owp .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-mxcpfe1owp :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Off-Chain Infrastructure

L2 - Unichain Sepolia

Middleware - Reactive Network

L1 - Ethereum Sepolia

1.Emit PriceUpdate

1.Monitor Events

2a. Cross-Chain Call (Primary Path)

3a. Forward Message

2b. Direct Call (Fallback Path)

MockOracle 0x1392C38921A818cEdb100cC3767e8f30deC3a7D8

AegisSentinel 0x0B6ae13119Fc3b61d6ABb115342A1A075e14b6B6

Reactive Network Public Relayer

AegisHook 0x1E2aE114cF3B63779A1367eD704ccA51a0218080

Hybrid Relayer relay.ts TypeScript Process

Dual-Path Message Delivery Architecture

The system operates with two parallel message delivery paths:

PathMechanismLatencyDecentralizationUse CasePrimaryReactive Network relayerVariable (testnet)Fully decentralizedProduction operationFallbackHybrid relayer (`relay.ts`)~1-2 secondsCentralized processTestnet/demo reliability

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)[README.md#56-75](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L56-L75)

---

## Implementation StrategyLink copied!

### Event Monitoring ApproachLink copied!

The hybrid relayer implements direct event monitoring of the `MockOracle` contract on Ethereum Sepolia:

"AegisSentinel (Reactive)""AegisHook (Unichain)""relay.ts (Off-Chain)""MockOracle (Sepolia)""AegisSentinel (Reactive)""AegisHook (Unichain)""relay.ts (Off-Chain)""MockOracle (Sepolia)"#mermaid-d9s6ccnf26e{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-d9s6ccnf26e .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-d9s6ccnf26e .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-d9s6ccnf26e .error-icon{fill:#a44141;}#mermaid-d9s6ccnf26e .error-text{fill:#ddd;stroke:#ddd;}#mermaid-d9s6ccnf26e .edge-thickness-normal{stroke-width:1px;}#mermaid-d9s6ccnf26e .edge-thickness-thick{stroke-width:3.5px;}#mermaid-d9s6ccnf26e .edge-pattern-solid{stroke-dasharray:0;}#mermaid-d9s6ccnf26e .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-d9s6ccnf26e .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-d9s6ccnf26e .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-d9s6ccnf26e .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-d9s6ccnf26e .marker.cross{stroke:lightgrey;}#mermaid-d9s6ccnf26e svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-d9s6ccnf26e p{margin:0;}#mermaid-d9s6ccnf26e .actor{stroke:#ccc;fill:#1f2020;}#mermaid-d9s6ccnf26e text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-d9s6ccnf26e .actor-line{stroke:#ccc;}#mermaid-d9s6ccnf26e .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-d9s6ccnf26e .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-d9s6ccnf26e .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-d9s6ccnf26e #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-d9s6ccnf26e .sequenceNumber{fill:black;}#mermaid-d9s6ccnf26e #sequencenumber{fill:lightgrey;}#mermaid-d9s6ccnf26e #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-d9s6ccnf26e .messageText{fill:lightgrey;stroke:none;}#mermaid-d9s6ccnf26e .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-d9s6ccnf26e .labelText,#mermaid-d9s6ccnf26e .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-d9s6ccnf26e .loopText,#mermaid-d9s6ccnf26e .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-d9s6ccnf26e .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-d9s6ccnf26e .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-d9s6ccnf26e .noteText,#mermaid-d9s6ccnf26e .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-d9s6ccnf26e .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-d9s6ccnf26e .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-d9s6ccnf26e .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-d9s6ccnf26e .actorPopupMenu{position:absolute;}#mermaid-d9s6ccnf26e .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-d9s6ccnf26e .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-d9s6ccnf26e .actor-man circle,#mermaid-d9s6ccnf26e line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-d9s6ccnf26e :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}Normal OperationTestnet Latency EventRelayer delay...Log intervention"Emit PriceUpdate(2000)""Detect PriceUpdate(2000)""setPanicMode(false)""Sentinel responsive No action needed""Emit PriceUpdate(1000)""Detect PriceUpdate(1000)""Price < THRESHOLD Wait 5 seconds""Check panicMode state""panicMode == false""setPanicMode(true) (Fallback Activation)"

Hybrid Relayer Intervention Logic

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)

---

## Operational ModesLink copied!

### Mode 1: Passive MonitoringLink copied!

In passive mode, the relayer observes events but does not intervene:

1. Subscribe to `PriceUpdate` events from `MockOracle` contract
2. Calculate whether price crosses the panic threshold (e.g., $1500 for ETH)
3. Wait for a configurable timeout period (default: 5 seconds)
4. Query the `AegisHook` contract's `panicMode` state
5. If state matches expected value, log success and continue monitoring

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)

### Mode 2: Active InterventionLink copied!

Active mode triggers when the Reactive Network path is delayed:

#mermaid-l6qm37frsv{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-l6qm37frsv .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-l6qm37frsv .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-l6qm37frsv .error-icon{fill:#a44141;}#mermaid-l6qm37frsv .error-text{fill:#ddd;stroke:#ddd;}#mermaid-l6qm37frsv .edge-thickness-normal{stroke-width:1px;}#mermaid-l6qm37frsv .edge-thickness-thick{stroke-width:3.5px;}#mermaid-l6qm37frsv .edge-pattern-solid{stroke-dasharray:0;}#mermaid-l6qm37frsv .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-l6qm37frsv .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-l6qm37frsv .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-l6qm37frsv .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-l6qm37frsv .marker.cross{stroke:lightgrey;}#mermaid-l6qm37frsv svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-l6qm37frsv p{margin:0;}#mermaid-l6qm37frsv defs #statediagram-barbEnd{fill:lightgrey;stroke:lightgrey;}#mermaid-l6qm37frsv g.stateGroup text{fill:#ccc;stroke:none;font-size:10px;}#mermaid-l6qm37frsv g.stateGroup text{fill:#ccc;stroke:none;font-size:10px;}#mermaid-l6qm37frsv g.stateGroup .state-title{font-weight:bolder;fill:#e0dfdf;}#mermaid-l6qm37frsv g.stateGroup rect{fill:#1f2020;stroke:#ccc;}#mermaid-l6qm37frsv g.stateGroup line{stroke:lightgrey;stroke-width:1;}#mermaid-l6qm37frsv .transition{stroke:lightgrey;stroke-width:1;fill:none;}#mermaid-l6qm37frsv .stateGroup .composit{fill:#333;border-bottom:1px;}#mermaid-l6qm37frsv .stateGroup .alt-composit{fill:#e0e0e0;border-bottom:1px;}#mermaid-l6qm37frsv .state-note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-l6qm37frsv .state-note text{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;font-size:10px;}#mermaid-l6qm37frsv .stateLabel .box{stroke:none;stroke-width:0;fill:#1f2020;opacity:0.5;}#mermaid-l6qm37frsv .edgeLabel .label rect{fill:#1f2020;opacity:0.5;}#mermaid-l6qm37frsv .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-l6qm37frsv .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-l6qm37frsv .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-l6qm37frsv .edgeLabel .label text{fill:#ccc;}#mermaid-l6qm37frsv .label div .edgeLabel{color:#ccc;}#mermaid-l6qm37frsv .stateLabel text{fill:#e0dfdf;font-size:10px;font-weight:bold;}#mermaid-l6qm37frsv .node circle.state-start{fill:#f4f4f4;stroke:#f4f4f4;}#mermaid-l6qm37frsv .node .fork-join{fill:#f4f4f4;stroke:#f4f4f4;}#mermaid-l6qm37frsv .node circle.state-end{fill:#cccccc;stroke:#333;stroke-width:1.5;}#mermaid-l6qm37frsv .end-state-inner{fill:#333;stroke-width:1.5;}#mermaid-l6qm37frsv .node rect{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-l6qm37frsv .node polygon{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-l6qm37frsv #statediagram-barbEnd{fill:lightgrey;}#mermaid-l6qm37frsv .statediagram-cluster rect{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-l6qm37frsv .cluster-label,#mermaid-l6qm37frsv .nodeLabel{color:#e0dfdf;}#mermaid-l6qm37frsv .statediagram-cluster rect.outer{rx:5px;ry:5px;}#mermaid-l6qm37frsv .statediagram-state .divider{stroke:#ccc;}#mermaid-l6qm37frsv .statediagram-state .title-state{rx:5px;ry:5px;}#mermaid-l6qm37frsv .statediagram-cluster.statediagram-cluster .inner{fill:#333;}#mermaid-l6qm37frsv .statediagram-cluster.statediagram-cluster-alt .inner{fill:#555;}#mermaid-l6qm37frsv .statediagram-cluster .inner{rx:0;ry:0;}#mermaid-l6qm37frsv .statediagram-state rect.basic{rx:5px;ry:5px;}#mermaid-l6qm37frsv .statediagram-state rect.divider{stroke-dasharray:10,10;fill:#555;}#mermaid-l6qm37frsv .note-edge{stroke-dasharray:5;}#mermaid-l6qm37frsv .statediagram-note rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:hsl(180, 0%, 18.3529411765%);stroke-width:1px;rx:0;ry:0;}#mermaid-l6qm37frsv .statediagram-note rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:hsl(180, 0%, 18.3529411765%);stroke-width:1px;rx:0;ry:0;}#mermaid-l6qm37frsv .statediagram-note text{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);}#mermaid-l6qm37frsv .statediagram-note .nodeLabel{color:rgb(183.8476190475, 181.5523809523, 181.5523809523);}#mermaid-l6qm37frsv .statediagram .edgeLabel{color:red;}#mermaid-l6qm37frsv #dependencyStart,#mermaid-l6qm37frsv #dependencyEnd{fill:lightgrey;stroke:lightgrey;stroke-width:1;}#mermaid-l6qm37frsv .statediagramTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-l6qm37frsv :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

"Start relay.ts"

"PriceUpdate event"

"Parse price value"

"Price < THRESHOLD"

"Price >= THRESHOLD"

"Wait 5 seconds"

"Hook state correct"

"Hook state mismatch"

"Call setPanicMode()"

"Tx confirmed"

"Tx failed"

"Continue monitoring"

Monitoring

PriceDetected

ThresholdCheck

WaitingPrimary

StateCheck

Intervention

TxSubmit

AlertAdmin

Hybrid Relayer State Machine

Intervention Criteria:

- Price update detected on L1
- Panic threshold violated
- Timeout period elapsed (primary path assumed delayed)
- Hook state does not match expected panic mode
- Relayer has valid credentials for `AegisHook.setPanicMode()`

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)

---

## Configuration and DeploymentLink copied!

### Running the RelayerLink copied!

The relayer is executed as a background process during development and testing:

```
# From the frontend directory
npm run relay &
 
# Start the UI
npm run dev
```

Sources:[README.md#116-120](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L116-L120)

### Environment VariablesLink copied!

The hybrid relayer requires the following configuration:

VariableDescriptionExample Value`SEPOLIA_RPC_URL`Ethereum Sepolia RPC endpoint`https://sepolia.infura.io/v3/...``UNICHAIN_RPC_URL`Unichain Sepolia RPC endpoint`https://sepolia.unichain.org``ORACLE_ADDRESS`Deployed `MockOracle` address`0x1392C38921A818cEdb100cC3767e8f30deC3a7D8``HOOK_ADDRESS`Deployed `AegisHook` address`0x1E2aE114cF3B63779A1367eD704ccA51a0218080``PRIVATE_KEY`Authorized wallet for calling `setPanicMode()``0x...``PANIC_THRESHOLD`Price threshold for panic activation`1500` (USD cents)`TIMEOUT_SECONDS`Wait time before fallback activation`5`

Sources:[README.md#138-142](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L138-L142)

### Network ConfigurationLink copied!

#mermaid-auwwtrm1fwo{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-auwwtrm1fwo .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-auwwtrm1fwo .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-auwwtrm1fwo .error-icon{fill:#a44141;}#mermaid-auwwtrm1fwo .error-text{fill:#ddd;stroke:#ddd;}#mermaid-auwwtrm1fwo .edge-thickness-normal{stroke-width:1px;}#mermaid-auwwtrm1fwo .edge-thickness-thick{stroke-width:3.5px;}#mermaid-auwwtrm1fwo .edge-pattern-solid{stroke-dasharray:0;}#mermaid-auwwtrm1fwo .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-auwwtrm1fwo .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-auwwtrm1fwo .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-auwwtrm1fwo .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-auwwtrm1fwo .marker.cross{stroke:lightgrey;}#mermaid-auwwtrm1fwo svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-auwwtrm1fwo p{margin:0;}#mermaid-auwwtrm1fwo .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-auwwtrm1fwo .cluster-label text{fill:#F9FFFE;}#mermaid-auwwtrm1fwo .cluster-label span{color:#F9FFFE;}#mermaid-auwwtrm1fwo .cluster-label span p{background-color:transparent;}#mermaid-auwwtrm1fwo .label text,#mermaid-auwwtrm1fwo span{fill:#ccc;color:#ccc;}#mermaid-auwwtrm1fwo .node rect,#mermaid-auwwtrm1fwo .node circle,#mermaid-auwwtrm1fwo .node ellipse,#mermaid-auwwtrm1fwo .node polygon,#mermaid-auwwtrm1fwo .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-auwwtrm1fwo .rough-node .label text,#mermaid-auwwtrm1fwo .node .label text,#mermaid-auwwtrm1fwo .image-shape .label,#mermaid-auwwtrm1fwo .icon-shape .label{text-anchor:middle;}#mermaid-auwwtrm1fwo .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-auwwtrm1fwo .rough-node .label,#mermaid-auwwtrm1fwo .node .label,#mermaid-auwwtrm1fwo .image-shape .label,#mermaid-auwwtrm1fwo .icon-shape .label{text-align:center;}#mermaid-auwwtrm1fwo .node.clickable{cursor:pointer;}#mermaid-auwwtrm1fwo .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-auwwtrm1fwo .arrowheadPath{fill:lightgrey;}#mermaid-auwwtrm1fwo .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-auwwtrm1fwo .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-auwwtrm1fwo .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-auwwtrm1fwo .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-auwwtrm1fwo .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-auwwtrm1fwo .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-auwwtrm1fwo .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-auwwtrm1fwo .cluster text{fill:#F9FFFE;}#mermaid-auwwtrm1fwo .cluster span{color:#F9FFFE;}#mermaid-auwwtrm1fwo div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-auwwtrm1fwo .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-auwwtrm1fwo rect.text{fill:none;stroke-width:0;}#mermaid-auwwtrm1fwo .icon-shape,#mermaid-auwwtrm1fwo .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-auwwtrm1fwo .icon-shape p,#mermaid-auwwtrm1fwo .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-auwwtrm1fwo .icon-shape rect,#mermaid-auwwtrm1fwo .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-auwwtrm1fwo .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-auwwtrm1fwo .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-auwwtrm1fwo :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

L2 Connection

L1 Connection

Relayer Process

relay.ts Node.js Runtime

Environment Variables RPC URLs + Keys

Sepolia RPC WebSocket Provider

MockOracle Event Subscription

Unichain RPC HTTP Provider

AegisHook Transaction Sender

Network Configuration for relay.ts

Sources:[README.md#138-142](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L138-L142)

---

## Trade-offs and Design DecisionsLink copied!

### Why Not Rely Solely on Reactive Network?Link copied!

The Reactive Network is the intended production path for Aegis because it provides:

- Decentralization: No centralized points of failure
- Trustlessness: Events trigger callbacks without human intervention
- Composability: Other protocols can subscribe to the same event streams

However, during the hackathon, testnet infrastructure limitations required a pragmatic solution:

AspectReactive Network (Primary)Hybrid Relayer (Fallback)Decentralization✅ Fully decentralized❌ Requires running serverTestnet Reliability⚠️ Variable during hackathon✅ Direct controlProduction Readiness✅ Designed for mainnet❌ Not production-suitableMaintenance✅ No operational overhead❌ Requires monitoringSecurity Model✅ Trustless execution⚠️ Trust in relayer operator

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)

### Production Migration PathLink copied!

For mainnet deployment, the hybrid relayer should be phased out in favor of exclusive Reactive Network operation:

1. Testnet Phase: Run both paths concurrently, log all interventions
2. Mainnet Observation: Deploy with Reactive Network only, monitor delivery latency
3. Fallback Decision: If mainnet relayers prove unreliable, consider running a private Reactive Network node rather than a custom relayer
4. Redundancy: For mission-critical applications, run multiple independent Reactive Network subscriptions

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)[README.md#86-91](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L86-L91)

### When to Use the Hybrid ApproachLink copied!

The hybrid relayer pattern is appropriate for:

ScenarioRecommendationHackathon/Demo✅ Use hybrid relayer for reliabilityTestnet Development✅ Use hybrid relayer during integration testingMainnet Production❌ Rely on Reactive Network or private nodesHigh-Value Pools⚠️ Consider redundant Reactive subscriptions

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)

---

## Integration with Core SystemLink copied!

### Access Control RequirementsLink copied!

The hybrid relayer must have authorization to call `AegisHook.setPanicMode()`:

#mermaid-r6pg7jxnz4r{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-r6pg7jxnz4r .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-r6pg7jxnz4r .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-r6pg7jxnz4r .error-icon{fill:#a44141;}#mermaid-r6pg7jxnz4r .error-text{fill:#ddd;stroke:#ddd;}#mermaid-r6pg7jxnz4r .edge-thickness-normal{stroke-width:1px;}#mermaid-r6pg7jxnz4r .edge-thickness-thick{stroke-width:3.5px;}#mermaid-r6pg7jxnz4r .edge-pattern-solid{stroke-dasharray:0;}#mermaid-r6pg7jxnz4r .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-r6pg7jxnz4r .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-r6pg7jxnz4r .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-r6pg7jxnz4r .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-r6pg7jxnz4r .marker.cross{stroke:lightgrey;}#mermaid-r6pg7jxnz4r svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-r6pg7jxnz4r p{margin:0;}#mermaid-r6pg7jxnz4r .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-r6pg7jxnz4r .cluster-label text{fill:#F9FFFE;}#mermaid-r6pg7jxnz4r .cluster-label span{color:#F9FFFE;}#mermaid-r6pg7jxnz4r .cluster-label span p{background-color:transparent;}#mermaid-r6pg7jxnz4r .label text,#mermaid-r6pg7jxnz4r span{fill:#ccc;color:#ccc;}#mermaid-r6pg7jxnz4r .node rect,#mermaid-r6pg7jxnz4r .node circle,#mermaid-r6pg7jxnz4r .node ellipse,#mermaid-r6pg7jxnz4r .node polygon,#mermaid-r6pg7jxnz4r .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-r6pg7jxnz4r .rough-node .label text,#mermaid-r6pg7jxnz4r .node .label text,#mermaid-r6pg7jxnz4r .image-shape .label,#mermaid-r6pg7jxnz4r .icon-shape .label{text-anchor:middle;}#mermaid-r6pg7jxnz4r .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-r6pg7jxnz4r .rough-node .label,#mermaid-r6pg7jxnz4r .node .label,#mermaid-r6pg7jxnz4r .image-shape .label,#mermaid-r6pg7jxnz4r .icon-shape .label{text-align:center;}#mermaid-r6pg7jxnz4r .node.clickable{cursor:pointer;}#mermaid-r6pg7jxnz4r .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-r6pg7jxnz4r .arrowheadPath{fill:lightgrey;}#mermaid-r6pg7jxnz4r .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-r6pg7jxnz4r .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-r6pg7jxnz4r .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-r6pg7jxnz4r .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-r6pg7jxnz4r .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-r6pg7jxnz4r .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-r6pg7jxnz4r .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-r6pg7jxnz4r .cluster text{fill:#F9FFFE;}#mermaid-r6pg7jxnz4r .cluster span{color:#F9FFFE;}#mermaid-r6pg7jxnz4r div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-r6pg7jxnz4r .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-r6pg7jxnz4r rect.text{fill:none;stroke-width:0;}#mermaid-r6pg7jxnz4r .icon-shape,#mermaid-r6pg7jxnz4r .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-r6pg7jxnz4r .icon-shape p,#mermaid-r6pg7jxnz4r .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-r6pg7jxnz4r .icon-shape rect,#mermaid-r6pg7jxnz4r .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-r6pg7jxnz4r .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-r6pg7jxnz4r .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-r6pg7jxnz4r :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Call Sources

Authorization Model

setPanicMode() Authorized

setPanicMode() Authorized

AegisHook.sol

Authorized Sender: AegisSentinel Address

Authorized Sender: Relayer Wallet

AegisSentinel (Primary)

relay.ts (Fallback)

Multi-Source Authorization for setPanicMode

The `AegisHook` contract must whitelist both the `AegisSentinel` contract address (for Reactive Network calls) and the relayer's wallet address (for fallback calls). This dual authorization enables seamless failover without contract modifications.

Sources:[README.md#39-42](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L39-L42)[README.md#138-142](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L138-L142)

---

## Monitoring and ObservabilityLink copied!

### Logging StrategyLink copied!

The hybrid relayer should implement comprehensive logging for operational visibility:

Event TypeLog LevelInformation CapturedStartupINFORPC URLs, contract addresses, threshold valuesPrice Update DetectedDEBUGTimestamp, price value, threshold comparisonPrimary Path SuccessINFOSentinel delivery confirmed, no interventionTimeout TriggeredWARNPrimary path delay detected, initiating fallbackFallback ActivationERRORTransaction hash, gas used, state before/afterTransaction FailureCRITICALError message, RPC response, retry attempts

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)

### Metrics for Dashboard IntegrationLink copied!

The relayer can expose metrics for monitoring:

- Primary path success rate: Percentage of events delivered without fallback
- Average delivery latency: Time from L1 event to L2 state change
- Fallback intervention count: Number of times relayer had to act
- Transaction gas costs: Cumulative cost of fallback operations

Sources:[README.md#95-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L95-L101)

---

## Related DocumentationLink copied!

- [Cross-Chain Messaging](#3.2): Details on the primary Reactive Network message flow
- [Reactive Network Integration](#3.1): How the `AegisSentinel` subscribes to events
- [AegisHook](#2.1): The L2 contract that receives panic mode signals
- [Deployment Verification](#5.5): How to confirm cross-chain connectivity

Sources:[README.md#81-84](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L81-L84)[README.md#95-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L95-L101)

---

# Development-Guide

# Development GuideLink copied!
Relevant source files
- [.gitignore](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.gitignore)
- [contracts/foundry.toml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml)

## Purpose and ScopeLink copied!

This document provides a comprehensive overview of the development workflow for the Aegis cross-chain circuit breaker system. It covers the core tools, repository structure, and common development tasks that developers will encounter when working on Aegis contracts.

For detailed setup instructions, see [Environment Setup](#4.1). For testing procedures, see [Building and Testing](#4.2). For dependency management, see [Dependencies](#4.3). For code formatting and style guidelines, see [Code Standards](#4.4). For deployment procedures, see [Deployment](#5).

## Development Environment OverviewLink copied!

Aegis uses Foundry as its primary development framework, specifically leveraging Forge for smart contract compilation, testing, and deployment. The project is configured for Solidity 0.8.26 with the Cancun EVM version and uses the Via IR compilation pipeline for optimized bytecode generation.

Key Configuration Parameters:

SettingValuePurpose`solc_version``0.8.26`Solidity compiler version`evm_version``cancun`Target EVM version for latest opcodes`via_ir``true`Enables IR-based optimization pipeline`bytecode_hash``none`Disables metadata hash for deterministic builds`ffi``true`Allows external script execution (used for hook address mining)

The development environment spans three blockchain networks:

- Sepolia L1: Ethereum testnet for `MockOracle` deployment
- Reactive Network Lasna: Middleware for `AegisSentinel` deployment
- Unichain Sepolia L2: Target L2 for `AegisHook` deployment

Sources:[contracts/foundry.toml#1-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L1-L16)

## Development WorkflowLink copied!

#mermaid-lqrkly19qv{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-lqrkly19qv .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-lqrkly19qv .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-lqrkly19qv .error-icon{fill:#a44141;}#mermaid-lqrkly19qv .error-text{fill:#ddd;stroke:#ddd;}#mermaid-lqrkly19qv .edge-thickness-normal{stroke-width:1px;}#mermaid-lqrkly19qv .edge-thickness-thick{stroke-width:3.5px;}#mermaid-lqrkly19qv .edge-pattern-solid{stroke-dasharray:0;}#mermaid-lqrkly19qv .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-lqrkly19qv .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-lqrkly19qv .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-lqrkly19qv .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-lqrkly19qv .marker.cross{stroke:lightgrey;}#mermaid-lqrkly19qv svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-lqrkly19qv p{margin:0;}#mermaid-lqrkly19qv .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-lqrkly19qv .cluster-label text{fill:#F9FFFE;}#mermaid-lqrkly19qv .cluster-label span{color:#F9FFFE;}#mermaid-lqrkly19qv .cluster-label span p{background-color:transparent;}#mermaid-lqrkly19qv .label text,#mermaid-lqrkly19qv span{fill:#ccc;color:#ccc;}#mermaid-lqrkly19qv .node rect,#mermaid-lqrkly19qv .node circle,#mermaid-lqrkly19qv .node ellipse,#mermaid-lqrkly19qv .node polygon,#mermaid-lqrkly19qv .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-lqrkly19qv .rough-node .label text,#mermaid-lqrkly19qv .node .label text,#mermaid-lqrkly19qv .image-shape .label,#mermaid-lqrkly19qv .icon-shape .label{text-anchor:middle;}#mermaid-lqrkly19qv .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-lqrkly19qv .rough-node .label,#mermaid-lqrkly19qv .node .label,#mermaid-lqrkly19qv .image-shape .label,#mermaid-lqrkly19qv .icon-shape .label{text-align:center;}#mermaid-lqrkly19qv .node.clickable{cursor:pointer;}#mermaid-lqrkly19qv .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-lqrkly19qv .arrowheadPath{fill:lightgrey;}#mermaid-lqrkly19qv .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-lqrkly19qv .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-lqrkly19qv .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-lqrkly19qv .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-lqrkly19qv .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-lqrkly19qv .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-lqrkly19qv .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-lqrkly19qv .cluster text{fill:#F9FFFE;}#mermaid-lqrkly19qv .cluster span{color:#F9FFFE;}#mermaid-lqrkly19qv div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-lqrkly19qv .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-lqrkly19qv rect.text{fill:none;stroke-width:0;}#mermaid-lqrkly19qv .icon-shape,#mermaid-lqrkly19qv .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-lqrkly19qv .icon-shape p,#mermaid-lqrkly19qv .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-lqrkly19qv .icon-shape rect,#mermaid-lqrkly19qv .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-lqrkly19qv .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-lqrkly19qv .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-lqrkly19qv :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Post-Deployment

Deployment Sequence

Pre-Deployment

Local Development

git clone Initialize Repository

forge install Install Dependencies

forge build Compile Contracts

forge test Run Test Suite

forge fmt Format Code

Configure .env Set RPC URLs & Keys

forge test -vvv Verbose Testing

forge snapshot Gas Benchmarks

forge script 04_DeployOracle.s.sol

forge script 05_DeploySentinel.s.sol

forge script 06_DeployHook.s.sol

contracts/broadcast/ run-latest.json

Manual Contract Verification

Cross-Chain Integration Tests

Workflow Description:

1. Local Development: Clone the repository, install dependencies via `forge install`, compile contracts with `forge build`, and run tests with `forge test`. Code formatting is enforced via `forge fmt`.
2. Pre-Deployment: Configure environment variables in `.env` (RPC URLs, private keys), run verbose tests to catch edge cases, and generate gas snapshots for benchmarking.
3. Deployment Sequence: Execute deployment scripts in order: Oracle → Sentinel → Hook. Each script targets a specific network and logs deployment data to JSON files.
4. Post-Deployment: Review broadcast logs for deployed addresses, verify contracts on block explorers, and run integration tests across all three chains.

Sources:[contracts/foundry.toml#1-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L1-L27)[.gitignore#1-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.gitignore#L1-L26)

## Repository StructureLink copied!

#mermaid-hxp4w2tpyk{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-hxp4w2tpyk .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-hxp4w2tpyk .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-hxp4w2tpyk .error-icon{fill:#a44141;}#mermaid-hxp4w2tpyk .error-text{fill:#ddd;stroke:#ddd;}#mermaid-hxp4w2tpyk .edge-thickness-normal{stroke-width:1px;}#mermaid-hxp4w2tpyk .edge-thickness-thick{stroke-width:3.5px;}#mermaid-hxp4w2tpyk .edge-pattern-solid{stroke-dasharray:0;}#mermaid-hxp4w2tpyk .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-hxp4w2tpyk .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-hxp4w2tpyk .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-hxp4w2tpyk .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-hxp4w2tpyk .marker.cross{stroke:lightgrey;}#mermaid-hxp4w2tpyk svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-hxp4w2tpyk p{margin:0;}#mermaid-hxp4w2tpyk .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-hxp4w2tpyk .cluster-label text{fill:#F9FFFE;}#mermaid-hxp4w2tpyk .cluster-label span{color:#F9FFFE;}#mermaid-hxp4w2tpyk .cluster-label span p{background-color:transparent;}#mermaid-hxp4w2tpyk .label text,#mermaid-hxp4w2tpyk span{fill:#ccc;color:#ccc;}#mermaid-hxp4w2tpyk .node rect,#mermaid-hxp4w2tpyk .node circle,#mermaid-hxp4w2tpyk .node ellipse,#mermaid-hxp4w2tpyk .node polygon,#mermaid-hxp4w2tpyk .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-hxp4w2tpyk .rough-node .label text,#mermaid-hxp4w2tpyk .node .label text,#mermaid-hxp4w2tpyk .image-shape .label,#mermaid-hxp4w2tpyk .icon-shape .label{text-anchor:middle;}#mermaid-hxp4w2tpyk .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-hxp4w2tpyk .rough-node .label,#mermaid-hxp4w2tpyk .node .label,#mermaid-hxp4w2tpyk .image-shape .label,#mermaid-hxp4w2tpyk .icon-shape .label{text-align:center;}#mermaid-hxp4w2tpyk .node.clickable{cursor:pointer;}#mermaid-hxp4w2tpyk .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-hxp4w2tpyk .arrowheadPath{fill:lightgrey;}#mermaid-hxp4w2tpyk .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-hxp4w2tpyk .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-hxp4w2tpyk .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-hxp4w2tpyk .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-hxp4w2tpyk .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-hxp4w2tpyk .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-hxp4w2tpyk .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-hxp4w2tpyk .cluster text{fill:#F9FFFE;}#mermaid-hxp4w2tpyk .cluster span{color:#F9FFFE;}#mermaid-hxp4w2tpyk div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-hxp4w2tpyk .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-hxp4w2tpyk rect.text{fill:none;stroke-width:0;}#mermaid-hxp4w2tpyk .icon-shape,#mermaid-hxp4w2tpyk .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-hxp4w2tpyk .icon-shape p,#mermaid-hxp4w2tpyk .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-hxp4w2tpyk .icon-shape rect,#mermaid-hxp4w2tpyk .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-hxp4w2tpyk .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-hxp4w2tpyk .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-hxp4w2tpyk :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Configuration

Build Artifacts (Ignored)

External Dependencies

Deployment Scripts

Source Code

Testing

test/

*.t.sol Forge Test Cases

src/

AegisHook.sol Uniswap v4 Hook

AegisSentinel.sol Reactive Contract

MockOracle.sol Price Feed Simulator

AegisGuardianRegistry.sol ERC-721 + ERC-8004

script/

04_DeployOracle.s.sol

05_DeploySentinel.s.sol

06_DeployHook.s.sol

lib/

forge-std/ Testing Framework

uniswap-hooks/ v4 Interfaces

system-smart-contracts/ Reactive Network

out/ Compiled Bytecode

cache/ Build Cache

broadcast/ Deployment Logs

foundry.toml Forge Configuration

.gitignore Git Exclusions

.env Private Keys (Not Committed)

Directory Descriptions:

DirectoryPurposeCommitted to Git`src/`Core smart contract source filesYes`test/`Forge test cases with `.t.sol` extensionYes`script/`Deployment scripts with `.s.sol` extensionYes`lib/`Git submodules for external dependenciesYes (submodule refs only)`out/`Compiled contract artifacts (JSON, bytecode)No`cache/`Forge build cache for incremental compilationNo`broadcast/`Deployment transaction logs and receiptsNo

The `.gitignore` configuration ensures that build artifacts, deployment logs, and environment files containing private keys are never committed to version control. Only source code and dependency references are tracked.

Sources:[.gitignore#1-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.gitignore#L1-L26)[contracts/foundry.toml#6-13](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L6-L13)

## Foundry Configuration Deep DiveLink copied!

The `foundry.toml` file contains critical configuration that affects compilation, testing, and deployment behavior.

### Compiler SettingsLink copied!

#mermaid-vyis5go8v7q{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-vyis5go8v7q .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-vyis5go8v7q .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-vyis5go8v7q .error-icon{fill:#a44141;}#mermaid-vyis5go8v7q .error-text{fill:#ddd;stroke:#ddd;}#mermaid-vyis5go8v7q .edge-thickness-normal{stroke-width:1px;}#mermaid-vyis5go8v7q .edge-thickness-thick{stroke-width:3.5px;}#mermaid-vyis5go8v7q .edge-pattern-solid{stroke-dasharray:0;}#mermaid-vyis5go8v7q .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-vyis5go8v7q .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-vyis5go8v7q .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-vyis5go8v7q .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-vyis5go8v7q .marker.cross{stroke:lightgrey;}#mermaid-vyis5go8v7q svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-vyis5go8v7q p{margin:0;}#mermaid-vyis5go8v7q .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-vyis5go8v7q .cluster-label text{fill:#F9FFFE;}#mermaid-vyis5go8v7q .cluster-label span{color:#F9FFFE;}#mermaid-vyis5go8v7q .cluster-label span p{background-color:transparent;}#mermaid-vyis5go8v7q .label text,#mermaid-vyis5go8v7q span{fill:#ccc;color:#ccc;}#mermaid-vyis5go8v7q .node rect,#mermaid-vyis5go8v7q .node circle,#mermaid-vyis5go8v7q .node ellipse,#mermaid-vyis5go8v7q .node polygon,#mermaid-vyis5go8v7q .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-vyis5go8v7q .rough-node .label text,#mermaid-vyis5go8v7q .node .label text,#mermaid-vyis5go8v7q .image-shape .label,#mermaid-vyis5go8v7q .icon-shape .label{text-anchor:middle;}#mermaid-vyis5go8v7q .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-vyis5go8v7q .rough-node .label,#mermaid-vyis5go8v7q .node .label,#mermaid-vyis5go8v7q .image-shape .label,#mermaid-vyis5go8v7q .icon-shape .label{text-align:center;}#mermaid-vyis5go8v7q .node.clickable{cursor:pointer;}#mermaid-vyis5go8v7q .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-vyis5go8v7q .arrowheadPath{fill:lightgrey;}#mermaid-vyis5go8v7q .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-vyis5go8v7q .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-vyis5go8v7q .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-vyis5go8v7q .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-vyis5go8v7q .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-vyis5go8v7q .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-vyis5go8v7q .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-vyis5go8v7q .cluster text{fill:#F9FFFE;}#mermaid-vyis5go8v7q .cluster span{color:#F9FFFE;}#mermaid-vyis5go8v7q div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-vyis5go8v7q .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-vyis5go8v7q rect.text{fill:none;stroke-width:0;}#mermaid-vyis5go8v7q .icon-shape,#mermaid-vyis5go8v7q .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-vyis5go8v7q .icon-shape p,#mermaid-vyis5go8v7q .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-vyis5go8v7q .icon-shape rect,#mermaid-vyis5go8v7q .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-vyis5go8v7q .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-vyis5go8v7q .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-vyis5go8v7q :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Compilation Output

Compiler Configuration

solc_version = '0.8.26' Compiler Version

evm_version = 'cancun' Target EVM

via_ir = true IR Pipeline

bytecode_hash = 'none' Deterministic Builds

Optimized Bytecode Smaller Contract Size

Deterministic Addresses Reproducible Builds

Key Settings Explained:

- `via_ir = true`: Enables the Intermediate Representation (IR) optimization pipeline, which produces more efficient bytecode at the cost of longer compilation times. This is essential for Aegis contracts to stay within the 24KB contract size limit.
- `bytecode_hash = "none"`: Removes the CBOR-encoded metadata hash from bytecode, ensuring that identical source code produces identical bytecode. This is critical for CREATE2 deployments and hook address mining in Uniswap v4.
- `evm_version = "cancun"`: Targets the Cancun EVM version, enabling access to the latest opcodes and features available on all three deployment networks.
- `ffi = true`: Allows Forge to execute external commands via the `ffi` cheatcode. This is used in deployment scripts for computationally intensive tasks like mining hook addresses with specific prefixes.

Sources:[contracts/foundry.toml#1-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L1-L16)

### RPC Endpoint ConfigurationLink copied!

#mermaid-c243jj2nruo{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-c243jj2nruo .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-c243jj2nruo .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-c243jj2nruo .error-icon{fill:#a44141;}#mermaid-c243jj2nruo .error-text{fill:#ddd;stroke:#ddd;}#mermaid-c243jj2nruo .edge-thickness-normal{stroke-width:1px;}#mermaid-c243jj2nruo .edge-thickness-thick{stroke-width:3.5px;}#mermaid-c243jj2nruo .edge-pattern-solid{stroke-dasharray:0;}#mermaid-c243jj2nruo .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-c243jj2nruo .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-c243jj2nruo .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-c243jj2nruo .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-c243jj2nruo .marker.cross{stroke:lightgrey;}#mermaid-c243jj2nruo svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-c243jj2nruo p{margin:0;}#mermaid-c243jj2nruo .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-c243jj2nruo .cluster-label text{fill:#F9FFFE;}#mermaid-c243jj2nruo .cluster-label span{color:#F9FFFE;}#mermaid-c243jj2nruo .cluster-label span p{background-color:transparent;}#mermaid-c243jj2nruo .label text,#mermaid-c243jj2nruo span{fill:#ccc;color:#ccc;}#mermaid-c243jj2nruo .node rect,#mermaid-c243jj2nruo .node circle,#mermaid-c243jj2nruo .node ellipse,#mermaid-c243jj2nruo .node polygon,#mermaid-c243jj2nruo .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-c243jj2nruo .rough-node .label text,#mermaid-c243jj2nruo .node .label text,#mermaid-c243jj2nruo .image-shape .label,#mermaid-c243jj2nruo .icon-shape .label{text-anchor:middle;}#mermaid-c243jj2nruo .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-c243jj2nruo .rough-node .label,#mermaid-c243jj2nruo .node .label,#mermaid-c243jj2nruo .image-shape .label,#mermaid-c243jj2nruo .icon-shape .label{text-align:center;}#mermaid-c243jj2nruo .node.clickable{cursor:pointer;}#mermaid-c243jj2nruo .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-c243jj2nruo .arrowheadPath{fill:lightgrey;}#mermaid-c243jj2nruo .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-c243jj2nruo .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-c243jj2nruo .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-c243jj2nruo .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-c243jj2nruo .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-c243jj2nruo .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-c243jj2nruo .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-c243jj2nruo .cluster text{fill:#F9FFFE;}#mermaid-c243jj2nruo .cluster span{color:#F9FFFE;}#mermaid-c243jj2nruo div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-c243jj2nruo .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-c243jj2nruo rect.text{fill:none;stroke-width:0;}#mermaid-c243jj2nruo .icon-shape,#mermaid-c243jj2nruo .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-c243jj2nruo .icon-shape p,#mermaid-c243jj2nruo .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-c243jj2nruo .icon-shape rect,#mermaid-c243jj2nruo .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-c243jj2nruo .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-c243jj2nruo .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-c243jj2nruo :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Deployment Scripts

Network Configuration

sepolia eth-sepolia.g.alchemy.com

reactive lasna-rpc.rnk.dev

unichain_sepolia unichain-sepolia-rpc.publicnode.com

04_DeployOracle.s.sol --rpc-url sepolia

05_DeploySentinel.s.sol --rpc-url reactive

06_DeployHook.s.sol --rpc-url unichain_sepolia

The `[rpc_endpoints]` section defines named RPC URLs that can be referenced in deployment commands. This allows developers to use shorthand names like `--rpc-url sepolia` instead of typing full URLs.

Network Details:

Network NameChain IDRPC EndpointPurpose`sepolia`11155111Alchemy endpointDeploy `MockOracle``reactive`5318007Reactive Network RPCDeploy `AegisSentinel``unichain_sepolia`1301Public Node endpointDeploy `AegisHook`

Sources:[contracts/foundry.toml#19-22](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L19-L22)

### Remapping ConfigurationLink copied!

Foundry uses import remappings to resolve dependencies from `lib/` submodules. The `remappings` array maps import prefixes to their actual file system locations.

#mermaid-kmd9v79ehva{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-kmd9v79ehva .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-kmd9v79ehva .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-kmd9v79ehva .error-icon{fill:#a44141;}#mermaid-kmd9v79ehva .error-text{fill:#ddd;stroke:#ddd;}#mermaid-kmd9v79ehva .edge-thickness-normal{stroke-width:1px;}#mermaid-kmd9v79ehva .edge-thickness-thick{stroke-width:3.5px;}#mermaid-kmd9v79ehva .edge-pattern-solid{stroke-dasharray:0;}#mermaid-kmd9v79ehva .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-kmd9v79ehva .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-kmd9v79ehva .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-kmd9v79ehva .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-kmd9v79ehva .marker.cross{stroke:lightgrey;}#mermaid-kmd9v79ehva svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-kmd9v79ehva p{margin:0;}#mermaid-kmd9v79ehva .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-kmd9v79ehva .cluster-label text{fill:#F9FFFE;}#mermaid-kmd9v79ehva .cluster-label span{color:#F9FFFE;}#mermaid-kmd9v79ehva .cluster-label span p{background-color:transparent;}#mermaid-kmd9v79ehva .label text,#mermaid-kmd9v79ehva span{fill:#ccc;color:#ccc;}#mermaid-kmd9v79ehva .node rect,#mermaid-kmd9v79ehva .node circle,#mermaid-kmd9v79ehva .node ellipse,#mermaid-kmd9v79ehva .node polygon,#mermaid-kmd9v79ehva .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-kmd9v79ehva .rough-node .label text,#mermaid-kmd9v79ehva .node .label text,#mermaid-kmd9v79ehva .image-shape .label,#mermaid-kmd9v79ehva .icon-shape .label{text-anchor:middle;}#mermaid-kmd9v79ehva .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-kmd9v79ehva .rough-node .label,#mermaid-kmd9v79ehva .node .label,#mermaid-kmd9v79ehva .image-shape .label,#mermaid-kmd9v79ehva .icon-shape .label{text-align:center;}#mermaid-kmd9v79ehva .node.clickable{cursor:pointer;}#mermaid-kmd9v79ehva .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-kmd9v79ehva .arrowheadPath{fill:lightgrey;}#mermaid-kmd9v79ehva .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-kmd9v79ehva .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-kmd9v79ehva .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-kmd9v79ehva .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-kmd9v79ehva .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-kmd9v79ehva .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-kmd9v79ehva .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-kmd9v79ehva .cluster text{fill:#F9FFFE;}#mermaid-kmd9v79ehva .cluster span{color:#F9FFFE;}#mermaid-kmd9v79ehva div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-kmd9v79ehva .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-kmd9v79ehva rect.text{fill:none;stroke-width:0;}#mermaid-kmd9v79ehva .icon-shape,#mermaid-kmd9v79ehva .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-kmd9v79ehva .icon-shape p,#mermaid-kmd9v79ehva .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-kmd9v79ehva .icon-shape rect,#mermaid-kmd9v79ehva .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-kmd9v79ehva .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-kmd9v79ehva .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-kmd9v79ehva :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Resolved File Paths

Import Statements in Code

import 'reactive-lib/...'

import 'system-smart-contracts/...'

import 'v4-core/...'

import 'v4-periphery/...'

lib/system-smart-contracts/ lib/reactive-lib/src/

lib/system-smart-contracts/src/

lib/uniswap-hooks/lib/v4-core/

lib/uniswap-hooks/lib/v4-periphery/

Remapping Examples:

- `reactive-lib/=lib/system-smart-contracts/lib/reactive-lib/src/` - Maps Reactive Network library imports
- `v4-core/=lib/uniswap-hooks/lib/v4-core/` - Maps Uniswap v4 core protocol imports
- `v4-periphery/=lib/uniswap-hooks/lib/v4-periphery/` - Maps Uniswap v4 periphery contracts

These remappings enable clean import statements like `import {IReactive} from "reactive-lib/IReactive.sol";` without needing to specify deeply nested file paths.

Sources:[contracts/foundry.toml#9-14](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L9-L14)

## Common Development CommandsLink copied!

The following table summarizes the most frequently used Forge commands during Aegis development:

CommandPurposeExample`forge build`Compile all contracts in `src/``forge build --force` (force recompile)`forge test`Run all tests in `test/``forge test -vvv` (verbose output)`forge test --match-test`Run specific test by name`forge test --match-test testPanicMode``forge test --match-contract`Run tests in specific contract`forge test --match-contract AegisHookTest``forge fmt`Format code according to style rules`forge fmt src/ test/``forge snapshot`Generate gas usage snapshots`forge snapshot --snap .forge-snapshots/``forge script`Execute deployment script`forge script script/04_DeployOracle.s.sol --rpc-url sepolia --broadcast``forge clean`Remove build artifacts`forge clean` (clears `out/` and `cache/`)`forge install`Install/update dependencies`forge install` (reads submodules)

Filesystem Permissions:

The `fs_permissions` setting in `foundry.toml` grants read-write access to `.forge-snapshots/`, allowing `forge snapshot` to persist gas benchmarks to disk. This is the only directory where Forge scripts have write access by default.

Sources:[contracts/foundry.toml#5](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L5-L5)

## Development Workflow ExamplesLink copied!

### Example 1: Adding a New FeatureLink copied!

GitHub ActionsTest SuiteForge CLIGit RepositoryDeveloperGitHub ActionsTest SuiteForge CLIGit RepositoryDeveloper#mermaid-a95i0lx2sj{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-a95i0lx2sj .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-a95i0lx2sj .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-a95i0lx2sj .error-icon{fill:#a44141;}#mermaid-a95i0lx2sj .error-text{fill:#ddd;stroke:#ddd;}#mermaid-a95i0lx2sj .edge-thickness-normal{stroke-width:1px;}#mermaid-a95i0lx2sj .edge-thickness-thick{stroke-width:3.5px;}#mermaid-a95i0lx2sj .edge-pattern-solid{stroke-dasharray:0;}#mermaid-a95i0lx2sj .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-a95i0lx2sj .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-a95i0lx2sj .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-a95i0lx2sj .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-a95i0lx2sj .marker.cross{stroke:lightgrey;}#mermaid-a95i0lx2sj svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-a95i0lx2sj p{margin:0;}#mermaid-a95i0lx2sj .actor{stroke:#ccc;fill:#1f2020;}#mermaid-a95i0lx2sj text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-a95i0lx2sj .actor-line{stroke:#ccc;}#mermaid-a95i0lx2sj .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-a95i0lx2sj .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-a95i0lx2sj .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-a95i0lx2sj #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-a95i0lx2sj .sequenceNumber{fill:black;}#mermaid-a95i0lx2sj #sequencenumber{fill:lightgrey;}#mermaid-a95i0lx2sj #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-a95i0lx2sj .messageText{fill:lightgrey;stroke:none;}#mermaid-a95i0lx2sj .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-a95i0lx2sj .labelText,#mermaid-a95i0lx2sj .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-a95i0lx2sj .loopText,#mermaid-a95i0lx2sj .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-a95i0lx2sj .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-a95i0lx2sj .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-a95i0lx2sj .noteText,#mermaid-a95i0lx2sj .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-a95i0lx2sj .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-a95i0lx2sj .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-a95i0lx2sj .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-a95i0lx2sj .actorPopupMenu{position:absolute;}#mermaid-a95i0lx2sj .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-a95i0lx2sj .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-a95i0lx2sj .actor-man circle,#mermaid-a95i0lx2sj line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-a95i0lx2sj :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}git checkout -b feature/new-logicEdit src/AegisHook.solforge buildCompilation SuccessWrite test/NewFeature.t.solforge test -vvvAll Tests Passforge fmtCode Formattedforge snapshotGas Snapshot Updatedgit add . && git commitgit push origin feature/new-logicTrigger CI Pipelineforge buildforge test✅ Checks Pass

Steps:

1. Create a feature branch
2. Edit contract source files in `src/`
3. Compile with `forge build` to catch syntax errors
4. Write tests in `test/` following the `*.t.sol` naming convention
5. Run tests with verbose output (`-vvv`) to debug failures
6. Format code with `forge fmt` to match style guidelines
7. Update gas snapshots to track efficiency changes
8. Commit changes and push to GitHub
9. CI/CD pipeline automatically runs build and test checks

Sources:[contracts/foundry.toml#1-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L1-L27)[.gitignore#1-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.gitignore#L1-L26)

### Example 2: Debugging a Failing TestLink copied!

#mermaid-9p423j886ew{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-9p423j886ew .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-9p423j886ew .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-9p423j886ew .error-icon{fill:#a44141;}#mermaid-9p423j886ew .error-text{fill:#ddd;stroke:#ddd;}#mermaid-9p423j886ew .edge-thickness-normal{stroke-width:1px;}#mermaid-9p423j886ew .edge-thickness-thick{stroke-width:3.5px;}#mermaid-9p423j886ew .edge-pattern-solid{stroke-dasharray:0;}#mermaid-9p423j886ew .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-9p423j886ew .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-9p423j886ew .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-9p423j886ew .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-9p423j886ew .marker.cross{stroke:lightgrey;}#mermaid-9p423j886ew svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-9p423j886ew p{margin:0;}#mermaid-9p423j886ew .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-9p423j886ew .cluster-label text{fill:#F9FFFE;}#mermaid-9p423j886ew .cluster-label span{color:#F9FFFE;}#mermaid-9p423j886ew .cluster-label span p{background-color:transparent;}#mermaid-9p423j886ew .label text,#mermaid-9p423j886ew span{fill:#ccc;color:#ccc;}#mermaid-9p423j886ew .node rect,#mermaid-9p423j886ew .node circle,#mermaid-9p423j886ew .node ellipse,#mermaid-9p423j886ew .node polygon,#mermaid-9p423j886ew .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-9p423j886ew .rough-node .label text,#mermaid-9p423j886ew .node .label text,#mermaid-9p423j886ew .image-shape .label,#mermaid-9p423j886ew .icon-shape .label{text-anchor:middle;}#mermaid-9p423j886ew .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-9p423j886ew .rough-node .label,#mermaid-9p423j886ew .node .label,#mermaid-9p423j886ew .image-shape .label,#mermaid-9p423j886ew .icon-shape .label{text-align:center;}#mermaid-9p423j886ew .node.clickable{cursor:pointer;}#mermaid-9p423j886ew .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-9p423j886ew .arrowheadPath{fill:lightgrey;}#mermaid-9p423j886ew .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-9p423j886ew .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-9p423j886ew .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-9p423j886ew .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-9p423j886ew .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-9p423j886ew .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-9p423j886ew .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-9p423j886ew .cluster text{fill:#F9FFFE;}#mermaid-9p423j886ew .cluster span{color:#F9FFFE;}#mermaid-9p423j886ew div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-9p423j886ew .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-9p423j886ew rect.text{fill:none;stroke-width:0;}#mermaid-9p423j886ew .icon-shape,#mermaid-9p423j886ew .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-9p423j886ew .icon-shape p,#mermaid-9p423j886ew .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-9p423j886ew .icon-shape rect,#mermaid-9p423j886ew .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-9p423j886ew .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-9p423j886ew .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-9p423j886ew :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Verification

Debugging Steps

Initial State

forge test ❌ Test Fails

forge test -vvv View Traces

Stack Traces Revert Reasons

Locate Bug in src/*.sol

Apply Fix to Contract Code

forge test -vvv

✅ Test Passes

forge snapshot Update Gas Costs

Debugging Techniques:

- `-vvv` flag: Prints full stack traces, emitted events, and console.log output
- `-vvvv` flag: Adds detailed opcode-level execution traces (very verbose)
- `--match-test testName`: Isolates a single failing test to reduce noise
- `console.log()` statements: Use `import "forge-std/console.sol";` to add debug prints in contract code

Sources:[contracts/foundry.toml#1-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L1-L27)

## Build Artifacts and Git Ignore RulesLink copied!

The `.gitignore` configuration prevents build artifacts and sensitive data from being committed to the repository:

#mermaid-k9rfpd145e{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-k9rfpd145e .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-k9rfpd145e .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-k9rfpd145e .error-icon{fill:#a44141;}#mermaid-k9rfpd145e .error-text{fill:#ddd;stroke:#ddd;}#mermaid-k9rfpd145e .edge-thickness-normal{stroke-width:1px;}#mermaid-k9rfpd145e .edge-thickness-thick{stroke-width:3.5px;}#mermaid-k9rfpd145e .edge-pattern-solid{stroke-dasharray:0;}#mermaid-k9rfpd145e .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-k9rfpd145e .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-k9rfpd145e .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-k9rfpd145e .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-k9rfpd145e .marker.cross{stroke:lightgrey;}#mermaid-k9rfpd145e svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-k9rfpd145e p{margin:0;}#mermaid-k9rfpd145e .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-k9rfpd145e .cluster-label text{fill:#F9FFFE;}#mermaid-k9rfpd145e .cluster-label span{color:#F9FFFE;}#mermaid-k9rfpd145e .cluster-label span p{background-color:transparent;}#mermaid-k9rfpd145e .label text,#mermaid-k9rfpd145e span{fill:#ccc;color:#ccc;}#mermaid-k9rfpd145e .node rect,#mermaid-k9rfpd145e .node circle,#mermaid-k9rfpd145e .node ellipse,#mermaid-k9rfpd145e .node polygon,#mermaid-k9rfpd145e .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-k9rfpd145e .rough-node .label text,#mermaid-k9rfpd145e .node .label text,#mermaid-k9rfpd145e .image-shape .label,#mermaid-k9rfpd145e .icon-shape .label{text-anchor:middle;}#mermaid-k9rfpd145e .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-k9rfpd145e .rough-node .label,#mermaid-k9rfpd145e .node .label,#mermaid-k9rfpd145e .image-shape .label,#mermaid-k9rfpd145e .icon-shape .label{text-align:center;}#mermaid-k9rfpd145e .node.clickable{cursor:pointer;}#mermaid-k9rfpd145e .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-k9rfpd145e .arrowheadPath{fill:lightgrey;}#mermaid-k9rfpd145e .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-k9rfpd145e .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-k9rfpd145e .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-k9rfpd145e .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-k9rfpd145e .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-k9rfpd145e .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-k9rfpd145e .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-k9rfpd145e .cluster text{fill:#F9FFFE;}#mermaid-k9rfpd145e .cluster span{color:#F9FFFE;}#mermaid-k9rfpd145e div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-k9rfpd145e .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-k9rfpd145e rect.text{fill:none;stroke-width:0;}#mermaid-k9rfpd145e .icon-shape,#mermaid-k9rfpd145e .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-k9rfpd145e .icon-shape p,#mermaid-k9rfpd145e .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-k9rfpd145e .icon-shape rect,#mermaid-k9rfpd145e .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-k9rfpd145e .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-k9rfpd145e .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-k9rfpd145e :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Ignored Files

Ignored Directories

Ignored

Ignored

Ignored

Ignored

Committed to Git

src/ Contract Source

foundry.toml Configuration

test/ Test Files

script/ Deploy Scripts

README.md Documentation

out/ Compiled Bytecode JSON ABIs

cache/ Incremental Build Cache Dependency Graph

broadcast/ Deployment Logs Transaction Receipts

node_modules/ NPM Dependencies (if using frontend)

.env Private Keys RPC URLs

.env.local Local Overrides

.DS_Store macOS Metadata

*.md (except README.md)

Security Note: The `.env` file contains private keys and must never be committed. The `.gitignore` file explicitly excludes `.env` and `.env.local` to prevent accidental exposure of credentials.

Build Artifact Locations:

- `out/`: Contains compiled bytecode, ABI JSON files, and compilation metadata for each contract
- `cache/`: Stores Forge's incremental compilation cache to speed up subsequent builds
- `broadcast/`: Holds deployment transaction data generated by `forge script --broadcast` commands

These directories are recreated automatically during `forge build` and `forge script` executions, so there is no need to version control them.

Sources:[.gitignore#1-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.gitignore#L1-L26)[contracts/foundry.toml#7](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L7-L7)

## Linting ConfigurationLink copied!

The `[lint]` section in `foundry.toml` configures Solidity code linting rules:

```
[lint]
exclude_lints = ["screaming-snake-case-immutable", "screaming-snake-case-const"]
lint_on_build = false
```

Configuration Details:

SettingValueRationale`exclude_lints`Excludes `SCREAMING_SNAKE_CASE` warningsAegis uses PascalCase for constants for readability`lint_on_build``false`Linting is performed separately via `forge fmt`, not during compilation

This configuration allows the codebase to deviate from Solidity style guide recommendations where appropriate, while still maintaining consistent formatting via `forge fmt`.

Sources:[contracts/foundry.toml#24-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L24-L26)

## Next StepsLink copied!

Now that you understand the core development workflow, proceed to the following pages for detailed instructions:

1. [Environment Setup](#4.1): Install Foundry, configure dependencies, and set up your local development environment
2. [Building and Testing](#4.2): Detailed guide to compilation, test execution, and debugging techniques
3. [Dependencies](#4.3): Overview of external libraries (forge-std, uniswap-hooks, system-smart-contracts) and submodule management
4. [Code Standards](#4.4): Formatting rules, naming conventions, and code quality guidelines

For deployment procedures after development is complete, see the [Deployment](#5) section.

Sources:[contracts/foundry.toml#1-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L1-L27)[.gitignore#1-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.gitignore#L1-L26)

---

# Environment-Setup

# Environment SetupLink copied!
Relevant source files
- [contracts/.gitmodules](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules)
- [contracts/.vscode/settings.json](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.vscode/settings.json)
- [contracts/foundry.lock](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.lock)
- [contracts/foundry.toml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml)

## Purpose and ScopeLink copied!

This document provides step-by-step instructions for configuring a development environment to work with the Aegis codebase. It covers prerequisite software installation, repository cloning, dependency management via git submodules, and configuration file setup. For a quick start guide without detailed explanations, see [Getting Started](#1.1). For detailed information about individual dependencies, see [Dependencies](#4.3). For build and test workflows after setup is complete, see [Building and Testing](#4.2).

---

## PrerequisitesLink copied!

### Required SoftwareLink copied!

The Aegis project requires the following tools to be installed before proceeding:

ToolPurposeMinimum VersionFoundrySolidity development toolchain (forge, cast, anvil)LatestGitVersion control and submodule management2.xNode.jsRequired for hybrid relayer (optional for contract development)18.x+

### Installing FoundryLink copied!

Foundry is the primary build system for Aegis smart contracts. Install it using the official installer:

```
curl -L https://foundry.paradigm.xyz | bash
foundryup
```

Verify installation:

```
forge --version
cast --version
```

Sources: General prerequisite knowledge based on Foundry ecosystem standards.

---

## Repository SetupLink copied!

### Cloning the RepositoryLink copied!

Clone the Aegis repository with all submodules:

```
git clone --recurse-submodules https://github.com/HACK3R-CRYPTO/Aegis.git
cd Aegis/contracts
```

If you already cloned without `--recurse-submodules`, initialize submodules manually:

```
git submodule update --init --recursive
```

Sources: Standard git workflow; [contracts/.gitmodules#1-13](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L1-L13)

### Repository StructureLink copied!

```
contracts/
├── src/                    # Smart contract source files
├── script/                 # Deployment scripts
├── test/                   # Forge test files
├── lib/                    # External dependencies (git submodules)
├── foundry.toml            # Foundry configuration
├── .gitmodules             # Submodule declarations
└── foundry.lock            # Locked dependency versions
```

Sources: Standard Foundry project structure.

---

## Dependency ManagementLink copied!

### Git Submodules OverviewLink copied!

Aegis manages external dependencies using git submodules. The submodule configuration is declared in `.gitmodules`:

#mermaid-6fjaw8wir3f{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-6fjaw8wir3f .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-6fjaw8wir3f .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-6fjaw8wir3f .error-icon{fill:#a44141;}#mermaid-6fjaw8wir3f .error-text{fill:#ddd;stroke:#ddd;}#mermaid-6fjaw8wir3f .edge-thickness-normal{stroke-width:1px;}#mermaid-6fjaw8wir3f .edge-thickness-thick{stroke-width:3.5px;}#mermaid-6fjaw8wir3f .edge-pattern-solid{stroke-dasharray:0;}#mermaid-6fjaw8wir3f .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-6fjaw8wir3f .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-6fjaw8wir3f .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-6fjaw8wir3f .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-6fjaw8wir3f .marker.cross{stroke:lightgrey;}#mermaid-6fjaw8wir3f svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-6fjaw8wir3f p{margin:0;}#mermaid-6fjaw8wir3f .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-6fjaw8wir3f .cluster-label text{fill:#F9FFFE;}#mermaid-6fjaw8wir3f .cluster-label span{color:#F9FFFE;}#mermaid-6fjaw8wir3f .cluster-label span p{background-color:transparent;}#mermaid-6fjaw8wir3f .label text,#mermaid-6fjaw8wir3f span{fill:#ccc;color:#ccc;}#mermaid-6fjaw8wir3f .node rect,#mermaid-6fjaw8wir3f .node circle,#mermaid-6fjaw8wir3f .node ellipse,#mermaid-6fjaw8wir3f .node polygon,#mermaid-6fjaw8wir3f .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-6fjaw8wir3f .rough-node .label text,#mermaid-6fjaw8wir3f .node .label text,#mermaid-6fjaw8wir3f .image-shape .label,#mermaid-6fjaw8wir3f .icon-shape .label{text-anchor:middle;}#mermaid-6fjaw8wir3f .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-6fjaw8wir3f .rough-node .label,#mermaid-6fjaw8wir3f .node .label,#mermaid-6fjaw8wir3f .image-shape .label,#mermaid-6fjaw8wir3f .icon-shape .label{text-align:center;}#mermaid-6fjaw8wir3f .node.clickable{cursor:pointer;}#mermaid-6fjaw8wir3f .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-6fjaw8wir3f .arrowheadPath{fill:lightgrey;}#mermaid-6fjaw8wir3f .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-6fjaw8wir3f .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-6fjaw8wir3f .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-6fjaw8wir3f .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-6fjaw8wir3f .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-6fjaw8wir3f .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-6fjaw8wir3f .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-6fjaw8wir3f .cluster text{fill:#F9FFFE;}#mermaid-6fjaw8wir3f .cluster span{color:#F9FFFE;}#mermaid-6fjaw8wir3f div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-6fjaw8wir3f .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-6fjaw8wir3f rect.text{fill:none;stroke-width:0;}#mermaid-6fjaw8wir3f .icon-shape,#mermaid-6fjaw8wir3f .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-6fjaw8wir3f .icon-shape p,#mermaid-6fjaw8wir3f .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-6fjaw8wir3f .icon-shape rect,#mermaid-6fjaw8wir3f .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-6fjaw8wir3f .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-6fjaw8wir3f .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-6fjaw8wir3f :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

[submodule lib/forge-std]

[submodule lib/uniswap-hooks]

[submodule lib/hookmate]

[submodule lib/system-smart-contracts]

Aegis Repository

lib/forge-std foundry-rs/forge-std

lib/uniswap-hooks openzeppelin/uniswap-hooks

lib/hookmate akshatmittal/hookmate

lib/system-smart-contracts Reactive-Network/system-smart-contracts

Diagram: Git Submodule Dependency Tree

Sources: [contracts/.gitmodules#1-13](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L1-L13)

### Locked Dependency VersionsLink copied!

The `foundry.lock` file pins specific commit hashes for reproducible builds:

DependencyLocked RevisionPurpose`forge-std``8bbcf6e3f8f62f419e5429a0bd89331c85c37824`Testing framework and utilities`uniswap-hooks``e59fe72c110c3862eec9b332530dce49ca506bbb`Uniswap v4 hook interfaces`hookmate``33408fbc15e083eb0bc4205fa37cb6ba0a926f44`Hook development utilities

Note: `system-smart-contracts` is not included in `foundry.lock` as it is managed separately by the Reactive Network team.

Sources: [contracts/foundry.lock#1-11](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.lock#L1-L11)

### Updating DependenciesLink copied!

To update all submodules to their latest commits:

```
git submodule update --remote --merge
```

To update a specific submodule:

```
git submodule update --remote --merge lib/forge-std
```

Warning: Updating dependencies may introduce breaking changes. Always run tests after updates (see [Building and Testing](#4.2)).

Sources: Standard git submodule workflows.

---

## Foundry ConfigurationLink copied!

### Configuration File StructureLink copied!

The `foundry.toml` file contains all compiler settings, network configurations, and build parameters:

#mermaid-omiz1oetkkl{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-omiz1oetkkl .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-omiz1oetkkl .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-omiz1oetkkl .error-icon{fill:#a44141;}#mermaid-omiz1oetkkl .error-text{fill:#ddd;stroke:#ddd;}#mermaid-omiz1oetkkl .edge-thickness-normal{stroke-width:1px;}#mermaid-omiz1oetkkl .edge-thickness-thick{stroke-width:3.5px;}#mermaid-omiz1oetkkl .edge-pattern-solid{stroke-dasharray:0;}#mermaid-omiz1oetkkl .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-omiz1oetkkl .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-omiz1oetkkl .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-omiz1oetkkl .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-omiz1oetkkl .marker.cross{stroke:lightgrey;}#mermaid-omiz1oetkkl svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-omiz1oetkkl p{margin:0;}#mermaid-omiz1oetkkl .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-omiz1oetkkl .cluster-label text{fill:#F9FFFE;}#mermaid-omiz1oetkkl .cluster-label span{color:#F9FFFE;}#mermaid-omiz1oetkkl .cluster-label span p{background-color:transparent;}#mermaid-omiz1oetkkl .label text,#mermaid-omiz1oetkkl span{fill:#ccc;color:#ccc;}#mermaid-omiz1oetkkl .node rect,#mermaid-omiz1oetkkl .node circle,#mermaid-omiz1oetkkl .node ellipse,#mermaid-omiz1oetkkl .node polygon,#mermaid-omiz1oetkkl .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-omiz1oetkkl .rough-node .label text,#mermaid-omiz1oetkkl .node .label text,#mermaid-omiz1oetkkl .image-shape .label,#mermaid-omiz1oetkkl .icon-shape .label{text-anchor:middle;}#mermaid-omiz1oetkkl .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-omiz1oetkkl .rough-node .label,#mermaid-omiz1oetkkl .node .label,#mermaid-omiz1oetkkl .image-shape .label,#mermaid-omiz1oetkkl .icon-shape .label{text-align:center;}#mermaid-omiz1oetkkl .node.clickable{cursor:pointer;}#mermaid-omiz1oetkkl .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-omiz1oetkkl .arrowheadPath{fill:lightgrey;}#mermaid-omiz1oetkkl .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-omiz1oetkkl .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-omiz1oetkkl .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-omiz1oetkkl .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-omiz1oetkkl .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-omiz1oetkkl .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-omiz1oetkkl .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-omiz1oetkkl .cluster text{fill:#F9FFFE;}#mermaid-omiz1oetkkl .cluster span{color:#F9FFFE;}#mermaid-omiz1oetkkl div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-omiz1oetkkl .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-omiz1oetkkl rect.text{fill:none;stroke-width:0;}#mermaid-omiz1oetkkl .icon-shape,#mermaid-omiz1oetkkl .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-omiz1oetkkl .icon-shape p,#mermaid-omiz1oetkkl .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-omiz1oetkkl .icon-shape rect,#mermaid-omiz1oetkkl .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-omiz1oetkkl .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-omiz1oetkkl .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-omiz1oetkkl :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

foundry.toml

[profile.default] Compiler Settings

[rpc_endpoints] Network RPCs

[lint] Linting Rules

solc_version = 0.8.26

evm_version = cancun

via_ir = true

remappings

unichain_sepolia

reactive

sepolia

Diagram: foundry.toml Configuration Hierarchy

Sources: [contracts/foundry.toml#1-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L1-L27)

### Compiler SettingsLink copied!

The `[profile.default]` section configures the Solidity compiler:

SettingValueRationale`solc_version``"0.8.26"`Required for Uniswap v4 compatibility`evm_version``"cancun"`Latest EVM opcode support`bytecode_hash``"none"`Deterministic builds for hook address mining`via_ir``true`Enables IR-based compilation for optimization`ffi``true`Allows external process calls (used in deployment scripts)

Sources: [contracts/foundry.toml#1-8](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L1-L8)

### Import RemappingsLink copied!

Remappings allow clean import paths in Solidity files. Aegis configures four primary remappings:

```
// Example imports enabled by remappings:
import "reactive-lib/IReactive.sol";
import "system-smart-contracts/ReactiveContract.sol";
import "v4-core/interfaces/IPoolManager.sol";
import "v4-periphery/BaseHook.sol";
```

Remapping Configuration:

```
reactive-lib/=lib/system-smart-contracts/lib/reactive-lib/src/
system-smart-contracts/=lib/system-smart-contracts/src/
v4-core/=lib/uniswap-hooks/lib/v4-core/
v4-periphery/=lib/uniswap-hooks/lib/v4-periphery/
```

Sources: [contracts/foundry.toml#9-14](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L9-L14)

### Network RPC EndpointsLink copied!

The `[rpc_endpoints]` section defines connection URLs for deployment and testing:

#mermaid-7ict4cvy96m{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-7ict4cvy96m .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-7ict4cvy96m .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-7ict4cvy96m .error-icon{fill:#a44141;}#mermaid-7ict4cvy96m .error-text{fill:#ddd;stroke:#ddd;}#mermaid-7ict4cvy96m .edge-thickness-normal{stroke-width:1px;}#mermaid-7ict4cvy96m .edge-thickness-thick{stroke-width:3.5px;}#mermaid-7ict4cvy96m .edge-pattern-solid{stroke-dasharray:0;}#mermaid-7ict4cvy96m .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-7ict4cvy96m .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-7ict4cvy96m .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-7ict4cvy96m .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-7ict4cvy96m .marker.cross{stroke:lightgrey;}#mermaid-7ict4cvy96m svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-7ict4cvy96m p{margin:0;}#mermaid-7ict4cvy96m .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-7ict4cvy96m .cluster-label text{fill:#F9FFFE;}#mermaid-7ict4cvy96m .cluster-label span{color:#F9FFFE;}#mermaid-7ict4cvy96m .cluster-label span p{background-color:transparent;}#mermaid-7ict4cvy96m .label text,#mermaid-7ict4cvy96m span{fill:#ccc;color:#ccc;}#mermaid-7ict4cvy96m .node rect,#mermaid-7ict4cvy96m .node circle,#mermaid-7ict4cvy96m .node ellipse,#mermaid-7ict4cvy96m .node polygon,#mermaid-7ict4cvy96m .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-7ict4cvy96m .rough-node .label text,#mermaid-7ict4cvy96m .node .label text,#mermaid-7ict4cvy96m .image-shape .label,#mermaid-7ict4cvy96m .icon-shape .label{text-anchor:middle;}#mermaid-7ict4cvy96m .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-7ict4cvy96m .rough-node .label,#mermaid-7ict4cvy96m .node .label,#mermaid-7ict4cvy96m .image-shape .label,#mermaid-7ict4cvy96m .icon-shape .label{text-align:center;}#mermaid-7ict4cvy96m .node.clickable{cursor:pointer;}#mermaid-7ict4cvy96m .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-7ict4cvy96m .arrowheadPath{fill:lightgrey;}#mermaid-7ict4cvy96m .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-7ict4cvy96m .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-7ict4cvy96m .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-7ict4cvy96m .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-7ict4cvy96m .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-7ict4cvy96m .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-7ict4cvy96m .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-7ict4cvy96m .cluster text{fill:#F9FFFE;}#mermaid-7ict4cvy96m .cluster span{color:#F9FFFE;}#mermaid-7ict4cvy96m div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-7ict4cvy96m .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-7ict4cvy96m rect.text{fill:none;stroke-width:0;}#mermaid-7ict4cvy96m .icon-shape,#mermaid-7ict4cvy96m .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-7ict4cvy96m .icon-shape p,#mermaid-7ict4cvy96m .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-7ict4cvy96m .icon-shape rect,#mermaid-7ict4cvy96m .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-7ict4cvy96m .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-7ict4cvy96m .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-7ict4cvy96m :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

--rpc-url sepolia

--rpc-url reactive

--rpc-url unichain_sepolia

--rpc-url sepolia

--rpc-url reactive

--rpc-url unichain_sepolia

sepolia Ethereum Sepolia L1 eth-sepolia.g.alchemy.com

reactive Reactive Network Lasna lasna-rpc.rnk.dev

unichain_sepolia Unichain Sepolia L2 unichain-sepolia-rpc.publicnode.com

Deployment Scripts

Cast Commands

Diagram: Network RPC Configuration Usage

Sources: [contracts/foundry.toml#19-23](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L19-L23)

### Linting ConfigurationLink copied!

The `[lint]` section controls code style enforcement:

SettingValuePurpose`exclude_lints``["screaming-snake-case-immutable", "screaming-snake-case-const"]`Allows flexible casing for constants`lint_on_build``false`Linting is manual, not automatic on build

To run linting manually:

```
forge fmt --check  # Check formatting
forge fmt          # Auto-format code
```

Sources: [contracts/foundry.toml#24-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L24-L27)

---

## IDE ConfigurationLink copied!

### Visual Studio Code SetupLink copied!

The project includes a `.vscode/settings.json` file for VSCode users:

```
{
  "solidity.formatter": "forge"
}
```

This configures the Solidity extension to use Forge's formatter (`forge fmt`) instead of other formatters like Prettier.

Recommended VSCode Extensions:

ExtensionPurpose`JuanBlanco.solidity`Solidity language support`NomicFoundation.hardhat-solidity`Alternative Solidity support

Sources: [contracts/.vscode/settings.json#1-4](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.vscode/settings.json#L1-L4)

### Other IDEsLink copied!

For non-VSCode editors, ensure your Solidity formatter is configured to respect `.editorconfig` or run `forge fmt` manually before committing.

Sources: General IDE configuration knowledge.

---

## Environment VariablesLink copied!

### Required Variables for DeploymentLink copied!

When deploying contracts (see [Deployment Overview](#5.1)), you must set the following environment variables:

```
export PRIVATE_KEY="0x..."  # Deployer private key
```

Security Warning: Never commit private keys to version control. Use `.env` files (gitignored) or secure secret management systems.

### Optional VariablesLink copied!

VariablePurposeDefault`ETHERSCAN_API_KEY`Contract verification on block explorersNot required for testnet`ALCHEMY_API_KEY`Alternative to using public RPCsPublic RPC used

Sources: Standard Foundry deployment practices.

---

## Verification StepsLink copied!

After completing environment setup, verify your installation:

### 1. Check Foundry InstallationLink copied!

```
forge --version
# Expected output: forge 0.2.0 (or later)
```

### 2. Verify SubmodulesLink copied!

```
ls -la lib/
# Expected: forge-std, hookmate, system-smart-contracts, uniswap-hooks
```

### 3. Compile ContractsLink copied!

```
forge build
# Expected: Successful compilation with no errors
```

If compilation succeeds, your environment is correctly configured. Proceed to [Building and Testing](#4.2).

Sources: Standard verification procedures.

---

## TroubleshootingLink copied!

### Common IssuesLink copied!

IssueCauseSolution"submodule not found"Submodules not initializedRun `git submodule update --init --recursive`Compilation errors in `lib/`Outdated submodulesRun `forge build --force` to rebuild dependencies"solc version not found"Foundry not up-to-dateRun `foundryup` to update FoundryRPC connection timeoutNetwork configuration issueVerify RPC URLs in `foundry.toml` are accessible

### Getting HelpLink copied!

If issues persist after following this guide:

1. Check the [Dependencies](#4.3) page for detailed dependency information
2. Review deployment-specific issues in [Deployment Overview](#5.1)
3. Consult the Foundry documentation at [https://book.getfoundry.sh](https://book.getfoundry.sh)

Sources: Common troubleshooting patterns in Foundry projects.

---

## SummaryLink copied!

At this point, your development environment should be fully configured with:

- ✅ Foundry installed and verified
- ✅ Aegis repository cloned with all submodules
- ✅ `foundry.toml` configured with correct compiler settings
- ✅ RPC endpoints configured for all three networks
- ✅ IDE configured for Solidity development
- ✅ Contracts successfully compiled

You are now ready to proceed to [Building and Testing](#4.2) to run the test suite and verify contract functionality.

Sources: Summary of all sections above.

---

# Building-and-Testing

# Building and TestingLink copied!
Relevant source files
- [contracts/.github/workflows/test.yml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml)
- [contracts/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md)
- [contracts/foundry.toml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml)

This page covers the compilation and testing workflows for Aegis smart contracts using Foundry's Forge toolchain. It explains how to build contracts, execute tests locally, interpret test output, and validate functionality before deployment. For initial environment setup and dependency installation, see [Environment Setup](#4.1). For deployment instructions across the three-network architecture, see [Deployment Overview](#5.1).

---

## Build ProcessLink copied!

The Aegis smart contracts are compiled using `forge build`, which invokes the Solidity compiler according to the configuration defined in [foundry.toml#1-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L1-L16)

### Basic CompilationLink copied!

To compile all contracts in the project:

```
forge build
```

This command:

- Compiles all Solidity files in `src/` directory
- Processes dependencies from `lib/` submodules
- Applies remappings for external libraries
- Outputs compiled artifacts to `out/` directory
- Uses Solidity version 0.8.26 with Cancun EVM features

### Build with Contract Size AnalysisLink copied!

To compile and display contract bytecode sizes:

```
forge build --sizes
```

This variant is particularly useful for monitoring gas optimization and ensuring contracts stay within deployment size limits (24KB for EVM contracts). The [.github/workflows/test.yml#28](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L28-L28) CI pipeline uses this command to track contract sizes over time.

### Build Configuration DetailsLink copied!

The compilation process is controlled by [foundry.toml#1-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L1-L16):

Configuration KeyValuePurpose`solc_version``0.8.26`Solidity compiler version`evm_version``cancun`Target EVM upgrade (latest features)`via_ir``true`Enable IR-based compilation pipeline (optimization)`bytecode_hash``none`Disable metadata hash (deterministic builds)`ffi``true`Allow Foreign Function Interface (for scripts)

The `via_ir = true` setting enables the intermediate representation (IR) optimization pipeline, which is critical for complex contracts like `AegisHook` that implement Uniswap v4 interfaces with extensive logic paths.

Build Process Flow Diagram:

#mermaid-6q9fjruh6ol{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-6q9fjruh6ol .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-6q9fjruh6ol .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-6q9fjruh6ol .error-icon{fill:#a44141;}#mermaid-6q9fjruh6ol .error-text{fill:#ddd;stroke:#ddd;}#mermaid-6q9fjruh6ol .edge-thickness-normal{stroke-width:1px;}#mermaid-6q9fjruh6ol .edge-thickness-thick{stroke-width:3.5px;}#mermaid-6q9fjruh6ol .edge-pattern-solid{stroke-dasharray:0;}#mermaid-6q9fjruh6ol .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-6q9fjruh6ol .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-6q9fjruh6ol .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-6q9fjruh6ol .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-6q9fjruh6ol .marker.cross{stroke:lightgrey;}#mermaid-6q9fjruh6ol svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-6q9fjruh6ol p{margin:0;}#mermaid-6q9fjruh6ol .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-6q9fjruh6ol .cluster-label text{fill:#F9FFFE;}#mermaid-6q9fjruh6ol .cluster-label span{color:#F9FFFE;}#mermaid-6q9fjruh6ol .cluster-label span p{background-color:transparent;}#mermaid-6q9fjruh6ol .label text,#mermaid-6q9fjruh6ol span{fill:#ccc;color:#ccc;}#mermaid-6q9fjruh6ol .node rect,#mermaid-6q9fjruh6ol .node circle,#mermaid-6q9fjruh6ol .node ellipse,#mermaid-6q9fjruh6ol .node polygon,#mermaid-6q9fjruh6ol .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-6q9fjruh6ol .rough-node .label text,#mermaid-6q9fjruh6ol .node .label text,#mermaid-6q9fjruh6ol .image-shape .label,#mermaid-6q9fjruh6ol .icon-shape .label{text-anchor:middle;}#mermaid-6q9fjruh6ol .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-6q9fjruh6ol .rough-node .label,#mermaid-6q9fjruh6ol .node .label,#mermaid-6q9fjruh6ol .image-shape .label,#mermaid-6q9fjruh6ol .icon-shape .label{text-align:center;}#mermaid-6q9fjruh6ol .node.clickable{cursor:pointer;}#mermaid-6q9fjruh6ol .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-6q9fjruh6ol .arrowheadPath{fill:lightgrey;}#mermaid-6q9fjruh6ol .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-6q9fjruh6ol .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-6q9fjruh6ol .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-6q9fjruh6ol .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-6q9fjruh6ol .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-6q9fjruh6ol .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-6q9fjruh6ol .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-6q9fjruh6ol .cluster text{fill:#F9FFFE;}#mermaid-6q9fjruh6ol .cluster span{color:#F9FFFE;}#mermaid-6q9fjruh6ol div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-6q9fjruh6ol .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-6q9fjruh6ol rect.text{fill:none;stroke-width:0;}#mermaid-6q9fjruh6ol .icon-shape,#mermaid-6q9fjruh6ol .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-6q9fjruh6ol .icon-shape p,#mermaid-6q9fjruh6ol .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-6q9fjruh6ol .icon-shape rect,#mermaid-6q9fjruh6ol .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-6q9fjruh6ol .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-6q9fjruh6ol .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-6q9fjruh6ol :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

AegisHook.sol

AegisSentinel.sol

MockOracle.sol

AegisGuardianRegistry.sol

uniswap-hooks

system-smart-contracts

forge-std

foundry.toml Configuration

src/*.sol Source Contracts

lib/* Dependencies

forge build Solc 0.8.26

out/ Compiled Artifacts

--sizes Bytecode Analysis

Sources:[foundry.toml#1-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L1-L16)[.github/workflows/test.yml#26-29](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L26-L29)

---

## Running TestsLink copied!

Aegis uses Foundry's testing framework to validate contract behavior through unit and integration tests written in Solidity.

### Basic Test ExecutionLink copied!

To run all tests in the project:

```
forge test
```

This command discovers and executes all test contracts in the `test/` directory (files matching `*.t.sol` pattern).

### Verbose Output LevelsLink copied!

Forge provides multiple verbosity levels for debugging test failures:

```
# Level 2 - Show logs and events for failing tests
forge test -vv
 
# Level 3 - Show logs, events, and traces for all tests
forge test -vvv
 
# Level 4 - Show detailed traces with stack traces
forge test -vvvv
```

The [.github/workflows/test.yml#33](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L33-L33) CI pipeline uses `-vvv` to capture full execution traces for debugging failed CI runs.

### Filtering TestsLink copied!

To run specific test contracts or functions:

```
# Run only integration tests
forge test --match-contract AegisIntegrationTest -vv
 
# Run specific test function
forge test --match-test testPanicTrigger
 
# Run tests matching pattern
forge test --match-path test/integration/*
```

The [README.md#82](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L82-L82) explicitly calls out the integration test contract as the primary validation suite for cross-chain functionality.

Test Execution Flow Diagram:

#mermaid-fowjghtsk9r{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-fowjghtsk9r .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-fowjghtsk9r .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-fowjghtsk9r .error-icon{fill:#a44141;}#mermaid-fowjghtsk9r .error-text{fill:#ddd;stroke:#ddd;}#mermaid-fowjghtsk9r .edge-thickness-normal{stroke-width:1px;}#mermaid-fowjghtsk9r .edge-thickness-thick{stroke-width:3.5px;}#mermaid-fowjghtsk9r .edge-pattern-solid{stroke-dasharray:0;}#mermaid-fowjghtsk9r .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-fowjghtsk9r .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-fowjghtsk9r .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-fowjghtsk9r .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-fowjghtsk9r .marker.cross{stroke:lightgrey;}#mermaid-fowjghtsk9r svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-fowjghtsk9r p{margin:0;}#mermaid-fowjghtsk9r .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-fowjghtsk9r .cluster-label text{fill:#F9FFFE;}#mermaid-fowjghtsk9r .cluster-label span{color:#F9FFFE;}#mermaid-fowjghtsk9r .cluster-label span p{background-color:transparent;}#mermaid-fowjghtsk9r .label text,#mermaid-fowjghtsk9r span{fill:#ccc;color:#ccc;}#mermaid-fowjghtsk9r .node rect,#mermaid-fowjghtsk9r .node circle,#mermaid-fowjghtsk9r .node ellipse,#mermaid-fowjghtsk9r .node polygon,#mermaid-fowjghtsk9r .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-fowjghtsk9r .rough-node .label text,#mermaid-fowjghtsk9r .node .label text,#mermaid-fowjghtsk9r .image-shape .label,#mermaid-fowjghtsk9r .icon-shape .label{text-anchor:middle;}#mermaid-fowjghtsk9r .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-fowjghtsk9r .rough-node .label,#mermaid-fowjghtsk9r .node .label,#mermaid-fowjghtsk9r .image-shape .label,#mermaid-fowjghtsk9r .icon-shape .label{text-align:center;}#mermaid-fowjghtsk9r .node.clickable{cursor:pointer;}#mermaid-fowjghtsk9r .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-fowjghtsk9r .arrowheadPath{fill:lightgrey;}#mermaid-fowjghtsk9r .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-fowjghtsk9r .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-fowjghtsk9r .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-fowjghtsk9r .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-fowjghtsk9r .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-fowjghtsk9r .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-fowjghtsk9r .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-fowjghtsk9r .cluster text{fill:#F9FFFE;}#mermaid-fowjghtsk9r .cluster span{color:#F9FFFE;}#mermaid-fowjghtsk9r div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-fowjghtsk9r .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-fowjghtsk9r rect.text{fill:none;stroke-width:0;}#mermaid-fowjghtsk9r .icon-shape,#mermaid-fowjghtsk9r .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-fowjghtsk9r .icon-shape p,#mermaid-fowjghtsk9r .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-fowjghtsk9r .icon-shape rect,#mermaid-fowjghtsk9r .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-fowjghtsk9r .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-fowjghtsk9r .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-fowjghtsk9r :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Finds

Finds

Finds

Runs

Runs

Runs

Runs

forge test -vvv

Test Discovery test/*.t.sol

setUp() Per-test initialization

Test Functions test*()

Assertions assert*/expect*

Test Results PASS/FAIL

AegisIntegrationTest

AegisHookTest

AegisSentinelTest

testOracleUpdate()

testAccessControl()

testPanicTrigger()

testCircuitBreaker()

Sources:[.github/workflows/test.yml#31-34](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L31-L34)[README.md#80-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L80-L94)

---

## Test Coverage and ScenariosLink copied!

The Aegis test suite validates critical security and functional requirements across the three-chain architecture. The [README.md#85-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L85-L94) documents four primary test scenarios:

### Core Test ScenariosLink copied!

Test CaseContract Under TestValidatesExpected BehaviorOracle Update`MockOracle`Price feed simulation on L1Emits `PriceUpdate` event correctlyAccess Control`AegisHook`Authorization mechanismOnly `AegisSentinel` can call `setPanicMode`Panic Trigger`AegisHook`State transition logic`setPanicMode(true)` activates circuit breakerCircuit Breaker`AegisHook`Swap blocking mechanism`beforeSwap` reverts with `PoolPaused()` when panic active

### Test Architecture PatternLink copied!

Aegis tests follow Foundry's standard test structure:

1. Test Contract Inheritance: Test contracts inherit from `Test` base class from `forge-std`
2. Setup Function: `setUp()` function runs before each test to initialize state
3. Test Functions: Functions prefixed with `test` are automatically discovered
4. Assertions: Uses `assertEq`, `assertTrue`, `assertFalse` for validation
5. Expectation Cheats: Uses `vm.expectRevert` to validate error conditions

### Integration Test FocusLink copied!

The integration test suite (`AegisIntegrationTest`) specifically validates:

- Cross-chain message flow: Oracle events → Sentinel detection → Hook state change
- Panic mode activation: Price threshold breach triggers circuit breaker
- Swap blocking: Uniswap v4 swaps correctly revert during panic state
- Recovery: System returns to normal operation after market stabilization

Test Validation Flow Diagram:

"AegisHook.sol""AegisSentinel.sol""MockOracle.sol""AegisIntegrationTest""forge test""AegisHook.sol""AegisSentinel.sol""MockOracle.sol""AegisIntegrationTest""forge test"#mermaid-m4o3nyqs6gg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-m4o3nyqs6gg .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-m4o3nyqs6gg .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-m4o3nyqs6gg .error-icon{fill:#a44141;}#mermaid-m4o3nyqs6gg .error-text{fill:#ddd;stroke:#ddd;}#mermaid-m4o3nyqs6gg .edge-thickness-normal{stroke-width:1px;}#mermaid-m4o3nyqs6gg .edge-thickness-thick{stroke-width:3.5px;}#mermaid-m4o3nyqs6gg .edge-pattern-solid{stroke-dasharray:0;}#mermaid-m4o3nyqs6gg .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-m4o3nyqs6gg .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-m4o3nyqs6gg .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-m4o3nyqs6gg .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-m4o3nyqs6gg .marker.cross{stroke:lightgrey;}#mermaid-m4o3nyqs6gg svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-m4o3nyqs6gg p{margin:0;}#mermaid-m4o3nyqs6gg .actor{stroke:#ccc;fill:#1f2020;}#mermaid-m4o3nyqs6gg text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-m4o3nyqs6gg .actor-line{stroke:#ccc;}#mermaid-m4o3nyqs6gg .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-m4o3nyqs6gg .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-m4o3nyqs6gg .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-m4o3nyqs6gg #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-m4o3nyqs6gg .sequenceNumber{fill:black;}#mermaid-m4o3nyqs6gg #sequencenumber{fill:lightgrey;}#mermaid-m4o3nyqs6gg #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-m4o3nyqs6gg .messageText{fill:lightgrey;stroke:none;}#mermaid-m4o3nyqs6gg .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-m4o3nyqs6gg .labelText,#mermaid-m4o3nyqs6gg .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-m4o3nyqs6gg .loopText,#mermaid-m4o3nyqs6gg .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-m4o3nyqs6gg .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-m4o3nyqs6gg .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-m4o3nyqs6gg .noteText,#mermaid-m4o3nyqs6gg .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-m4o3nyqs6gg .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-m4o3nyqs6gg .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-m4o3nyqs6gg .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-m4o3nyqs6gg .actorPopupMenu{position:absolute;}#mermaid-m4o3nyqs6gg .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-m4o3nyqs6gg .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-m4o3nyqs6gg .actor-man circle,#mermaid-m4o3nyqs6gg line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-m4o3nyqs6gg :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}"Execute setUp()""Deploy contract""Deploy contract""Deploy contract""Run testOracleUpdate()""setPrice(2000)""Emit PriceUpdate(2000)""assertEq(price | 2000)""✅ PASS""Run testAccessControl()""setPanicMode() from unauthorized""Revert: Unauthorized""vm.expectRevert()""✅ PASS""Run testPanicTrigger()""setPrice(1000)""Detect crash""setPanicMode(true)""assertTrue(panicMode)""✅ PASS""Run testCircuitBreaker()""panicMode = true""beforeSwap()""Revert: PoolPaused()""vm.expectRevert(PoolPaused.selector)""✅ PASS"

Sources:[README.md#85-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L85-L94)

---

## Local Verification WorkflowLink copied!

Before deploying to testnets, developers should verify contract functionality locally:

### 1. Clean BuildLink copied!

```
# Remove previous artifacts
forge clean
 
# Rebuild from scratch
forge build --sizes
```

### 2. Run Full Test SuiteLink copied!

```
# Execute all tests with verbose output
forge test -vvv
```

### 3. Verify Specific ComponentsLink copied!

```
# Test only the hook contract
forge test --match-contract AegisHookTest -vv
 
# Test only the sentinel logic
forge test --match-contract AegisSentinelTest -vv
 
# Test cross-chain integration
forge test --match-contract AegisIntegrationTest -vvv
```

### 4. Check Gas UsageLink copied!

```
# Display gas reports for all tests
forge test --gas-report
```

This output helps identify expensive operations that may need optimization before mainnet deployment.

### 5. Generate Coverage ReportLink copied!

```
# Run tests and output coverage data
forge coverage
```

This command uses LCOV format to show which code paths are exercised by tests, helping identify untested edge cases.

Local Verification Checklist:

#mermaid-4c9lenqykle{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-4c9lenqykle .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-4c9lenqykle .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-4c9lenqykle .error-icon{fill:#a44141;}#mermaid-4c9lenqykle .error-text{fill:#ddd;stroke:#ddd;}#mermaid-4c9lenqykle .edge-thickness-normal{stroke-width:1px;}#mermaid-4c9lenqykle .edge-thickness-thick{stroke-width:3.5px;}#mermaid-4c9lenqykle .edge-pattern-solid{stroke-dasharray:0;}#mermaid-4c9lenqykle .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-4c9lenqykle .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-4c9lenqykle .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-4c9lenqykle .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-4c9lenqykle .marker.cross{stroke:lightgrey;}#mermaid-4c9lenqykle svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-4c9lenqykle p{margin:0;}#mermaid-4c9lenqykle .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-4c9lenqykle .cluster-label text{fill:#F9FFFE;}#mermaid-4c9lenqykle .cluster-label span{color:#F9FFFE;}#mermaid-4c9lenqykle .cluster-label span p{background-color:transparent;}#mermaid-4c9lenqykle .label text,#mermaid-4c9lenqykle span{fill:#ccc;color:#ccc;}#mermaid-4c9lenqykle .node rect,#mermaid-4c9lenqykle .node circle,#mermaid-4c9lenqykle .node ellipse,#mermaid-4c9lenqykle .node polygon,#mermaid-4c9lenqykle .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-4c9lenqykle .rough-node .label text,#mermaid-4c9lenqykle .node .label text,#mermaid-4c9lenqykle .image-shape .label,#mermaid-4c9lenqykle .icon-shape .label{text-anchor:middle;}#mermaid-4c9lenqykle .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-4c9lenqykle .rough-node .label,#mermaid-4c9lenqykle .node .label,#mermaid-4c9lenqykle .image-shape .label,#mermaid-4c9lenqykle .icon-shape .label{text-align:center;}#mermaid-4c9lenqykle .node.clickable{cursor:pointer;}#mermaid-4c9lenqykle .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-4c9lenqykle .arrowheadPath{fill:lightgrey;}#mermaid-4c9lenqykle .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-4c9lenqykle .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-4c9lenqykle .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-4c9lenqykle .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-4c9lenqykle .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-4c9lenqykle .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-4c9lenqykle .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-4c9lenqykle .cluster text{fill:#F9FFFE;}#mermaid-4c9lenqykle .cluster span{color:#F9FFFE;}#mermaid-4c9lenqykle div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-4c9lenqykle .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-4c9lenqykle rect.text{fill:none;stroke-width:0;}#mermaid-4c9lenqykle .icon-shape,#mermaid-4c9lenqykle .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-4c9lenqykle .icon-shape p,#mermaid-4c9lenqykle .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-4c9lenqykle .icon-shape rect,#mermaid-4c9lenqykle .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-4c9lenqykle .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-4c9lenqykle .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-4c9lenqykle :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Yes

No

Yes

No

Start Verification

forge clean

forge build --sizes

Build Success?

forge test -vvv

All Tests Pass?

forge test --gas-report

forge coverage

Ready for Deployment

Debug Failures

Sources:[README.md#74-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L74-L94)

---

## CI/CD IntegrationLink copied!

The project includes automated testing via GitHub Actions, defined in [.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L1-L35)

### CI Pipeline ConfigurationLink copied!

The CI workflow executes on:

- Manual trigger via `workflow_dispatch` ([.github/workflows/test.yml#4](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L4-L4))
- Currently disabled: Push and pull request events ([.github/workflows/test.yml#5-6](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L5-L6))

The workflow uses the `ci` Foundry profile ([.github/workflows/test.yml#9](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L9-L9)), which can be customized in `foundry.toml` to modify compiler settings for CI environments.

### CI Pipeline StepsLink copied!

#mermaid-8nhepgmm09k{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-8nhepgmm09k .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-8nhepgmm09k .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-8nhepgmm09k .error-icon{fill:#a44141;}#mermaid-8nhepgmm09k .error-text{fill:#ddd;stroke:#ddd;}#mermaid-8nhepgmm09k .edge-thickness-normal{stroke-width:1px;}#mermaid-8nhepgmm09k .edge-thickness-thick{stroke-width:3.5px;}#mermaid-8nhepgmm09k .edge-pattern-solid{stroke-dasharray:0;}#mermaid-8nhepgmm09k .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-8nhepgmm09k .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-8nhepgmm09k .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-8nhepgmm09k .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-8nhepgmm09k .marker.cross{stroke:lightgrey;}#mermaid-8nhepgmm09k svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-8nhepgmm09k p{margin:0;}#mermaid-8nhepgmm09k .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-8nhepgmm09k .cluster-label text{fill:#F9FFFE;}#mermaid-8nhepgmm09k .cluster-label span{color:#F9FFFE;}#mermaid-8nhepgmm09k .cluster-label span p{background-color:transparent;}#mermaid-8nhepgmm09k .label text,#mermaid-8nhepgmm09k span{fill:#ccc;color:#ccc;}#mermaid-8nhepgmm09k .node rect,#mermaid-8nhepgmm09k .node circle,#mermaid-8nhepgmm09k .node ellipse,#mermaid-8nhepgmm09k .node polygon,#mermaid-8nhepgmm09k .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-8nhepgmm09k .rough-node .label text,#mermaid-8nhepgmm09k .node .label text,#mermaid-8nhepgmm09k .image-shape .label,#mermaid-8nhepgmm09k .icon-shape .label{text-anchor:middle;}#mermaid-8nhepgmm09k .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-8nhepgmm09k .rough-node .label,#mermaid-8nhepgmm09k .node .label,#mermaid-8nhepgmm09k .image-shape .label,#mermaid-8nhepgmm09k .icon-shape .label{text-align:center;}#mermaid-8nhepgmm09k .node.clickable{cursor:pointer;}#mermaid-8nhepgmm09k .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-8nhepgmm09k .arrowheadPath{fill:lightgrey;}#mermaid-8nhepgmm09k .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-8nhepgmm09k .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-8nhepgmm09k .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-8nhepgmm09k .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-8nhepgmm09k .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-8nhepgmm09k .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-8nhepgmm09k .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-8nhepgmm09k .cluster text{fill:#F9FFFE;}#mermaid-8nhepgmm09k .cluster span{color:#F9FFFE;}#mermaid-8nhepgmm09k div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-8nhepgmm09k .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-8nhepgmm09k rect.text{fill:none;stroke-width:0;}#mermaid-8nhepgmm09k .icon-shape,#mermaid-8nhepgmm09k .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-8nhepgmm09k .icon-shape p,#mermaid-8nhepgmm09k .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-8nhepgmm09k .icon-shape rect,#mermaid-8nhepgmm09k .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-8nhepgmm09k .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-8nhepgmm09k .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-8nhepgmm09k :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

actions/checkout@v4

foundry-rs/foundry-toolchain@v1

Workflow Trigger workflow_dispatch

Checkout Code with submodules

Install Foundry stable version

forge build --sizes

forge test -vvv

Test Results Published

### Key CI FeaturesLink copied!

FeatureImplementationPurposeSubmodule Checkout[.github/workflows/test.yml#17-18](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L17-L18)Ensures all dependencies from `lib/` are availableFoundry Toolchain[.github/workflows/test.yml#20-23](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L20-L23)Installs stable version of ForgeBuild Verification[.github/workflows/test.yml#25-29](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L25-L29)Confirms contracts compile with size analysisTest Execution[.github/workflows/test.yml#31-34](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L31-L34)Runs full test suite with verbose output

### Environment VariablesLink copied!

The CI uses the `FOUNDRY_PROFILE=ci` environment variable ([.github/workflows/test.yml#9](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L9-L9)), allowing developers to define CI-specific compiler settings:

```
[profile.ci]
# CI-specific overrides would go here
# Example: optimizer_runs = 1000
```

Sources:[.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L1-L35)[foundry.toml#1-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L1-L16)

---

## Troubleshooting Common IssuesLink copied!

### Compilation FailuresLink copied!

Problem: `forge build` fails with dependency errors

Solution: Ensure all submodules are initialized:

```
git submodule update --init --recursive
forge install
```

### Test FailuresLink copied!

Problem: Tests pass locally but fail in CI

Solution: Check for:

- Hardcoded addresses that differ between environments
- Time-dependent logic (use `vm.warp()` for deterministic time)
- Randomness assumptions (use `vm.roll()` for block numbers)

### Out of Memory ErrorsLink copied!

Problem: Large contracts fail to compile with `via_ir = true`

Solution: Temporarily disable IR optimization in [foundry.toml#16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L16-L16):

```
via_ir = false
```

Note: This may increase bytecode size and gas costs.

---

## SummaryLink copied!

The Aegis build and test workflow follows Foundry best practices:

1. Build: Use `forge build --sizes` to compile and monitor contract sizes
2. Test: Use `forge test -vvv` for comprehensive test execution with full traces
3. Verify: Run integration tests specifically with `--match-contract AegisIntegrationTest`
4. CI: Automated testing validates all changes via GitHub Actions

The test suite covers the critical security requirements documented in [README.md#85-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L85-L94): oracle updates, access control, panic triggering, and circuit breaker functionality. All tests must pass before proceeding to deployment across the three-network architecture (see [Deployment Overview](#5.1)).

Sources:[.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L1-L35)[README.md#74-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md#L74-L94)[foundry.toml#1-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L1-L16)

---

# Dependencies

# DependenciesLink copied!
Relevant source files
- [contracts/.gitmodules](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules)
- [contracts/foundry.lock](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.lock)
- [contracts/foundry.toml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml)

This document provides a comprehensive overview of external dependencies used in the Aegis system and how they are managed. It covers the four primary dependencies (forge-std, uniswap-hooks, hookmate, and system-smart-contracts), the git submodule workflow, and Foundry's remapping configuration. For information about building and testing with these dependencies, see [Building and Testing](#4.2). For environment setup instructions, see [Environment Setup](#4.1).

---

## Dependency Management StrategyLink copied!

Aegis uses git submodules to manage all external dependencies, avoiding centralized package managers like npm. This approach ensures reproducible builds and simplifies version pinning. All dependencies are stored in the `lib/` directory and tracked via [contracts/.gitmodules#1-13](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L1-L13)

The project pins specific commit hashes in [contracts/foundry.lock#1-11](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.lock#L1-L11) to ensure deterministic builds across different environments. Foundry's remapping system in [contracts/foundry.toml#9-14](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L9-L14) enables clean import paths without requiring deep directory traversal.

#mermaid-j2yrk0l33il{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-j2yrk0l33il .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-j2yrk0l33il .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-j2yrk0l33il .error-icon{fill:#a44141;}#mermaid-j2yrk0l33il .error-text{fill:#ddd;stroke:#ddd;}#mermaid-j2yrk0l33il .edge-thickness-normal{stroke-width:1px;}#mermaid-j2yrk0l33il .edge-thickness-thick{stroke-width:3.5px;}#mermaid-j2yrk0l33il .edge-pattern-solid{stroke-dasharray:0;}#mermaid-j2yrk0l33il .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-j2yrk0l33il .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-j2yrk0l33il .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-j2yrk0l33il .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-j2yrk0l33il .marker.cross{stroke:lightgrey;}#mermaid-j2yrk0l33il svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-j2yrk0l33il p{margin:0;}#mermaid-j2yrk0l33il .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-j2yrk0l33il .cluster-label text{fill:#F9FFFE;}#mermaid-j2yrk0l33il .cluster-label span{color:#F9FFFE;}#mermaid-j2yrk0l33il .cluster-label span p{background-color:transparent;}#mermaid-j2yrk0l33il .label text,#mermaid-j2yrk0l33il span{fill:#ccc;color:#ccc;}#mermaid-j2yrk0l33il .node rect,#mermaid-j2yrk0l33il .node circle,#mermaid-j2yrk0l33il .node ellipse,#mermaid-j2yrk0l33il .node polygon,#mermaid-j2yrk0l33il .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-j2yrk0l33il .rough-node .label text,#mermaid-j2yrk0l33il .node .label text,#mermaid-j2yrk0l33il .image-shape .label,#mermaid-j2yrk0l33il .icon-shape .label{text-anchor:middle;}#mermaid-j2yrk0l33il .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-j2yrk0l33il .rough-node .label,#mermaid-j2yrk0l33il .node .label,#mermaid-j2yrk0l33il .image-shape .label,#mermaid-j2yrk0l33il .icon-shape .label{text-align:center;}#mermaid-j2yrk0l33il .node.clickable{cursor:pointer;}#mermaid-j2yrk0l33il .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-j2yrk0l33il .arrowheadPath{fill:lightgrey;}#mermaid-j2yrk0l33il .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-j2yrk0l33il .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-j2yrk0l33il .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-j2yrk0l33il .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-j2yrk0l33il .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-j2yrk0l33il .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-j2yrk0l33il .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-j2yrk0l33il .cluster text{fill:#F9FFFE;}#mermaid-j2yrk0l33il .cluster span{color:#F9FFFE;}#mermaid-j2yrk0l33il div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-j2yrk0l33il .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-j2yrk0l33il rect.text{fill:none;stroke-width:0;}#mermaid-j2yrk0l33il .icon-shape,#mermaid-j2yrk0l33il .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-j2yrk0l33il .icon-shape p,#mermaid-j2yrk0l33il .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-j2yrk0l33il .icon-shape rect,#mermaid-j2yrk0l33il .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-j2yrk0l33il .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-j2yrk0l33il .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-j2yrk0l33il :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Source Contracts

lib/ Directory

Aegis Repository

Defines URLs

Defines URLs

Defines URLs

Defines URLs

Pins Commits

Pins Commits

Pins Commits

Maps Import Paths

Maps Import Paths

Maps Import Paths

Imports

Imports

Imports

Imports

Imports

contracts/.gitmodules Submodule Definitions

contracts/foundry.lock Commit Hash Pinning

contracts/foundry.toml Remapping Configuration

lib/forge-std/

lib/uniswap-hooks/

lib/hookmate/

lib/system-smart-contracts/

src/AegisHook.sol

src/AegisSentinel.sol

src/MockOracle.sol

src/AegisGuardianRegistry.sol

Sources:[contracts/.gitmodules#1-13](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L1-L13)[contracts/foundry.lock#1-11](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.lock#L1-L11)[contracts/foundry.toml#9-14](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L9-L14)

---

## Core External DependenciesLink copied!

### forge-stdLink copied!

Repository:[https://github.com/foundry-rs/forge-std](https://github.com/foundry-rs/forge-std)Pinned Commit:`8bbcf6e3f8f62f419e5429a0bd89331c85c37824`Purpose: Foundry's standard library for testing and scripting

The `forge-std` library provides the testing framework used throughout Aegis. It includes:

- Test Base Contracts:`Test` contract with cheatcodes and assertions
- Script Base Contracts:`Script` contract for deployment scripts
- Console Logging:`console.sol` and `console2.sol` for debugging
- Standard Cheats: VM manipulation functions for testing
- Standard Storage: Low-level storage manipulation utilities

Import Remapping: None required (default Foundry path)

Key Usage in Aegis:

- Test files extend `forge-std/Test.sol`
- Deployment scripts extend `forge-std/Script.sol`
- Console logging during development and debugging

For detailed documentation of forge-std utilities, see [Testing Utilities](#7.1) and [Base Contracts](#7.2).

Sources:[contracts/.gitmodules#1-3](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L1-L3)[contracts/foundry.lock#2-4](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.lock#L2-L4)

---

### uniswap-hooksLink copied!

Repository:[https://github.com/openzeppelin/uniswap-hooks](https://github.com/openzeppelin/uniswap-hooks)Pinned Commit:`e59fe72c110c3862eec9b332530dce49ca506bbb`Purpose: OpenZeppelin's fork providing Uniswap v4 hook interfaces

This dependency is critical for `AegisHook` integration with Uniswap v4. It provides:

- IPoolManager Interface: Core pool management functions
- BaseHook Abstract Contract: Base implementation for custom hooks
- Hook Callback Interfaces:`beforeSwap`, `afterSwap`, etc.
- v4-core Types:`PoolKey`, `BalanceDelta`, `BeforeSwapDelta`
- v4-periphery Utilities: Position management and routing

Import Remappings:

```
v4-core/=lib/uniswap-hooks/lib/v4-core/
v4-periphery/=lib/uniswap-hooks/lib/v4-periphery/
```

Key Usage in Aegis:

- `AegisHook` extends `BaseHook` from this library
- Implements `beforeSwap` callback to gate swaps during panic mode
- Uses `PoolKey` and `BeforeSwapDelta` types for pool identification

Sources:[contracts/.gitmodules#4-6](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L4-L6)[contracts/foundry.lock#8-10](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.lock#L8-L10)[contracts/foundry.toml#12-13](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L12-L13)

---

### hookmateLink copied!

Repository:[https://github.com/akshatmittal/hookmate](https://github.com/akshatmittal/hookmate)Pinned Commit:`33408fbc15e083eb0bc4205fa37cb6ba0a926f44`Purpose: Hook development utilities and helper functions

The `hookmate` library provides developer tooling for Uniswap v4 hook creation:

- Hook Address Mining: Tools to find addresses with specific flag patterns
- Test Helpers: Utilities for hook testing scenarios
- Hook Validation: Functions to verify hook implementations
- Address Utilities: Functions for hook address calculations

Import Remapping: None explicitly configured (uses default `lib/hookmate/` path)

Key Usage in Aegis:

- Used during development and testing of `AegisHook`
- May be used for hook address calculation during deployment

Sources:[contracts/.gitmodules#7-9](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L7-L9)[contracts/foundry.lock#5-7](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.lock#L5-L7)

---

### system-smart-contractsLink copied!

Repository:[https://github.com/Reactive-Network/system-smart-contracts](https://github.com/Reactive-Network/system-smart-contracts)Pinned Commit: Not tracked in foundry.lock (manually managed)Purpose: Reactive Network core contracts and reactive-lib

This is the most critical dependency for Aegis's cross-chain functionality. It provides:

- AbstractReactive: Base contract for reactive smart contracts
- IReactive Interface: Event subscription and callback methods
- reactive-lib: Low-level reactive protocol primitives
- Reactive Service Contract: System contract for cross-chain calls

Import Remappings:

```
reactive-lib/=lib/system-smart-contracts/lib/reactive-lib/src/
system-smart-contracts/=lib/system-smart-contracts/src/
```

Key Usage in Aegis:

- `AegisSentinel` extends `AbstractReactive`
- Subscribes to `PriceUpdate` events from `MockOracle` on Ethereum L1
- Triggers cross-chain calls to `AegisHook` on Unichain L2

For detailed information on Reactive Network integration, see [Reactive Network Integration](#3.1).

Sources:[contracts/.gitmodules#10-12](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L10-L12)[contracts/foundry.toml#10-11](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L10-L11)

---

## Dependency ConfigurationLink copied!

### Remapping SystemLink copied!

Foundry's remapping system simplifies imports by mapping short prefixes to deep directory paths. This is configured in [contracts/foundry.toml#9-14](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L9-L14):

Remapping PrefixTarget PathUsed By`reactive-lib/``lib/system-smart-contracts/lib/reactive-lib/src/``AegisSentinel``system-smart-contracts/``lib/system-smart-contracts/src/``AegisSentinel``v4-core/``lib/uniswap-hooks/lib/v4-core/``AegisHook``v4-periphery/``lib/uniswap-hooks/lib/v4-periphery/``AegisHook`

Example Import Transformation:

```
// Without remapping (verbose):
import "lib/uniswap-hooks/lib/v4-core/src/interfaces/IPoolManager.sol";
 
// With remapping (clean):
import "v4-core/src/interfaces/IPoolManager.sol";
```

This configuration allows Aegis contracts to use clean, readable import paths while maintaining flexibility to upgrade dependencies by changing remappings without modifying source code.

Sources:[contracts/foundry.toml#9-14](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L9-L14)

---

### Version PinningLink copied!

The [contracts/foundry.lock#1-11](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.lock#L1-L11) file pins exact commit hashes for three dependencies:

```
{
  "lib/forge-std": {
    "rev": "8bbcf6e3f8f62f419e5429a0bd89331c85c37824"
  },
  "lib/hookmate": {
    "rev": "33408fbc15e083eb0bc4205fa37cb6ba0a926f44"
  },
  "lib/uniswap-hooks": {
    "rev": "e59fe72c110c3862eec9b332530dce49ca506bbb"
  }
}
```

Note: The `system-smart-contracts` dependency is not tracked in `foundry.lock`, likely because it's under active development. Developers should manually verify the commit hash when cloning.

Sources:[contracts/foundry.lock#1-11](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.lock#L1-L11)

---

## Dependency Import FlowLink copied!

This diagram illustrates how Aegis contracts import from dependencies through the remapping system:

#mermaid-y3y1gemu32m{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-y3y1gemu32m .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-y3y1gemu32m .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-y3y1gemu32m .error-icon{fill:#a44141;}#mermaid-y3y1gemu32m .error-text{fill:#ddd;stroke:#ddd;}#mermaid-y3y1gemu32m .edge-thickness-normal{stroke-width:1px;}#mermaid-y3y1gemu32m .edge-thickness-thick{stroke-width:3.5px;}#mermaid-y3y1gemu32m .edge-pattern-solid{stroke-dasharray:0;}#mermaid-y3y1gemu32m .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-y3y1gemu32m .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-y3y1gemu32m .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-y3y1gemu32m .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-y3y1gemu32m .marker.cross{stroke:lightgrey;}#mermaid-y3y1gemu32m svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-y3y1gemu32m p{margin:0;}#mermaid-y3y1gemu32m .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-y3y1gemu32m .cluster-label text{fill:#F9FFFE;}#mermaid-y3y1gemu32m .cluster-label span{color:#F9FFFE;}#mermaid-y3y1gemu32m .cluster-label span p{background-color:transparent;}#mermaid-y3y1gemu32m .label text,#mermaid-y3y1gemu32m span{fill:#ccc;color:#ccc;}#mermaid-y3y1gemu32m .node rect,#mermaid-y3y1gemu32m .node circle,#mermaid-y3y1gemu32m .node ellipse,#mermaid-y3y1gemu32m .node polygon,#mermaid-y3y1gemu32m .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-y3y1gemu32m .rough-node .label text,#mermaid-y3y1gemu32m .node .label text,#mermaid-y3y1gemu32m .image-shape .label,#mermaid-y3y1gemu32m .icon-shape .label{text-anchor:middle;}#mermaid-y3y1gemu32m .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-y3y1gemu32m .rough-node .label,#mermaid-y3y1gemu32m .node .label,#mermaid-y3y1gemu32m .image-shape .label,#mermaid-y3y1gemu32m .icon-shape .label{text-align:center;}#mermaid-y3y1gemu32m .node.clickable{cursor:pointer;}#mermaid-y3y1gemu32m .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-y3y1gemu32m .arrowheadPath{fill:lightgrey;}#mermaid-y3y1gemu32m .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-y3y1gemu32m .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-y3y1gemu32m .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-y3y1gemu32m .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-y3y1gemu32m .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-y3y1gemu32m .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-y3y1gemu32m .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-y3y1gemu32m .cluster text{fill:#F9FFFE;}#mermaid-y3y1gemu32m .cluster span{color:#F9FFFE;}#mermaid-y3y1gemu32m div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-y3y1gemu32m .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-y3y1gemu32m rect.text{fill:none;stroke-width:0;}#mermaid-y3y1gemu32m .icon-shape,#mermaid-y3y1gemu32m .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-y3y1gemu32m .icon-shape p,#mermaid-y3y1gemu32m .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-y3y1gemu32m .icon-shape rect,#mermaid-y3y1gemu32m .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-y3y1gemu32m .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-y3y1gemu32m .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-y3y1gemu32m :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Remapping Resolution

Deployment Scripts Imports

Test Contracts Imports

AegisSentinel.sol Imports

AegisHook.sol Imports

Resolved via

Resolved via

Resolved via

Resolved via

Resolved via

Located in

Located in

Located in

Located in

Located in

import 'v4-core/src/interfaces/IPoolManager.sol'

import 'v4-core/src/types/PoolKey.sol'

import 'uniswap-hooks/BaseHook.sol'

import 'system-smart-contracts/AbstractReactive.sol'

import 'reactive-lib/IReactive.sol'

import 'system-smart-contracts/IReactiveService.sol'

import 'forge-std/Test.sol'

import 'forge-std/console.sol'

import 'forge-std/Script.sol'

v4-core/ → lib/uniswap-hooks/lib/v4-core/

system-smart-contracts/ → lib/system-smart-contracts/src/

reactive-lib/ → lib/system-smart-contracts/lib/reactive-lib/src/

lib/uniswap-hooks/

lib/system-smart-contracts/

lib/forge-std/

Sources:[contracts/foundry.toml#9-14](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L9-L14)

---

## Managing SubmodulesLink copied!

### Initial SetupLink copied!

When cloning the Aegis repository, initialize all submodules:

```
git clone https://github.com/HACK3R-CRYPTO/Aegis
cd Aegis/contracts
git submodule update --init --recursive
```

This command:

1. Initializes all submodules defined in [contracts/.gitmodules#1-13](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L1-L13)
2. Checks out the commits specified in the parent repository
3. Recursively initializes nested submodules (e.g., `v4-core` within `uniswap-hooks`)

### Updating DependenciesLink copied!

To update a specific dependency to its latest version:

```
cd lib/forge-std
git pull origin main
cd ../..
git add lib/forge-std
git commit -m "Update forge-std to latest"
```

To update all dependencies:

```
git submodule update --remote
```

Warning: Updating dependencies may introduce breaking changes. Always run the full test suite after updating.

---

## Dependency Resolution During BuildLink copied!

#mermaid-ujker4ngor{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-ujker4ngor .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-ujker4ngor .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-ujker4ngor .error-icon{fill:#a44141;}#mermaid-ujker4ngor .error-text{fill:#ddd;stroke:#ddd;}#mermaid-ujker4ngor .edge-thickness-normal{stroke-width:1px;}#mermaid-ujker4ngor .edge-thickness-thick{stroke-width:3.5px;}#mermaid-ujker4ngor .edge-pattern-solid{stroke-dasharray:0;}#mermaid-ujker4ngor .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-ujker4ngor .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-ujker4ngor .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-ujker4ngor .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-ujker4ngor .marker.cross{stroke:lightgrey;}#mermaid-ujker4ngor svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-ujker4ngor p{margin:0;}#mermaid-ujker4ngor .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-ujker4ngor .cluster-label text{fill:#F9FFFE;}#mermaid-ujker4ngor .cluster-label span{color:#F9FFFE;}#mermaid-ujker4ngor .cluster-label span p{background-color:transparent;}#mermaid-ujker4ngor .label text,#mermaid-ujker4ngor span{fill:#ccc;color:#ccc;}#mermaid-ujker4ngor .node rect,#mermaid-ujker4ngor .node circle,#mermaid-ujker4ngor .node ellipse,#mermaid-ujker4ngor .node polygon,#mermaid-ujker4ngor .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-ujker4ngor .rough-node .label text,#mermaid-ujker4ngor .node .label text,#mermaid-ujker4ngor .image-shape .label,#mermaid-ujker4ngor .icon-shape .label{text-anchor:middle;}#mermaid-ujker4ngor .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-ujker4ngor .rough-node .label,#mermaid-ujker4ngor .node .label,#mermaid-ujker4ngor .image-shape .label,#mermaid-ujker4ngor .icon-shape .label{text-align:center;}#mermaid-ujker4ngor .node.clickable{cursor:pointer;}#mermaid-ujker4ngor .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-ujker4ngor .arrowheadPath{fill:lightgrey;}#mermaid-ujker4ngor .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-ujker4ngor .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-ujker4ngor .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-ujker4ngor .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-ujker4ngor .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-ujker4ngor .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-ujker4ngor .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-ujker4ngor .cluster text{fill:#F9FFFE;}#mermaid-ujker4ngor .cluster span{color:#F9FFFE;}#mermaid-ujker4ngor div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-ujker4ngor .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-ujker4ngor rect.text{fill:none;stroke-width:0;}#mermaid-ujker4ngor .icon-shape,#mermaid-ujker4ngor .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-ujker4ngor .icon-shape p,#mermaid-ujker4ngor .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-ujker4ngor .icon-shape rect,#mermaid-ujker4ngor .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-ujker4ngor .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-ujker4ngor .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-ujker4ngor :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Dependency Libraries

Configuration Files

Foundry Build Process

Read remappings

Verify commits

Reference

Linked via remapping

Linked via remapping

Linked via remapping

forge build

Read foundry.toml

Load lib/ Submodules

Apply Remappings

Resolve Import Paths

Compile Solidity

foundry.toml remappings, solc_version

foundry.lock commit hashes

.gitmodules submodule URLs

lib/forge-std/

lib/uniswap-hooks/

lib/hookmate/

lib/system-smart-contracts/

Sources:[contracts/foundry.toml#1-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L1-L27)[contracts/.gitmodules#1-13](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L1-L13)[contracts/foundry.lock#1-11](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.lock#L1-L11)

---

## Dependency Usage SummaryLink copied!

Aegis Contractforge-stduniswap-hookshookmatesystem-smart-contracts`AegisHook.sol`❌✅ (BaseHook, IPoolManager)✅ (utilities)❌`AegisSentinel.sol`❌❌❌✅ (AbstractReactive, IReactive)`MockOracle.sol`❌❌❌❌ (pure Solidity)`AegisGuardianRegistry.sol`❌❌❌❌ (pure Solidity + ERC standards)Test contracts (`.t.sol`)✅ (Test base)✅ (interfaces)❌✅ (test utilities)Deployment scripts (`.s.sol`)✅ (Script base)❌❌❌

Sources:[contracts/.gitmodules#1-13](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L1-L13)[contracts/foundry.toml#9-14](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L9-L14)

---

## TroubleshootingLink copied!

### Common IssuesLink copied!

Issue:`Error: Failed to resolve import: v4-core/src/interfaces/IPoolManager.sol`

Solution: Verify remappings in [contracts/foundry.toml#12-13](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L12-L13) are correct and submodules are initialized:

```
git submodule update --init --recursive
```

---

Issue:`Error: Source "lib/uniswap-hooks" not found`

Solution: The submodule is not initialized. Run:

```
cd contracts
git submodule update --init
```

---

Issue: Build fails after updating dependencies

Solution: Check [contracts/foundry.lock#1-11](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.lock#L1-L11) for commit hash mismatches. Reset submodules to pinned versions:

```
git submodule update --recursive
```

---

## Related PagesLink copied!

- For build instructions using these dependencies, see [Building and Testing](#4.2)
- For environment setup including dependency installation, see [Environment Setup](#4.1)
- For detailed forge-std documentation, see [Forge Standard Library](#7)
- For Reactive Network integration details, see [Reactive Network Integration](#3.1)

Sources:[contracts/.gitmodules#1-13](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L1-L13)[contracts/foundry.lock#1-11](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.lock#L1-L11)[contracts/foundry.toml#1-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L1-L27)

---

# Code-Standards

# Code StandardsLink copied!
Relevant source files
- [contracts/.vscode/settings.json](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.vscode/settings.json)
- [contracts/foundry.toml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml)

## Purpose and ScopeLink copied!

This document defines the code formatting rules, linting configuration, compiler settings, and development conventions used throughout the Aegis codebase. These standards ensure consistency across all smart contracts and maintain compatibility with the three-chain deployment architecture.

For environment setup instructions and tool installation, see [Environment Setup](#4.1). For building and testing workflows that enforce these standards, see [Building and Testing](#4.2). For information about external library dependencies, see [Dependencies](#4.3).

---

## Formatter ConfigurationLink copied!

### Forge FormatterLink copied!

The Aegis project uses the Forge formatter as the exclusive code formatting tool for all Solidity files. This is configured at both the editor and project levels.

VS Code Integration

The editor is configured to use Forge as the default Solidity formatter via [.vscode/settings.json#1-3](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.vscode/settings.json#L1-L3):

```
{
  "solidity.formatter": "forge"
}
```

This ensures that any IDE-level formatting operations (e.g., "Format Document" commands) delegate to Forge's native formatter, maintaining consistency with command-line builds.

Command-Line Usage

Developers format code using:

```
forge fmt
```

This command recursively formats all `.sol` files in the `src/` and `test/` directories according to Forge's built-in style rules. The formatter automatically handles:

- Indentation (4 spaces)
- Line length limits
- Import statement ordering
- Function modifier alignment
- Comment formatting

Sources: [.vscode/settings.json#1-3](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.vscode/settings.json#L1-L3)[foundry.toml#1-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L1-L27)

---

## Compiler ConfigurationLink copied!

### Solidity Version and EVM TargetLink copied!

The project enforces strict compiler settings to ensure compatibility across all three deployment networks (Ethereum Sepolia, Reactive Network, Unichain Sepolia).

Core Compiler Settings

From [foundry.toml#1-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L1-L16):

SettingValuePurpose`solc_version``0.8.26`Latest stable Solidity compiler with required features`evm_version``cancun`Targets Cancun hard fork opcodes (available on all chains)`via_ir``true`Enables IR-based code generation for optimized bytecode`bytecode_hash``none`Disables metadata hash inclusion for deterministic builds

IR-Based Compilation

The `via_ir = true` setting enables the Yul-based intermediate representation compiler pipeline. This is critical for the project because:

1. Uniswap v4 Compatibility: The `AegisHook` contract inherits from complex Uniswap v4 base contracts that benefit from IR optimization to avoid stack-too-deep errors.
2. Cross-Chain Efficiency: Reduced bytecode size lowers deployment costs across three networks.
3. Guardian Registry Complexity: The `AegisGuardianRegistry` implements both ERC-721 and ERC-8004, requiring aggressive optimization.

Cancun Hard Fork Opcodes

The `evm_version = "cancun"` setting enables:

- `MCOPY` opcode for efficient memory operations
- `PUSH0` opcode for gas-optimized zero values
- EIP-1153 transient storage (if used in future iterations)

All three deployment networks (Sepolia, Reactive Network Lasna, Unichain Sepolia) support Cancun, making this a safe target.

Sources: [foundry.toml#1-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L1-L16)

---

### Configuration Flow DiagramLink copied!

#mermaid-fhqycw7nf8{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-fhqycw7nf8 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-fhqycw7nf8 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-fhqycw7nf8 .error-icon{fill:#a44141;}#mermaid-fhqycw7nf8 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-fhqycw7nf8 .edge-thickness-normal{stroke-width:1px;}#mermaid-fhqycw7nf8 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-fhqycw7nf8 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-fhqycw7nf8 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-fhqycw7nf8 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-fhqycw7nf8 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-fhqycw7nf8 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-fhqycw7nf8 .marker.cross{stroke:lightgrey;}#mermaid-fhqycw7nf8 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-fhqycw7nf8 p{margin:0;}#mermaid-fhqycw7nf8 .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-fhqycw7nf8 .cluster-label text{fill:#F9FFFE;}#mermaid-fhqycw7nf8 .cluster-label span{color:#F9FFFE;}#mermaid-fhqycw7nf8 .cluster-label span p{background-color:transparent;}#mermaid-fhqycw7nf8 .label text,#mermaid-fhqycw7nf8 span{fill:#ccc;color:#ccc;}#mermaid-fhqycw7nf8 .node rect,#mermaid-fhqycw7nf8 .node circle,#mermaid-fhqycw7nf8 .node ellipse,#mermaid-fhqycw7nf8 .node polygon,#mermaid-fhqycw7nf8 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-fhqycw7nf8 .rough-node .label text,#mermaid-fhqycw7nf8 .node .label text,#mermaid-fhqycw7nf8 .image-shape .label,#mermaid-fhqycw7nf8 .icon-shape .label{text-anchor:middle;}#mermaid-fhqycw7nf8 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-fhqycw7nf8 .rough-node .label,#mermaid-fhqycw7nf8 .node .label,#mermaid-fhqycw7nf8 .image-shape .label,#mermaid-fhqycw7nf8 .icon-shape .label{text-align:center;}#mermaid-fhqycw7nf8 .node.clickable{cursor:pointer;}#mermaid-fhqycw7nf8 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-fhqycw7nf8 .arrowheadPath{fill:lightgrey;}#mermaid-fhqycw7nf8 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-fhqycw7nf8 .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-fhqycw7nf8 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-fhqycw7nf8 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-fhqycw7nf8 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-fhqycw7nf8 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-fhqycw7nf8 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-fhqycw7nf8 .cluster text{fill:#F9FFFE;}#mermaid-fhqycw7nf8 .cluster span{color:#F9FFFE;}#mermaid-fhqycw7nf8 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-fhqycw7nf8 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-fhqycw7nf8 rect.text{fill:none;stroke-width:0;}#mermaid-fhqycw7nf8 .icon-shape,#mermaid-fhqycw7nf8 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-fhqycw7nf8 .icon-shape p,#mermaid-fhqycw7nf8 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-fhqycw7nf8 .icon-shape rect,#mermaid-fhqycw7nf8 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-fhqycw7nf8 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-fhqycw7nf8 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-fhqycw7nf8 :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Formatting

Build Artifacts

Source Code

Compiler Settings

foundry.toml Configuration File

solc_version: 0.8.26

evm_version: cancun

via_ir: true

bytecode_hash: none

src/*.sol Contract Source

test/*.t.sol Test Files

script/*.s.sol Deploy Scripts

out/ Compiled Contracts

.forge-snapshots/ Gas Benchmarks

forge fmt

VS Code Formatter

Configuration Dependency Flow

This diagram shows how the `foundry.toml` configuration file drives all compilation, formatting, and build processes. The formatter operates on source files before compilation, and all artifacts are generated in the `out/` directory. Gas snapshots are written to `.forge-snapshots/` for performance tracking across commits.

Sources: [foundry.toml#1-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L1-L16)[.vscode/settings.json#1-3](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.vscode/settings.json#L1-L3)

---

## Linting RulesLink copied!

### Exclusions and RationaleLink copied!

The project disables specific Forge linting rules that conflict with established Solidity conventions used in DeFi protocols. From [foundry.toml#24-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L24-L26):

```
[lint]
exclude_lints = ["screaming-snake-case-immutable", "screaming-snake-case-const"]
lint_on_build = false
```

Excluded Lint Rules

RuleDefault RequirementWhy Excluded`screaming-snake-case-immutable`Immutable variables must use `SCREAMING_SNAKE_CASE`Aegis uses `camelCase` for immutable storage variables to match Uniswap v4 conventions`screaming-snake-case-const`Constant variables must use `SCREAMING_SNAKE_CASE`Constants in Aegis use `SCREAMING_SNAKE_CASE` for true constants, but `camelCase` for complex storage references

Build-Time Linting

The `lint_on_build = false` setting disables automatic linting during `forge build` commands. This prevents build interruptions from non-critical style warnings. Developers can manually run linting checks using:

```
forge lint
```

This separation allows for fast iteration during development while maintaining the ability to enforce standards via CI/CD pipelines (see [CI/CD Pipelines](#6.2)).

Sources: [foundry.toml#24-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L24-L26)

---

### Naming Convention MappingLink copied!

#mermaid-i82t8obfaar{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-i82t8obfaar .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-i82t8obfaar .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-i82t8obfaar .error-icon{fill:#a44141;}#mermaid-i82t8obfaar .error-text{fill:#ddd;stroke:#ddd;}#mermaid-i82t8obfaar .edge-thickness-normal{stroke-width:1px;}#mermaid-i82t8obfaar .edge-thickness-thick{stroke-width:3.5px;}#mermaid-i82t8obfaar .edge-pattern-solid{stroke-dasharray:0;}#mermaid-i82t8obfaar .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-i82t8obfaar .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-i82t8obfaar .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-i82t8obfaar .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-i82t8obfaar .marker.cross{stroke:lightgrey;}#mermaid-i82t8obfaar svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-i82t8obfaar p{margin:0;}#mermaid-i82t8obfaar .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-i82t8obfaar .cluster-label text{fill:#F9FFFE;}#mermaid-i82t8obfaar .cluster-label span{color:#F9FFFE;}#mermaid-i82t8obfaar .cluster-label span p{background-color:transparent;}#mermaid-i82t8obfaar .label text,#mermaid-i82t8obfaar span{fill:#ccc;color:#ccc;}#mermaid-i82t8obfaar .node rect,#mermaid-i82t8obfaar .node circle,#mermaid-i82t8obfaar .node ellipse,#mermaid-i82t8obfaar .node polygon,#mermaid-i82t8obfaar .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-i82t8obfaar .rough-node .label text,#mermaid-i82t8obfaar .node .label text,#mermaid-i82t8obfaar .image-shape .label,#mermaid-i82t8obfaar .icon-shape .label{text-anchor:middle;}#mermaid-i82t8obfaar .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-i82t8obfaar .rough-node .label,#mermaid-i82t8obfaar .node .label,#mermaid-i82t8obfaar .image-shape .label,#mermaid-i82t8obfaar .icon-shape .label{text-align:center;}#mermaid-i82t8obfaar .node.clickable{cursor:pointer;}#mermaid-i82t8obfaar .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-i82t8obfaar .arrowheadPath{fill:lightgrey;}#mermaid-i82t8obfaar .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-i82t8obfaar .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-i82t8obfaar .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-i82t8obfaar .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-i82t8obfaar .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-i82t8obfaar .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-i82t8obfaar .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-i82t8obfaar .cluster text{fill:#F9FFFE;}#mermaid-i82t8obfaar .cluster span{color:#F9FFFE;}#mermaid-i82t8obfaar div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-i82t8obfaar .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-i82t8obfaar rect.text{fill:none;stroke-width:0;}#mermaid-i82t8obfaar .icon-shape,#mermaid-i82t8obfaar .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-i82t8obfaar .icon-shape p,#mermaid-i82t8obfaar .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-i82t8obfaar .icon-shape rect,#mermaid-i82t8obfaar .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-i82t8obfaar .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-i82t8obfaar .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-i82t8obfaar :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Naming Conventions

Code Entity Types

Contract Names

Function Names

Storage Variables

Immutable Variables

Compile-Time Constants

Event Names

Error Names

PascalCase

camelCase

SCREAMING_SNAKE_CASE

Example: AegisHook

Example: beforeSwap

Example: panicMode

Example: poolManager

Example: PRICE_THRESHOLD

Example: PriceUpdate

Example: PoolPaused

Naming Convention Rules by Entity Type

This diagram maps Solidity language constructs to their required naming conventions in the Aegis codebase. The key deviation from default Forge linting is that immutable storage variables use `camelCase` instead of `SCREAMING_SNAKE_CASE`, matching the conventions established by Uniswap v4 and other modern Solidity codebases.

Sources: [foundry.toml#24-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L24-L26)

---

## Project Structure StandardsLink copied!

### Directory OrganizationLink copied!

The Aegis codebase follows Foundry's standard project structure as configured in [foundry.toml#1-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L1-L16):

```
contracts/
├── src/              # Contract source files (solc input)
├── test/             # Forge test files (*.t.sol)
├── script/           # Deployment scripts (*.s.sol)
├── lib/              # External dependencies (git submodules)
├── out/              # Compilation output (ignored by git)
└── .forge-snapshots/ # Gas benchmark snapshots
```

Source Directory

The `src = "src"` setting in [foundry.toml#15](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L15-L15) designates the `src/` directory as the root for all production contract code. Files in this directory:

- Contain the four core contracts: `AegisHook.sol`, `AegisSentinel.sol`, `MockOracle.sol`, `AegisGuardianRegistry.sol`
- Are subject to compilation with the full Solidity 0.8.26 feature set
- Must not contain test-specific code or Forge Standard Library imports (except `console.sol` for debugging)

Library Directory

The `libs = ["lib"]` setting in [foundry.toml#6](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L6-L6) tells Forge to search the `lib/` directory for external dependencies. This directory contains git submodules:

- `lib/forge-std/` - Forge Standard Library for testing
- `lib/uniswap-hooks/` - Uniswap v4 interfaces and base contracts
- `lib/system-smart-contracts/` - Reactive Network protocol contracts

See [Dependencies](#4.3) for detailed information about these libraries.

Output Directory

The `out = "out"` setting in [foundry.toml#7](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L7-L7) specifies where compiled artifacts are written. This directory is excluded from version control via `.gitignore` because build artifacts are deterministic and can be regenerated from source.

Sources: [foundry.toml#1-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L1-L16)

---

## Dependency RemappingLink copied!

### Import Path ResolutionLink copied!

The project uses custom import remappings to simplify dependency resolution and avoid deep relative paths. From [foundry.toml#9-14](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L9-L14):

```
remappings = [
    "reactive-lib/=lib/system-smart-contracts/lib/reactive-lib/src/",
    "system-smart-contracts/=lib/system-smart-contracts/src/",
    "v4-core/=lib/uniswap-hooks/lib/v4-core/",
    "v4-periphery/=lib/uniswap-hooks/lib/v4-periphery/"
]
```

Remapping Table

Import PrefixFilesystem PathUsed By`reactive-lib/``lib/system-smart-contracts/lib/reactive-lib/src/``AegisSentinel.sol``system-smart-contracts/``lib/system-smart-contracts/src/``AegisSentinel.sol``v4-core/``lib/uniswap-hooks/lib/v4-core/``AegisHook.sol``v4-periphery/``lib/uniswap-hooks/lib/v4-periphery/``AegisHook.sol` (future expansion)

Example Usage

Without remapping, imports would require verbose relative paths:

```
import "../../lib/system-smart-contracts/src/AbstractReactive.sol";
```

With remapping, imports become concise:

```
import "system-smart-contracts/AbstractReactive.sol";
```

This improves readability and makes refactoring easier, as remappings can be updated in a single location rather than modifying dozens of import statements.

Sources: [foundry.toml#9-14](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L9-L14)

---

### Remapping Resolution DiagramLink copied!

#mermaid-654sut7mpcq{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-654sut7mpcq .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-654sut7mpcq .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-654sut7mpcq .error-icon{fill:#a44141;}#mermaid-654sut7mpcq .error-text{fill:#ddd;stroke:#ddd;}#mermaid-654sut7mpcq .edge-thickness-normal{stroke-width:1px;}#mermaid-654sut7mpcq .edge-thickness-thick{stroke-width:3.5px;}#mermaid-654sut7mpcq .edge-pattern-solid{stroke-dasharray:0;}#mermaid-654sut7mpcq .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-654sut7mpcq .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-654sut7mpcq .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-654sut7mpcq .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-654sut7mpcq .marker.cross{stroke:lightgrey;}#mermaid-654sut7mpcq svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-654sut7mpcq p{margin:0;}#mermaid-654sut7mpcq .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-654sut7mpcq .cluster-label text{fill:#F9FFFE;}#mermaid-654sut7mpcq .cluster-label span{color:#F9FFFE;}#mermaid-654sut7mpcq .cluster-label span p{background-color:transparent;}#mermaid-654sut7mpcq .label text,#mermaid-654sut7mpcq span{fill:#ccc;color:#ccc;}#mermaid-654sut7mpcq .node rect,#mermaid-654sut7mpcq .node circle,#mermaid-654sut7mpcq .node ellipse,#mermaid-654sut7mpcq .node polygon,#mermaid-654sut7mpcq .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-654sut7mpcq .rough-node .label text,#mermaid-654sut7mpcq .node .label text,#mermaid-654sut7mpcq .image-shape .label,#mermaid-654sut7mpcq .icon-shape .label{text-anchor:middle;}#mermaid-654sut7mpcq .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-654sut7mpcq .rough-node .label,#mermaid-654sut7mpcq .node .label,#mermaid-654sut7mpcq .image-shape .label,#mermaid-654sut7mpcq .icon-shape .label{text-align:center;}#mermaid-654sut7mpcq .node.clickable{cursor:pointer;}#mermaid-654sut7mpcq .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-654sut7mpcq .arrowheadPath{fill:lightgrey;}#mermaid-654sut7mpcq .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-654sut7mpcq .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-654sut7mpcq .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-654sut7mpcq .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-654sut7mpcq .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-654sut7mpcq .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-654sut7mpcq .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-654sut7mpcq .cluster text{fill:#F9FFFE;}#mermaid-654sut7mpcq .cluster span{color:#F9FFFE;}#mermaid-654sut7mpcq div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-654sut7mpcq .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-654sut7mpcq rect.text{fill:none;stroke-width:0;}#mermaid-654sut7mpcq .icon-shape,#mermaid-654sut7mpcq .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-654sut7mpcq .icon-shape p,#mermaid-654sut7mpcq .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-654sut7mpcq .icon-shape rect,#mermaid-654sut7mpcq .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-654sut7mpcq .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-654sut7mpcq .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-654sut7mpcq :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Filesystem Paths

Remapping Configuration

Source Code Imports

AegisSentinel.sol import system-smart-contracts/AbstractReactive.sol

AegisHook.sol import v4-core/interfaces/IPoolManager.sol

reactive-lib/=lib/system-smart-contracts/lib/reactive-lib/src/

system-smart-contracts/=lib/system-smart-contracts/src/

v4-core/=lib/uniswap-hooks/lib/v4-core/

v4-periphery/=lib/uniswap-hooks/lib/v4-periphery/

lib/system-smart-contracts/lib/reactive-lib/src/

lib/system-smart-contracts/src/AbstractReactive.sol

lib/uniswap-hooks/lib/v4-core/interfaces/IPoolManager.sol

lib/uniswap-hooks/lib/v4-periphery/

Import Resolution Flow

This diagram shows how Solidity imports in contract files are resolved to actual filesystem paths using the remapping configuration. The compiler reads the `remappings` array in `foundry.toml`, matches the import prefix, and substitutes the full filesystem path during compilation. Dotted lines indicate remappings that are configured but not yet actively used in the current codebase.

Sources: [foundry.toml#9-14](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L9-L14)

---

## Build ConfigurationLink copied!

### Advanced FeaturesLink copied!

The `foundry.toml` configuration enables several advanced build features required for the Aegis system's complex cross-chain operations.

Foreign Function Interface (FFI)

From [foundry.toml#4](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L4-L4):

```
ffi = true
```

FFI allows Forge tests and scripts to execute arbitrary shell commands during execution. This is used for:

- Generating deterministic hook addresses via `cast create2` (see [Deploying AegisHook](#5.4))
- Computing CREATE2 salts for contract deployment
- Running external helper scripts during deployment

Security Note: FFI is disabled by default in Forge because it breaks the security sandbox. It should only be enabled in trusted development environments, never in production.

Filesystem Permissions

From [foundry.toml#5](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L5-L5):

```
fs_permissions = [{access = "read-write", path = ".forge-snapshots/"}]
```

This grants Forge read-write access to the `.forge-snapshots/` directory for storing gas usage benchmarks. The `forge snapshot` command writes baseline gas measurements here, allowing developers to detect performance regressions across commits.

Without this permission, snapshot tests would fail with filesystem access errors.

Sources: [foundry.toml#4-5](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L4-L5)

---

## Network ConfigurationLink copied!

### RPC EndpointsLink copied!

The project defines RPC endpoints for all three deployment networks in [foundry.toml#19-22](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L19-L22):

```
[rpc_endpoints]
unichain_sepolia = "https://unichain-sepolia-rpc.publicnode.com"
reactive = "https://lasna-rpc.rnk.dev/"
sepolia = "https://eth-sepolia.g.alchemy.com/v2/uHo7ICSBqpDRguF-DhjWWF72l-sPapYX"
```

Network Identifier Mapping

Network NameChain IDRPC URLUsed For`sepolia`11155111Alchemy Sepolia endpointDeploying `MockOracle` (L1 data source)`reactive`5318007Reactive Network LasnaDeploying `AegisSentinel` (control logic)`unichain_sepolia`1301Unichain Sepolia public nodeDeploying `AegisHook` (enforcement layer)

These identifiers are used in deployment scripts with the `--rpc-url` flag:

```
forge script script/04_DeployOracle.s.sol --rpc-url sepolia --broadcast
```

The RPC URLs can be overridden via environment variables or command-line arguments, allowing developers to use private RPC providers for faster response times or higher rate limits.

Sources: [foundry.toml#19-22](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L19-L22)

---

### Network Configuration MappingLink copied!

#mermaid-ajfprvznvvg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-ajfprvznvvg .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-ajfprvznvvg .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-ajfprvznvvg .error-icon{fill:#a44141;}#mermaid-ajfprvznvvg .error-text{fill:#ddd;stroke:#ddd;}#mermaid-ajfprvznvvg .edge-thickness-normal{stroke-width:1px;}#mermaid-ajfprvznvvg .edge-thickness-thick{stroke-width:3.5px;}#mermaid-ajfprvznvvg .edge-pattern-solid{stroke-dasharray:0;}#mermaid-ajfprvznvvg .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-ajfprvznvvg .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-ajfprvznvvg .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-ajfprvznvvg .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-ajfprvznvvg .marker.cross{stroke:lightgrey;}#mermaid-ajfprvznvvg svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-ajfprvznvvg p{margin:0;}#mermaid-ajfprvznvvg .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-ajfprvznvvg .cluster-label text{fill:#F9FFFE;}#mermaid-ajfprvznvvg .cluster-label span{color:#F9FFFE;}#mermaid-ajfprvznvvg .cluster-label span p{background-color:transparent;}#mermaid-ajfprvznvvg .label text,#mermaid-ajfprvznvvg span{fill:#ccc;color:#ccc;}#mermaid-ajfprvznvvg .node rect,#mermaid-ajfprvznvvg .node circle,#mermaid-ajfprvznvvg .node ellipse,#mermaid-ajfprvznvvg .node polygon,#mermaid-ajfprvznvvg .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-ajfprvznvvg .rough-node .label text,#mermaid-ajfprvznvvg .node .label text,#mermaid-ajfprvznvvg .image-shape .label,#mermaid-ajfprvznvvg .icon-shape .label{text-anchor:middle;}#mermaid-ajfprvznvvg .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-ajfprvznvvg .rough-node .label,#mermaid-ajfprvznvvg .node .label,#mermaid-ajfprvznvvg .image-shape .label,#mermaid-ajfprvznvvg .icon-shape .label{text-align:center;}#mermaid-ajfprvznvvg .node.clickable{cursor:pointer;}#mermaid-ajfprvznvvg .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-ajfprvznvvg .arrowheadPath{fill:lightgrey;}#mermaid-ajfprvznvvg .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-ajfprvznvvg .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-ajfprvznvvg .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-ajfprvznvvg .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-ajfprvznvvg .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-ajfprvznvvg .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-ajfprvznvvg .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-ajfprvznvvg .cluster text{fill:#F9FFFE;}#mermaid-ajfprvznvvg .cluster span{color:#F9FFFE;}#mermaid-ajfprvznvvg div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-ajfprvznvvg .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-ajfprvznvvg rect.text{fill:none;stroke-width:0;}#mermaid-ajfprvznvvg .icon-shape,#mermaid-ajfprvznvvg .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-ajfprvznvvg .icon-shape p,#mermaid-ajfprvznvvg .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-ajfprvznvvg .icon-shape rect,#mermaid-ajfprvznvvg .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-ajfprvznvvg .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-ajfprvznvvg .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-ajfprvznvvg :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Deployed Contracts

Deployment Scripts

foundry.toml RPC Endpoints

sepolia Alchemy Ethereum Testnet

reactive Reactive Network Lasna

unichain_sepolia PublicNode Unichain L2

04_DeployOracle.s.sol --rpc-url sepolia

05_DeploySentinel.s.sol --rpc-url reactive

06_DeployHook.s.sol --rpc-url unichain_sepolia

MockOracle Chain ID: 11155111

AegisSentinel Chain ID: 5318007

AegisHook Chain ID: 1301

Deployment Network Flow

This diagram maps the RPC endpoint identifiers defined in `foundry.toml` to the deployment scripts that consume them, and finally to the contracts deployed on each network. Each script uses the `--rpc-url` flag to target the appropriate network, ensuring that contracts are deployed to their intended blockchain environments.

Sources: [foundry.toml#19-22](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L19-L22)

---

## Summary of StandardsLink copied!

The Aegis codebase enforces the following development standards:

1. Formatting: All Solidity code must be formatted using `forge fmt` (Forge's native formatter)
2. Compiler: Solidity 0.8.26 with Cancun EVM version and IR-based compilation
3. Linting: Manual linting via `forge lint`; build-time linting disabled for developer velocity
4. Naming:

- Contracts and events: `PascalCase`
- Functions and variables: `camelCase`
- Constants: `SCREAMING_SNAKE_CASE`
- Immutables: `camelCase` (exception to default Forge rules)
5. Imports: Use remapping prefixes (`system-smart-contracts/`, `v4-core/`) instead of relative paths
6. Dependencies: Managed via git submodules in `lib/` directory
7. Build Artifacts: Written to `out/` and excluded from version control
8. Networks: Three RPC endpoints configured for Sepolia, Reactive Network, and Unichain

Developers must run `forge fmt` before committing code. CI/CD pipelines enforce these standards via automated checks (see [CI/CD Pipelines](#6.2)).

Sources: [foundry.toml#1-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L1-L27)[.vscode/settings.json#1-3](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.vscode/settings.json#L1-L3)

---

# Deployment

# DeploymentLink copied!
Relevant source files
- [contracts/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md)
- [contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json)

## Purpose and ScopeLink copied!

This document describes the deployment process for the Aegis cross-chain circuit breaker system. It covers the sequential deployment strategy across three blockchain networks, the Foundry scripts used, and the prerequisites required for successful deployment. For step-by-step instructions on deploying individual contracts, see sections [5.2](#5.2), [5.3](#5.3), and [5.4](#5.4). For post-deployment verification procedures, see [5.5](#5.5). For initial development environment setup, see [4.1](#4.1).

## Three-Network Deployment ArchitectureLink copied!

Aegis operates across three distinct blockchain networks, requiring coordinated deployment in a specific order to establish cross-chain communication channels. The deployment sequence is critical because each contract references addresses from previously deployed contracts.

#mermaid-77ydkyrwjdl{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-77ydkyrwjdl .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-77ydkyrwjdl .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-77ydkyrwjdl .error-icon{fill:#a44141;}#mermaid-77ydkyrwjdl .error-text{fill:#ddd;stroke:#ddd;}#mermaid-77ydkyrwjdl .edge-thickness-normal{stroke-width:1px;}#mermaid-77ydkyrwjdl .edge-thickness-thick{stroke-width:3.5px;}#mermaid-77ydkyrwjdl .edge-pattern-solid{stroke-dasharray:0;}#mermaid-77ydkyrwjdl .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-77ydkyrwjdl .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-77ydkyrwjdl .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-77ydkyrwjdl .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-77ydkyrwjdl .marker.cross{stroke:lightgrey;}#mermaid-77ydkyrwjdl svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-77ydkyrwjdl p{margin:0;}#mermaid-77ydkyrwjdl .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-77ydkyrwjdl .cluster-label text{fill:#F9FFFE;}#mermaid-77ydkyrwjdl .cluster-label span{color:#F9FFFE;}#mermaid-77ydkyrwjdl .cluster-label span p{background-color:transparent;}#mermaid-77ydkyrwjdl .label text,#mermaid-77ydkyrwjdl span{fill:#ccc;color:#ccc;}#mermaid-77ydkyrwjdl .node rect,#mermaid-77ydkyrwjdl .node circle,#mermaid-77ydkyrwjdl .node ellipse,#mermaid-77ydkyrwjdl .node polygon,#mermaid-77ydkyrwjdl .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-77ydkyrwjdl .rough-node .label text,#mermaid-77ydkyrwjdl .node .label text,#mermaid-77ydkyrwjdl .image-shape .label,#mermaid-77ydkyrwjdl .icon-shape .label{text-anchor:middle;}#mermaid-77ydkyrwjdl .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-77ydkyrwjdl .rough-node .label,#mermaid-77ydkyrwjdl .node .label,#mermaid-77ydkyrwjdl .image-shape .label,#mermaid-77ydkyrwjdl .icon-shape .label{text-align:center;}#mermaid-77ydkyrwjdl .node.clickable{cursor:pointer;}#mermaid-77ydkyrwjdl .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-77ydkyrwjdl .arrowheadPath{fill:lightgrey;}#mermaid-77ydkyrwjdl .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-77ydkyrwjdl .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-77ydkyrwjdl .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-77ydkyrwjdl .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-77ydkyrwjdl .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-77ydkyrwjdl .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-77ydkyrwjdl .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-77ydkyrwjdl .cluster text{fill:#F9FFFE;}#mermaid-77ydkyrwjdl .cluster span{color:#F9FFFE;}#mermaid-77ydkyrwjdl div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-77ydkyrwjdl .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-77ydkyrwjdl rect.text{fill:none;stroke-width:0;}#mermaid-77ydkyrwjdl .icon-shape,#mermaid-77ydkyrwjdl .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-77ydkyrwjdl .icon-shape p,#mermaid-77ydkyrwjdl .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-77ydkyrwjdl .icon-shape rect,#mermaid-77ydkyrwjdl .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-77ydkyrwjdl .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-77ydkyrwjdl .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-77ydkyrwjdl :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Step 3: Unichain Sepolia L2

Step 2: Reactive Network Lasna

Step 1: Ethereum Sepolia L1

deploys

deploys

requires Oracle address

deploys

requires Sentinel address

emits PriceUpdate events

sends cross-chain calls

04_DeployOracle.s.sol

MockOracle.sol 0x1392C38921A818cEdb100cC3767e8f30deC3a7D8

05_DeploySentinel.s.sol

AegisSentinel.sol 0x0B6ae13119Fc3b61d6ABb115342A1A075e14b6B6

06_DeployHook.s.sol

AegisHook.sol 0x1E2aE114cF3B63779A1367eD704ccA51a0218080

Deployment Sequence Diagram

Sources: [contracts/README.md#96-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L96-L122)

## Network ConfigurationLink copied!

The deployment spans three testnets with distinct chain IDs and RPC endpoints:

NetworkChain IDRPC AliasContract DeployedPurposeEthereum Sepolia11155111`sepolia``MockOracle.sol`Price feed data source (L1)Reactive Network Lasna5318007`reactive``AegisSentinel.sol`Event monitoring and control logicUnichain Sepolia1301`unichain_sepolia``AegisHook.sol`Uniswap v4 pool protection (L2)

Sources: [contracts/README.md#99-104](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L99-L104)[contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json#44](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json#L44-L44)

## Deployment Script ArchitectureLink copied!

Each deployment is handled by a numbered Foundry script that follows the naming convention `0X_Deploy[ContractName].s.sol`. The numbering indicates the execution order:

#mermaid-c70v08vfag{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-c70v08vfag .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-c70v08vfag .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-c70v08vfag .error-icon{fill:#a44141;}#mermaid-c70v08vfag .error-text{fill:#ddd;stroke:#ddd;}#mermaid-c70v08vfag .edge-thickness-normal{stroke-width:1px;}#mermaid-c70v08vfag .edge-thickness-thick{stroke-width:3.5px;}#mermaid-c70v08vfag .edge-pattern-solid{stroke-dasharray:0;}#mermaid-c70v08vfag .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-c70v08vfag .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-c70v08vfag .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-c70v08vfag .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-c70v08vfag .marker.cross{stroke:lightgrey;}#mermaid-c70v08vfag svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-c70v08vfag p{margin:0;}#mermaid-c70v08vfag .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-c70v08vfag .cluster-label text{fill:#F9FFFE;}#mermaid-c70v08vfag .cluster-label span{color:#F9FFFE;}#mermaid-c70v08vfag .cluster-label span p{background-color:transparent;}#mermaid-c70v08vfag .label text,#mermaid-c70v08vfag span{fill:#ccc;color:#ccc;}#mermaid-c70v08vfag .node rect,#mermaid-c70v08vfag .node circle,#mermaid-c70v08vfag .node ellipse,#mermaid-c70v08vfag .node polygon,#mermaid-c70v08vfag .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-c70v08vfag .rough-node .label text,#mermaid-c70v08vfag .node .label text,#mermaid-c70v08vfag .image-shape .label,#mermaid-c70v08vfag .icon-shape .label{text-anchor:middle;}#mermaid-c70v08vfag .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-c70v08vfag .rough-node .label,#mermaid-c70v08vfag .node .label,#mermaid-c70v08vfag .image-shape .label,#mermaid-c70v08vfag .icon-shape .label{text-align:center;}#mermaid-c70v08vfag .node.clickable{cursor:pointer;}#mermaid-c70v08vfag .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-c70v08vfag .arrowheadPath{fill:lightgrey;}#mermaid-c70v08vfag .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-c70v08vfag .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-c70v08vfag .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-c70v08vfag .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-c70v08vfag .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-c70v08vfag .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-c70v08vfag .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-c70v08vfag .cluster text{fill:#F9FFFE;}#mermaid-c70v08vfag .cluster span{color:#F9FFFE;}#mermaid-c70v08vfag div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-c70v08vfag .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-c70v08vfag rect.text{fill:none;stroke-width:0;}#mermaid-c70v08vfag .icon-shape,#mermaid-c70v08vfag .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-c70v08vfag .icon-shape p,#mermaid-c70v08vfag .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-c70v08vfag .icon-shape rect,#mermaid-c70v08vfag .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-c70v08vfag .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-c70v08vfag .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-c70v08vfag :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Broadcast Logs

Smart Contracts

Foundry Scripts

compiles and deploys

compiles and deploys

compiles and deploys

generates

generates

generates

04_DeployOracle.s.sol script/

05_DeploySentinel.s.sol script/

06_DeployHook.s.sol script/

MockOracle.sol src/

AegisSentinel.sol src/

AegisHook.sol src/

run-latest.json broadcast/04_DeployOracle.s.sol/11155111/

run-latest.json broadcast/05_DeploySentinel.s.sol/5318007/

run-latest.json broadcast/06_DeployHook.s.sol/1301/

Script-to-Contract Mapping

Sources: [contracts/README.md#105-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L105-L122)

## Deployment CommandsLink copied!

Each network requires a specific `forge script` invocation with network-specific flags and configurations:

### Oracle Deployment (Sepolia L1)Link copied!

```
forge script script/04_DeployOracle.s.sol --rpc-url sepolia --broadcast
```

- Network: Ethereum Sepolia (Chain ID: 11155111)
- Transaction Type: `CREATE`
- Contract: `MockOracle`
- Special Flags: None (standard EIP-1559 transaction)

Sources: [contracts/README.md#107-110](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L107-L110)

### Sentinel Deployment (Reactive Network)Link copied!

```
forge script script/05_DeploySentinel.s.sol --rpc-url reactive --broadcast --legacy
```

- Network: Reactive Network Lasna (Chain ID: 5318007)
- Transaction Type: Legacy (pre-EIP-1559)
- Contract: `AegisSentinel`
- Special Flags: `--legacy` (required for Reactive Network compatibility)
- Post-Deployment: Manual subscription call required to register event listeners

Sources: [contracts/README.md#112-116](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L112-L116)

### Hook Deployment (Unichain L2)Link copied!

```
forge script script/06_DeployHook.s.sol --rpc-url unichain_sepolia --broadcast
```

- Network: Unichain Sepolia (Chain ID: 1301)
- Transaction Type: `CREATE2` with salt mining
- Contract: `AegisHook`
- Special Flags: None
- Special Requirements: Hook address must satisfy Uniswap v4 permission flags via deterministic deployment salt

Sources: [contracts/README.md#118-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L118-L122)

## Deployment Process FlowLink copied!

The following diagram shows the complete deployment workflow including prerequisite checks, deployment steps, and post-deployment actions:

Unichain L2Reactive NetworkSepolia L1Forge CLIDeveloperUnichain L2Reactive NetworkSepolia L1Forge CLIDeveloper#mermaid-73v3ew0hvq{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-73v3ew0hvq .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-73v3ew0hvq .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-73v3ew0hvq .error-icon{fill:#a44141;}#mermaid-73v3ew0hvq .error-text{fill:#ddd;stroke:#ddd;}#mermaid-73v3ew0hvq .edge-thickness-normal{stroke-width:1px;}#mermaid-73v3ew0hvq .edge-thickness-thick{stroke-width:3.5px;}#mermaid-73v3ew0hvq .edge-pattern-solid{stroke-dasharray:0;}#mermaid-73v3ew0hvq .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-73v3ew0hvq .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-73v3ew0hvq .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-73v3ew0hvq .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-73v3ew0hvq .marker.cross{stroke:lightgrey;}#mermaid-73v3ew0hvq svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-73v3ew0hvq p{margin:0;}#mermaid-73v3ew0hvq .actor{stroke:#ccc;fill:#1f2020;}#mermaid-73v3ew0hvq text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-73v3ew0hvq .actor-line{stroke:#ccc;}#mermaid-73v3ew0hvq .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-73v3ew0hvq .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-73v3ew0hvq .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-73v3ew0hvq #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-73v3ew0hvq .sequenceNumber{fill:black;}#mermaid-73v3ew0hvq #sequencenumber{fill:lightgrey;}#mermaid-73v3ew0hvq #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-73v3ew0hvq .messageText{fill:lightgrey;stroke:none;}#mermaid-73v3ew0hvq .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-73v3ew0hvq .labelText,#mermaid-73v3ew0hvq .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-73v3ew0hvq .loopText,#mermaid-73v3ew0hvq .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-73v3ew0hvq .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-73v3ew0hvq .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-73v3ew0hvq .noteText,#mermaid-73v3ew0hvq .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-73v3ew0hvq .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-73v3ew0hvq .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-73v3ew0hvq .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-73v3ew0hvq .actorPopupMenu{position:absolute;}#mermaid-73v3ew0hvq .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-73v3ew0hvq .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-73v3ew0hvq .actor-man circle,#mermaid-73v3ew0hvq line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-73v3ew0hvq :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}Prerequisites: RPC endpoints configured, private keys setCopy Oracle address for next stepRequires ORACLE_ADDRESS env varManual step: Call subscribe() on SentinelCopy Sentinel address for next stepRequires SENTINEL_ADDRESS env var + salt miningforge script 04_DeployOracle.s.solDeploy MockOraclecontractAddress: 0x1392...a7D8Save to broadcast/04_DeployOracle.s.sol/11155111/run-latest.jsonforge script 05_DeploySentinel.s.solDeploy AegisSentinel(ORACLE_ADDRESS)contractAddress: 0x0B6a...b6B6Save to broadcast/05_DeploySentinel.s.sol/5318007/run-latest.jsonsentinel.subscribe(REACTIVE_IGNORE | ORACLE_ADDRESS | topic)forge script 06_DeployHook.s.solMine CREATE2 salt for hook permissionsDeploy AegisHook(poolManager | SENTINEL_ADDRESS | salt)contractAddress: 0x1E2a...8080Save to broadcast/06_DeployHook.s.sol/1301/run-latest.json

Complete Deployment Sequence

Sources: [contracts/README.md#96-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L96-L122)

## Deployment PrerequisitesLink copied!

Before executing deployment scripts, the following requirements must be satisfied:

RequirementDescriptionConfiguration LocationFoundry Installation`forge`, `cast`, and `anvil` CLI toolsSee [4.1](#4.1)RPC EndpointsValid RPC URLs for all three networks`foundry.toml``[rpc_endpoints]` sectionPrivate KeysDeployer account private keysEnvironment variables or `--private-key` flagNative TokensGas tokens for each network (Sepolia ETH, Reactive tokens, Unichain testnet ETH)Obtained from faucetsDependenciesForge submodules installedRun `forge install`

Sources: [contracts/README.md#72-77](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L72-L77)

## Broadcast Logs and Transaction RecordsLink copied!

Each deployment generates a JSON log file in the `broadcast/` directory hierarchy. The log structure follows the pattern:

```
broadcast/
└── [ScriptName].s.sol/
    └── [ChainID]/
        └── run-latest.json
```

The `run-latest.json` file contains critical deployment data:

FieldDescriptionExample`transactions[].hash`Transaction hash on the network`0x3a084a0a072d...``transactions[].contractAddress`Deployed contract address`0x29f8f8d2a0033...``receipts[].status`Deployment success status`0x1` (success)`receipts[].gasUsed`Gas consumed by deployment`0x32915` (206,101 gas)`chain`Network chain ID`11155111` (Sepolia)`timestamp`Unix timestamp of deployment`1769586193733`

Sources: [contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json#1-46](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json#L1-L46)

## Key Deployment ConsiderationsLink copied!

### Oracle Address PropagationLink copied!

The `AegisSentinel` constructor requires the deployed `MockOracle` address as a parameter. This creates a deployment dependency:

1. Deploy `MockOracle` on Sepolia
2. Extract `contractAddress` from `run-latest.json`
3. Pass address to `05_DeploySentinel.s.sol` via environment variable or script modification

Sources: [contracts/README.md#112-116](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L112-L116)

### Reactive Network SubscriptionLink copied!

The `AegisSentinel` deployment on Reactive Network is a two-step process:

1. Deploy Contract: Execute `05_DeploySentinel.s.sol`
2. Register Subscription: Manually call `subscribe()` with the Oracle address and event topic

The subscription links the Sentinel to the Oracle's `PriceUpdate` events. This step is not automated in the deployment script and must be performed post-deployment.

Sources: [contracts/README.md#114](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L114-L114)

### Hook Address Mining (CREATE2 Salt)Link copied!

Uniswap v4 hooks require specific address prefix permissions. The `AegisHook` deployment uses CREATE2 with salt mining to generate a compliant address:

- Hook addresses must satisfy bitflag requirements based on implemented callbacks
- The deployment script iteratively computes salts until a valid address is found
- This process may take several seconds to minutes depending on required permissions

Sources: [contracts/README.md#118-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L118-L122)

## Deployed Contract AddressesLink copied!

The following table lists the official testnet deployment addresses referenced throughout the Aegis documentation:

ContractNetworkAddressDeployment Script`MockOracle`Sepolia L1`0x1392C38921A818cEdb100cC3767e8f30deC3a7D8``04_DeployOracle.s.sol``AegisSentinel`Reactive Lasna`0x0B6ae13119Fc3b61d6ABb115342A1A075e14b6B6``05_DeploySentinel.s.sol``AegisHook`Unichain Sepolia`0x1E2aE114cF3B63779A1367eD704ccA51a0218080``06_DeployHook.s.sol`

Sources: [contracts/README.md#99-104](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L99-L104)

## Transaction Types by NetworkLink copied!

Different networks require different transaction formats:

#mermaid-9wuqi8d1n0f{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-9wuqi8d1n0f .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-9wuqi8d1n0f .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-9wuqi8d1n0f .error-icon{fill:#a44141;}#mermaid-9wuqi8d1n0f .error-text{fill:#ddd;stroke:#ddd;}#mermaid-9wuqi8d1n0f .edge-thickness-normal{stroke-width:1px;}#mermaid-9wuqi8d1n0f .edge-thickness-thick{stroke-width:3.5px;}#mermaid-9wuqi8d1n0f .edge-pattern-solid{stroke-dasharray:0;}#mermaid-9wuqi8d1n0f .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-9wuqi8d1n0f .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-9wuqi8d1n0f .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-9wuqi8d1n0f .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-9wuqi8d1n0f .marker.cross{stroke:lightgrey;}#mermaid-9wuqi8d1n0f svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-9wuqi8d1n0f p{margin:0;}#mermaid-9wuqi8d1n0f .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-9wuqi8d1n0f .cluster-label text{fill:#F9FFFE;}#mermaid-9wuqi8d1n0f .cluster-label span{color:#F9FFFE;}#mermaid-9wuqi8d1n0f .cluster-label span p{background-color:transparent;}#mermaid-9wuqi8d1n0f .label text,#mermaid-9wuqi8d1n0f span{fill:#ccc;color:#ccc;}#mermaid-9wuqi8d1n0f .node rect,#mermaid-9wuqi8d1n0f .node circle,#mermaid-9wuqi8d1n0f .node ellipse,#mermaid-9wuqi8d1n0f .node polygon,#mermaid-9wuqi8d1n0f .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-9wuqi8d1n0f .rough-node .label text,#mermaid-9wuqi8d1n0f .node .label text,#mermaid-9wuqi8d1n0f .image-shape .label,#mermaid-9wuqi8d1n0f .icon-shape .label{text-anchor:middle;}#mermaid-9wuqi8d1n0f .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-9wuqi8d1n0f .rough-node .label,#mermaid-9wuqi8d1n0f .node .label,#mermaid-9wuqi8d1n0f .image-shape .label,#mermaid-9wuqi8d1n0f .icon-shape .label{text-align:center;}#mermaid-9wuqi8d1n0f .node.clickable{cursor:pointer;}#mermaid-9wuqi8d1n0f .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-9wuqi8d1n0f .arrowheadPath{fill:lightgrey;}#mermaid-9wuqi8d1n0f .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-9wuqi8d1n0f .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-9wuqi8d1n0f .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-9wuqi8d1n0f .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-9wuqi8d1n0f .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-9wuqi8d1n0f .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-9wuqi8d1n0f .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-9wuqi8d1n0f .cluster text{fill:#F9FFFE;}#mermaid-9wuqi8d1n0f .cluster span{color:#F9FFFE;}#mermaid-9wuqi8d1n0f div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-9wuqi8d1n0f .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-9wuqi8d1n0f rect.text{fill:none;stroke-width:0;}#mermaid-9wuqi8d1n0f .icon-shape,#mermaid-9wuqi8d1n0f .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-9wuqi8d1n0f .icon-shape p,#mermaid-9wuqi8d1n0f .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-9wuqi8d1n0f .icon-shape rect,#mermaid-9wuqi8d1n0f .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-9wuqi8d1n0f .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-9wuqi8d1n0f .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-9wuqi8d1n0f :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Unichain L2

Transaction Type: EIP-1559 Type: 0x2 Gas: Optimistic rollup pricing

Reactive Network

Transaction Type: Legacy Type: 0x0 Gas: Fixed gas price Flag: --legacy required

Sepolia L1

Transaction Type: EIP-1559 Type: 0x2 Gas: Dynamic base + priority fee

Network Transaction Type Requirements

The `--legacy` flag is critical for Reactive Network deployments and will cause failures if omitted.

Sources: [contracts/README.md#112-116](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L112-L116)[contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json#28](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json#L28-L28)

## Common Deployment IssuesLink copied!

IssueSymptomSolutionMissing RPC URL`Error: Failed to connect to RPC`Add endpoint to `foundry.toml` or use `--rpc-url` flagInsufficient Gas`Transaction reverted: out of gas`Fund deployer address with native tokensWrong Transaction Type`Transaction type not supported`Add `--legacy` flag for Reactive NetworkSalt Mining TimeoutHook deployment hangsIncrease mining iterations or relax permission requirementsSubscription Not CalledSentinel doesn't react to eventsManually invoke `subscribe()` after Sentinel deployment

For verification procedures after deployment, see [5.5](#5.5).

Sources: [contracts/README.md#105-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L105-L122)

---

# Deployment-Overview

# Deployment OverviewLink copied!
Relevant source files
- [contracts/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md)
- [contracts/foundry.toml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml)

## Purpose and ScopeLink copied!

This document provides a high-level overview of the Aegis deployment strategy across three blockchain networks. It covers the deployment order, network prerequisites, configuration requirements, and dependencies between contracts. For detailed step-by-step instructions on deploying individual contracts, see [Deploying MockOracle](#5.2), [Deploying AegisSentinel](#5.3), and [Deploying AegisHook](#5.4). For post-deployment verification procedures, see [Deployment Verification](#5.5).

## Multi-Network ArchitectureLink copied!

Aegis operates as a distributed system spanning three distinct blockchain networks. Each network hosts a specific contract component, and the deployment process must account for cross-chain dependencies and communication requirements.

### Network TopologyLink copied!

#mermaid-q3gfmfda12{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-q3gfmfda12 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-q3gfmfda12 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-q3gfmfda12 .error-icon{fill:#a44141;}#mermaid-q3gfmfda12 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-q3gfmfda12 .edge-thickness-normal{stroke-width:1px;}#mermaid-q3gfmfda12 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-q3gfmfda12 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-q3gfmfda12 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-q3gfmfda12 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-q3gfmfda12 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-q3gfmfda12 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-q3gfmfda12 .marker.cross{stroke:lightgrey;}#mermaid-q3gfmfda12 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-q3gfmfda12 p{margin:0;}#mermaid-q3gfmfda12 .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-q3gfmfda12 .cluster-label text{fill:#F9FFFE;}#mermaid-q3gfmfda12 .cluster-label span{color:#F9FFFE;}#mermaid-q3gfmfda12 .cluster-label span p{background-color:transparent;}#mermaid-q3gfmfda12 .label text,#mermaid-q3gfmfda12 span{fill:#ccc;color:#ccc;}#mermaid-q3gfmfda12 .node rect,#mermaid-q3gfmfda12 .node circle,#mermaid-q3gfmfda12 .node ellipse,#mermaid-q3gfmfda12 .node polygon,#mermaid-q3gfmfda12 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-q3gfmfda12 .rough-node .label text,#mermaid-q3gfmfda12 .node .label text,#mermaid-q3gfmfda12 .image-shape .label,#mermaid-q3gfmfda12 .icon-shape .label{text-anchor:middle;}#mermaid-q3gfmfda12 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-q3gfmfda12 .rough-node .label,#mermaid-q3gfmfda12 .node .label,#mermaid-q3gfmfda12 .image-shape .label,#mermaid-q3gfmfda12 .icon-shape .label{text-align:center;}#mermaid-q3gfmfda12 .node.clickable{cursor:pointer;}#mermaid-q3gfmfda12 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-q3gfmfda12 .arrowheadPath{fill:lightgrey;}#mermaid-q3gfmfda12 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-q3gfmfda12 .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-q3gfmfda12 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-q3gfmfda12 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-q3gfmfda12 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-q3gfmfda12 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-q3gfmfda12 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-q3gfmfda12 .cluster text{fill:#F9FFFE;}#mermaid-q3gfmfda12 .cluster span{color:#F9FFFE;}#mermaid-q3gfmfda12 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-q3gfmfda12 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-q3gfmfda12 rect.text{fill:none;stroke-width:0;}#mermaid-q3gfmfda12 .icon-shape,#mermaid-q3gfmfda12 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-q3gfmfda12 .icon-shape p,#mermaid-q3gfmfda12 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-q3gfmfda12 .icon-shape rect,#mermaid-q3gfmfda12 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-q3gfmfda12 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-q3gfmfda12 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-q3gfmfda12 :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Unichain Sepolia L2 Chain ID: 1301

Reactive Network Lasna Chain ID: 5318007

Ethereum Sepolia L1 Chain ID: 11155111

PriceUpdate events

setPanicMode calls

MockOracle.sol 0x1392C38921A818cEdb100cC3767e8f30deC3a7D8

AegisSentinel.sol 0x0B6ae13119Fc3b61d6ABb115342A1A075e14b6B6

AegisHook.sol 0x1E2aE114cF3B63779A1367eD704ccA51a0218080

Diagram: Three-Network Deployment Architecture

Sources: [contracts/README.md#1-123](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L1-L123)[contracts/foundry.toml#19-22](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L19-L22)

## Deployment StrategyLink copied!

The Aegis deployment follows a sequential, dependency-driven approach. Contracts must be deployed in a specific order to ensure that cross-chain references are properly configured during initialization.

### Deployment SequenceLink copied!

StepNetworkContractScriptDependencies1Ethereum Sepolia`MockOracle``04_DeployOracle.s.sol`None2Reactive Network`AegisSentinel``05_DeploySentinel.s.sol`MockOracle address3Unichain Sepolia`AegisHook``06_DeployHook.s.sol`AegisSentinel address

The numbering scheme (04, 05, 06) in the deployment scripts indicates the execution order. This convention ensures that developers can identify the correct deployment sequence at a glance.

Sources: [contracts/README.md#96-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L96-L122)

### Dependency ChainLink copied!

#mermaid-iljxhpkajte{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-iljxhpkajte .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-iljxhpkajte .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-iljxhpkajte .error-icon{fill:#a44141;}#mermaid-iljxhpkajte .error-text{fill:#ddd;stroke:#ddd;}#mermaid-iljxhpkajte .edge-thickness-normal{stroke-width:1px;}#mermaid-iljxhpkajte .edge-thickness-thick{stroke-width:3.5px;}#mermaid-iljxhpkajte .edge-pattern-solid{stroke-dasharray:0;}#mermaid-iljxhpkajte .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-iljxhpkajte .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-iljxhpkajte .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-iljxhpkajte .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-iljxhpkajte .marker.cross{stroke:lightgrey;}#mermaid-iljxhpkajte svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-iljxhpkajte p{margin:0;}#mermaid-iljxhpkajte .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-iljxhpkajte .cluster-label text{fill:#F9FFFE;}#mermaid-iljxhpkajte .cluster-label span{color:#F9FFFE;}#mermaid-iljxhpkajte .cluster-label span p{background-color:transparent;}#mermaid-iljxhpkajte .label text,#mermaid-iljxhpkajte span{fill:#ccc;color:#ccc;}#mermaid-iljxhpkajte .node rect,#mermaid-iljxhpkajte .node circle,#mermaid-iljxhpkajte .node ellipse,#mermaid-iljxhpkajte .node polygon,#mermaid-iljxhpkajte .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-iljxhpkajte .rough-node .label text,#mermaid-iljxhpkajte .node .label text,#mermaid-iljxhpkajte .image-shape .label,#mermaid-iljxhpkajte .icon-shape .label{text-anchor:middle;}#mermaid-iljxhpkajte .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-iljxhpkajte .rough-node .label,#mermaid-iljxhpkajte .node .label,#mermaid-iljxhpkajte .image-shape .label,#mermaid-iljxhpkajte .icon-shape .label{text-align:center;}#mermaid-iljxhpkajte .node.clickable{cursor:pointer;}#mermaid-iljxhpkajte .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-iljxhpkajte .arrowheadPath{fill:lightgrey;}#mermaid-iljxhpkajte .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-iljxhpkajte .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-iljxhpkajte .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-iljxhpkajte .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-iljxhpkajte .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-iljxhpkajte .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-iljxhpkajte .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-iljxhpkajte .cluster text{fill:#F9FFFE;}#mermaid-iljxhpkajte .cluster span{color:#F9FFFE;}#mermaid-iljxhpkajte div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-iljxhpkajte .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-iljxhpkajte rect.text{fill:none;stroke-width:0;}#mermaid-iljxhpkajte .icon-shape,#mermaid-iljxhpkajte .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-iljxhpkajte .icon-shape p,#mermaid-iljxhpkajte .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-iljxhpkajte .icon-shape rect,#mermaid-iljxhpkajte .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-iljxhpkajte .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-iljxhpkajte .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-iljxhpkajte :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

deploys

address required

deploys

address required

deploys

04_DeployOracle.s.sol

05_DeploySentinel.s.sol

06_DeployHook.s.sol

MockOracle Sepolia

AegisSentinel Reactive Network

AegisHook Unichain

Diagram: Contract Deployment Dependencies

Sources: [contracts/README.md#96-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L96-L122)

## PrerequisitesLink copied!

Before initiating deployment, the following requirements must be satisfied:

### Software DependenciesLink copied!

- Foundry Toolchain: The deployment process uses `forge script` for all contract deployments
- Git Submodules: External dependencies must be initialized via `forge install` or `git submodule update --init --recursive`
- Solidity 0.8.26: Configured in [foundry.toml#8](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L8-L8)
- Cancun EVM Version: Required for compatibility with Uniswap v4 hooks [foundry.toml#3](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L3-L3)

### Network AccessLink copied!

Each target network requires:

1. RPC Endpoint: Configured in [foundry.toml#19-22](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L19-L22)
2. Funded Deployer Account: Private key with sufficient native tokens for gas:

- Sepolia ETH
- Reactive Network native token
- Unichain Sepolia ETH
3. Network Stability: Active and responsive RPC endpoints

### Configuration FilesLink copied!

FilePurpose`foundry.toml`Network RPC endpoints, compiler settings, remappings`.env`Private keys for deployment accounts (not tracked in git)`broadcast/*/run-latest.json`Deployment artifacts and transaction logs

Sources: [contracts/foundry.toml#1-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L1-L27)[contracts/README.md#70-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L70-L122)

## Network-Specific RequirementsLink copied!

Each blockchain network has unique deployment characteristics that must be addressed.

### Ethereum Sepolia (L1)Link copied!

- Standard Deployment: Uses default `forge script` workflow
- No Special Flags: Standard transaction broadcasting
- Gas Estimation: Reliable EIP-1559 gas pricing

Deployment Command Pattern:

```
forge script script/04_DeployOracle.s.sol --rpc-url sepolia --broadcast
```

### Reactive Network LasnaLink copied!

- Legacy Transaction Mode: Requires `--legacy` flag due to EIP-1559 incompatibility
- Manual Subscription: Post-deployment step required to subscribe the Sentinel to Oracle events
- Chain ID: 5318007 (non-standard, must be explicitly configured)

Deployment Command Pattern:

```
forge script script/05_DeploySentinel.s.sol --rpc-url reactive --broadcast --legacy
```

Critical Post-Deployment Step: The Sentinel contract must manually subscribe to the `PriceUpdate` event signature from the MockOracle address. This step establishes the reactive listening mechanism.

### Unichain Sepolia (L2)Link copied!

- Hook Address Mining: Uses `CREATE2` salt mining to generate addresses with required permission flags
- Permission Validation: Hook addresses must satisfy Uniswap v4 permission requirements
- Flashblocks Architecture: Sub-second block times (250ms) enable rapid panic mode activation

Deployment Command Pattern:

```
forge script script/06_DeployHook.s.sol --rpc-url unichain_sepolia --broadcast
```

Sources: [contracts/README.md#105-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L105-L122)[contracts/foundry.toml#19-22](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L19-L22)

## Configuration ManagementLink copied!

The deployment process relies on a centralized configuration file to manage network connectivity and compilation settings.

### Foundry ConfigurationLink copied!

The [foundry.toml#1-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml#L1-L27) file defines critical deployment parameters:

```
[profile.default]
solc_version = "0.8.26"
evm_version = "cancun"
via_ir = true
bytecode_hash = "none"
 
[rpc_endpoints]
sepolia = "https://eth-sepolia.g.alchemy.com/v2/..."
reactive = "https://lasna-rpc.rnk.dev/"
unichain_sepolia = "https://unichain-sepolia-rpc.publicnode.com"
```

Key Settings:

- `via_ir = true`: Required for Uniswap v4 hook compilation with intermediate representation optimizer
- `bytecode_hash = "none"`: Ensures deterministic bytecode for `CREATE2` address mining
- `remappings`: Maps external dependencies to their submodule paths

### Deployment Script StructureLink copied!

All deployment scripts follow a consistent pattern:

#mermaid-ik7q7bbudt{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-ik7q7bbudt .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-ik7q7bbudt .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-ik7q7bbudt .error-icon{fill:#a44141;}#mermaid-ik7q7bbudt .error-text{fill:#ddd;stroke:#ddd;}#mermaid-ik7q7bbudt .edge-thickness-normal{stroke-width:1px;}#mermaid-ik7q7bbudt .edge-thickness-thick{stroke-width:3.5px;}#mermaid-ik7q7bbudt .edge-pattern-solid{stroke-dasharray:0;}#mermaid-ik7q7bbudt .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-ik7q7bbudt .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-ik7q7bbudt .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-ik7q7bbudt .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-ik7q7bbudt .marker.cross{stroke:lightgrey;}#mermaid-ik7q7bbudt svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-ik7q7bbudt p{margin:0;}#mermaid-ik7q7bbudt .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-ik7q7bbudt .cluster-label text{fill:#F9FFFE;}#mermaid-ik7q7bbudt .cluster-label span{color:#F9FFFE;}#mermaid-ik7q7bbudt .cluster-label span p{background-color:transparent;}#mermaid-ik7q7bbudt .label text,#mermaid-ik7q7bbudt span{fill:#ccc;color:#ccc;}#mermaid-ik7q7bbudt .node rect,#mermaid-ik7q7bbudt .node circle,#mermaid-ik7q7bbudt .node ellipse,#mermaid-ik7q7bbudt .node polygon,#mermaid-ik7q7bbudt .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-ik7q7bbudt .rough-node .label text,#mermaid-ik7q7bbudt .node .label text,#mermaid-ik7q7bbudt .image-shape .label,#mermaid-ik7q7bbudt .icon-shape .label{text-anchor:middle;}#mermaid-ik7q7bbudt .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-ik7q7bbudt .rough-node .label,#mermaid-ik7q7bbudt .node .label,#mermaid-ik7q7bbudt .image-shape .label,#mermaid-ik7q7bbudt .icon-shape .label{text-align:center;}#mermaid-ik7q7bbudt .node.clickable{cursor:pointer;}#mermaid-ik7q7bbudt .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-ik7q7bbudt .arrowheadPath{fill:lightgrey;}#mermaid-ik7q7bbudt .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-ik7q7bbudt .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-ik7q7bbudt .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-ik7q7bbudt .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-ik7q7bbudt .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-ik7q7bbudt .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-ik7q7bbudt .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-ik7q7bbudt .cluster text{fill:#F9FFFE;}#mermaid-ik7q7bbudt .cluster span{color:#F9FFFE;}#mermaid-ik7q7bbudt div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-ik7q7bbudt .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-ik7q7bbudt rect.text{fill:none;stroke-width:0;}#mermaid-ik7q7bbudt .icon-shape,#mermaid-ik7q7bbudt .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-ik7q7bbudt .icon-shape p,#mermaid-ik7q7bbudt .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-ik7q7bbudt .icon-shape rect,#mermaid-ik7q7bbudt .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-ik7q7bbudt .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-ik7q7bbudt .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-ik7q7bbudt :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Deployment Script Execution

setUp() Load environment variables Initialize deployer account

run() Deploy contract with constructor args

forge broadcast Submit transaction to network

Write to broadcast/*/run-latest.json Record deployed address

Diagram: Standard Deployment Script Flow

Sources: [contracts/README.md#105-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L105-L122)[contracts/foundry.toml#1-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L1-L27)

## Deployment OutputsLink copied!

Each successful deployment generates artifacts that are critical for subsequent steps and system operation.

### Broadcast LogsLink copied!

Deployment transactions are recorded in `broadcast/<chain-id>/<script-name>/run-latest.json`. These logs contain:

- Deployed contract address
- Constructor arguments
- Transaction hash
- Block number and timestamp
- Gas used

Directory Structure:

```
broadcast/
├── 11155111/               # Sepolia L1
│   └── 04_DeployOracle.s.sol/
│       └── run-latest.json
├── 5318007/                # Reactive Network
│   └── 05_DeploySentinel.s.sol/
│       └── run-latest.json
└── 1301/                   # Unichain Sepolia
    └── 06_DeployHook.s.sol/
        └── run-latest.json
```

### Address PropagationLink copied!

Deployed addresses must be manually propagated to subsequent deployment scripts. The workflow requires:

1. Deploy `MockOracle` on Sepolia
2. Extract address from `broadcast/11155111/*/run-latest.json`
3. Configure `05_DeploySentinel.s.sol` with Oracle address
4. Deploy `AegisSentinel` on Reactive Network
5. Extract Sentinel address
6. Configure `06_DeployHook.s.sol` with Sentinel address
7. Deploy `AegisHook` on Unichain

Sources: [contracts/README.md#96-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L96-L122)

## Post-Deployment StepsLink copied!

After all three contracts are deployed, additional configuration steps are required to activate the system.

### Reactive Network SubscriptionLink copied!

The `AegisSentinel` must subscribe to the `PriceUpdate(uint256)` event from the `MockOracle` contract. This establishes the event-driven trigger mechanism that enables autonomous monitoring.

Subscription Parameters:

- Source Contract: MockOracle address on Sepolia
- Source Chain ID: 11155111 (Sepolia)
- Event Signature: `keccak256("PriceUpdate(uint256)")`
- Reactive Contract: AegisSentinel address

### Access Control VerificationLink copied!

Verify that the `AegisHook` has correctly stored the `AegisSentinel` address as an authorized caller. Only the Sentinel should be able to invoke `setPanicMode()`.

Verification Check:

```
Read AegisHook.sentinelAddress() == deployed AegisSentinel address
```

### Guardian Registry InitializationLink copied!

If the Guardian Registry is deployed (optional for MVP), the `AegisHook` must be configured to recognize the registry address for VIP lane functionality.

Sources: [contracts/README.md#96-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L96-L122)

## Security ConsiderationsLink copied!

### Private Key ManagementLink copied!

Deployment private keys must be stored securely and never committed to version control. The `.env` file is explicitly excluded via `.gitignore`.

Environment Variables:

- `PRIVATE_KEY_SEPOLIA`: Deployer account for L1
- `PRIVATE_KEY_REACTIVE`: Deployer account for Reactive Network
- `PRIVATE_KEY_UNICHAIN`: Deployer account for L2

### Address ValidationLink copied!

After each deployment step, verify the deployed address matches expected characteristics:

- Non-zero address
- Correct network (verify chain ID)
- Sufficient gas used (indicates actual deployment, not revert)

### Testnet vs. MainnetLink copied!

The current deployment targets testnet networks. For mainnet deployment:

1. Replace `MockOracle` with official Chainlink Oracle address
2. Update `AegisSentinel` constructor to reference production Oracle
3. Perform extensive security audits on all contracts
4. Test cross-chain message delivery with real economic value

Sources: [contracts/README.md#59-68](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L59-L68)

## Deployment ChecklistLink copied!

Before beginning deployment, ensure:

- All git submodules are initialized
- `forge build` completes successfully
- `forge test` passes all tests
- RPC endpoints are accessible for all three networks
- Deployer accounts are funded on all three networks
- `.env` file contains valid private keys
- `foundry.toml` RPC endpoints are current
- Previous deployment artifacts are backed up (if redeploying)

After deployment:

- MockOracle address recorded
- AegisSentinel address recorded
- AegisHook address recorded
- Sentinel subscribed to Oracle events
- Hook access control verified
- Cross-chain connectivity tested
- Deployment addresses documented in [Deployed Addresses](#10.1)

Sources: [contracts/README.md#1-123](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L1-L123)[contracts/foundry.toml#1-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/foundry.toml#L1-L27)

---

# Deploying-MockOracle-(Sepolia-L1)

# Deploying MockOracle (Sepolia L1)Link copied!
Relevant source files
- [contracts/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md)
- [contracts/broadcast/04_DeployOracle.s.sol/11155111/run-1769586193733.json](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/broadcast/04_DeployOracle.s.sol/11155111/run-1769586193733.json)
- [contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json)

## Purpose and ScopeLink copied!

This document provides detailed instructions for deploying the `MockOracle` contract to Ethereum Sepolia testnet (Chain ID: 11155111). The MockOracle serves as the L1 data source that emits `PriceUpdate` events, which the `AegisSentinel` on Reactive Network monitors to trigger circuit breaker actions.

For the overall deployment strategy and order of operations, see [Deployment Overview](#5.1). For deploying subsequent components, see [Deploying AegisSentinel](#5.3) and [Deploying AegisHook](#5.4). For verification procedures, see [Deployment Verification](#5.5).

Sources:[contracts/README.md#1-123](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L1-L123)

---

## PrerequisitesLink copied!

Before deploying the MockOracle, ensure the following requirements are met:

RequirementDescriptionVerification CommandFoundry InstallationForge command-line tool available`forge --version`Wallet Private KeyDeployer account with Sepolia ETHSet in `.env` or via CLI flagRPC AccessSepolia RPC endpoint configuredTest with `cast block-number --rpc-url sepolia`Gas FundsMinimum 0.01 SepoliaETH for deploymentCheck balance on block explorer

The deployment uses the Foundry script located at `script/04_DeployOracle.s.sol`, which handles contract compilation, deployment, and broadcast logging automatically.

Sources:[contracts/README.md#106-109](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L106-L109)

---

## The MockOracle ContractLink copied!

### Purpose in System ArchitectureLink copied!

The `MockOracle` contract simulates a Chainlink-style price feed for testing and demonstration purposes. It allows deterministic control over price updates, enabling on-demand simulation of market crash scenarios.

#mermaid-ace3qs6883{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-ace3qs6883 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-ace3qs6883 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-ace3qs6883 .error-icon{fill:#a44141;}#mermaid-ace3qs6883 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-ace3qs6883 .edge-thickness-normal{stroke-width:1px;}#mermaid-ace3qs6883 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-ace3qs6883 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-ace3qs6883 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-ace3qs6883 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-ace3qs6883 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-ace3qs6883 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-ace3qs6883 .marker.cross{stroke:lightgrey;}#mermaid-ace3qs6883 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-ace3qs6883 p{margin:0;}#mermaid-ace3qs6883 .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-ace3qs6883 .cluster-label text{fill:#F9FFFE;}#mermaid-ace3qs6883 .cluster-label span{color:#F9FFFE;}#mermaid-ace3qs6883 .cluster-label span p{background-color:transparent;}#mermaid-ace3qs6883 .label text,#mermaid-ace3qs6883 span{fill:#ccc;color:#ccc;}#mermaid-ace3qs6883 .node rect,#mermaid-ace3qs6883 .node circle,#mermaid-ace3qs6883 .node ellipse,#mermaid-ace3qs6883 .node polygon,#mermaid-ace3qs6883 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-ace3qs6883 .rough-node .label text,#mermaid-ace3qs6883 .node .label text,#mermaid-ace3qs6883 .image-shape .label,#mermaid-ace3qs6883 .icon-shape .label{text-anchor:middle;}#mermaid-ace3qs6883 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-ace3qs6883 .rough-node .label,#mermaid-ace3qs6883 .node .label,#mermaid-ace3qs6883 .image-shape .label,#mermaid-ace3qs6883 .icon-shape .label{text-align:center;}#mermaid-ace3qs6883 .node.clickable{cursor:pointer;}#mermaid-ace3qs6883 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-ace3qs6883 .arrowheadPath{fill:lightgrey;}#mermaid-ace3qs6883 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-ace3qs6883 .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-ace3qs6883 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-ace3qs6883 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-ace3qs6883 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-ace3qs6883 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-ace3qs6883 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-ace3qs6883 .cluster text{fill:#F9FFFE;}#mermaid-ace3qs6883 .cluster span{color:#F9FFFE;}#mermaid-ace3qs6883 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-ace3qs6883 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-ace3qs6883 rect.text{fill:none;stroke-width:0;}#mermaid-ace3qs6883 .icon-shape,#mermaid-ace3qs6883 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-ace3qs6883 .icon-shape p,#mermaid-ace3qs6883 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-ace3qs6883 .icon-shape rect,#mermaid-ace3qs6883 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-ace3qs6883 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-ace3qs6883 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-ace3qs6883 :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Post-Deployment

Ethereum Sepolia L1

Deployer Account 0xd2df...e2a

04_DeployOracle.s.sol Foundry Script

MockOracle.sol Contract Source

MockOracle Instance 0x29f8...a3b

PriceUpdate Event Emitted to L1 Logs

Diagram: MockOracle Deployment Flow on Sepolia L1

The contract implements two key functions:

- `setPrice(uint256 newPrice)` - Updates price and emits `PriceUpdate` event
- `price` - Public state variable storing current price (initialized to 2000 ETH)

Sources:[contracts/README.md#46-51](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L46-L51)[contracts/README.md#99-103](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L99-L103)

---

## The Deployment ScriptLink copied!

The deployment is automated via `script/04_DeployOracle.s.sol`. While the exact script contents are not provided in the source files, based on the broadcast logs, the script performs the following operations:

BlockchainRPCScriptForgeBlockchain["Ethereum Sepolia"]RPC["Sepolia RPC"]Script["04_DeployOracle.s.sol"]Forge["forge script"]UserBlockchainRPCScriptForgeBlockchain["Ethereum Sepolia"]RPC["Sepolia RPC"]Script["04_DeployOracle.s.sol"]Forge["forge script"]User#mermaid-8z2bcw5fd8k{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-8z2bcw5fd8k .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-8z2bcw5fd8k .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-8z2bcw5fd8k .error-icon{fill:#a44141;}#mermaid-8z2bcw5fd8k .error-text{fill:#ddd;stroke:#ddd;}#mermaid-8z2bcw5fd8k .edge-thickness-normal{stroke-width:1px;}#mermaid-8z2bcw5fd8k .edge-thickness-thick{stroke-width:3.5px;}#mermaid-8z2bcw5fd8k .edge-pattern-solid{stroke-dasharray:0;}#mermaid-8z2bcw5fd8k .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-8z2bcw5fd8k .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-8z2bcw5fd8k .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-8z2bcw5fd8k .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-8z2bcw5fd8k .marker.cross{stroke:lightgrey;}#mermaid-8z2bcw5fd8k svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-8z2bcw5fd8k p{margin:0;}#mermaid-8z2bcw5fd8k .actor{stroke:#ccc;fill:#1f2020;}#mermaid-8z2bcw5fd8k text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-8z2bcw5fd8k .actor-line{stroke:#ccc;}#mermaid-8z2bcw5fd8k .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-8z2bcw5fd8k .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-8z2bcw5fd8k .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-8z2bcw5fd8k #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-8z2bcw5fd8k .sequenceNumber{fill:black;}#mermaid-8z2bcw5fd8k #sequencenumber{fill:lightgrey;}#mermaid-8z2bcw5fd8k #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-8z2bcw5fd8k .messageText{fill:lightgrey;stroke:none;}#mermaid-8z2bcw5fd8k .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-8z2bcw5fd8k .labelText,#mermaid-8z2bcw5fd8k .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-8z2bcw5fd8k .loopText,#mermaid-8z2bcw5fd8k .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-8z2bcw5fd8k .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-8z2bcw5fd8k .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-8z2bcw5fd8k .noteText,#mermaid-8z2bcw5fd8k .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-8z2bcw5fd8k .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-8z2bcw5fd8k .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-8z2bcw5fd8k .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-8z2bcw5fd8k .actorPopupMenu{position:absolute;}#mermaid-8z2bcw5fd8k .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-8z2bcw5fd8k .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-8z2bcw5fd8k .actor-man circle,#mermaid-8z2bcw5fd8k line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-8z2bcw5fd8k :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}"forge script ... --broadcast""Execute run() function""Compile MockOracle.sol""Send CREATE transaction""Mine transaction""Transaction receipt""Contract address: 0x29f8...""Write broadcast log""Deployment complete"

Diagram: Deployment Script Execution Flow

The script uses Foundry's `ScriptBase` contract to handle:

1. Contract bytecode compilation
2. Transaction construction with nonce management
3. Gas estimation and pricing
4. Transaction broadcast to RPC endpoint
5. Receipt verification
6. Broadcast log generation

Sources:[contracts/README.md#106-109](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L106-L109)[contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json#1-46](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json#L1-L46)

---

## Deployment ProcessLink copied!

### Step 1: Environment ConfigurationLink copied!

Ensure your environment is configured with Sepolia RPC access. The `foundry.toml` file should include:

```
[rpc_endpoints]
sepolia = "https://sepolia.infura.io/v3/${INFURA_API_KEY}"
```

Alternatively, provide the RPC URL directly in the command.

### Step 2: Execute Deployment CommandLink copied!

Run the following command from the `contracts/` directory:

```
forge script script/04_DeployOracle.s.sol --rpc-url sepolia --broadcast
```

Command Parameters:

FlagPurposeValue`--rpc-url sepolia`Target networkUses RPC alias from foundry.toml`--broadcast`Execute transactions on-chainWrites to blockchain

Optional Parameters:

```
# With explicit private key (not recommended for production)
forge script script/04_DeployOracle.s.sol \
  --rpc-url sepolia \
  --private-key $PRIVATE_KEY \
  --broadcast
 
# With hardware wallet
forge script script/04_DeployOracle.s.sol \
  --rpc-url sepolia \
  --ledger \
  --broadcast
 
# With gas price control
forge script script/04_DeployOracle.s.sol \
  --rpc-url sepolia \
  --with-gas-price 30gwei \
  --broadcast
```

### Step 3: Monitor DeploymentLink copied!

The deployment process outputs real-time information:

```
[⠊] Compiling...
[⠊] Compiling 1 files with 0.8.26
[⠒] Solc 0.8.26 finished in 1.23s
Compiler run successful!
 
Script ran successfully.
Gas used: 206613
 
== Logs ==
  MockOracle deployed at: 0x29f8f8d2a00330f9683e73a926f61ae7e91cba3b
 
ONCHAIN EXECUTION COMPLETE & SUCCESSFUL.
Total Paid: 0.00743 ETH (206613 gas * 35.94 gwei)
```

Sources:[contracts/README.md#106-109](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L106-L109)[contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json#10-17](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json#L10-L17)

---

## Understanding the Broadcast OutputLink copied!

After successful deployment, Foundry generates a broadcast log at:

```
contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json
```

### Broadcast Log StructureLink copied!

#mermaid-u4y4bnxle4{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-u4y4bnxle4 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-u4y4bnxle4 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-u4y4bnxle4 .error-icon{fill:#a44141;}#mermaid-u4y4bnxle4 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-u4y4bnxle4 .edge-thickness-normal{stroke-width:1px;}#mermaid-u4y4bnxle4 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-u4y4bnxle4 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-u4y4bnxle4 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-u4y4bnxle4 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-u4y4bnxle4 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-u4y4bnxle4 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-u4y4bnxle4 .marker.cross{stroke:lightgrey;}#mermaid-u4y4bnxle4 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-u4y4bnxle4 p{margin:0;}#mermaid-u4y4bnxle4 .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-u4y4bnxle4 .cluster-label text{fill:#F9FFFE;}#mermaid-u4y4bnxle4 .cluster-label span{color:#F9FFFE;}#mermaid-u4y4bnxle4 .cluster-label span p{background-color:transparent;}#mermaid-u4y4bnxle4 .label text,#mermaid-u4y4bnxle4 span{fill:#ccc;color:#ccc;}#mermaid-u4y4bnxle4 .node rect,#mermaid-u4y4bnxle4 .node circle,#mermaid-u4y4bnxle4 .node ellipse,#mermaid-u4y4bnxle4 .node polygon,#mermaid-u4y4bnxle4 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-u4y4bnxle4 .rough-node .label text,#mermaid-u4y4bnxle4 .node .label text,#mermaid-u4y4bnxle4 .image-shape .label,#mermaid-u4y4bnxle4 .icon-shape .label{text-anchor:middle;}#mermaid-u4y4bnxle4 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-u4y4bnxle4 .rough-node .label,#mermaid-u4y4bnxle4 .node .label,#mermaid-u4y4bnxle4 .image-shape .label,#mermaid-u4y4bnxle4 .icon-shape .label{text-align:center;}#mermaid-u4y4bnxle4 .node.clickable{cursor:pointer;}#mermaid-u4y4bnxle4 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-u4y4bnxle4 .arrowheadPath{fill:lightgrey;}#mermaid-u4y4bnxle4 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-u4y4bnxle4 .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-u4y4bnxle4 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-u4y4bnxle4 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-u4y4bnxle4 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-u4y4bnxle4 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-u4y4bnxle4 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-u4y4bnxle4 .cluster text{fill:#F9FFFE;}#mermaid-u4y4bnxle4 .cluster span{color:#F9FFFE;}#mermaid-u4y4bnxle4 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-u4y4bnxle4 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-u4y4bnxle4 rect.text{fill:none;stroke-width:0;}#mermaid-u4y4bnxle4 .icon-shape,#mermaid-u4y4bnxle4 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-u4y4bnxle4 .icon-shape p,#mermaid-u4y4bnxle4 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-u4y4bnxle4 .icon-shape rect,#mermaid-u4y4bnxle4 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-u4y4bnxle4 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-u4y4bnxle4 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-u4y4bnxle4 :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Receipts Array

Transactions Array

Top-Level Fields

run-latest.json Deployment Artifact

chain: 11155111 Sepolia Chain ID

timestamp Unix Epoch

commit Git Hash

hash 0x3a084a0a...

transactionType: CREATE

contractName: MockOracle

contractAddress 0x29f8f8d2a00330...

transaction object from, gas, value, input

receipts[0]

status: 0x1 (success)

blockNumber 0x9ab972

gasUsed: 0x32915 (206,613 decimal)

Diagram: Broadcast Log Data Structure

### Key Fields ExplainedLink copied!

FieldValueInterpretation`transactions[0].hash``0x3a084a0a072d935c30754dc6b246b1869ae71c2e3b99527b4f43fe49934349ba`Transaction hash on Sepolia`transactions[0].contractAddress``0x29f8f8d2a00330f9683e73a926f61ae7e91cba3b`Deployed MockOracle address`transactions[0].transaction.from``0xd2df53d9791e98db221842dd085f4144014bbe2a`Deployer account`transactions[0].transaction.nonce``0x123` (291 decimal)Account nonce at deployment`receipts[0].status``0x1`Success status`receipts[0].gasUsed``0x32915` (206,613 decimal)Gas consumed`receipts[0].blockNumber``0x9ab972` (10,139,058 decimal)Block containing deployment

The `contractAddress` field is the critical output needed for subsequent deployments.

Sources:[contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json#1-46](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json#L1-L46)

---

## Post-Deployment VerificationLink copied!

### Step 1: Verify Contract DeploymentLink copied!

Use `cast` to verify the contract exists:

```
# Check bytecode exists at address
cast code 0x29f8f8d2a00330f9683e73a926f61ae7e91cba3b --rpc-url sepolia
 
# Read initial price value
cast call 0x29f8f8d2a00330f9683e73a926f61ae7e91cba3b "price()" --rpc-url sepolia
# Expected output: 0x0000000000000000000000000000000000000000000000006c6b935b8bbd400000
# (2000 ETH in hex)
```

### Step 2: Verify OwnershipLink copied!

The MockOracle initializes with `msg.sender` as `owner`:

```
cast call 0x29f8f8d2a00330f9683e73a926f61ae7e91cba3b "owner()" --rpc-url sepolia
# Should return: 0x000000000000000000000000d2df53d9791e98db221842dd085f4144014bbe2a
```

### Step 3: Test Price Update FunctionalityLink copied!

```
# Update price to 1000 ETH to simulate crash
cast send 0x29f8f8d2a00330f9683e73a926f61ae7e91cba3b \
  "setPrice(uint256)" \
  1000000000000000000000 \
  --rpc-url sepolia \
  --private-key $PRIVATE_KEY
 
# Verify price changed
cast call 0x29f8f8d2a00330f9683e73a926f61ae7e91cba3b "price()" --rpc-url sepolia
```

### Step 4: Verify Event EmissionLink copied!

Check that `PriceUpdate` events are emitted correctly:

```
# Get recent logs (requires block range)
cast logs \
  --address 0x29f8f8d2a00330f9683e73a926f61ae7e91cba3b \
  --from-block 10139058 \
  --to-block latest \
  --rpc-url sepolia
```

The event signature is:

```
PriceUpdate(uint256 price, uint256 timestamp)
Topic0: 0x92664190cca12aca9cd5309d87194bdda75bb51362d71c06e1a6f75c7c765711
```

Sources:[contracts/README.md#46-51](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L46-L51)

---

## Contract Address RegistrationLink copied!

### Update Configuration FilesLink copied!

After successful deployment, update the following locations with the deployed address:

1. Sentinel Deployment Script - The `AegisSentinel` needs the MockOracle address to subscribe to `PriceUpdate` events
2. README Documentation - Update the deployed addresses table
3. Environment Variables - Store for integration tests

Example update in README:

```
| Contract | Network | Address | Description |
| :--- | :--- | :--- | :--- |
| **MockOracle** | Sepolia (L1) | `0x29f8f8d2a00330f9683e73a926f61ae7e91cba3b` | Simulates ETH Price |
```

Sources:[contracts/README.md#99-103](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L99-L103)

---

## Deployment Transaction AnatomyLink copied!

The actual deployment transaction contains the contract creation bytecode in the `input` field. Analysis of the transaction structure:

#mermaid-duub6ac6hs{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-duub6ac6hs .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-duub6ac6hs .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-duub6ac6hs .error-icon{fill:#a44141;}#mermaid-duub6ac6hs .error-text{fill:#ddd;stroke:#ddd;}#mermaid-duub6ac6hs .edge-thickness-normal{stroke-width:1px;}#mermaid-duub6ac6hs .edge-thickness-thick{stroke-width:3.5px;}#mermaid-duub6ac6hs .edge-pattern-solid{stroke-dasharray:0;}#mermaid-duub6ac6hs .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-duub6ac6hs .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-duub6ac6hs .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-duub6ac6hs .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-duub6ac6hs .marker.cross{stroke:lightgrey;}#mermaid-duub6ac6hs svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-duub6ac6hs p{margin:0;}#mermaid-duub6ac6hs .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-duub6ac6hs .cluster-label text{fill:#F9FFFE;}#mermaid-duub6ac6hs .cluster-label span{color:#F9FFFE;}#mermaid-duub6ac6hs .cluster-label span p{background-color:transparent;}#mermaid-duub6ac6hs .label text,#mermaid-duub6ac6hs span{fill:#ccc;color:#ccc;}#mermaid-duub6ac6hs .node rect,#mermaid-duub6ac6hs .node circle,#mermaid-duub6ac6hs .node ellipse,#mermaid-duub6ac6hs .node polygon,#mermaid-duub6ac6hs .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-duub6ac6hs .rough-node .label text,#mermaid-duub6ac6hs .node .label text,#mermaid-duub6ac6hs .image-shape .label,#mermaid-duub6ac6hs .icon-shape .label{text-anchor:middle;}#mermaid-duub6ac6hs .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-duub6ac6hs .rough-node .label,#mermaid-duub6ac6hs .node .label,#mermaid-duub6ac6hs .image-shape .label,#mermaid-duub6ac6hs .icon-shape .label{text-align:center;}#mermaid-duub6ac6hs .node.clickable{cursor:pointer;}#mermaid-duub6ac6hs .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-duub6ac6hs .arrowheadPath{fill:lightgrey;}#mermaid-duub6ac6hs .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-duub6ac6hs .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-duub6ac6hs .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-duub6ac6hs .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-duub6ac6hs .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-duub6ac6hs .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-duub6ac6hs .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-duub6ac6hs .cluster text{fill:#F9FFFE;}#mermaid-duub6ac6hs .cluster span{color:#F9FFFE;}#mermaid-duub6ac6hs div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-duub6ac6hs .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-duub6ac6hs rect.text{fill:none;stroke-width:0;}#mermaid-duub6ac6hs .icon-shape,#mermaid-duub6ac6hs .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-duub6ac6hs .icon-shape p,#mermaid-duub6ac6hs .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-duub6ac6hs .icon-shape rect,#mermaid-duub6ac6hs .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-duub6ac6hs .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-duub6ac6hs .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-duub6ac6hs :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Receipt Result

Transaction Object

from 0xd2df...e2a Deployer EOA

to null (Contract Creation)

gas 0x41bce (269,262) Gas Limit

value 0x0 No ETH Sent

input 0x6080604052... Contract Bytecode

nonce 0x123 (291)

chainId 0xaa36a7 (11155111)

contractAddress 0x29f8...a3b Computed Address

gasUsed 0x32915 (206,613) Actual Gas

status 0x1 (Success)

Diagram: Deployment Transaction Structure

### Contract Address DerivationLink copied!

The contract address is deterministically derived using:

```
address = keccak256(rlp([sender_address, nonce]))[12:]
```

For this deployment:

- Sender: `0xd2df53d9791e98db221842dd085f4144014bbe2a`
- Nonce: `0x123` (291)
- Result: `0x29f8f8d2a00330f9683e73a926f61ae7e91cba3b`

Sources:[contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json#10-17](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json#L10-L17)[contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json#22-38](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/broadcast/04_DeployOracle.s.sol/11155111/run-latest.json#L22-L38)

---

## Common Issues and TroubleshootingLink copied!

### Issue: Insufficient GasLink copied!

Symptom: Transaction reverts with "out of gas" error

Solution: Increase gas limit manually:

```
forge script script/04_DeployOracle.s.sol \
  --rpc-url sepolia \
  --gas-limit 300000 \
  --broadcast
```

### Issue: Nonce Too LowLink copied!

Symptom: Error message "nonce too low"

Solution: Foundry manages nonces automatically, but if manual transactions were sent, reset the nonce or wait for pending transactions to complete.

### Issue: RPC Connection FailureLink copied!

Symptom: "Failed to connect to RPC endpoint"

Solution:

1. Verify RPC URL is correct
2. Check API key is valid (for Infura/Alchemy)
3. Try alternative RPC provider

### Issue: Deployment Succeeds but Contract Not FoundLink copied!

Symptom:`cast code` returns `0x`

Solution:

1. Wait for block confirmation (usually 1-2 minutes on Sepolia)
2. Verify you're checking the correct network
3. Confirm transaction was mined by checking block explorer

Sources:[contracts/README.md#106-109](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L106-L109)

---

## Next StepsLink copied!

After successfully deploying the MockOracle:

1. Record the Contract Address - Save `0x29f8f8d2a00330f9683e73a926f61ae7e91cba3b` for use in Sentinel deployment
2. Deploy AegisSentinel - Proceed to [Deploying AegisSentinel](#5.3) on Reactive Network, providing the MockOracle address
3. Set Initial Price - Optionally update the price from default 2000 ETH to desired value
4. Monitor Events - Set up event monitoring to verify `PriceUpdate` emissions before integrating with Sentinel

The MockOracle is now ready to serve as the L1 data source for the Aegis system. The Sentinel will subscribe to this contract's events to detect market crashes and trigger circuit breaker actions.

Sources:[contracts/README.md#99-123](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L99-L123)

---

# Testing-and-CI-CD

# Testing and CI/CDLink copied!
Relevant source files
- [contracts/.github/workflows/test.yml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml)
- [contracts/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md)

This document describes the testing strategy and continuous integration/continuous deployment (CI/CD) infrastructure for the Aegis system. It covers the test execution framework, CI pipeline configuration, and verification workflows used to ensure contract correctness across the three-chain architecture.

For detailed test scenarios and coverage analysis, see [Testing Strategy](#6.1). For GitHub Actions workflow implementation, see [CI/CD Pipelines](#6.2).

## Purpose and ScopeLink copied!

Aegis employs a Foundry-based testing infrastructure to validate smart contract behavior across multiple deployment targets. The testing approach focuses on:

- Unit Testing: Isolated contract function verification
- Integration Testing: Cross-chain interaction validation
- Access Control Testing: Permission boundary enforcement
- Crisis Scenario Testing: Circuit breaker activation under market stress

The CI/CD pipeline automates build verification and test execution, ensuring code quality before deployment to testnet environments.

---

## Testing Framework ArchitectureLink copied!

Aegis uses Foundry as the primary testing framework, leveraging `forge-std` for test utilities and assertion libraries. The testing infrastructure is organized to validate both individual contracts and cross-chain interactions.

### Testing Stack ComponentsLink copied!

#mermaid-n7kae83vkpn{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-n7kae83vkpn .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-n7kae83vkpn .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-n7kae83vkpn .error-icon{fill:#a44141;}#mermaid-n7kae83vkpn .error-text{fill:#ddd;stroke:#ddd;}#mermaid-n7kae83vkpn .edge-thickness-normal{stroke-width:1px;}#mermaid-n7kae83vkpn .edge-thickness-thick{stroke-width:3.5px;}#mermaid-n7kae83vkpn .edge-pattern-solid{stroke-dasharray:0;}#mermaid-n7kae83vkpn .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-n7kae83vkpn .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-n7kae83vkpn .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-n7kae83vkpn .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-n7kae83vkpn .marker.cross{stroke:lightgrey;}#mermaid-n7kae83vkpn svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-n7kae83vkpn p{margin:0;}#mermaid-n7kae83vkpn .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-n7kae83vkpn .cluster-label text{fill:#F9FFFE;}#mermaid-n7kae83vkpn .cluster-label span{color:#F9FFFE;}#mermaid-n7kae83vkpn .cluster-label span p{background-color:transparent;}#mermaid-n7kae83vkpn .label text,#mermaid-n7kae83vkpn span{fill:#ccc;color:#ccc;}#mermaid-n7kae83vkpn .node rect,#mermaid-n7kae83vkpn .node circle,#mermaid-n7kae83vkpn .node ellipse,#mermaid-n7kae83vkpn .node polygon,#mermaid-n7kae83vkpn .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-n7kae83vkpn .rough-node .label text,#mermaid-n7kae83vkpn .node .label text,#mermaid-n7kae83vkpn .image-shape .label,#mermaid-n7kae83vkpn .icon-shape .label{text-anchor:middle;}#mermaid-n7kae83vkpn .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-n7kae83vkpn .rough-node .label,#mermaid-n7kae83vkpn .node .label,#mermaid-n7kae83vkpn .image-shape .label,#mermaid-n7kae83vkpn .icon-shape .label{text-align:center;}#mermaid-n7kae83vkpn .node.clickable{cursor:pointer;}#mermaid-n7kae83vkpn .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-n7kae83vkpn .arrowheadPath{fill:lightgrey;}#mermaid-n7kae83vkpn .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-n7kae83vkpn .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-n7kae83vkpn .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-n7kae83vkpn .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-n7kae83vkpn .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-n7kae83vkpn .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-n7kae83vkpn .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-n7kae83vkpn .cluster text{fill:#F9FFFE;}#mermaid-n7kae83vkpn .cluster span{color:#F9FFFE;}#mermaid-n7kae83vkpn div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-n7kae83vkpn .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-n7kae83vkpn rect.text{fill:none;stroke-width:0;}#mermaid-n7kae83vkpn .icon-shape,#mermaid-n7kae83vkpn .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-n7kae83vkpn .icon-shape p,#mermaid-n7kae83vkpn .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-n7kae83vkpn .icon-shape rect,#mermaid-n7kae83vkpn .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-n7kae83vkpn .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-n7kae83vkpn .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-n7kae83vkpn :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Contracts Under Test

Test Suites

Testing Infrastructure

Provides

Provides

Provides

Inherited By

Inherited By

Tests

Tests

Tests

Tests

forge-std (lib/forge-std)

Test.sol Base Contract

StdCheats.sol VM Manipulation

console.sol Logging

AegisIntegrationTest.t.sol Cross-Chain Validation

Contract Unit Tests (test/*.t.sol)

AegisHook.sol Panic Mode Logic

AegisSentinel.sol Crash Detection

MockOracle.sol Price Simulation

AegisGuardianRegistry.sol Reputation System

Sources:[contracts/README.md#80-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L80-L94)[.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L1-L35)

---

## Test Execution WorkflowLink copied!

The testing process follows a standardized workflow using Foundry's `forge test` command. Tests are executed locally during development and automatically in CI pipelines.

### Local Test ExecutionLink copied!

#mermaid-3rfzph9et2i{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-3rfzph9et2i .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-3rfzph9et2i .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-3rfzph9et2i .error-icon{fill:#a44141;}#mermaid-3rfzph9et2i .error-text{fill:#ddd;stroke:#ddd;}#mermaid-3rfzph9et2i .edge-thickness-normal{stroke-width:1px;}#mermaid-3rfzph9et2i .edge-thickness-thick{stroke-width:3.5px;}#mermaid-3rfzph9et2i .edge-pattern-solid{stroke-dasharray:0;}#mermaid-3rfzph9et2i .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-3rfzph9et2i .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-3rfzph9et2i .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-3rfzph9et2i .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-3rfzph9et2i .marker.cross{stroke:lightgrey;}#mermaid-3rfzph9et2i svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-3rfzph9et2i p{margin:0;}#mermaid-3rfzph9et2i .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-3rfzph9et2i .cluster-label text{fill:#F9FFFE;}#mermaid-3rfzph9et2i .cluster-label span{color:#F9FFFE;}#mermaid-3rfzph9et2i .cluster-label span p{background-color:transparent;}#mermaid-3rfzph9et2i .label text,#mermaid-3rfzph9et2i span{fill:#ccc;color:#ccc;}#mermaid-3rfzph9et2i .node rect,#mermaid-3rfzph9et2i .node circle,#mermaid-3rfzph9et2i .node ellipse,#mermaid-3rfzph9et2i .node polygon,#mermaid-3rfzph9et2i .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-3rfzph9et2i .rough-node .label text,#mermaid-3rfzph9et2i .node .label text,#mermaid-3rfzph9et2i .image-shape .label,#mermaid-3rfzph9et2i .icon-shape .label{text-anchor:middle;}#mermaid-3rfzph9et2i .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-3rfzph9et2i .rough-node .label,#mermaid-3rfzph9et2i .node .label,#mermaid-3rfzph9et2i .image-shape .label,#mermaid-3rfzph9et2i .icon-shape .label{text-align:center;}#mermaid-3rfzph9et2i .node.clickable{cursor:pointer;}#mermaid-3rfzph9et2i .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-3rfzph9et2i .arrowheadPath{fill:lightgrey;}#mermaid-3rfzph9et2i .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-3rfzph9et2i .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-3rfzph9et2i .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-3rfzph9et2i .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-3rfzph9et2i .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-3rfzph9et2i .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-3rfzph9et2i .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-3rfzph9et2i .cluster text{fill:#F9FFFE;}#mermaid-3rfzph9et2i .cluster span{color:#F9FFFE;}#mermaid-3rfzph9et2i div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-3rfzph9et2i .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-3rfzph9et2i rect.text{fill:none;stroke-width:0;}#mermaid-3rfzph9et2i .icon-shape,#mermaid-3rfzph9et2i .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-3rfzph9et2i .icon-shape p,#mermaid-3rfzph9et2i .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-3rfzph9et2i .icon-shape rect,#mermaid-3rfzph9et2i .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-3rfzph9et2i .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-3rfzph9et2i .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-3rfzph9et2i :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

1.Compile

2.Run Tests

3.Generate

✅ Pass

❌ Fail

Iterate

Developer

forge build

forge test

Test Output (-vvv verbosity)

Continue Development

Debug & Fix

Execution Commands:

CommandPurposeVerbosity`forge test`Run all testsMinimal output`forge test -vv`Run with event logsMedium verbosity`forge test -vvv`Run with call tracesHigh verbosity`forge test --match-contract AegisIntegrationTest -vv`Run specific test suiteTargeted execution

Sources:[contracts/README.md#80-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L80-L83)

---

## Verified Test ScenariosLink copied!

The Aegis test suite validates critical system behaviors across the three-chain architecture. Each scenario corresponds to a specific threat model or operational requirement.

### Integration Test CoverageLink copied!

#mermaid-fth57rruw6a{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-fth57rruw6a .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-fth57rruw6a .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-fth57rruw6a .error-icon{fill:#a44141;}#mermaid-fth57rruw6a .error-text{fill:#ddd;stroke:#ddd;}#mermaid-fth57rruw6a .edge-thickness-normal{stroke-width:1px;}#mermaid-fth57rruw6a .edge-thickness-thick{stroke-width:3.5px;}#mermaid-fth57rruw6a .edge-pattern-solid{stroke-dasharray:0;}#mermaid-fth57rruw6a .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-fth57rruw6a .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-fth57rruw6a .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-fth57rruw6a .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-fth57rruw6a .marker.cross{stroke:lightgrey;}#mermaid-fth57rruw6a svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-fth57rruw6a p{margin:0;}#mermaid-fth57rruw6a .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-fth57rruw6a .cluster-label text{fill:#F9FFFE;}#mermaid-fth57rruw6a .cluster-label span{color:#F9FFFE;}#mermaid-fth57rruw6a .cluster-label span p{background-color:transparent;}#mermaid-fth57rruw6a .label text,#mermaid-fth57rruw6a span{fill:#ccc;color:#ccc;}#mermaid-fth57rruw6a .node rect,#mermaid-fth57rruw6a .node circle,#mermaid-fth57rruw6a .node ellipse,#mermaid-fth57rruw6a .node polygon,#mermaid-fth57rruw6a .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-fth57rruw6a .rough-node .label text,#mermaid-fth57rruw6a .node .label text,#mermaid-fth57rruw6a .image-shape .label,#mermaid-fth57rruw6a .icon-shape .label{text-anchor:middle;}#mermaid-fth57rruw6a .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-fth57rruw6a .rough-node .label,#mermaid-fth57rruw6a .node .label,#mermaid-fth57rruw6a .image-shape .label,#mermaid-fth57rruw6a .icon-shape .label{text-align:center;}#mermaid-fth57rruw6a .node.clickable{cursor:pointer;}#mermaid-fth57rruw6a .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-fth57rruw6a .arrowheadPath{fill:lightgrey;}#mermaid-fth57rruw6a .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-fth57rruw6a .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-fth57rruw6a .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-fth57rruw6a .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-fth57rruw6a .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-fth57rruw6a .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-fth57rruw6a .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-fth57rruw6a .cluster text{fill:#F9FFFE;}#mermaid-fth57rruw6a .cluster span{color:#F9FFFE;}#mermaid-fth57rruw6a div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-fth57rruw6a .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-fth57rruw6a rect.text{fill:none;stroke-width:0;}#mermaid-fth57rruw6a .icon-shape,#mermaid-fth57rruw6a .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-fth57rruw6a .icon-shape p,#mermaid-fth57rruw6a .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-fth57rruw6a .icon-shape rect,#mermaid-fth57rruw6a .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-fth57rruw6a .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-fth57rruw6a .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-fth57rruw6a :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Validation Targets

Test Scenarios

Verifies

Verifies

Verifies

Verifies

Oracle Update Test Validates L1 Price Feed

Access Control Test Sentinel-Only Permissions

Panic Trigger Test setPanicMode(true)

Circuit Breaker Test Swap Revert Logic

MockOracle.sol PriceUpdate Event

AegisHook.sol onlyAuthorized Modifier

AegisSentinel.sol react() Function

AegisHook.beforeSwap() panicMode Check

Test Results Matrix:

Test CaseScenarioExpected BehaviorStatusOracle Update`setPrice(2000)` on L1Emits `PriceUpdate(2000)`✅ PASSAccess ControlUnauthorized call to `setPanicMode()`Reverts with permission error✅ PASSPanic TriggerPrice drops below `THRESHOLD` (1500)Sentinel calls `setPanicMode(true)`✅ PASSCircuit BreakerSwap attempt during `panicMode = true`Reverts with `PoolPaused()`✅ PASS

Sources:[contracts/README.md#85-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L85-L94)

---

## CI/CD Pipeline ArchitectureLink copied!

The Aegis project uses GitHub Actions for continuous integration. The pipeline is defined in `.github/workflows/test.yml` and executes on workflow dispatch events.

### GitHub Actions Workflow StructureLink copied!

#mermaid-voel1wearoc{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-voel1wearoc .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-voel1wearoc .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-voel1wearoc .error-icon{fill:#a44141;}#mermaid-voel1wearoc .error-text{fill:#ddd;stroke:#ddd;}#mermaid-voel1wearoc .edge-thickness-normal{stroke-width:1px;}#mermaid-voel1wearoc .edge-thickness-thick{stroke-width:3.5px;}#mermaid-voel1wearoc .edge-pattern-solid{stroke-dasharray:0;}#mermaid-voel1wearoc .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-voel1wearoc .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-voel1wearoc .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-voel1wearoc .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-voel1wearoc .marker.cross{stroke:lightgrey;}#mermaid-voel1wearoc svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-voel1wearoc p{margin:0;}#mermaid-voel1wearoc .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-voel1wearoc .cluster-label text{fill:#F9FFFE;}#mermaid-voel1wearoc .cluster-label span{color:#F9FFFE;}#mermaid-voel1wearoc .cluster-label span p{background-color:transparent;}#mermaid-voel1wearoc .label text,#mermaid-voel1wearoc span{fill:#ccc;color:#ccc;}#mermaid-voel1wearoc .node rect,#mermaid-voel1wearoc .node circle,#mermaid-voel1wearoc .node ellipse,#mermaid-voel1wearoc .node polygon,#mermaid-voel1wearoc .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-voel1wearoc .rough-node .label text,#mermaid-voel1wearoc .node .label text,#mermaid-voel1wearoc .image-shape .label,#mermaid-voel1wearoc .icon-shape .label{text-anchor:middle;}#mermaid-voel1wearoc .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-voel1wearoc .rough-node .label,#mermaid-voel1wearoc .node .label,#mermaid-voel1wearoc .image-shape .label,#mermaid-voel1wearoc .icon-shape .label{text-align:center;}#mermaid-voel1wearoc .node.clickable{cursor:pointer;}#mermaid-voel1wearoc .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-voel1wearoc .arrowheadPath{fill:lightgrey;}#mermaid-voel1wearoc .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-voel1wearoc .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-voel1wearoc .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-voel1wearoc .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-voel1wearoc .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-voel1wearoc .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-voel1wearoc .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-voel1wearoc .cluster text{fill:#F9FFFE;}#mermaid-voel1wearoc .cluster span{color:#F9FFFE;}#mermaid-voel1wearoc div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-voel1wearoc .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-voel1wearoc rect.text{fill:none;stroke-width:0;}#mermaid-voel1wearoc .icon-shape,#mermaid-voel1wearoc .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-voel1wearoc .icon-shape p,#mermaid-voel1wearoc .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-voel1wearoc .icon-shape rect,#mermaid-voel1wearoc .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-voel1wearoc .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-voel1wearoc .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-voel1wearoc :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Failure

Failure

Success

Workflow Trigger workflow_dispatch

Checkout Code actions/checkout@v4

Initialize Submodules recursive: true

Install Foundry foundry-rs/foundry-toolchain@v1

Build Contracts forge build --sizes

Run Test Suite forge test -vvv

Test Results Pass/Fail

❌ Build Failed

❌ Tests Failed

✅ CI Passed

Sources:[.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L1-L35)

### Pipeline ConfigurationLink copied!

The CI workflow uses the following configuration:

Environment Variables:

- `FOUNDRY_PROFILE: ci` - Activates CI-specific Foundry settings

Job Steps:

1. Code Checkout ([.github/workflows/test.yml#16-18](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L16-L18)):

- Uses `actions/checkout@v4`
- Recursively initializes git submodules (required for `forge-std`, `uniswap-hooks`, `system-smart-contracts`)
2. Foundry Installation ([.github/workflows/test.yml#20-23](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L20-L23)):

- Uses `foundry-rs/foundry-toolchain@v1`
- Installs stable version of Foundry toolchain
3. Build Phase ([.github/workflows/test.yml#25-29](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L25-L29)):

- Executes `forge --version` to verify installation
- Runs `forge build --sizes` to compile contracts and display bytecode sizes
4. Test Phase ([.github/workflows/test.yml#31-34](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L31-L34)):

- Executes `forge test -vvv` with maximum verbosity
- Captures test output including call traces

Sources:[.github/workflows/test.yml#8-34](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L8-L34)

---

## Deployment VerificationLink copied!

After deploying contracts to testnets, the system requires verification to confirm cross-chain connectivity and proper configuration.

### Verification ChecklistLink copied!

#mermaid-nyas1zagdaq{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-nyas1zagdaq .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-nyas1zagdaq .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-nyas1zagdaq .error-icon{fill:#a44141;}#mermaid-nyas1zagdaq .error-text{fill:#ddd;stroke:#ddd;}#mermaid-nyas1zagdaq .edge-thickness-normal{stroke-width:1px;}#mermaid-nyas1zagdaq .edge-thickness-thick{stroke-width:3.5px;}#mermaid-nyas1zagdaq .edge-pattern-solid{stroke-dasharray:0;}#mermaid-nyas1zagdaq .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-nyas1zagdaq .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-nyas1zagdaq .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-nyas1zagdaq .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-nyas1zagdaq .marker.cross{stroke:lightgrey;}#mermaid-nyas1zagdaq svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-nyas1zagdaq p{margin:0;}#mermaid-nyas1zagdaq .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-nyas1zagdaq .cluster-label text{fill:#F9FFFE;}#mermaid-nyas1zagdaq .cluster-label span{color:#F9FFFE;}#mermaid-nyas1zagdaq .cluster-label span p{background-color:transparent;}#mermaid-nyas1zagdaq .label text,#mermaid-nyas1zagdaq span{fill:#ccc;color:#ccc;}#mermaid-nyas1zagdaq .node rect,#mermaid-nyas1zagdaq .node circle,#mermaid-nyas1zagdaq .node ellipse,#mermaid-nyas1zagdaq .node polygon,#mermaid-nyas1zagdaq .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-nyas1zagdaq .rough-node .label text,#mermaid-nyas1zagdaq .node .label text,#mermaid-nyas1zagdaq .image-shape .label,#mermaid-nyas1zagdaq .icon-shape .label{text-anchor:middle;}#mermaid-nyas1zagdaq .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-nyas1zagdaq .rough-node .label,#mermaid-nyas1zagdaq .node .label,#mermaid-nyas1zagdaq .image-shape .label,#mermaid-nyas1zagdaq .icon-shape .label{text-align:center;}#mermaid-nyas1zagdaq .node.clickable{cursor:pointer;}#mermaid-nyas1zagdaq .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-nyas1zagdaq .arrowheadPath{fill:lightgrey;}#mermaid-nyas1zagdaq .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-nyas1zagdaq .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-nyas1zagdaq .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-nyas1zagdaq .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-nyas1zagdaq .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-nyas1zagdaq .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-nyas1zagdaq .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-nyas1zagdaq .cluster text{fill:#F9FFFE;}#mermaid-nyas1zagdaq .cluster span{color:#F9FFFE;}#mermaid-nyas1zagdaq div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-nyas1zagdaq .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-nyas1zagdaq rect.text{fill:none;stroke-width:0;}#mermaid-nyas1zagdaq .icon-shape,#mermaid-nyas1zagdaq .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-nyas1zagdaq .icon-shape p,#mermaid-nyas1zagdaq .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-nyas1zagdaq .icon-shape rect,#mermaid-nyas1zagdaq .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-nyas1zagdaq .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-nyas1zagdaq .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-nyas1zagdaq :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

L2 Verification (Unichain)

Reactive Network Verification

L1 Verification (Sepolia)

Contracts Deployed

Verify MockOracle Address: 0x1392...a7D8

Test setPrice() Call

Confirm PriceUpdate Event

Verify AegisSentinel Address: 0x0B6a...b6B6

Confirm Subscription Active

Test react() Logic

Verify AegisHook Address: 0x1E2a...8080

Confirm Hook Attached to Pool

Test setPanicMode() Access

Deployed Contract Addresses (Testnet):

ContractNetworkAddressVerification`MockOracle`Sepolia L1`0x1392C38921A818cEdb100cC3767e8f30deC3a7D8`Emit `PriceUpdate` event`AegisSentinel`Reactive Lasna`0x0B6ae13119Fc3b61d6ABb115342A1A075e14b6B6`Confirm subscription active`AegisHook`Unichain Sepolia`0x1E2aE114cF3B63779A1367eD704ccA51a0218080`Verify hook permissions

Sources:[contracts/README.md#99-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L99-L122)

---

## Test-Driven Development WorkflowLink copied!

Aegis follows a test-first approach for new feature development. The workflow ensures that all critical paths are validated before deployment.

### Development CycleLink copied!

#mermaid-1x6k9e731sj{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-1x6k9e731sj .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-1x6k9e731sj .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-1x6k9e731sj .error-icon{fill:#a44141;}#mermaid-1x6k9e731sj .error-text{fill:#ddd;stroke:#ddd;}#mermaid-1x6k9e731sj .edge-thickness-normal{stroke-width:1px;}#mermaid-1x6k9e731sj .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1x6k9e731sj .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1x6k9e731sj .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-1x6k9e731sj .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1x6k9e731sj .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1x6k9e731sj .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-1x6k9e731sj .marker.cross{stroke:lightgrey;}#mermaid-1x6k9e731sj svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-1x6k9e731sj p{margin:0;}#mermaid-1x6k9e731sj .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-1x6k9e731sj .cluster-label text{fill:#F9FFFE;}#mermaid-1x6k9e731sj .cluster-label span{color:#F9FFFE;}#mermaid-1x6k9e731sj .cluster-label span p{background-color:transparent;}#mermaid-1x6k9e731sj .label text,#mermaid-1x6k9e731sj span{fill:#ccc;color:#ccc;}#mermaid-1x6k9e731sj .node rect,#mermaid-1x6k9e731sj .node circle,#mermaid-1x6k9e731sj .node ellipse,#mermaid-1x6k9e731sj .node polygon,#mermaid-1x6k9e731sj .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-1x6k9e731sj .rough-node .label text,#mermaid-1x6k9e731sj .node .label text,#mermaid-1x6k9e731sj .image-shape .label,#mermaid-1x6k9e731sj .icon-shape .label{text-anchor:middle;}#mermaid-1x6k9e731sj .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-1x6k9e731sj .rough-node .label,#mermaid-1x6k9e731sj .node .label,#mermaid-1x6k9e731sj .image-shape .label,#mermaid-1x6k9e731sj .icon-shape .label{text-align:center;}#mermaid-1x6k9e731sj .node.clickable{cursor:pointer;}#mermaid-1x6k9e731sj .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-1x6k9e731sj .arrowheadPath{fill:lightgrey;}#mermaid-1x6k9e731sj .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-1x6k9e731sj .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-1x6k9e731sj .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-1x6k9e731sj .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-1x6k9e731sj .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-1x6k9e731sj .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-1x6k9e731sj .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-1x6k9e731sj .cluster text{fill:#F9FFFE;}#mermaid-1x6k9e731sj .cluster span{color:#F9FFFE;}#mermaid-1x6k9e731sj div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1x6k9e731sj .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-1x6k9e731sj rect.text{fill:none;stroke-width:0;}#mermaid-1x6k9e731sj .icon-shape,#mermaid-1x6k9e731sj .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-1x6k9e731sj .icon-shape p,#mermaid-1x6k9e731sj .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-1x6k9e731sj .icon-shape rect,#mermaid-1x6k9e731sj .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-1x6k9e731sj .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-1x6k9e731sj .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-1x6k9e731sj :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Fail

Pass

Approved

Changes Requested

New Feature Requirement

Write Failing Test (test/*.t.sol)

Implement Logic (src/*.sol)

forge test

Code Review

Deploy to Testnet

Debug Implementation

Key Testing Principles:

1. Isolation: Each test should be independent and not rely on external state
2. Determinism: Tests must produce consistent results across runs
3. Coverage: Critical paths (panic mode activation, access control) must have dedicated tests
4. Gas Analysis: Use `forge build --sizes` to monitor bytecode bloat

Sources:[contracts/README.md#72-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L72-L94)

---

## Continuous Integration TriggersLink copied!

The GitHub Actions workflow is currently configured for manual triggering via `workflow_dispatch`. The commented-out lines show intended triggers for production:

Current Configuration:

```
on:
  workflow_dispatch:
  # push:
  # pull_request:
```

Production Configuration (Future):

- Push Trigger: Run CI on every push to main branch
- Pull Request Trigger: Run CI on all PRs before merge
- Scheduled Runs: Nightly integration tests against live testnets

Sources:[.github/workflows/test.yml#3-6](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L3-L6)

---

## Test Execution PerformanceLink copied!

Foundry's testing framework provides near-instant feedback for local development:

MetricValueNotesAverage Test Suite Runtime< 5 secondsLocal executionBuild Time< 10 secondsFull recompilationCI Pipeline Duration~2 minutesIncludes setup, build, testSubmodule Initialization~30 secondsFirst-time checkout only

Optimization Strategies:

- Use `forge test --match-contract` to run specific test suites
- Enable `ffi = false` in `foundry.toml` to prevent external calls
- Leverage `forge snapshot` for gas regression testing

Sources:[.github/workflows/test.yml#25-34](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L25-L34)[contracts/README.md#80-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L80-L83)

---

## Integration with Deployment ScriptsLink copied!

The test suite validates the same deployment logic used in production scripts. This ensures that deployment scripts are tested before execution on live networks.

### Script-Test AlignmentLink copied!

#mermaid-wmrui3jtwsh{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-wmrui3jtwsh .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-wmrui3jtwsh .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-wmrui3jtwsh .error-icon{fill:#a44141;}#mermaid-wmrui3jtwsh .error-text{fill:#ddd;stroke:#ddd;}#mermaid-wmrui3jtwsh .edge-thickness-normal{stroke-width:1px;}#mermaid-wmrui3jtwsh .edge-thickness-thick{stroke-width:3.5px;}#mermaid-wmrui3jtwsh .edge-pattern-solid{stroke-dasharray:0;}#mermaid-wmrui3jtwsh .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-wmrui3jtwsh .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-wmrui3jtwsh .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-wmrui3jtwsh .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-wmrui3jtwsh .marker.cross{stroke:lightgrey;}#mermaid-wmrui3jtwsh svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-wmrui3jtwsh p{margin:0;}#mermaid-wmrui3jtwsh .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-wmrui3jtwsh .cluster-label text{fill:#F9FFFE;}#mermaid-wmrui3jtwsh .cluster-label span{color:#F9FFFE;}#mermaid-wmrui3jtwsh .cluster-label span p{background-color:transparent;}#mermaid-wmrui3jtwsh .label text,#mermaid-wmrui3jtwsh span{fill:#ccc;color:#ccc;}#mermaid-wmrui3jtwsh .node rect,#mermaid-wmrui3jtwsh .node circle,#mermaid-wmrui3jtwsh .node ellipse,#mermaid-wmrui3jtwsh .node polygon,#mermaid-wmrui3jtwsh .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-wmrui3jtwsh .rough-node .label text,#mermaid-wmrui3jtwsh .node .label text,#mermaid-wmrui3jtwsh .image-shape .label,#mermaid-wmrui3jtwsh .icon-shape .label{text-anchor:middle;}#mermaid-wmrui3jtwsh .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-wmrui3jtwsh .rough-node .label,#mermaid-wmrui3jtwsh .node .label,#mermaid-wmrui3jtwsh .image-shape .label,#mermaid-wmrui3jtwsh .icon-shape .label{text-align:center;}#mermaid-wmrui3jtwsh .node.clickable{cursor:pointer;}#mermaid-wmrui3jtwsh .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-wmrui3jtwsh .arrowheadPath{fill:lightgrey;}#mermaid-wmrui3jtwsh .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-wmrui3jtwsh .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-wmrui3jtwsh .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-wmrui3jtwsh .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-wmrui3jtwsh .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-wmrui3jtwsh .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-wmrui3jtwsh .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-wmrui3jtwsh .cluster text{fill:#F9FFFE;}#mermaid-wmrui3jtwsh .cluster span{color:#F9FFFE;}#mermaid-wmrui3jtwsh div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-wmrui3jtwsh .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-wmrui3jtwsh rect.text{fill:none;stroke-width:0;}#mermaid-wmrui3jtwsh .icon-shape,#mermaid-wmrui3jtwsh .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-wmrui3jtwsh .icon-shape p,#mermaid-wmrui3jtwsh .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-wmrui3jtwsh .icon-shape rect,#mermaid-wmrui3jtwsh .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-wmrui3jtwsh .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-wmrui3jtwsh .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-wmrui3jtwsh :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Test Validation

Deployment Scripts

Mirrors

Mirrors

Mirrors

04_DeployOracle.s.sol Sepolia Deploy

05_DeploySentinel.s.sol Reactive Deploy

06_DeployHook.s.sol Unichain Deploy

Oracle Deployment Test Constructor Args

Sentinel Subscription Test Cross-Chain Setup

Hook Permissions Test Salt Mining Validation

Deployment-Test Mapping:

- `04_DeployOracle.s.sol` → Tests verify `MockOracle` constructor parameters
- `05_DeploySentinel.s.sol` → Tests validate subscription setup and cross-chain calls
- `06_DeployHook.s.sol` → Tests confirm hook address mining and permission flags

For detailed deployment procedures, see [Deployment](#5).

Sources:[contracts/README.md#105-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L105-L122)

---

## Future CI/CD EnhancementsLink copied!

Planned improvements to the testing and CI infrastructure:

1. Coverage Reporting: Integrate `forge coverage` with GitHub Actions
2. Gas Benchmarking: Add `forge snapshot` to track gas regressions
3. Multi-Network Testing: Deploy ephemeral test instances to live testnets in CI
4. Automated Deployment: Trigger testnet deployments on successful CI runs
5. Slither Integration: Add static analysis for vulnerability detection

Sources:[.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.github/workflows/test.yml#L1-L35)

---

# Testing-Strategy

# Testing StrategyLink copied!
Relevant source files
- [contracts/.github/workflows/test.yml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml)
- [contracts/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md)

## Purpose and ScopeLink copied!

This document explains the testing strategy employed by Aegis to ensure reliability across its three-chain architecture. It covers test structure, coverage approach, and key test scenarios that validate the circuit breaker functionality. For information about continuous integration and automated testing pipelines, see [CI/CD Pipelines](#6.2). For information about building and running tests locally, see [Building and Testing](#4.2).

The testing strategy focuses on proving that:

1. The `AegisHook` correctly gates Uniswap v4 swaps during panic mode
2. The `AegisSentinel` accurately detects price crashes and triggers cross-chain calls
3. Access control prevents unauthorized panic mode activation
4. The `MockOracle` reliably simulates price feed updates for testing

Sources: [contracts/README.md#85-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L85-L94)

---

## Test OrganizationLink copied!

Aegis uses Foundry's testing framework (`forge-std`) to organize tests into two primary categories: unit tests and integration tests. The test suite is located in the `test/` directory and follows Foundry's naming convention where test files end with `.t.sol`.

### Test File StructureLink copied!

#mermaid-887y1ap1y4f{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-887y1ap1y4f .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-887y1ap1y4f .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-887y1ap1y4f .error-icon{fill:#a44141;}#mermaid-887y1ap1y4f .error-text{fill:#ddd;stroke:#ddd;}#mermaid-887y1ap1y4f .edge-thickness-normal{stroke-width:1px;}#mermaid-887y1ap1y4f .edge-thickness-thick{stroke-width:3.5px;}#mermaid-887y1ap1y4f .edge-pattern-solid{stroke-dasharray:0;}#mermaid-887y1ap1y4f .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-887y1ap1y4f .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-887y1ap1y4f .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-887y1ap1y4f .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-887y1ap1y4f .marker.cross{stroke:lightgrey;}#mermaid-887y1ap1y4f svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-887y1ap1y4f p{margin:0;}#mermaid-887y1ap1y4f .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-887y1ap1y4f .cluster-label text{fill:#F9FFFE;}#mermaid-887y1ap1y4f .cluster-label span{color:#F9FFFE;}#mermaid-887y1ap1y4f .cluster-label span p{background-color:transparent;}#mermaid-887y1ap1y4f .label text,#mermaid-887y1ap1y4f span{fill:#ccc;color:#ccc;}#mermaid-887y1ap1y4f .node rect,#mermaid-887y1ap1y4f .node circle,#mermaid-887y1ap1y4f .node ellipse,#mermaid-887y1ap1y4f .node polygon,#mermaid-887y1ap1y4f .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-887y1ap1y4f .rough-node .label text,#mermaid-887y1ap1y4f .node .label text,#mermaid-887y1ap1y4f .image-shape .label,#mermaid-887y1ap1y4f .icon-shape .label{text-anchor:middle;}#mermaid-887y1ap1y4f .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-887y1ap1y4f .rough-node .label,#mermaid-887y1ap1y4f .node .label,#mermaid-887y1ap1y4f .image-shape .label,#mermaid-887y1ap1y4f .icon-shape .label{text-align:center;}#mermaid-887y1ap1y4f .node.clickable{cursor:pointer;}#mermaid-887y1ap1y4f .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-887y1ap1y4f .arrowheadPath{fill:lightgrey;}#mermaid-887y1ap1y4f .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-887y1ap1y4f .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-887y1ap1y4f .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-887y1ap1y4f .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-887y1ap1y4f .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-887y1ap1y4f .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-887y1ap1y4f .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-887y1ap1y4f .cluster text{fill:#F9FFFE;}#mermaid-887y1ap1y4f .cluster span{color:#F9FFFE;}#mermaid-887y1ap1y4f div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-887y1ap1y4f .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-887y1ap1y4f rect.text{fill:none;stroke-width:0;}#mermaid-887y1ap1y4f .icon-shape,#mermaid-887y1ap1y4f .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-887y1ap1y4f .icon-shape p,#mermaid-887y1ap1y4f .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-887y1ap1y4f .icon-shape rect,#mermaid-887y1ap1y4f .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-887y1ap1y4f .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-887y1ap1y4f .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-887y1ap1y4f :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

forge-std (lib/forge-std)

test/

AegisIntegrationTest.t.sol Cross-chain scenario tests

AegisHook.t.sol Hook behavior tests

AegisSentinel.t.sol Sentinel logic tests

MockOracle.t.sol Oracle simulation tests

AegisGuardianRegistry.t.sol Reputation system tests

Test.sol Base test contract

StdCheats.sol Cheatcodes

console.sol Logging

Test Organization by Contract

Test FileTarget ContractFocus Area`AegisIntegrationTest.t.sol`All contractsEnd-to-end cross-chain flows`AegisHook.t.sol``AegisHook`Panic mode logic, VIP lane, access control`AegisSentinel.t.sol``AegisSentinel`Price monitoring, threshold detection, cross-chain calls`MockOracle.t.sol``MockOracle`Price updates, event emissions`AegisGuardianRegistry.t.sol``AegisGuardianRegistry`NFT minting, reputation tracking, ERC-8004 compliance

Sources: [contracts/README.md#81-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L81-L94)[contracts/.github/workflows/test.yml#31-34](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L31-L34)

---

## Testing ApproachLink copied!

### Unit TestingLink copied!

Unit tests validate individual contract functions in isolation. Each contract has dedicated unit tests that use Foundry's cheatcodes to mock external dependencies and control the test environment.

Key Unit Test Patterns:

#mermaid-qqmgqyja4rg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-qqmgqyja4rg .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-qqmgqyja4rg .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-qqmgqyja4rg .error-icon{fill:#a44141;}#mermaid-qqmgqyja4rg .error-text{fill:#ddd;stroke:#ddd;}#mermaid-qqmgqyja4rg .edge-thickness-normal{stroke-width:1px;}#mermaid-qqmgqyja4rg .edge-thickness-thick{stroke-width:3.5px;}#mermaid-qqmgqyja4rg .edge-pattern-solid{stroke-dasharray:0;}#mermaid-qqmgqyja4rg .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-qqmgqyja4rg .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-qqmgqyja4rg .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-qqmgqyja4rg .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-qqmgqyja4rg .marker.cross{stroke:lightgrey;}#mermaid-qqmgqyja4rg svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-qqmgqyja4rg p{margin:0;}#mermaid-qqmgqyja4rg .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-qqmgqyja4rg .cluster-label text{fill:#F9FFFE;}#mermaid-qqmgqyja4rg .cluster-label span{color:#F9FFFE;}#mermaid-qqmgqyja4rg .cluster-label span p{background-color:transparent;}#mermaid-qqmgqyja4rg .label text,#mermaid-qqmgqyja4rg span{fill:#ccc;color:#ccc;}#mermaid-qqmgqyja4rg .node rect,#mermaid-qqmgqyja4rg .node circle,#mermaid-qqmgqyja4rg .node ellipse,#mermaid-qqmgqyja4rg .node polygon,#mermaid-qqmgqyja4rg .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-qqmgqyja4rg .rough-node .label text,#mermaid-qqmgqyja4rg .node .label text,#mermaid-qqmgqyja4rg .image-shape .label,#mermaid-qqmgqyja4rg .icon-shape .label{text-anchor:middle;}#mermaid-qqmgqyja4rg .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-qqmgqyja4rg .rough-node .label,#mermaid-qqmgqyja4rg .node .label,#mermaid-qqmgqyja4rg .image-shape .label,#mermaid-qqmgqyja4rg .icon-shape .label{text-align:center;}#mermaid-qqmgqyja4rg .node.clickable{cursor:pointer;}#mermaid-qqmgqyja4rg .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-qqmgqyja4rg .arrowheadPath{fill:lightgrey;}#mermaid-qqmgqyja4rg .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-qqmgqyja4rg .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-qqmgqyja4rg .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-qqmgqyja4rg .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-qqmgqyja4rg .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-qqmgqyja4rg .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-qqmgqyja4rg .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-qqmgqyja4rg .cluster text{fill:#F9FFFE;}#mermaid-qqmgqyja4rg .cluster span{color:#F9FFFE;}#mermaid-qqmgqyja4rg div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-qqmgqyja4rg .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-qqmgqyja4rg rect.text{fill:none;stroke-width:0;}#mermaid-qqmgqyja4rg .icon-shape,#mermaid-qqmgqyja4rg .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-qqmgqyja4rg .icon-shape p,#mermaid-qqmgqyja4rg .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-qqmgqyja4rg .icon-shape rect,#mermaid-qqmgqyja4rg .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-qqmgqyja4rg .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-qqmgqyja4rg .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-qqmgqyja4rg :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Unit Test Pattern

setUp() Deploy contracts Initialize state

test_FunctionName() Call target function Assert expected behavior

Automatic cleanup by Foundry

Cheatcodes Used:

- `vm.prank(address)` - Simulate calls from specific addresses for access control testing
- `vm.expectRevert()` - Assert that transactions revert with expected errors
- `vm.expectEmit()` - Verify event emissions
- `vm.warp(timestamp)` - Manipulate block timestamps for time-dependent logic
- `vm.deal(address, amount)` - Fund test accounts

Sources: [contracts/.github/workflows/test.yml#31-34](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L31-L34)

### Integration TestingLink copied!

Integration tests validate the entire cross-chain flow, simulating the complete lifecycle from L1 price update through L2 swap blocking. The `AegisIntegrationTest` contract orchestrates multi-contract interactions to prove end-to-end functionality.

"AegisHook (L2 Simulation)""AegisSentinel (Reactive Simulation)""MockOracle (L1 Simulation)""AegisIntegrationTest""AegisHook (L2 Simulation)""AegisSentinel (Reactive Simulation)""MockOracle (L1 Simulation)""AegisIntegrationTest"#mermaid-qrb2jlmc688{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-qrb2jlmc688 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-qrb2jlmc688 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-qrb2jlmc688 .error-icon{fill:#a44141;}#mermaid-qrb2jlmc688 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-qrb2jlmc688 .edge-thickness-normal{stroke-width:1px;}#mermaid-qrb2jlmc688 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-qrb2jlmc688 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-qrb2jlmc688 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-qrb2jlmc688 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-qrb2jlmc688 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-qrb2jlmc688 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-qrb2jlmc688 .marker.cross{stroke:lightgrey;}#mermaid-qrb2jlmc688 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-qrb2jlmc688 p{margin:0;}#mermaid-qrb2jlmc688 .actor{stroke:#ccc;fill:#1f2020;}#mermaid-qrb2jlmc688 text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-qrb2jlmc688 .actor-line{stroke:#ccc;}#mermaid-qrb2jlmc688 .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-qrb2jlmc688 .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-qrb2jlmc688 .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-qrb2jlmc688 #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-qrb2jlmc688 .sequenceNumber{fill:black;}#mermaid-qrb2jlmc688 #sequencenumber{fill:lightgrey;}#mermaid-qrb2jlmc688 #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-qrb2jlmc688 .messageText{fill:lightgrey;stroke:none;}#mermaid-qrb2jlmc688 .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-qrb2jlmc688 .labelText,#mermaid-qrb2jlmc688 .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-qrb2jlmc688 .loopText,#mermaid-qrb2jlmc688 .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-qrb2jlmc688 .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-qrb2jlmc688 .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-qrb2jlmc688 .noteText,#mermaid-qrb2jlmc688 .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-qrb2jlmc688 .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-qrb2jlmc688 .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-qrb2jlmc688 .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-qrb2jlmc688 .actorPopupMenu{position:absolute;}#mermaid-qrb2jlmc688 .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-qrb2jlmc688 .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-qrb2jlmc688 .actor-man circle,#mermaid-qrb2jlmc688 line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-qrb2jlmc688 :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}setUp() - Deploy all contractstest_OracleUpdate()test_PanicTrigger()test_CircuitBreaker()"Deploy MockOracle""Deploy AegisSentinel""Deploy AegisHook""setPrice(2000)""emit PriceUpdate(2000)""setPrice(1000)""PriceUpdate(1000) detected""Check: 1000 < THRESHOLD""setPanicMode(true)""panicMode == true""beforeSwap()""revert PoolPaused()"

Integration Test Characteristics:

- Simulates cross-chain interactions within a single test environment
- Uses event monitoring to verify contract communication
- Tests state consistency across multiple contracts
- Validates access control boundaries

Sources: [contracts/README.md#81-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L81-L94)

---

## Core Test ScenariosLink copied!

The Aegis test suite validates four critical scenarios that prove the system's circuit breaker functionality. These scenarios correspond to the operational flow described in the system architecture.

### Verified Test ScenariosLink copied!

Test CaseContract Under TestScenario DescriptionExpected BehaviorStatusOracle Update`MockOracle`Updates price on L1 simulation`PriceUpdate` event emitted with new price✅ PASSAccess Control`AegisHook`Unauthorized address calls `setPanicMode()`Transaction reverts with `Unauthorized()` error✅ PASSPanic Trigger`AegisSentinel` → `AegisHook`Price falls below threshold (1500)Hook's `panicMode` set to `true`✅ PASSCircuit Breaker`AegisHook`Swap attempted during panic modeSwap reverts with `PoolPaused()` error✅ PASS

Sources: [contracts/README.md#85-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L85-L94)

### Test Scenario Deep DiveLink copied!

#### 1. Oracle Update Test

Purpose: Validate that the `MockOracle` correctly updates price and emits events.

Test Flow:

#mermaid-sq3tx8rw90a{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-sq3tx8rw90a .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-sq3tx8rw90a .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-sq3tx8rw90a .error-icon{fill:#a44141;}#mermaid-sq3tx8rw90a .error-text{fill:#ddd;stroke:#ddd;}#mermaid-sq3tx8rw90a .edge-thickness-normal{stroke-width:1px;}#mermaid-sq3tx8rw90a .edge-thickness-thick{stroke-width:3.5px;}#mermaid-sq3tx8rw90a .edge-pattern-solid{stroke-dasharray:0;}#mermaid-sq3tx8rw90a .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-sq3tx8rw90a .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-sq3tx8rw90a .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-sq3tx8rw90a .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-sq3tx8rw90a .marker.cross{stroke:lightgrey;}#mermaid-sq3tx8rw90a svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-sq3tx8rw90a p{margin:0;}#mermaid-sq3tx8rw90a .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-sq3tx8rw90a .cluster-label text{fill:#F9FFFE;}#mermaid-sq3tx8rw90a .cluster-label span{color:#F9FFFE;}#mermaid-sq3tx8rw90a .cluster-label span p{background-color:transparent;}#mermaid-sq3tx8rw90a .label text,#mermaid-sq3tx8rw90a span{fill:#ccc;color:#ccc;}#mermaid-sq3tx8rw90a .node rect,#mermaid-sq3tx8rw90a .node circle,#mermaid-sq3tx8rw90a .node ellipse,#mermaid-sq3tx8rw90a .node polygon,#mermaid-sq3tx8rw90a .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-sq3tx8rw90a .rough-node .label text,#mermaid-sq3tx8rw90a .node .label text,#mermaid-sq3tx8rw90a .image-shape .label,#mermaid-sq3tx8rw90a .icon-shape .label{text-anchor:middle;}#mermaid-sq3tx8rw90a .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-sq3tx8rw90a .rough-node .label,#mermaid-sq3tx8rw90a .node .label,#mermaid-sq3tx8rw90a .image-shape .label,#mermaid-sq3tx8rw90a .icon-shape .label{text-align:center;}#mermaid-sq3tx8rw90a .node.clickable{cursor:pointer;}#mermaid-sq3tx8rw90a .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-sq3tx8rw90a .arrowheadPath{fill:lightgrey;}#mermaid-sq3tx8rw90a .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-sq3tx8rw90a .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-sq3tx8rw90a .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-sq3tx8rw90a .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-sq3tx8rw90a .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-sq3tx8rw90a .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-sq3tx8rw90a .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-sq3tx8rw90a .cluster text{fill:#F9FFFE;}#mermaid-sq3tx8rw90a .cluster span{color:#F9FFFE;}#mermaid-sq3tx8rw90a div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-sq3tx8rw90a .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-sq3tx8rw90a rect.text{fill:none;stroke-width:0;}#mermaid-sq3tx8rw90a .icon-shape,#mermaid-sq3tx8rw90a .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-sq3tx8rw90a .icon-shape p,#mermaid-sq3tx8rw90a .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-sq3tx8rw90a .icon-shape rect,#mermaid-sq3tx8rw90a .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-sq3tx8rw90a .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-sq3tx8rw90a .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-sq3tx8rw90a :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

test_OracleUpdate()

oracle.setPrice(2000)

vm.expectEmit(true, true, true, true)

Verify PriceUpdate(2000) emitted

Assertions:

- `PriceUpdate` event emitted with correct price
- `latestPrice()` getter returns updated value

Sources: [contracts/README.md#91](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L91-L91)[contracts/src/MockOracle.sol#1-51](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/src/MockOracle.sol#L1-L51)

#### 2. Access Control Test

Purpose: Ensure only the `AegisSentinel` can activate panic mode on the `AegisHook`.

Test Flow:

#mermaid-rqr0ug080ea{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-rqr0ug080ea .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-rqr0ug080ea .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-rqr0ug080ea .error-icon{fill:#a44141;}#mermaid-rqr0ug080ea .error-text{fill:#ddd;stroke:#ddd;}#mermaid-rqr0ug080ea .edge-thickness-normal{stroke-width:1px;}#mermaid-rqr0ug080ea .edge-thickness-thick{stroke-width:3.5px;}#mermaid-rqr0ug080ea .edge-pattern-solid{stroke-dasharray:0;}#mermaid-rqr0ug080ea .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-rqr0ug080ea .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-rqr0ug080ea .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-rqr0ug080ea .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-rqr0ug080ea .marker.cross{stroke:lightgrey;}#mermaid-rqr0ug080ea svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-rqr0ug080ea p{margin:0;}#mermaid-rqr0ug080ea .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-rqr0ug080ea .cluster-label text{fill:#F9FFFE;}#mermaid-rqr0ug080ea .cluster-label span{color:#F9FFFE;}#mermaid-rqr0ug080ea .cluster-label span p{background-color:transparent;}#mermaid-rqr0ug080ea .label text,#mermaid-rqr0ug080ea span{fill:#ccc;color:#ccc;}#mermaid-rqr0ug080ea .node rect,#mermaid-rqr0ug080ea .node circle,#mermaid-rqr0ug080ea .node ellipse,#mermaid-rqr0ug080ea .node polygon,#mermaid-rqr0ug080ea .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-rqr0ug080ea .rough-node .label text,#mermaid-rqr0ug080ea .node .label text,#mermaid-rqr0ug080ea .image-shape .label,#mermaid-rqr0ug080ea .icon-shape .label{text-anchor:middle;}#mermaid-rqr0ug080ea .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-rqr0ug080ea .rough-node .label,#mermaid-rqr0ug080ea .node .label,#mermaid-rqr0ug080ea .image-shape .label,#mermaid-rqr0ug080ea .icon-shape .label{text-align:center;}#mermaid-rqr0ug080ea .node.clickable{cursor:pointer;}#mermaid-rqr0ug080ea .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-rqr0ug080ea .arrowheadPath{fill:lightgrey;}#mermaid-rqr0ug080ea .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-rqr0ug080ea .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-rqr0ug080ea .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-rqr0ug080ea .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-rqr0ug080ea .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-rqr0ug080ea .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-rqr0ug080ea .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-rqr0ug080ea .cluster text{fill:#F9FFFE;}#mermaid-rqr0ug080ea .cluster span{color:#F9FFFE;}#mermaid-rqr0ug080ea div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-rqr0ug080ea .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-rqr0ug080ea rect.text{fill:none;stroke-width:0;}#mermaid-rqr0ug080ea .icon-shape,#mermaid-rqr0ug080ea .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-rqr0ug080ea .icon-shape p,#mermaid-rqr0ug080ea .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-rqr0ug080ea .icon-shape rect,#mermaid-rqr0ug080ea .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-rqr0ug080ea .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-rqr0ug080ea .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-rqr0ug080ea :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

test_AccessControl()

vm.prank(attacker)

vm.expectRevert(Unauthorized.selector)

hook.setPanicMode(true)

Assertions:

- Calls from unauthorized addresses revert with `Unauthorized()` error [src/AegisHook.sol#50-52](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol#L50-L52)
- Only the Sentinel address stored in `sentinel` variable can call `setPanicMode`[src/AegisHook.sol#45](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol#L45-L45)

Sources: [contracts/README.md#92](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L92-L92)[contracts/src/AegisHook.sol#45-52](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/src/AegisHook.sol#L45-L52)

#### 3. Panic Trigger Test

Purpose: Verify that the `AegisSentinel` correctly detects price crashes and activates the hook.

Test Flow:

#mermaid-cp3lkyp8e8a{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-cp3lkyp8e8a .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-cp3lkyp8e8a .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-cp3lkyp8e8a .error-icon{fill:#a44141;}#mermaid-cp3lkyp8e8a .error-text{fill:#ddd;stroke:#ddd;}#mermaid-cp3lkyp8e8a .edge-thickness-normal{stroke-width:1px;}#mermaid-cp3lkyp8e8a .edge-thickness-thick{stroke-width:3.5px;}#mermaid-cp3lkyp8e8a .edge-pattern-solid{stroke-dasharray:0;}#mermaid-cp3lkyp8e8a .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-cp3lkyp8e8a .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-cp3lkyp8e8a .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-cp3lkyp8e8a .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-cp3lkyp8e8a .marker.cross{stroke:lightgrey;}#mermaid-cp3lkyp8e8a svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-cp3lkyp8e8a p{margin:0;}#mermaid-cp3lkyp8e8a .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-cp3lkyp8e8a .cluster-label text{fill:#F9FFFE;}#mermaid-cp3lkyp8e8a .cluster-label span{color:#F9FFFE;}#mermaid-cp3lkyp8e8a .cluster-label span p{background-color:transparent;}#mermaid-cp3lkyp8e8a .label text,#mermaid-cp3lkyp8e8a span{fill:#ccc;color:#ccc;}#mermaid-cp3lkyp8e8a .node rect,#mermaid-cp3lkyp8e8a .node circle,#mermaid-cp3lkyp8e8a .node ellipse,#mermaid-cp3lkyp8e8a .node polygon,#mermaid-cp3lkyp8e8a .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-cp3lkyp8e8a .rough-node .label text,#mermaid-cp3lkyp8e8a .node .label text,#mermaid-cp3lkyp8e8a .image-shape .label,#mermaid-cp3lkyp8e8a .icon-shape .label{text-anchor:middle;}#mermaid-cp3lkyp8e8a .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-cp3lkyp8e8a .rough-node .label,#mermaid-cp3lkyp8e8a .node .label,#mermaid-cp3lkyp8e8a .image-shape .label,#mermaid-cp3lkyp8e8a .icon-shape .label{text-align:center;}#mermaid-cp3lkyp8e8a .node.clickable{cursor:pointer;}#mermaid-cp3lkyp8e8a .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-cp3lkyp8e8a .arrowheadPath{fill:lightgrey;}#mermaid-cp3lkyp8e8a .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-cp3lkyp8e8a .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-cp3lkyp8e8a .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-cp3lkyp8e8a .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-cp3lkyp8e8a .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-cp3lkyp8e8a .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-cp3lkyp8e8a .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-cp3lkyp8e8a .cluster text{fill:#F9FFFE;}#mermaid-cp3lkyp8e8a .cluster span{color:#F9FFFE;}#mermaid-cp3lkyp8e8a div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-cp3lkyp8e8a .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-cp3lkyp8e8a rect.text{fill:none;stroke-width:0;}#mermaid-cp3lkyp8e8a .icon-shape,#mermaid-cp3lkyp8e8a .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-cp3lkyp8e8a .icon-shape p,#mermaid-cp3lkyp8e8a .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-cp3lkyp8e8a .icon-shape rect,#mermaid-cp3lkyp8e8a .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-cp3lkyp8e8a .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-cp3lkyp8e8a .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-cp3lkyp8e8a :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

test_PanicTrigger()

oracle.setPrice(2000) Above THRESHOLD

Assert: hook.panicMode() == false

oracle.setPrice(1000) Below THRESHOLD

Simulate sentinel.react() Call hook.setPanicMode(true)

Assert: hook.panicMode() == true

Key Logic Tested:

- Price threshold detection: `price < THRESHOLD` (1500 ETH)
- Cross-chain call simulation from Sentinel to Hook
- State transition from normal to panic mode

Sources: [contracts/README.md#93](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L93-L93)[contracts/src/AegisSentinel.sol#1-53](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/src/AegisSentinel.sol#L1-L53)

#### 4. Circuit Breaker Test

Purpose: Confirm that swaps are blocked when panic mode is active.

Test Flow:

#mermaid-r4i8f6uhyqk{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-r4i8f6uhyqk .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-r4i8f6uhyqk .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-r4i8f6uhyqk .error-icon{fill:#a44141;}#mermaid-r4i8f6uhyqk .error-text{fill:#ddd;stroke:#ddd;}#mermaid-r4i8f6uhyqk .edge-thickness-normal{stroke-width:1px;}#mermaid-r4i8f6uhyqk .edge-thickness-thick{stroke-width:3.5px;}#mermaid-r4i8f6uhyqk .edge-pattern-solid{stroke-dasharray:0;}#mermaid-r4i8f6uhyqk .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-r4i8f6uhyqk .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-r4i8f6uhyqk .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-r4i8f6uhyqk .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-r4i8f6uhyqk .marker.cross{stroke:lightgrey;}#mermaid-r4i8f6uhyqk svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-r4i8f6uhyqk p{margin:0;}#mermaid-r4i8f6uhyqk .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-r4i8f6uhyqk .cluster-label text{fill:#F9FFFE;}#mermaid-r4i8f6uhyqk .cluster-label span{color:#F9FFFE;}#mermaid-r4i8f6uhyqk .cluster-label span p{background-color:transparent;}#mermaid-r4i8f6uhyqk .label text,#mermaid-r4i8f6uhyqk span{fill:#ccc;color:#ccc;}#mermaid-r4i8f6uhyqk .node rect,#mermaid-r4i8f6uhyqk .node circle,#mermaid-r4i8f6uhyqk .node ellipse,#mermaid-r4i8f6uhyqk .node polygon,#mermaid-r4i8f6uhyqk .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-r4i8f6uhyqk .rough-node .label text,#mermaid-r4i8f6uhyqk .node .label text,#mermaid-r4i8f6uhyqk .image-shape .label,#mermaid-r4i8f6uhyqk .icon-shape .label{text-anchor:middle;}#mermaid-r4i8f6uhyqk .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-r4i8f6uhyqk .rough-node .label,#mermaid-r4i8f6uhyqk .node .label,#mermaid-r4i8f6uhyqk .image-shape .label,#mermaid-r4i8f6uhyqk .icon-shape .label{text-align:center;}#mermaid-r4i8f6uhyqk .node.clickable{cursor:pointer;}#mermaid-r4i8f6uhyqk .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-r4i8f6uhyqk .arrowheadPath{fill:lightgrey;}#mermaid-r4i8f6uhyqk .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-r4i8f6uhyqk .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-r4i8f6uhyqk .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-r4i8f6uhyqk .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-r4i8f6uhyqk .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-r4i8f6uhyqk .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-r4i8f6uhyqk .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-r4i8f6uhyqk .cluster text{fill:#F9FFFE;}#mermaid-r4i8f6uhyqk .cluster span{color:#F9FFFE;}#mermaid-r4i8f6uhyqk div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-r4i8f6uhyqk .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-r4i8f6uhyqk rect.text{fill:none;stroke-width:0;}#mermaid-r4i8f6uhyqk .icon-shape,#mermaid-r4i8f6uhyqk .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-r4i8f6uhyqk .icon-shape p,#mermaid-r4i8f6uhyqk .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-r4i8f6uhyqk .icon-shape rect,#mermaid-r4i8f6uhyqk .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-r4i8f6uhyqk .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-r4i8f6uhyqk .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-r4i8f6uhyqk :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

test_CircuitBreaker()

hook.setPanicMode(true) (as Sentinel)

Prepare PoolSwapTest.TestSettings

vm.expectRevert(PoolPaused.selector)

hook.beforeSwap() Simulate v4 swap

Verify: Swap reverted

Assertions:

- `beforeSwap()` reverts with `PoolPaused()` error when `panicMode == true`[src/AegisHook.sol#64-70](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol#L64-L70)
- Swaps execute normally when `panicMode == false`
- VIP Guardians bypass panic mode if their reputation meets threshold [src/AegisHook.sol#68-70](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol#L68-L70)

Sources: [contracts/README.md#94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L94-L94)[contracts/src/AegisHook.sol#64-70](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/src/AegisHook.sol#L64-L70)

---

## Test ExecutionLink copied!

### Local Test ExecutionLink copied!

Basic Test Run:

```
forge test
```

Verbose Output (Recommended):

```
forge test -vvv
```

Verbosity levels:

- `-v`: Show test names
- `-vv`: Show test names and failure details
- `-vvv`: Show test names, failure details, and stack traces
- `-vvvv`: Show test names, failure details, stack traces, and setup traces

Filter by Contract:

```
forge test --match-contract AegisIntegrationTest -vv
```

Filter by Test Name:

```
forge test --match-test test_CircuitBreaker -vvv
```

Generate Gas Report:

```
forge test --gas-report
```

Sources: [contracts/README.md#81-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L81-L83)[contracts/.github/workflows/test.yml#31-34](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L31-L34)

### Test Execution FlowLink copied!

#mermaid-xrxs9mj7c07{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-xrxs9mj7c07 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-xrxs9mj7c07 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-xrxs9mj7c07 .error-icon{fill:#a44141;}#mermaid-xrxs9mj7c07 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-xrxs9mj7c07 .edge-thickness-normal{stroke-width:1px;}#mermaid-xrxs9mj7c07 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-xrxs9mj7c07 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-xrxs9mj7c07 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-xrxs9mj7c07 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-xrxs9mj7c07 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-xrxs9mj7c07 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-xrxs9mj7c07 .marker.cross{stroke:lightgrey;}#mermaid-xrxs9mj7c07 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-xrxs9mj7c07 p{margin:0;}#mermaid-xrxs9mj7c07 .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-xrxs9mj7c07 .cluster-label text{fill:#F9FFFE;}#mermaid-xrxs9mj7c07 .cluster-label span{color:#F9FFFE;}#mermaid-xrxs9mj7c07 .cluster-label span p{background-color:transparent;}#mermaid-xrxs9mj7c07 .label text,#mermaid-xrxs9mj7c07 span{fill:#ccc;color:#ccc;}#mermaid-xrxs9mj7c07 .node rect,#mermaid-xrxs9mj7c07 .node circle,#mermaid-xrxs9mj7c07 .node ellipse,#mermaid-xrxs9mj7c07 .node polygon,#mermaid-xrxs9mj7c07 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-xrxs9mj7c07 .rough-node .label text,#mermaid-xrxs9mj7c07 .node .label text,#mermaid-xrxs9mj7c07 .image-shape .label,#mermaid-xrxs9mj7c07 .icon-shape .label{text-anchor:middle;}#mermaid-xrxs9mj7c07 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-xrxs9mj7c07 .rough-node .label,#mermaid-xrxs9mj7c07 .node .label,#mermaid-xrxs9mj7c07 .image-shape .label,#mermaid-xrxs9mj7c07 .icon-shape .label{text-align:center;}#mermaid-xrxs9mj7c07 .node.clickable{cursor:pointer;}#mermaid-xrxs9mj7c07 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-xrxs9mj7c07 .arrowheadPath{fill:lightgrey;}#mermaid-xrxs9mj7c07 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-xrxs9mj7c07 .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-xrxs9mj7c07 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-xrxs9mj7c07 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-xrxs9mj7c07 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-xrxs9mj7c07 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-xrxs9mj7c07 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-xrxs9mj7c07 .cluster text{fill:#F9FFFE;}#mermaid-xrxs9mj7c07 .cluster span{color:#F9FFFE;}#mermaid-xrxs9mj7c07 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-xrxs9mj7c07 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-xrxs9mj7c07 rect.text{fill:none;stroke-width:0;}#mermaid-xrxs9mj7c07 .icon-shape,#mermaid-xrxs9mj7c07 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-xrxs9mj7c07 .icon-shape p,#mermaid-xrxs9mj7c07 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-xrxs9mj7c07 .icon-shape rect,#mermaid-xrxs9mj7c07 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-xrxs9mj7c07 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-xrxs9mj7c07 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-xrxs9mj7c07 :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Yes

No

forge test

Compile contracts forge build

Discover test files *.t.sol pattern

Run setUp() in each test contract

Execute test functions test_* pattern

Generate test report PASS/FAIL status

Optional: Gas report --gas-report

Test Failed?

Show failure trace based on verbosity

Test Contract Discovery Rules:

1. Files ending in `.t.sol` in the `test/` directory
2. Contracts inheriting from `Test` (forge-std)
3. Functions starting with `test` prefix
4. Optional `setUp()` function runs before each test
5. Optional `invariant_*` functions for fuzz testing

Sources: [contracts/.github/workflows/test.yml#26-34](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L26-L34)

---

## Coverage StrategyLink copied!

### What Is TestedLink copied!

The Aegis test suite prioritizes critical path coverage over exhaustive coverage. The focus is on validating that the circuit breaker functionality works correctly under both normal and crisis scenarios.

Coverage Priority Matrix:

ComponentCoverage FocusRationale`AegisHook.beforeSwap()`✅ HighCore gating mechanism - must never fail`AegisHook.setPanicMode()`✅ HighSingle point of control - must be secure`AegisSentinel.react()`✅ HighAutonomous trigger - must detect crashes accurately`MockOracle.setPrice()`✅ MediumSimulation only - production uses Chainlink`AegisGuardianRegistry` reputation logic✅ MediumGamification layer - enhances but not criticalHook deployment salt mining⚠️ LowOne-time operation - manual verification sufficient

### Cross-Chain Simulation LimitationsLink copied!

Testing Challenge: Aegis operates across three blockchains (Ethereum L1, Reactive Network, Unichain L2). True cross-chain testing requires deployed contracts on live testnets.

Testing Approach:

#mermaid-tuhtxw4umc{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-tuhtxw4umc .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-tuhtxw4umc .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-tuhtxw4umc .error-icon{fill:#a44141;}#mermaid-tuhtxw4umc .error-text{fill:#ddd;stroke:#ddd;}#mermaid-tuhtxw4umc .edge-thickness-normal{stroke-width:1px;}#mermaid-tuhtxw4umc .edge-thickness-thick{stroke-width:3.5px;}#mermaid-tuhtxw4umc .edge-pattern-solid{stroke-dasharray:0;}#mermaid-tuhtxw4umc .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-tuhtxw4umc .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-tuhtxw4umc .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-tuhtxw4umc .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-tuhtxw4umc .marker.cross{stroke:lightgrey;}#mermaid-tuhtxw4umc svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-tuhtxw4umc p{margin:0;}#mermaid-tuhtxw4umc .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-tuhtxw4umc .cluster-label text{fill:#F9FFFE;}#mermaid-tuhtxw4umc .cluster-label span{color:#F9FFFE;}#mermaid-tuhtxw4umc .cluster-label span p{background-color:transparent;}#mermaid-tuhtxw4umc .label text,#mermaid-tuhtxw4umc span{fill:#ccc;color:#ccc;}#mermaid-tuhtxw4umc .node rect,#mermaid-tuhtxw4umc .node circle,#mermaid-tuhtxw4umc .node ellipse,#mermaid-tuhtxw4umc .node polygon,#mermaid-tuhtxw4umc .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-tuhtxw4umc .rough-node .label text,#mermaid-tuhtxw4umc .node .label text,#mermaid-tuhtxw4umc .image-shape .label,#mermaid-tuhtxw4umc .icon-shape .label{text-anchor:middle;}#mermaid-tuhtxw4umc .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-tuhtxw4umc .rough-node .label,#mermaid-tuhtxw4umc .node .label,#mermaid-tuhtxw4umc .image-shape .label,#mermaid-tuhtxw4umc .icon-shape .label{text-align:center;}#mermaid-tuhtxw4umc .node.clickable{cursor:pointer;}#mermaid-tuhtxw4umc .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-tuhtxw4umc .arrowheadPath{fill:lightgrey;}#mermaid-tuhtxw4umc .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-tuhtxw4umc .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-tuhtxw4umc .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-tuhtxw4umc .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-tuhtxw4umc .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-tuhtxw4umc .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-tuhtxw4umc .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-tuhtxw4umc .cluster text{fill:#F9FFFE;}#mermaid-tuhtxw4umc .cluster span{color:#F9FFFE;}#mermaid-tuhtxw4umc div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-tuhtxw4umc .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-tuhtxw4umc rect.text{fill:none;stroke-width:0;}#mermaid-tuhtxw4umc .icon-shape,#mermaid-tuhtxw4umc .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-tuhtxw4umc .icon-shape p,#mermaid-tuhtxw4umc .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-tuhtxw4umc .icon-shape rect,#mermaid-tuhtxw4umc .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-tuhtxw4umc .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-tuhtxw4umc .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-tuhtxw4umc :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Testnet Validation

Local Testing (forge test)

Unit Tests Individual contract logic

Integration Tests Multi-contract simulation

Deployed MockOracle Sepolia L1

Deployed AegisSentinel Reactive Network

Deployed AegisHook Unichain L2

Local: Prove logic correctness

Testnet: Prove cross-chain messaging

Local Test Limitations:

- Cannot test actual cross-chain message passing
- Reactive Network's event subscription system not simulated
- Network latency and block time differences not modeled

Mitigation: The test suite simulates the Sentinel's logic by directly calling `hook.setPanicMode()` as if it were the Sentinel. This proves the state transition logic while accepting that true cross-chain connectivity must be validated on live testnets.

Sources: [contracts/README.md#59-68](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L59-L68)[contracts/README.md#97-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L97-L122)

### Test Data and ScenariosLink copied!

Price Scenarios Tested:

ScenarioInitial PriceCrash PriceThresholdExpected BehaviorNormal operation2000 ETH-1500 ETHNo panic mode activationModerate drop2000 ETH1600 ETH1500 ETHNo panic mode activationThreshold boundary2000 ETH1500 ETH1500 ETHEdge case - implementation specificSevere crash2000 ETH1000 ETH1500 ETHPanic mode activatedRecovery1000 ETH1800 ETH1500 ETHPanic mode deactivated

Guardian Reputation Scenarios:

ScenarioGuardian ReputationPanic Mode ActiveExpected BehaviorLow-rep Guardian50YesSwap reverts with `PoolPaused()`High-rep Guardian95YesSwap executes (VIP lane)High-rep Guardian95NoSwap executes (normal fee)

Sources: [contracts/src/AegisHook.sol#64-70](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/src/AegisHook.sol#L64-L70)[contracts/README.md#85-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L85-L94)

---

## Test MaintenanceLink copied!

### Test Data ManagementLink copied!

Deterministic Testing: The `MockOracle` provides deterministic price updates, ensuring test reproducibility. Each test begins with a known initial state established in the `setUp()` function.

No External Dependencies: Tests do not rely on external APIs or live price feeds. All price data is controlled within the test environment.

### Continuous ValidationLink copied!

Tests are automatically executed in the CI/CD pipeline (see [CI/CD Pipelines](#6.2)) on:

- Every pull request (commented out in current workflow)
- Manual workflow dispatch via GitHub Actions
- Before deployment to testnets (manual verification)

The CI environment uses the `FOUNDRY_PROFILE=ci` configuration defined in [foundry.toml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml) to ensure consistent test execution.

Sources: [contracts/.github/workflows/test.yml#8-34](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L8-L34)

---

## Testing the Reputation SystemLink copied!

The Guardian Registry introduces additional complexity due to its dual compliance with ERC-721 (NFT) and ERC-8004 (Trustless Agents) standards. Testing focuses on:

ERC-721 Compliance:

- NFT minting for new Guardians
- Ownership queries
- Transfer restrictions (if any)

ERC-8004 Compliance:

- Intervention recording via `recordHeroicIntervention()`[src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol)
- Reputation score updates
- Feedback event emissions for Sentinel consumption

Cross-Chain Reputation Sync:

- `NewFeedback` event detection by Sentinel
- Automatic reputation boost via `BOOST_REP` operation
- L2 reputation cache updates in `AegisHook`

Sources: [contracts/README.md#52-57](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L52-L57)

---

## SummaryLink copied!

The Aegis testing strategy employs a hybrid approach:

1. Unit tests prove individual contract correctness in isolation
2. Integration tests validate multi-contract interactions within a simulated environment
3. Testnet deployments confirm cross-chain messaging functionality
4. Critical path coverage prioritizes the circuit breaker flow over edge cases

This strategy balances thoroughness with development velocity, ensuring that the core protection mechanism—blocking swaps during market crashes—is rigorously validated before deployment.

For deployment verification procedures and testnet validation steps, see [Deployment Verification](#5.5).

Sources: [contracts/README.md#79-94](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/README.md#L79-L94)[contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)

---

# CI-CD-Pipelines

# CI/CD PipelinesLink copied!
Relevant source files
- [contracts/.github/workflows/test.yml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml)
- [contracts/lib/forge-std/.github/workflows/ci.yml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml)
- [contracts/lib/forge-std/.github/workflows/sync.yml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/sync.yml)

## Purpose and ScopeLink copied!

This document describes the continuous integration and continuous deployment (CI/CD) infrastructure for the Aegis system. It covers the GitHub Actions workflows that automate building, testing, and validation of smart contracts across the multi-chain architecture. For information about test structure and coverage strategy, see [Testing Strategy](#6.1). For deployment procedures, see [Deployment Overview](#5.1).

## CI/CD Architecture OverviewLink copied!

The Aegis project employs a two-tier CI/CD structure:

1. Primary Aegis Workflows: Focused on contract compilation and integration testing
2. Dependency Workflows: Maintained by forge-std library for broader compatibility testing

All workflows leverage the Foundry toolchain (`forge`, `anvil`, `cast`) and execute within GitHub Actions runners.

#mermaid-qw8i8b3s4wb{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-qw8i8b3s4wb .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-qw8i8b3s4wb .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-qw8i8b3s4wb .error-icon{fill:#a44141;}#mermaid-qw8i8b3s4wb .error-text{fill:#ddd;stroke:#ddd;}#mermaid-qw8i8b3s4wb .edge-thickness-normal{stroke-width:1px;}#mermaid-qw8i8b3s4wb .edge-thickness-thick{stroke-width:3.5px;}#mermaid-qw8i8b3s4wb .edge-pattern-solid{stroke-dasharray:0;}#mermaid-qw8i8b3s4wb .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-qw8i8b3s4wb .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-qw8i8b3s4wb .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-qw8i8b3s4wb .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-qw8i8b3s4wb .marker.cross{stroke:lightgrey;}#mermaid-qw8i8b3s4wb svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-qw8i8b3s4wb p{margin:0;}#mermaid-qw8i8b3s4wb .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-qw8i8b3s4wb .cluster-label text{fill:#F9FFFE;}#mermaid-qw8i8b3s4wb .cluster-label span{color:#F9FFFE;}#mermaid-qw8i8b3s4wb .cluster-label span p{background-color:transparent;}#mermaid-qw8i8b3s4wb .label text,#mermaid-qw8i8b3s4wb span{fill:#ccc;color:#ccc;}#mermaid-qw8i8b3s4wb .node rect,#mermaid-qw8i8b3s4wb .node circle,#mermaid-qw8i8b3s4wb .node ellipse,#mermaid-qw8i8b3s4wb .node polygon,#mermaid-qw8i8b3s4wb .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-qw8i8b3s4wb .rough-node .label text,#mermaid-qw8i8b3s4wb .node .label text,#mermaid-qw8i8b3s4wb .image-shape .label,#mermaid-qw8i8b3s4wb .icon-shape .label{text-anchor:middle;}#mermaid-qw8i8b3s4wb .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-qw8i8b3s4wb .rough-node .label,#mermaid-qw8i8b3s4wb .node .label,#mermaid-qw8i8b3s4wb .image-shape .label,#mermaid-qw8i8b3s4wb .icon-shape .label{text-align:center;}#mermaid-qw8i8b3s4wb .node.clickable{cursor:pointer;}#mermaid-qw8i8b3s4wb .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-qw8i8b3s4wb .arrowheadPath{fill:lightgrey;}#mermaid-qw8i8b3s4wb .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-qw8i8b3s4wb .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-qw8i8b3s4wb .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-qw8i8b3s4wb .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-qw8i8b3s4wb .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-qw8i8b3s4wb .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-qw8i8b3s4wb .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-qw8i8b3s4wb .cluster text{fill:#F9FFFE;}#mermaid-qw8i8b3s4wb .cluster span{color:#F9FFFE;}#mermaid-qw8i8b3s4wb div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-qw8i8b3s4wb .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-qw8i8b3s4wb rect.text{fill:none;stroke-width:0;}#mermaid-qw8i8b3s4wb .icon-shape,#mermaid-qw8i8b3s4wb .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-qw8i8b3s4wb .icon-shape p,#mermaid-qw8i8b3s4wb .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-qw8i8b3s4wb .icon-shape rect,#mermaid-qw8i8b3s4wb .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-qw8i8b3s4wb .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-qw8i8b3s4wb .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-qw8i8b3s4wb :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Validation Steps

GitHub Actions Infrastructure

Forge-std Workflows

Aegis Workflows

GitHub Repository

Triggers

Triggers

On Release

contracts/

contracts/lib/forge-std/

test.yml Manual Trigger Only

ci.yml Build + Test + Fmt

sync.yml Release Branch Sync

ubuntu-latest Runner

foundry-rs/foundry-toolchain@v1

actions/checkout@v4

forge build

forge test

forge fmt --check

crate-ci/typos@v1

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)[contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)[contracts/lib/forge-std/.github/workflows/sync.yml#1-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/sync.yml#L1-L32)

---

## Aegis Test WorkflowLink copied!

### Workflow ConfigurationLink copied!

The primary Aegis test workflow is defined in `test.yml` and executes a complete build-test cycle for all contracts in the system.

PropertyValueFile Path`contracts/.github/workflows/test.yml`Trigger`workflow_dispatch` (manual only)Runner OS`ubuntu-latest`Foundry Profile`ci` (set via `FOUNDRY_PROFILE` env var)TimeoutNot specified (default)

### Workflow StepsLink copied!

"Foundry Toolchain""ubuntu-latest""GitHub Actions""Developer""Foundry Toolchain""ubuntu-latest""GitHub Actions""Developer"#mermaid-km0wp7acpg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-km0wp7acpg .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-km0wp7acpg .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-km0wp7acpg .error-icon{fill:#a44141;}#mermaid-km0wp7acpg .error-text{fill:#ddd;stroke:#ddd;}#mermaid-km0wp7acpg .edge-thickness-normal{stroke-width:1px;}#mermaid-km0wp7acpg .edge-thickness-thick{stroke-width:3.5px;}#mermaid-km0wp7acpg .edge-pattern-solid{stroke-dasharray:0;}#mermaid-km0wp7acpg .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-km0wp7acpg .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-km0wp7acpg .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-km0wp7acpg .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-km0wp7acpg .marker.cross{stroke:lightgrey;}#mermaid-km0wp7acpg svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-km0wp7acpg p{margin:0;}#mermaid-km0wp7acpg .actor{stroke:#ccc;fill:#1f2020;}#mermaid-km0wp7acpg text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-km0wp7acpg .actor-line{stroke:#ccc;}#mermaid-km0wp7acpg .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-km0wp7acpg .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-km0wp7acpg .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-km0wp7acpg #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-km0wp7acpg .sequenceNumber{fill:black;}#mermaid-km0wp7acpg #sequencenumber{fill:lightgrey;}#mermaid-km0wp7acpg #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-km0wp7acpg .messageText{fill:lightgrey;stroke:none;}#mermaid-km0wp7acpg .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-km0wp7acpg .labelText,#mermaid-km0wp7acpg .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-km0wp7acpg .loopText,#mermaid-km0wp7acpg .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-km0wp7acpg .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-km0wp7acpg .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-km0wp7acpg .noteText,#mermaid-km0wp7acpg .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-km0wp7acpg .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-km0wp7acpg .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-km0wp7acpg .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-km0wp7acpg .actorPopupMenu{position:absolute;}#mermaid-km0wp7acpg .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-km0wp7acpg .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-km0wp7acpg .actor-man circle,#mermaid-km0wp7acpg line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-km0wp7acpg :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}"Checks out lib/forge-std, lib/uniswap-hooks, etc.""Compile all contracts Report contract sizes""Execute test suite Verbose logging level 3""Trigger workflow_dispatch""Allocate runner""actions/checkout@v4 with submodules: recursive""foundry-rs/foundry-toolchain@v1 version: stable""Install forge, anvil, cast""forge --version""Display toolchain version""forge build --sizes""Build artifacts + size report""forge test -vvv""Test results""Report success/failure""Workflow complete"

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)

### Environment ConfigurationLink copied!

The workflow sets the Foundry profile to `ci` via environment variable [contracts/.github/workflows/test.yml#8-9](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L8-L9):

```
env:
  FOUNDRY_PROFILE: ci
```

This references the `[profile.ci]` section in `foundry.toml`, which may contain CI-specific optimizations (e.g., reduced optimizer runs, specific solc versions).

### Job BreakdownLink copied!

#### Job: `test`

Step 1: Checkout

- Action: `actions/checkout@v4`
- Configuration: `submodules: recursive`
- Purpose: Clones the Aegis repository and all git submodules (forge-std, uniswap-hooks, system-smart-contracts)

[contracts/.github/workflows/test.yml#16-18](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L16-L18)

#### Step 2: Install Foundry

- Action: `foundry-rs/foundry-toolchain@v1`
- Version: `stable`
- Purpose: Installs the latest stable Foundry release (forge, anvil, cast)

[contracts/.github/workflows/test.yml#20-23](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L20-L23)

#### Step 3: Build

- Command: `forge build --sizes`
- ID: `build`
- Purpose: Compiles all Solidity contracts and reports compiled bytecode sizes (critical for deployment gas analysis)

[contracts/.github/workflows/test.yml#25-29](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L25-L29)

#### Step 4: Test

- Command: `forge test -vvv`
- ID: `test`
- Verbosity: Level 3 (displays detailed traces, including failing test stack traces)
- Purpose: Executes all test files in `test/` directory

[contracts/.github/workflows/test.yml#31-34](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L31-L34)

### Trigger MechanismLink copied!

The workflow uses manual dispatch only[contracts/.github/workflows/test.yml#3-6](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L3-L6) Automated triggers for push and pull requests are commented out:

```
on:
  workflow_dispatch:
  # push:
  # pull_request:
```

This suggests the workflow is:

1. In development/configuration phase
2. Intended for on-demand validation
3. Not yet integrated into standard PR review process

Recommendation: Enable `pull_request` trigger once testnet stability improves to ensure all PRs are validated before merge.

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)

---

## Forge-std Dependency WorkflowsLink copied!

The Aegis project depends on `forge-std` (Foundry Standard Library), which maintains its own CI/CD pipelines. These workflows execute independently but validate the integrity of the dependency chain.

### CI Workflow (ci.yml)Link copied!

The forge-std CI workflow is significantly more comprehensive than Aegis's primary workflow, testing multiple Solidity compiler versions and compilation strategies.

#mermaid-31jylq0mfvq{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-31jylq0mfvq .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-31jylq0mfvq .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-31jylq0mfvq .error-icon{fill:#a44141;}#mermaid-31jylq0mfvq .error-text{fill:#ddd;stroke:#ddd;}#mermaid-31jylq0mfvq .edge-thickness-normal{stroke-width:1px;}#mermaid-31jylq0mfvq .edge-thickness-thick{stroke-width:3.5px;}#mermaid-31jylq0mfvq .edge-pattern-solid{stroke-dasharray:0;}#mermaid-31jylq0mfvq .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-31jylq0mfvq .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-31jylq0mfvq .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-31jylq0mfvq .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-31jylq0mfvq .marker.cross{stroke:lightgrey;}#mermaid-31jylq0mfvq svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-31jylq0mfvq p{margin:0;}#mermaid-31jylq0mfvq .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-31jylq0mfvq .cluster-label text{fill:#F9FFFE;}#mermaid-31jylq0mfvq .cluster-label span{color:#F9FFFE;}#mermaid-31jylq0mfvq .cluster-label span p{background-color:transparent;}#mermaid-31jylq0mfvq .label text,#mermaid-31jylq0mfvq span{fill:#ccc;color:#ccc;}#mermaid-31jylq0mfvq .node rect,#mermaid-31jylq0mfvq .node circle,#mermaid-31jylq0mfvq .node ellipse,#mermaid-31jylq0mfvq .node polygon,#mermaid-31jylq0mfvq .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-31jylq0mfvq .rough-node .label text,#mermaid-31jylq0mfvq .node .label text,#mermaid-31jylq0mfvq .image-shape .label,#mermaid-31jylq0mfvq .icon-shape .label{text-anchor:middle;}#mermaid-31jylq0mfvq .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-31jylq0mfvq .rough-node .label,#mermaid-31jylq0mfvq .node .label,#mermaid-31jylq0mfvq .image-shape .label,#mermaid-31jylq0mfvq .icon-shape .label{text-align:center;}#mermaid-31jylq0mfvq .node.clickable{cursor:pointer;}#mermaid-31jylq0mfvq .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-31jylq0mfvq .arrowheadPath{fill:lightgrey;}#mermaid-31jylq0mfvq .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-31jylq0mfvq .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-31jylq0mfvq .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-31jylq0mfvq .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-31jylq0mfvq .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-31jylq0mfvq .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-31jylq0mfvq .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-31jylq0mfvq .cluster text{fill:#F9FFFE;}#mermaid-31jylq0mfvq .cluster span{color:#F9FFFE;}#mermaid-31jylq0mfvq div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-31jylq0mfvq .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-31jylq0mfvq rect.text{fill:none;stroke-width:0;}#mermaid-31jylq0mfvq .icon-shape,#mermaid-31jylq0mfvq .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-31jylq0mfvq .icon-shape p,#mermaid-31jylq0mfvq .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-31jylq0mfvq .icon-shape rect,#mermaid-31jylq0mfvq .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-31jylq0mfvq .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-31jylq0mfvq .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-31jylq0mfvq :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Job: ci-success

Job: typos

Job: fmt

Job: test

Job: build

Trigger Events

workflow_dispatch

pull_request

push to master

Matrix Strategy toolchain: [stable, nightly] flags: 9 configurations

1. Checkout 2. Install Foundry 3. forge build --skip test

Conditional: if via-ir forge build compilation tests

Matrix Strategy toolchain: [stable, nightly]

1. Checkout 2. Install Foundry 3. forge test -vvv

1. Checkout 2. Install Foundry 3. forge fmt --check

1. Checkout 2. crate-ci/typos@v1

re-actors/alls-green@release/v1 Requires: build, test, fmt, typos

Sources: [contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

#### Build Job Matrix

The `build` job uses a matrix strategy to test 18 configurations (2 toolchains × 9 flag sets) [contracts/lib/forge-std/.github/workflows/ci.yml#12-36](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L12-L36):

ToolchainFlagsPurposestable(empty)Default compilationstable`--via-ir`Intermediate representation optimizationstable`--use solc:0.8.17 --via-ir`Solc 0.8.17 with IRstable`--use solc:0.8.17`Solc 0.8.17 standardstable`--use solc:0.8.0`Solc 0.8.0 compatibilitystable`--use solc:0.7.6`Solc 0.7.6 compatibilitystable`--use solc:0.7.0`Solc 0.7.0 compatibilitystable`--use solc:0.6.2`Solc 0.6.2 compatibilitystable`--use solc:0.6.12`Solc 0.6.12 compatibilitynightly(same 9 configurations)Repeated with nightly Foundry

This ensures forge-std works across a wide range of Solidity versions and compilation modes.

#### Test Job

The `test` job runs the forge-std test suite against both stable and nightly Foundry versions [contracts/lib/forge-std/.github/workflows/ci.yml#38-51](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L38-L51):

```
test:
  runs-on: ubuntu-latest
  strategy:
    fail-fast: false
    matrix:
      toolchain: [stable, nightly]
  steps:
    - uses: actions/checkout@v4
    - uses: foundry-rs/foundry-toolchain@v1
      with:
        version: ${{ matrix.toolchain }}
    - run: forge test -vvv
```

#### Format Job

The `fmt` job validates code formatting compliance [contracts/lib/forge-std/.github/workflows/ci.yml#53-60](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L53-L60):

```
fmt:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    - uses: foundry-rs/foundry-toolchain@v1
    - run: forge fmt --check
```

If formatting violations are detected, the job fails. Developers must run `forge fmt` locally to fix.

#### Typos Job

The `typos` job scans for common spelling errors using the `crate-ci/typos` action [contracts/lib/forge-std/.github/workflows/ci.yml#62-67](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L62-L67):

```
typos:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    - uses: crate-ci/typos@v1
```

#### CI Success Aggregator

The `ci-success` job acts as a status check aggregator, requiring all previous jobs to pass [contracts/lib/forge-std/.github/workflows/ci.yml#69-82](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L69-L82):

```
ci-success:
  runs-on: ubuntu-latest
  if: always()
  needs:
    - build
    - test
    - fmt
    - typos
  steps:
    - name: Decide whether the needed jobs succeeded or failed
      uses: re-actors/alls-green@release/v1
      with:
        jobs: ${{ toJSON(needs) }}
```

This provides a single status check for branch protection rules.

Sources: [contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

### Sync Workflow (sync.yml)Link copied!

The sync workflow automatically updates the `v1` branch when a new release is published [contracts/lib/forge-std/.github/workflows/sync.yml#1-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/sync.yml#L1-L32):

"v1 Branch""sync-release-branch Job"GitHubMaintainer"v1 Branch""sync-release-branch Job"GitHubMaintainer#mermaid-tw0mqfc873s{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-tw0mqfc873s .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-tw0mqfc873s .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-tw0mqfc873s .error-icon{fill:#a44141;}#mermaid-tw0mqfc873s .error-text{fill:#ddd;stroke:#ddd;}#mermaid-tw0mqfc873s .edge-thickness-normal{stroke-width:1px;}#mermaid-tw0mqfc873s .edge-thickness-thick{stroke-width:3.5px;}#mermaid-tw0mqfc873s .edge-pattern-solid{stroke-dasharray:0;}#mermaid-tw0mqfc873s .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-tw0mqfc873s .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-tw0mqfc873s .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-tw0mqfc873s .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-tw0mqfc873s .marker.cross{stroke:lightgrey;}#mermaid-tw0mqfc873s svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-tw0mqfc873s p{margin:0;}#mermaid-tw0mqfc873s .actor{stroke:#ccc;fill:#1f2020;}#mermaid-tw0mqfc873s text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-tw0mqfc873s .actor-line{stroke:#ccc;}#mermaid-tw0mqfc873s .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-tw0mqfc873s .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-tw0mqfc873s .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-tw0mqfc873s #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-tw0mqfc873s .sequenceNumber{fill:black;}#mermaid-tw0mqfc873s #sequencenumber{fill:lightgrey;}#mermaid-tw0mqfc873s #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-tw0mqfc873s .messageText{fill:lightgrey;stroke:none;}#mermaid-tw0mqfc873s .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-tw0mqfc873s .labelText,#mermaid-tw0mqfc873s .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-tw0mqfc873s .loopText,#mermaid-tw0mqfc873s .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-tw0mqfc873s .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-tw0mqfc873s .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-tw0mqfc873s .noteText,#mermaid-tw0mqfc873s .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-tw0mqfc873s .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-tw0mqfc873s .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-tw0mqfc873s .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-tw0mqfc873s .actorPopupMenu{position:absolute;}#mermaid-tw0mqfc873s .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-tw0mqfc873s .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-tw0mqfc873s .actor-man circle,#mermaid-tw0mqfc873s line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-tw0mqfc873s :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}alt["Tag starts with v1"]["Tag does not start with v1"]"Create release v1.x.x""Trigger on: release.created""Check: startsWith(tag | 'v1')""Checkout v1 branch""git config user.name/email github-actions[bot]""git fetch --tags""git reset --hard $GITHUB_REF""git push --force""v1 branch updated""Skip sync"

This workflow is specific to forge-std's versioning strategy and does not directly impact Aegis development.

Sources: [contracts/lib/forge-std/.github/workflows/sync.yml#1-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/sync.yml#L1-L32)

---

## Workflow Configuration DetailsLink copied!

### Foundry Profile SelectionLink copied!

The `FOUNDRY_PROFILE` environment variable controls which configuration section from `foundry.toml` is used during CI execution. In Aegis, this is set to `ci`[contracts/.github/workflows/test.yml#8-9](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L8-L9)

Typical CI profile settings might include:

- Reduced optimizer runs for faster compilation
- Specific Solidity version constraints
- Increased verbosity for debugging
- Custom test flags

### Submodule HandlingLink copied!

All workflows use `actions/checkout@v4` with `submodules: recursive` to ensure dependencies are cloned [contracts/.github/workflows/test.yml#16-18](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L16-L18):

```
- uses: actions/checkout@v4
  with:
    submodules: recursive
```

This is critical because Aegis depends on:

- `lib/forge-std` (testing framework)
- `lib/uniswap-hooks` (Uniswap V4 interfaces)
- `lib/system-smart-contracts` (Reactive Network contracts)

Without recursive submodule checkout, imports like `IHooks` and `AbstractReactive` would fail.

### Timeout ConfigurationLink copied!

The forge-std CI workflow sets explicit timeouts [contracts/lib/forge-std/.github/workflows/ci.yml#14](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L14-L14):

```
timeout-minutes: 10
```

The Aegis workflow does not specify timeouts, using GitHub Actions' default (360 minutes). Consider adding a timeout to prevent hung builds.

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)[contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

---

## Trigger PatternsLink copied!

### Current StateLink copied!

WorkflowManualPushPull RequestReleaseAegis `test.yml`✅❌ (commented)❌ (commented)❌forge-std `ci.yml`✅✅ (master only)✅❌forge-std `sync.yml`❌❌❌✅

The Aegis workflow is intentionally limited to manual triggers, likely due to:

1. Testnet Instability: The hybrid relayer documentation mentions testnet connectivity issues
2. Development Phase: The project is still in active development
3. Cost Concerns: Automated CI runs consume GitHub Actions minutes

### Recommended Production ConfigurationLink copied!

For production readiness, enable automated triggers [contracts/.github/workflows/test.yml#3-6](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L3-L6):

```
on:
  workflow_dispatch:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
```

This ensures:

- All PRs are tested before merge
- Main branch integrity is validated on every push
- Manual triggers remain available for ad-hoc testing

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)[contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

---

## CI/CD Workflow Execution FlowLink copied!

The following diagram illustrates the complete execution flow when a developer triggers the Aegis test workflow:

#mermaid-zmb2qj3ixn{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-zmb2qj3ixn .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-zmb2qj3ixn .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-zmb2qj3ixn .error-icon{fill:#a44141;}#mermaid-zmb2qj3ixn .error-text{fill:#ddd;stroke:#ddd;}#mermaid-zmb2qj3ixn .edge-thickness-normal{stroke-width:1px;}#mermaid-zmb2qj3ixn .edge-thickness-thick{stroke-width:3.5px;}#mermaid-zmb2qj3ixn .edge-pattern-solid{stroke-dasharray:0;}#mermaid-zmb2qj3ixn .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-zmb2qj3ixn .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-zmb2qj3ixn .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-zmb2qj3ixn .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-zmb2qj3ixn .marker.cross{stroke:lightgrey;}#mermaid-zmb2qj3ixn svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-zmb2qj3ixn p{margin:0;}#mermaid-zmb2qj3ixn .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-zmb2qj3ixn .cluster-label text{fill:#F9FFFE;}#mermaid-zmb2qj3ixn .cluster-label span{color:#F9FFFE;}#mermaid-zmb2qj3ixn .cluster-label span p{background-color:transparent;}#mermaid-zmb2qj3ixn .label text,#mermaid-zmb2qj3ixn span{fill:#ccc;color:#ccc;}#mermaid-zmb2qj3ixn .node rect,#mermaid-zmb2qj3ixn .node circle,#mermaid-zmb2qj3ixn .node ellipse,#mermaid-zmb2qj3ixn .node polygon,#mermaid-zmb2qj3ixn .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-zmb2qj3ixn .rough-node .label text,#mermaid-zmb2qj3ixn .node .label text,#mermaid-zmb2qj3ixn .image-shape .label,#mermaid-zmb2qj3ixn .icon-shape .label{text-anchor:middle;}#mermaid-zmb2qj3ixn .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-zmb2qj3ixn .rough-node .label,#mermaid-zmb2qj3ixn .node .label,#mermaid-zmb2qj3ixn .image-shape .label,#mermaid-zmb2qj3ixn .icon-shape .label{text-align:center;}#mermaid-zmb2qj3ixn .node.clickable{cursor:pointer;}#mermaid-zmb2qj3ixn .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-zmb2qj3ixn .arrowheadPath{fill:lightgrey;}#mermaid-zmb2qj3ixn .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-zmb2qj3ixn .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-zmb2qj3ixn .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-zmb2qj3ixn .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-zmb2qj3ixn .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-zmb2qj3ixn .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-zmb2qj3ixn .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-zmb2qj3ixn .cluster text{fill:#F9FFFE;}#mermaid-zmb2qj3ixn .cluster span{color:#F9FFFE;}#mermaid-zmb2qj3ixn div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-zmb2qj3ixn .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-zmb2qj3ixn rect.text{fill:none;stroke-width:0;}#mermaid-zmb2qj3ixn .icon-shape,#mermaid-zmb2qj3ixn .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-zmb2qj3ixn .icon-shape p,#mermaid-zmb2qj3ixn .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-zmb2qj3ixn .icon-shape rect,#mermaid-zmb2qj3ixn .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-zmb2qj3ixn .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-zmb2qj3ixn .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-zmb2qj3ixn :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Yes

No

Yes

No

Yes

No

Developer triggers workflow_dispatch

GitHub Actions allocates ubuntu-latest runner

actions/checkout@v4 Clone repo + submodules

Submodules cloned?

foundry-rs/foundry-toolchain@v1 Install Foundry stable

forge --version Display version

forge build --sizes Compile contracts

Build successful?

forge test -vvv Execute test suite

Tests passed?

Report SUCCESS to GitHub

Report FAILURE to GitHub

Workflow complete

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)

---

## Integration with Development WorkflowLink copied!

### Local Development vs CILink copied!

Developers should replicate CI behavior locally before pushing:

1. Profile Consistency: Run `FOUNDRY_PROFILE=ci forge build` locally
2. Verbose Testing: Use `forge test -vvv` to match CI verbosity
3. Formatting: Run `forge fmt` before committing (if format checks are added)
4. Size Analysis: Review `forge build --sizes` output to catch bloated contracts

### CI Feedback LoopLink copied!

When a workflow fails:

1. Check the Build step output for compilation errors (import failures, syntax errors)
2. Check the Test step output for failing assertions
3. Review contract size warnings if deployment gas limits are approached
4. Examine verbose traces (`-vvv`) for low-level call failures

### Future EnhancementsLink copied!

Potential CI/CD improvements for Aegis:

EnhancementPurposeAdd `forge fmt --check` jobEnforce code formatting standardsAdd `forge snapshot` jobTrack gas usage changes in PRsAdd deployment dry-runValidate deployment scripts compileEnable `pull_request` triggerAutomate PR validationAdd coverage reportingTrack test coverage metricsAdd slither/mythril scansSecurity vulnerability detectionAdd multi-network testsValidate cross-chain scenarios

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)[contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

---

## Dependency CI IntegrationLink copied!

### Why Dependency Workflows MatterLink copied!

Although forge-std maintains its own CI, Aegis indirectly benefits from these checks:

1. Compatibility Validation: Ensures forge-std works with Aegis's Solidity versions
2. Stability Guarantees: Tests run on nightly Foundry builds catch breaking changes early
3. Formatting Standards: Forge-std's formatting rules propagate to Aegis via inheritance

### Monitoring Dependency HealthLink copied!

To monitor forge-std CI status:

1. Check the [forge-std GitHub Actions page](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/forge-std GitHub Actions page)
2. Review the `ci-success` job for aggregate status
3. Pin to specific forge-std commit hashes if nightly builds break

### Updating DependenciesLink copied!

When updating forge-std:

```
cd contracts
git submodule update --remote lib/forge-std
forge build
forge test
```

If tests fail, the forge-std CI likely caught breaking changes that Aegis needs to address.

Sources: [contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

---

## SummaryLink copied!

The Aegis CI/CD infrastructure consists of:

1. Aegis Test Workflow: Manual-trigger workflow that builds and tests contracts using Foundry
2. Forge-std CI: Comprehensive multi-version compatibility testing for the core dependency
3. Forge-std Sync: Automated release branch management (non-critical for Aegis)

Key Characteristics:

- Currently manual-trigger only (automated triggers commented out)
- Uses Foundry toolchain exclusively (forge, anvil, cast)
- Leverages matrix strategies in dependencies for version compatibility
- Executes on ubuntu-latest runners
- Requires recursive submodule checkout for dependency resolution

Recommended Next Steps:

1. Enable `pull_request` trigger once testnet stability improves
2. Add formatting checks (`forge fmt --check`)
3. Add gas snapshot tracking (`forge snapshot`)
4. Configure branch protection rules requiring CI success

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)[contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)[contracts/lib/forge-std/.github/workflows/sync.yml#1-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/sync.yml#L1-L32)

---

# CI-CD-Pipelines-1

# CI/CD PipelinesLink copied!
Relevant source files
- [contracts/.github/workflows/test.yml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml)
- [contracts/lib/forge-std/.github/workflows/ci.yml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml)
- [contracts/lib/forge-std/.github/workflows/sync.yml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/sync.yml)

## Purpose and ScopeLink copied!

This document describes the continuous integration and continuous deployment (CI/CD) infrastructure for the Aegis system. It covers the GitHub Actions workflows that automate building, testing, and validation of smart contracts across the multi-chain architecture. For information about test structure and coverage strategy, see [Testing Strategy](#6.1). For deployment procedures, see [Deployment Overview](#5.1).

## CI/CD Architecture OverviewLink copied!

The Aegis project employs a two-tier CI/CD structure:

1. Primary Aegis Workflows: Focused on contract compilation and integration testing
2. Dependency Workflows: Maintained by forge-std library for broader compatibility testing

All workflows leverage the Foundry toolchain (`forge`, `anvil`, `cast`) and execute within GitHub Actions runners.

#mermaid-qw8i8b3s4wb{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-qw8i8b3s4wb .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-qw8i8b3s4wb .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-qw8i8b3s4wb .error-icon{fill:#a44141;}#mermaid-qw8i8b3s4wb .error-text{fill:#ddd;stroke:#ddd;}#mermaid-qw8i8b3s4wb .edge-thickness-normal{stroke-width:1px;}#mermaid-qw8i8b3s4wb .edge-thickness-thick{stroke-width:3.5px;}#mermaid-qw8i8b3s4wb .edge-pattern-solid{stroke-dasharray:0;}#mermaid-qw8i8b3s4wb .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-qw8i8b3s4wb .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-qw8i8b3s4wb .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-qw8i8b3s4wb .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-qw8i8b3s4wb .marker.cross{stroke:lightgrey;}#mermaid-qw8i8b3s4wb svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-qw8i8b3s4wb p{margin:0;}#mermaid-qw8i8b3s4wb .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-qw8i8b3s4wb .cluster-label text{fill:#F9FFFE;}#mermaid-qw8i8b3s4wb .cluster-label span{color:#F9FFFE;}#mermaid-qw8i8b3s4wb .cluster-label span p{background-color:transparent;}#mermaid-qw8i8b3s4wb .label text,#mermaid-qw8i8b3s4wb span{fill:#ccc;color:#ccc;}#mermaid-qw8i8b3s4wb .node rect,#mermaid-qw8i8b3s4wb .node circle,#mermaid-qw8i8b3s4wb .node ellipse,#mermaid-qw8i8b3s4wb .node polygon,#mermaid-qw8i8b3s4wb .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-qw8i8b3s4wb .rough-node .label text,#mermaid-qw8i8b3s4wb .node .label text,#mermaid-qw8i8b3s4wb .image-shape .label,#mermaid-qw8i8b3s4wb .icon-shape .label{text-anchor:middle;}#mermaid-qw8i8b3s4wb .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-qw8i8b3s4wb .rough-node .label,#mermaid-qw8i8b3s4wb .node .label,#mermaid-qw8i8b3s4wb .image-shape .label,#mermaid-qw8i8b3s4wb .icon-shape .label{text-align:center;}#mermaid-qw8i8b3s4wb .node.clickable{cursor:pointer;}#mermaid-qw8i8b3s4wb .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-qw8i8b3s4wb .arrowheadPath{fill:lightgrey;}#mermaid-qw8i8b3s4wb .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-qw8i8b3s4wb .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-qw8i8b3s4wb .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-qw8i8b3s4wb .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-qw8i8b3s4wb .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-qw8i8b3s4wb .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-qw8i8b3s4wb .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-qw8i8b3s4wb .cluster text{fill:#F9FFFE;}#mermaid-qw8i8b3s4wb .cluster span{color:#F9FFFE;}#mermaid-qw8i8b3s4wb div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-qw8i8b3s4wb .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-qw8i8b3s4wb rect.text{fill:none;stroke-width:0;}#mermaid-qw8i8b3s4wb .icon-shape,#mermaid-qw8i8b3s4wb .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-qw8i8b3s4wb .icon-shape p,#mermaid-qw8i8b3s4wb .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-qw8i8b3s4wb .icon-shape rect,#mermaid-qw8i8b3s4wb .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-qw8i8b3s4wb .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-qw8i8b3s4wb .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-qw8i8b3s4wb :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Validation Steps

GitHub Actions Infrastructure

Forge-std Workflows

Aegis Workflows

GitHub Repository

Triggers

Triggers

On Release

contracts/

contracts/lib/forge-std/

test.yml Manual Trigger Only

ci.yml Build + Test + Fmt

sync.yml Release Branch Sync

ubuntu-latest Runner

foundry-rs/foundry-toolchain@v1

actions/checkout@v4

forge build

forge test

forge fmt --check

crate-ci/typos@v1

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)[contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)[contracts/lib/forge-std/.github/workflows/sync.yml#1-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/sync.yml#L1-L32)

---

## Aegis Test WorkflowLink copied!

### Workflow ConfigurationLink copied!

The primary Aegis test workflow is defined in `test.yml` and executes a complete build-test cycle for all contracts in the system.

PropertyValueFile Path`contracts/.github/workflows/test.yml`Trigger`workflow_dispatch` (manual only)Runner OS`ubuntu-latest`Foundry Profile`ci` (set via `FOUNDRY_PROFILE` env var)TimeoutNot specified (default)

### Workflow StepsLink copied!

"Foundry Toolchain""ubuntu-latest""GitHub Actions""Developer""Foundry Toolchain""ubuntu-latest""GitHub Actions""Developer"#mermaid-km0wp7acpg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-km0wp7acpg .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-km0wp7acpg .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-km0wp7acpg .error-icon{fill:#a44141;}#mermaid-km0wp7acpg .error-text{fill:#ddd;stroke:#ddd;}#mermaid-km0wp7acpg .edge-thickness-normal{stroke-width:1px;}#mermaid-km0wp7acpg .edge-thickness-thick{stroke-width:3.5px;}#mermaid-km0wp7acpg .edge-pattern-solid{stroke-dasharray:0;}#mermaid-km0wp7acpg .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-km0wp7acpg .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-km0wp7acpg .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-km0wp7acpg .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-km0wp7acpg .marker.cross{stroke:lightgrey;}#mermaid-km0wp7acpg svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-km0wp7acpg p{margin:0;}#mermaid-km0wp7acpg .actor{stroke:#ccc;fill:#1f2020;}#mermaid-km0wp7acpg text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-km0wp7acpg .actor-line{stroke:#ccc;}#mermaid-km0wp7acpg .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-km0wp7acpg .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-km0wp7acpg .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-km0wp7acpg #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-km0wp7acpg .sequenceNumber{fill:black;}#mermaid-km0wp7acpg #sequencenumber{fill:lightgrey;}#mermaid-km0wp7acpg #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-km0wp7acpg .messageText{fill:lightgrey;stroke:none;}#mermaid-km0wp7acpg .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-km0wp7acpg .labelText,#mermaid-km0wp7acpg .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-km0wp7acpg .loopText,#mermaid-km0wp7acpg .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-km0wp7acpg .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-km0wp7acpg .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-km0wp7acpg .noteText,#mermaid-km0wp7acpg .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-km0wp7acpg .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-km0wp7acpg .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-km0wp7acpg .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-km0wp7acpg .actorPopupMenu{position:absolute;}#mermaid-km0wp7acpg .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-km0wp7acpg .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-km0wp7acpg .actor-man circle,#mermaid-km0wp7acpg line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-km0wp7acpg :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}"Checks out lib/forge-std, lib/uniswap-hooks, etc.""Compile all contracts Report contract sizes""Execute test suite Verbose logging level 3""Trigger workflow_dispatch""Allocate runner""actions/checkout@v4 with submodules: recursive""foundry-rs/foundry-toolchain@v1 version: stable""Install forge, anvil, cast""forge --version""Display toolchain version""forge build --sizes""Build artifacts + size report""forge test -vvv""Test results""Report success/failure""Workflow complete"

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)

### Environment ConfigurationLink copied!

The workflow sets the Foundry profile to `ci` via environment variable [contracts/.github/workflows/test.yml#8-9](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L8-L9):

```
env:
  FOUNDRY_PROFILE: ci
```

This references the `[profile.ci]` section in `foundry.toml`, which may contain CI-specific optimizations (e.g., reduced optimizer runs, specific solc versions).

### Job BreakdownLink copied!

#### Job: `test`

Step 1: Checkout

- Action: `actions/checkout@v4`
- Configuration: `submodules: recursive`
- Purpose: Clones the Aegis repository and all git submodules (forge-std, uniswap-hooks, system-smart-contracts)

[contracts/.github/workflows/test.yml#16-18](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L16-L18)

#### Step 2: Install Foundry

- Action: `foundry-rs/foundry-toolchain@v1`
- Version: `stable`
- Purpose: Installs the latest stable Foundry release (forge, anvil, cast)

[contracts/.github/workflows/test.yml#20-23](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L20-L23)

#### Step 3: Build

- Command: `forge build --sizes`
- ID: `build`
- Purpose: Compiles all Solidity contracts and reports compiled bytecode sizes (critical for deployment gas analysis)

[contracts/.github/workflows/test.yml#25-29](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L25-L29)

#### Step 4: Test

- Command: `forge test -vvv`
- ID: `test`
- Verbosity: Level 3 (displays detailed traces, including failing test stack traces)
- Purpose: Executes all test files in `test/` directory

[contracts/.github/workflows/test.yml#31-34](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L31-L34)

### Trigger MechanismLink copied!

The workflow uses manual dispatch only[contracts/.github/workflows/test.yml#3-6](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L3-L6) Automated triggers for push and pull requests are commented out:

```
on:
  workflow_dispatch:
  # push:
  # pull_request:
```

This suggests the workflow is:

1. In development/configuration phase
2. Intended for on-demand validation
3. Not yet integrated into standard PR review process

Recommendation: Enable `pull_request` trigger once testnet stability improves to ensure all PRs are validated before merge.

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)

---

## Forge-std Dependency WorkflowsLink copied!

The Aegis project depends on `forge-std` (Foundry Standard Library), which maintains its own CI/CD pipelines. These workflows execute independently but validate the integrity of the dependency chain.

### CI Workflow (ci.yml)Link copied!

The forge-std CI workflow is significantly more comprehensive than Aegis's primary workflow, testing multiple Solidity compiler versions and compilation strategies.

#mermaid-31jylq0mfvq{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-31jylq0mfvq .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-31jylq0mfvq .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-31jylq0mfvq .error-icon{fill:#a44141;}#mermaid-31jylq0mfvq .error-text{fill:#ddd;stroke:#ddd;}#mermaid-31jylq0mfvq .edge-thickness-normal{stroke-width:1px;}#mermaid-31jylq0mfvq .edge-thickness-thick{stroke-width:3.5px;}#mermaid-31jylq0mfvq .edge-pattern-solid{stroke-dasharray:0;}#mermaid-31jylq0mfvq .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-31jylq0mfvq .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-31jylq0mfvq .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-31jylq0mfvq .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-31jylq0mfvq .marker.cross{stroke:lightgrey;}#mermaid-31jylq0mfvq svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-31jylq0mfvq p{margin:0;}#mermaid-31jylq0mfvq .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-31jylq0mfvq .cluster-label text{fill:#F9FFFE;}#mermaid-31jylq0mfvq .cluster-label span{color:#F9FFFE;}#mermaid-31jylq0mfvq .cluster-label span p{background-color:transparent;}#mermaid-31jylq0mfvq .label text,#mermaid-31jylq0mfvq span{fill:#ccc;color:#ccc;}#mermaid-31jylq0mfvq .node rect,#mermaid-31jylq0mfvq .node circle,#mermaid-31jylq0mfvq .node ellipse,#mermaid-31jylq0mfvq .node polygon,#mermaid-31jylq0mfvq .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-31jylq0mfvq .rough-node .label text,#mermaid-31jylq0mfvq .node .label text,#mermaid-31jylq0mfvq .image-shape .label,#mermaid-31jylq0mfvq .icon-shape .label{text-anchor:middle;}#mermaid-31jylq0mfvq .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-31jylq0mfvq .rough-node .label,#mermaid-31jylq0mfvq .node .label,#mermaid-31jylq0mfvq .image-shape .label,#mermaid-31jylq0mfvq .icon-shape .label{text-align:center;}#mermaid-31jylq0mfvq .node.clickable{cursor:pointer;}#mermaid-31jylq0mfvq .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-31jylq0mfvq .arrowheadPath{fill:lightgrey;}#mermaid-31jylq0mfvq .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-31jylq0mfvq .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-31jylq0mfvq .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-31jylq0mfvq .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-31jylq0mfvq .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-31jylq0mfvq .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-31jylq0mfvq .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-31jylq0mfvq .cluster text{fill:#F9FFFE;}#mermaid-31jylq0mfvq .cluster span{color:#F9FFFE;}#mermaid-31jylq0mfvq div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-31jylq0mfvq .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-31jylq0mfvq rect.text{fill:none;stroke-width:0;}#mermaid-31jylq0mfvq .icon-shape,#mermaid-31jylq0mfvq .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-31jylq0mfvq .icon-shape p,#mermaid-31jylq0mfvq .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-31jylq0mfvq .icon-shape rect,#mermaid-31jylq0mfvq .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-31jylq0mfvq .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-31jylq0mfvq .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-31jylq0mfvq :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Job: ci-success

Job: typos

Job: fmt

Job: test

Job: build

Trigger Events

workflow_dispatch

pull_request

push to master

Matrix Strategy toolchain: [stable, nightly] flags: 9 configurations

1. Checkout 2. Install Foundry 3. forge build --skip test

Conditional: if via-ir forge build compilation tests

Matrix Strategy toolchain: [stable, nightly]

1. Checkout 2. Install Foundry 3. forge test -vvv

1. Checkout 2. Install Foundry 3. forge fmt --check

1. Checkout 2. crate-ci/typos@v1

re-actors/alls-green@release/v1 Requires: build, test, fmt, typos

Sources: [contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

#### Build Job Matrix

The `build` job uses a matrix strategy to test 18 configurations (2 toolchains × 9 flag sets) [contracts/lib/forge-std/.github/workflows/ci.yml#12-36](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L12-L36):

ToolchainFlagsPurposestable(empty)Default compilationstable`--via-ir`Intermediate representation optimizationstable`--use solc:0.8.17 --via-ir`Solc 0.8.17 with IRstable`--use solc:0.8.17`Solc 0.8.17 standardstable`--use solc:0.8.0`Solc 0.8.0 compatibilitystable`--use solc:0.7.6`Solc 0.7.6 compatibilitystable`--use solc:0.7.0`Solc 0.7.0 compatibilitystable`--use solc:0.6.2`Solc 0.6.2 compatibilitystable`--use solc:0.6.12`Solc 0.6.12 compatibilitynightly(same 9 configurations)Repeated with nightly Foundry

This ensures forge-std works across a wide range of Solidity versions and compilation modes.

#### Test Job

The `test` job runs the forge-std test suite against both stable and nightly Foundry versions [contracts/lib/forge-std/.github/workflows/ci.yml#38-51](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L38-L51):

```
test:
  runs-on: ubuntu-latest
  strategy:
    fail-fast: false
    matrix:
      toolchain: [stable, nightly]
  steps:
    - uses: actions/checkout@v4
    - uses: foundry-rs/foundry-toolchain@v1
      with:
        version: ${{ matrix.toolchain }}
    - run: forge test -vvv
```

#### Format Job

The `fmt` job validates code formatting compliance [contracts/lib/forge-std/.github/workflows/ci.yml#53-60](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L53-L60):

```
fmt:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    - uses: foundry-rs/foundry-toolchain@v1
    - run: forge fmt --check
```

If formatting violations are detected, the job fails. Developers must run `forge fmt` locally to fix.

#### Typos Job

The `typos` job scans for common spelling errors using the `crate-ci/typos` action [contracts/lib/forge-std/.github/workflows/ci.yml#62-67](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L62-L67):

```
typos:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    - uses: crate-ci/typos@v1
```

#### CI Success Aggregator

The `ci-success` job acts as a status check aggregator, requiring all previous jobs to pass [contracts/lib/forge-std/.github/workflows/ci.yml#69-82](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L69-L82):

```
ci-success:
  runs-on: ubuntu-latest
  if: always()
  needs:
    - build
    - test
    - fmt
    - typos
  steps:
    - name: Decide whether the needed jobs succeeded or failed
      uses: re-actors/alls-green@release/v1
      with:
        jobs: ${{ toJSON(needs) }}
```

This provides a single status check for branch protection rules.

Sources: [contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

### Sync Workflow (sync.yml)Link copied!

The sync workflow automatically updates the `v1` branch when a new release is published [contracts/lib/forge-std/.github/workflows/sync.yml#1-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/sync.yml#L1-L32):

"v1 Branch""sync-release-branch Job"GitHubMaintainer"v1 Branch""sync-release-branch Job"GitHubMaintainer#mermaid-tw0mqfc873s{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-tw0mqfc873s .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-tw0mqfc873s .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-tw0mqfc873s .error-icon{fill:#a44141;}#mermaid-tw0mqfc873s .error-text{fill:#ddd;stroke:#ddd;}#mermaid-tw0mqfc873s .edge-thickness-normal{stroke-width:1px;}#mermaid-tw0mqfc873s .edge-thickness-thick{stroke-width:3.5px;}#mermaid-tw0mqfc873s .edge-pattern-solid{stroke-dasharray:0;}#mermaid-tw0mqfc873s .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-tw0mqfc873s .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-tw0mqfc873s .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-tw0mqfc873s .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-tw0mqfc873s .marker.cross{stroke:lightgrey;}#mermaid-tw0mqfc873s svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-tw0mqfc873s p{margin:0;}#mermaid-tw0mqfc873s .actor{stroke:#ccc;fill:#1f2020;}#mermaid-tw0mqfc873s text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-tw0mqfc873s .actor-line{stroke:#ccc;}#mermaid-tw0mqfc873s .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-tw0mqfc873s .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-tw0mqfc873s .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-tw0mqfc873s #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-tw0mqfc873s .sequenceNumber{fill:black;}#mermaid-tw0mqfc873s #sequencenumber{fill:lightgrey;}#mermaid-tw0mqfc873s #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-tw0mqfc873s .messageText{fill:lightgrey;stroke:none;}#mermaid-tw0mqfc873s .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-tw0mqfc873s .labelText,#mermaid-tw0mqfc873s .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-tw0mqfc873s .loopText,#mermaid-tw0mqfc873s .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-tw0mqfc873s .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-tw0mqfc873s .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-tw0mqfc873s .noteText,#mermaid-tw0mqfc873s .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-tw0mqfc873s .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-tw0mqfc873s .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-tw0mqfc873s .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-tw0mqfc873s .actorPopupMenu{position:absolute;}#mermaid-tw0mqfc873s .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-tw0mqfc873s .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-tw0mqfc873s .actor-man circle,#mermaid-tw0mqfc873s line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-tw0mqfc873s :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}alt["Tag starts with v1"]["Tag does not start with v1"]"Create release v1.x.x""Trigger on: release.created""Check: startsWith(tag | 'v1')""Checkout v1 branch""git config user.name/email github-actions[bot]""git fetch --tags""git reset --hard $GITHUB_REF""git push --force""v1 branch updated""Skip sync"

This workflow is specific to forge-std's versioning strategy and does not directly impact Aegis development.

Sources: [contracts/lib/forge-std/.github/workflows/sync.yml#1-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/sync.yml#L1-L32)

---

## Workflow Configuration DetailsLink copied!

### Foundry Profile SelectionLink copied!

The `FOUNDRY_PROFILE` environment variable controls which configuration section from `foundry.toml` is used during CI execution. In Aegis, this is set to `ci`[contracts/.github/workflows/test.yml#8-9](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L8-L9)

Typical CI profile settings might include:

- Reduced optimizer runs for faster compilation
- Specific Solidity version constraints
- Increased verbosity for debugging
- Custom test flags

### Submodule HandlingLink copied!

All workflows use `actions/checkout@v4` with `submodules: recursive` to ensure dependencies are cloned [contracts/.github/workflows/test.yml#16-18](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L16-L18):

```
- uses: actions/checkout@v4
  with:
    submodules: recursive
```

This is critical because Aegis depends on:

- `lib/forge-std` (testing framework)
- `lib/uniswap-hooks` (Uniswap V4 interfaces)
- `lib/system-smart-contracts` (Reactive Network contracts)

Without recursive submodule checkout, imports like `IHooks` and `AbstractReactive` would fail.

### Timeout ConfigurationLink copied!

The forge-std CI workflow sets explicit timeouts [contracts/lib/forge-std/.github/workflows/ci.yml#14](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L14-L14):

```
timeout-minutes: 10
```

The Aegis workflow does not specify timeouts, using GitHub Actions' default (360 minutes). Consider adding a timeout to prevent hung builds.

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)[contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

---

## Trigger PatternsLink copied!

### Current StateLink copied!

WorkflowManualPushPull RequestReleaseAegis `test.yml`✅❌ (commented)❌ (commented)❌forge-std `ci.yml`✅✅ (master only)✅❌forge-std `sync.yml`❌❌❌✅

The Aegis workflow is intentionally limited to manual triggers, likely due to:

1. Testnet Instability: The hybrid relayer documentation mentions testnet connectivity issues
2. Development Phase: The project is still in active development
3. Cost Concerns: Automated CI runs consume GitHub Actions minutes

### Recommended Production ConfigurationLink copied!

For production readiness, enable automated triggers [contracts/.github/workflows/test.yml#3-6](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L3-L6):

```
on:
  workflow_dispatch:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
```

This ensures:

- All PRs are tested before merge
- Main branch integrity is validated on every push
- Manual triggers remain available for ad-hoc testing

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)[contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

---

## CI/CD Workflow Execution FlowLink copied!

The following diagram illustrates the complete execution flow when a developer triggers the Aegis test workflow:

#mermaid-zmb2qj3ixn{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-zmb2qj3ixn .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-zmb2qj3ixn .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-zmb2qj3ixn .error-icon{fill:#a44141;}#mermaid-zmb2qj3ixn .error-text{fill:#ddd;stroke:#ddd;}#mermaid-zmb2qj3ixn .edge-thickness-normal{stroke-width:1px;}#mermaid-zmb2qj3ixn .edge-thickness-thick{stroke-width:3.5px;}#mermaid-zmb2qj3ixn .edge-pattern-solid{stroke-dasharray:0;}#mermaid-zmb2qj3ixn .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-zmb2qj3ixn .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-zmb2qj3ixn .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-zmb2qj3ixn .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-zmb2qj3ixn .marker.cross{stroke:lightgrey;}#mermaid-zmb2qj3ixn svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-zmb2qj3ixn p{margin:0;}#mermaid-zmb2qj3ixn .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-zmb2qj3ixn .cluster-label text{fill:#F9FFFE;}#mermaid-zmb2qj3ixn .cluster-label span{color:#F9FFFE;}#mermaid-zmb2qj3ixn .cluster-label span p{background-color:transparent;}#mermaid-zmb2qj3ixn .label text,#mermaid-zmb2qj3ixn span{fill:#ccc;color:#ccc;}#mermaid-zmb2qj3ixn .node rect,#mermaid-zmb2qj3ixn .node circle,#mermaid-zmb2qj3ixn .node ellipse,#mermaid-zmb2qj3ixn .node polygon,#mermaid-zmb2qj3ixn .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-zmb2qj3ixn .rough-node .label text,#mermaid-zmb2qj3ixn .node .label text,#mermaid-zmb2qj3ixn .image-shape .label,#mermaid-zmb2qj3ixn .icon-shape .label{text-anchor:middle;}#mermaid-zmb2qj3ixn .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-zmb2qj3ixn .rough-node .label,#mermaid-zmb2qj3ixn .node .label,#mermaid-zmb2qj3ixn .image-shape .label,#mermaid-zmb2qj3ixn .icon-shape .label{text-align:center;}#mermaid-zmb2qj3ixn .node.clickable{cursor:pointer;}#mermaid-zmb2qj3ixn .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-zmb2qj3ixn .arrowheadPath{fill:lightgrey;}#mermaid-zmb2qj3ixn .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-zmb2qj3ixn .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-zmb2qj3ixn .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-zmb2qj3ixn .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-zmb2qj3ixn .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-zmb2qj3ixn .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-zmb2qj3ixn .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-zmb2qj3ixn .cluster text{fill:#F9FFFE;}#mermaid-zmb2qj3ixn .cluster span{color:#F9FFFE;}#mermaid-zmb2qj3ixn div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-zmb2qj3ixn .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-zmb2qj3ixn rect.text{fill:none;stroke-width:0;}#mermaid-zmb2qj3ixn .icon-shape,#mermaid-zmb2qj3ixn .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-zmb2qj3ixn .icon-shape p,#mermaid-zmb2qj3ixn .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-zmb2qj3ixn .icon-shape rect,#mermaid-zmb2qj3ixn .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-zmb2qj3ixn .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-zmb2qj3ixn .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-zmb2qj3ixn :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Yes

No

Yes

No

Yes

No

Developer triggers workflow_dispatch

GitHub Actions allocates ubuntu-latest runner

actions/checkout@v4 Clone repo + submodules

Submodules cloned?

foundry-rs/foundry-toolchain@v1 Install Foundry stable

forge --version Display version

forge build --sizes Compile contracts

Build successful?

forge test -vvv Execute test suite

Tests passed?

Report SUCCESS to GitHub

Report FAILURE to GitHub

Workflow complete

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)

---

## Integration with Development WorkflowLink copied!

### Local Development vs CILink copied!

Developers should replicate CI behavior locally before pushing:

1. Profile Consistency: Run `FOUNDRY_PROFILE=ci forge build` locally
2. Verbose Testing: Use `forge test -vvv` to match CI verbosity
3. Formatting: Run `forge fmt` before committing (if format checks are added)
4. Size Analysis: Review `forge build --sizes` output to catch bloated contracts

### CI Feedback LoopLink copied!

When a workflow fails:

1. Check the Build step output for compilation errors (import failures, syntax errors)
2. Check the Test step output for failing assertions
3. Review contract size warnings if deployment gas limits are approached
4. Examine verbose traces (`-vvv`) for low-level call failures

### Future EnhancementsLink copied!

Potential CI/CD improvements for Aegis:

EnhancementPurposeAdd `forge fmt --check` jobEnforce code formatting standardsAdd `forge snapshot` jobTrack gas usage changes in PRsAdd deployment dry-runValidate deployment scripts compileEnable `pull_request` triggerAutomate PR validationAdd coverage reportingTrack test coverage metricsAdd slither/mythril scansSecurity vulnerability detectionAdd multi-network testsValidate cross-chain scenarios

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)[contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

---

## Dependency CI IntegrationLink copied!

### Why Dependency Workflows MatterLink copied!

Although forge-std maintains its own CI, Aegis indirectly benefits from these checks:

1. Compatibility Validation: Ensures forge-std works with Aegis's Solidity versions
2. Stability Guarantees: Tests run on nightly Foundry builds catch breaking changes early
3. Formatting Standards: Forge-std's formatting rules propagate to Aegis via inheritance

### Monitoring Dependency HealthLink copied!

To monitor forge-std CI status:

1. Check the [forge-std GitHub Actions page](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/forge-std GitHub Actions page)
2. Review the `ci-success` job for aggregate status
3. Pin to specific forge-std commit hashes if nightly builds break

### Updating DependenciesLink copied!

When updating forge-std:

```
cd contracts
git submodule update --remote lib/forge-std
forge build
forge test
```

If tests fail, the forge-std CI likely caught breaking changes that Aegis needs to address.

Sources: [contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

---

## SummaryLink copied!

The Aegis CI/CD infrastructure consists of:

1. Aegis Test Workflow: Manual-trigger workflow that builds and tests contracts using Foundry
2. Forge-std CI: Comprehensive multi-version compatibility testing for the core dependency
3. Forge-std Sync: Automated release branch management (non-critical for Aegis)

Key Characteristics:

- Currently manual-trigger only (automated triggers commented out)
- Uses Foundry toolchain exclusively (forge, anvil, cast)
- Leverages matrix strategies in dependencies for version compatibility
- Executes on ubuntu-latest runners
- Requires recursive submodule checkout for dependency resolution

Recommended Next Steps:

1. Enable `pull_request` trigger once testnet stability improves
2. Add formatting checks (`forge fmt --check`)
3. Add gas snapshot tracking (`forge snapshot`)
4. Configure branch protection rules requiring CI success

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)[contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)[contracts/lib/forge-std/.github/workflows/sync.yml#1-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/sync.yml#L1-L32)

---

# CI-CD-Pipelines-2

# CI/CD PipelinesLink copied!
Relevant source files
- [contracts/.github/workflows/test.yml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml)
- [contracts/lib/forge-std/.github/workflows/ci.yml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml)
- [contracts/lib/forge-std/.github/workflows/sync.yml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/sync.yml)

## Purpose and ScopeLink copied!

This document describes the continuous integration and continuous deployment (CI/CD) infrastructure for the Aegis system. It covers the GitHub Actions workflows that automate building, testing, and validation of smart contracts across the multi-chain architecture. For information about test structure and coverage strategy, see [Testing Strategy](#6.1). For deployment procedures, see [Deployment Overview](#5.1).

## CI/CD Architecture OverviewLink copied!

The Aegis project employs a two-tier CI/CD structure:

1. Primary Aegis Workflows: Focused on contract compilation and integration testing
2. Dependency Workflows: Maintained by forge-std library for broader compatibility testing

All workflows leverage the Foundry toolchain (`forge`, `anvil`, `cast`) and execute within GitHub Actions runners.

#mermaid-qw8i8b3s4wb{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-qw8i8b3s4wb .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-qw8i8b3s4wb .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-qw8i8b3s4wb .error-icon{fill:#a44141;}#mermaid-qw8i8b3s4wb .error-text{fill:#ddd;stroke:#ddd;}#mermaid-qw8i8b3s4wb .edge-thickness-normal{stroke-width:1px;}#mermaid-qw8i8b3s4wb .edge-thickness-thick{stroke-width:3.5px;}#mermaid-qw8i8b3s4wb .edge-pattern-solid{stroke-dasharray:0;}#mermaid-qw8i8b3s4wb .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-qw8i8b3s4wb .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-qw8i8b3s4wb .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-qw8i8b3s4wb .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-qw8i8b3s4wb .marker.cross{stroke:lightgrey;}#mermaid-qw8i8b3s4wb svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-qw8i8b3s4wb p{margin:0;}#mermaid-qw8i8b3s4wb .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-qw8i8b3s4wb .cluster-label text{fill:#F9FFFE;}#mermaid-qw8i8b3s4wb .cluster-label span{color:#F9FFFE;}#mermaid-qw8i8b3s4wb .cluster-label span p{background-color:transparent;}#mermaid-qw8i8b3s4wb .label text,#mermaid-qw8i8b3s4wb span{fill:#ccc;color:#ccc;}#mermaid-qw8i8b3s4wb .node rect,#mermaid-qw8i8b3s4wb .node circle,#mermaid-qw8i8b3s4wb .node ellipse,#mermaid-qw8i8b3s4wb .node polygon,#mermaid-qw8i8b3s4wb .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-qw8i8b3s4wb .rough-node .label text,#mermaid-qw8i8b3s4wb .node .label text,#mermaid-qw8i8b3s4wb .image-shape .label,#mermaid-qw8i8b3s4wb .icon-shape .label{text-anchor:middle;}#mermaid-qw8i8b3s4wb .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-qw8i8b3s4wb .rough-node .label,#mermaid-qw8i8b3s4wb .node .label,#mermaid-qw8i8b3s4wb .image-shape .label,#mermaid-qw8i8b3s4wb .icon-shape .label{text-align:center;}#mermaid-qw8i8b3s4wb .node.clickable{cursor:pointer;}#mermaid-qw8i8b3s4wb .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-qw8i8b3s4wb .arrowheadPath{fill:lightgrey;}#mermaid-qw8i8b3s4wb .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-qw8i8b3s4wb .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-qw8i8b3s4wb .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-qw8i8b3s4wb .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-qw8i8b3s4wb .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-qw8i8b3s4wb .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-qw8i8b3s4wb .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-qw8i8b3s4wb .cluster text{fill:#F9FFFE;}#mermaid-qw8i8b3s4wb .cluster span{color:#F9FFFE;}#mermaid-qw8i8b3s4wb div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-qw8i8b3s4wb .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-qw8i8b3s4wb rect.text{fill:none;stroke-width:0;}#mermaid-qw8i8b3s4wb .icon-shape,#mermaid-qw8i8b3s4wb .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-qw8i8b3s4wb .icon-shape p,#mermaid-qw8i8b3s4wb .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-qw8i8b3s4wb .icon-shape rect,#mermaid-qw8i8b3s4wb .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-qw8i8b3s4wb .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-qw8i8b3s4wb .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-qw8i8b3s4wb :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Validation Steps

GitHub Actions Infrastructure

Forge-std Workflows

Aegis Workflows

GitHub Repository

Triggers

Triggers

On Release

contracts/

contracts/lib/forge-std/

test.yml Manual Trigger Only

ci.yml Build + Test + Fmt

sync.yml Release Branch Sync

ubuntu-latest Runner

foundry-rs/foundry-toolchain@v1

actions/checkout@v4

forge build

forge test

forge fmt --check

crate-ci/typos@v1

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)[contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)[contracts/lib/forge-std/.github/workflows/sync.yml#1-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/sync.yml#L1-L32)

---

## Aegis Test WorkflowLink copied!

### Workflow ConfigurationLink copied!

The primary Aegis test workflow is defined in `test.yml` and executes a complete build-test cycle for all contracts in the system.

PropertyValueFile Path`contracts/.github/workflows/test.yml`Trigger`workflow_dispatch` (manual only)Runner OS`ubuntu-latest`Foundry Profile`ci` (set via `FOUNDRY_PROFILE` env var)TimeoutNot specified (default)

### Workflow StepsLink copied!

"Foundry Toolchain""ubuntu-latest""GitHub Actions""Developer""Foundry Toolchain""ubuntu-latest""GitHub Actions""Developer"#mermaid-km0wp7acpg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-km0wp7acpg .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-km0wp7acpg .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-km0wp7acpg .error-icon{fill:#a44141;}#mermaid-km0wp7acpg .error-text{fill:#ddd;stroke:#ddd;}#mermaid-km0wp7acpg .edge-thickness-normal{stroke-width:1px;}#mermaid-km0wp7acpg .edge-thickness-thick{stroke-width:3.5px;}#mermaid-km0wp7acpg .edge-pattern-solid{stroke-dasharray:0;}#mermaid-km0wp7acpg .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-km0wp7acpg .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-km0wp7acpg .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-km0wp7acpg .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-km0wp7acpg .marker.cross{stroke:lightgrey;}#mermaid-km0wp7acpg svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-km0wp7acpg p{margin:0;}#mermaid-km0wp7acpg .actor{stroke:#ccc;fill:#1f2020;}#mermaid-km0wp7acpg text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-km0wp7acpg .actor-line{stroke:#ccc;}#mermaid-km0wp7acpg .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-km0wp7acpg .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-km0wp7acpg .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-km0wp7acpg #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-km0wp7acpg .sequenceNumber{fill:black;}#mermaid-km0wp7acpg #sequencenumber{fill:lightgrey;}#mermaid-km0wp7acpg #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-km0wp7acpg .messageText{fill:lightgrey;stroke:none;}#mermaid-km0wp7acpg .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-km0wp7acpg .labelText,#mermaid-km0wp7acpg .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-km0wp7acpg .loopText,#mermaid-km0wp7acpg .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-km0wp7acpg .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-km0wp7acpg .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-km0wp7acpg .noteText,#mermaid-km0wp7acpg .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-km0wp7acpg .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-km0wp7acpg .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-km0wp7acpg .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-km0wp7acpg .actorPopupMenu{position:absolute;}#mermaid-km0wp7acpg .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-km0wp7acpg .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-km0wp7acpg .actor-man circle,#mermaid-km0wp7acpg line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-km0wp7acpg :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}"Checks out lib/forge-std, lib/uniswap-hooks, etc.""Compile all contracts Report contract sizes""Execute test suite Verbose logging level 3""Trigger workflow_dispatch""Allocate runner""actions/checkout@v4 with submodules: recursive""foundry-rs/foundry-toolchain@v1 version: stable""Install forge, anvil, cast""forge --version""Display toolchain version""forge build --sizes""Build artifacts + size report""forge test -vvv""Test results""Report success/failure""Workflow complete"

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)

### Environment ConfigurationLink copied!

The workflow sets the Foundry profile to `ci` via environment variable [contracts/.github/workflows/test.yml#8-9](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L8-L9):

```
env:
  FOUNDRY_PROFILE: ci
```

This references the `[profile.ci]` section in `foundry.toml`, which may contain CI-specific optimizations (e.g., reduced optimizer runs, specific solc versions).

### Job BreakdownLink copied!

#### Job: `test`

Step 1: Checkout

- Action: `actions/checkout@v4`
- Configuration: `submodules: recursive`
- Purpose: Clones the Aegis repository and all git submodules (forge-std, uniswap-hooks, system-smart-contracts)

[contracts/.github/workflows/test.yml#16-18](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L16-L18)

#### Step 2: Install Foundry

- Action: `foundry-rs/foundry-toolchain@v1`
- Version: `stable`
- Purpose: Installs the latest stable Foundry release (forge, anvil, cast)

[contracts/.github/workflows/test.yml#20-23](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L20-L23)

#### Step 3: Build

- Command: `forge build --sizes`
- ID: `build`
- Purpose: Compiles all Solidity contracts and reports compiled bytecode sizes (critical for deployment gas analysis)

[contracts/.github/workflows/test.yml#25-29](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L25-L29)

#### Step 4: Test

- Command: `forge test -vvv`
- ID: `test`
- Verbosity: Level 3 (displays detailed traces, including failing test stack traces)
- Purpose: Executes all test files in `test/` directory

[contracts/.github/workflows/test.yml#31-34](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L31-L34)

### Trigger MechanismLink copied!

The workflow uses manual dispatch only[contracts/.github/workflows/test.yml#3-6](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L3-L6) Automated triggers for push and pull requests are commented out:

```
on:
  workflow_dispatch:
  # push:
  # pull_request:
```

This suggests the workflow is:

1. In development/configuration phase
2. Intended for on-demand validation
3. Not yet integrated into standard PR review process

Recommendation: Enable `pull_request` trigger once testnet stability improves to ensure all PRs are validated before merge.

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)

---

## Forge-std Dependency WorkflowsLink copied!

The Aegis project depends on `forge-std` (Foundry Standard Library), which maintains its own CI/CD pipelines. These workflows execute independently but validate the integrity of the dependency chain.

### CI Workflow (ci.yml)Link copied!

The forge-std CI workflow is significantly more comprehensive than Aegis's primary workflow, testing multiple Solidity compiler versions and compilation strategies.

#mermaid-31jylq0mfvq{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-31jylq0mfvq .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-31jylq0mfvq .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-31jylq0mfvq .error-icon{fill:#a44141;}#mermaid-31jylq0mfvq .error-text{fill:#ddd;stroke:#ddd;}#mermaid-31jylq0mfvq .edge-thickness-normal{stroke-width:1px;}#mermaid-31jylq0mfvq .edge-thickness-thick{stroke-width:3.5px;}#mermaid-31jylq0mfvq .edge-pattern-solid{stroke-dasharray:0;}#mermaid-31jylq0mfvq .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-31jylq0mfvq .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-31jylq0mfvq .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-31jylq0mfvq .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-31jylq0mfvq .marker.cross{stroke:lightgrey;}#mermaid-31jylq0mfvq svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-31jylq0mfvq p{margin:0;}#mermaid-31jylq0mfvq .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-31jylq0mfvq .cluster-label text{fill:#F9FFFE;}#mermaid-31jylq0mfvq .cluster-label span{color:#F9FFFE;}#mermaid-31jylq0mfvq .cluster-label span p{background-color:transparent;}#mermaid-31jylq0mfvq .label text,#mermaid-31jylq0mfvq span{fill:#ccc;color:#ccc;}#mermaid-31jylq0mfvq .node rect,#mermaid-31jylq0mfvq .node circle,#mermaid-31jylq0mfvq .node ellipse,#mermaid-31jylq0mfvq .node polygon,#mermaid-31jylq0mfvq .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-31jylq0mfvq .rough-node .label text,#mermaid-31jylq0mfvq .node .label text,#mermaid-31jylq0mfvq .image-shape .label,#mermaid-31jylq0mfvq .icon-shape .label{text-anchor:middle;}#mermaid-31jylq0mfvq .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-31jylq0mfvq .rough-node .label,#mermaid-31jylq0mfvq .node .label,#mermaid-31jylq0mfvq .image-shape .label,#mermaid-31jylq0mfvq .icon-shape .label{text-align:center;}#mermaid-31jylq0mfvq .node.clickable{cursor:pointer;}#mermaid-31jylq0mfvq .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-31jylq0mfvq .arrowheadPath{fill:lightgrey;}#mermaid-31jylq0mfvq .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-31jylq0mfvq .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-31jylq0mfvq .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-31jylq0mfvq .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-31jylq0mfvq .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-31jylq0mfvq .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-31jylq0mfvq .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-31jylq0mfvq .cluster text{fill:#F9FFFE;}#mermaid-31jylq0mfvq .cluster span{color:#F9FFFE;}#mermaid-31jylq0mfvq div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-31jylq0mfvq .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-31jylq0mfvq rect.text{fill:none;stroke-width:0;}#mermaid-31jylq0mfvq .icon-shape,#mermaid-31jylq0mfvq .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-31jylq0mfvq .icon-shape p,#mermaid-31jylq0mfvq .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-31jylq0mfvq .icon-shape rect,#mermaid-31jylq0mfvq .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-31jylq0mfvq .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-31jylq0mfvq .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-31jylq0mfvq :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Job: ci-success

Job: typos

Job: fmt

Job: test

Job: build

Trigger Events

workflow_dispatch

pull_request

push to master

Matrix Strategy toolchain: [stable, nightly] flags: 9 configurations

1. Checkout 2. Install Foundry 3. forge build --skip test

Conditional: if via-ir forge build compilation tests

Matrix Strategy toolchain: [stable, nightly]

1. Checkout 2. Install Foundry 3. forge test -vvv

1. Checkout 2. Install Foundry 3. forge fmt --check

1. Checkout 2. crate-ci/typos@v1

re-actors/alls-green@release/v1 Requires: build, test, fmt, typos

Sources: [contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

#### Build Job Matrix

The `build` job uses a matrix strategy to test 18 configurations (2 toolchains × 9 flag sets) [contracts/lib/forge-std/.github/workflows/ci.yml#12-36](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L12-L36):

ToolchainFlagsPurposestable(empty)Default compilationstable`--via-ir`Intermediate representation optimizationstable`--use solc:0.8.17 --via-ir`Solc 0.8.17 with IRstable`--use solc:0.8.17`Solc 0.8.17 standardstable`--use solc:0.8.0`Solc 0.8.0 compatibilitystable`--use solc:0.7.6`Solc 0.7.6 compatibilitystable`--use solc:0.7.0`Solc 0.7.0 compatibilitystable`--use solc:0.6.2`Solc 0.6.2 compatibilitystable`--use solc:0.6.12`Solc 0.6.12 compatibilitynightly(same 9 configurations)Repeated with nightly Foundry

This ensures forge-std works across a wide range of Solidity versions and compilation modes.

#### Test Job

The `test` job runs the forge-std test suite against both stable and nightly Foundry versions [contracts/lib/forge-std/.github/workflows/ci.yml#38-51](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L38-L51):

```
test:
  runs-on: ubuntu-latest
  strategy:
    fail-fast: false
    matrix:
      toolchain: [stable, nightly]
  steps:
    - uses: actions/checkout@v4
    - uses: foundry-rs/foundry-toolchain@v1
      with:
        version: ${{ matrix.toolchain }}
    - run: forge test -vvv
```

#### Format Job

The `fmt` job validates code formatting compliance [contracts/lib/forge-std/.github/workflows/ci.yml#53-60](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L53-L60):

```
fmt:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    - uses: foundry-rs/foundry-toolchain@v1
    - run: forge fmt --check
```

If formatting violations are detected, the job fails. Developers must run `forge fmt` locally to fix.

#### Typos Job

The `typos` job scans for common spelling errors using the `crate-ci/typos` action [contracts/lib/forge-std/.github/workflows/ci.yml#62-67](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L62-L67):

```
typos:
  runs-on: ubuntu-latest
  steps:
    - uses: actions/checkout@v4
    - uses: crate-ci/typos@v1
```

#### CI Success Aggregator

The `ci-success` job acts as a status check aggregator, requiring all previous jobs to pass [contracts/lib/forge-std/.github/workflows/ci.yml#69-82](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L69-L82):

```
ci-success:
  runs-on: ubuntu-latest
  if: always()
  needs:
    - build
    - test
    - fmt
    - typos
  steps:
    - name: Decide whether the needed jobs succeeded or failed
      uses: re-actors/alls-green@release/v1
      with:
        jobs: ${{ toJSON(needs) }}
```

This provides a single status check for branch protection rules.

Sources: [contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

### Sync Workflow (sync.yml)Link copied!

The sync workflow automatically updates the `v1` branch when a new release is published [contracts/lib/forge-std/.github/workflows/sync.yml#1-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/sync.yml#L1-L32):

"v1 Branch""sync-release-branch Job"GitHubMaintainer"v1 Branch""sync-release-branch Job"GitHubMaintainer#mermaid-tw0mqfc873s{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-tw0mqfc873s .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-tw0mqfc873s .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-tw0mqfc873s .error-icon{fill:#a44141;}#mermaid-tw0mqfc873s .error-text{fill:#ddd;stroke:#ddd;}#mermaid-tw0mqfc873s .edge-thickness-normal{stroke-width:1px;}#mermaid-tw0mqfc873s .edge-thickness-thick{stroke-width:3.5px;}#mermaid-tw0mqfc873s .edge-pattern-solid{stroke-dasharray:0;}#mermaid-tw0mqfc873s .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-tw0mqfc873s .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-tw0mqfc873s .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-tw0mqfc873s .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-tw0mqfc873s .marker.cross{stroke:lightgrey;}#mermaid-tw0mqfc873s svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-tw0mqfc873s p{margin:0;}#mermaid-tw0mqfc873s .actor{stroke:#ccc;fill:#1f2020;}#mermaid-tw0mqfc873s text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-tw0mqfc873s .actor-line{stroke:#ccc;}#mermaid-tw0mqfc873s .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-tw0mqfc873s .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-tw0mqfc873s .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-tw0mqfc873s #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-tw0mqfc873s .sequenceNumber{fill:black;}#mermaid-tw0mqfc873s #sequencenumber{fill:lightgrey;}#mermaid-tw0mqfc873s #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-tw0mqfc873s .messageText{fill:lightgrey;stroke:none;}#mermaid-tw0mqfc873s .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-tw0mqfc873s .labelText,#mermaid-tw0mqfc873s .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-tw0mqfc873s .loopText,#mermaid-tw0mqfc873s .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-tw0mqfc873s .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-tw0mqfc873s .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-tw0mqfc873s .noteText,#mermaid-tw0mqfc873s .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-tw0mqfc873s .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-tw0mqfc873s .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-tw0mqfc873s .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-tw0mqfc873s .actorPopupMenu{position:absolute;}#mermaid-tw0mqfc873s .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-tw0mqfc873s .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-tw0mqfc873s .actor-man circle,#mermaid-tw0mqfc873s line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-tw0mqfc873s :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}alt["Tag starts with v1"]["Tag does not start with v1"]"Create release v1.x.x""Trigger on: release.created""Check: startsWith(tag | 'v1')""Checkout v1 branch""git config user.name/email github-actions[bot]""git fetch --tags""git reset --hard $GITHUB_REF""git push --force""v1 branch updated""Skip sync"

This workflow is specific to forge-std's versioning strategy and does not directly impact Aegis development.

Sources: [contracts/lib/forge-std/.github/workflows/sync.yml#1-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/sync.yml#L1-L32)

---

## Workflow Configuration DetailsLink copied!

### Foundry Profile SelectionLink copied!

The `FOUNDRY_PROFILE` environment variable controls which configuration section from `foundry.toml` is used during CI execution. In Aegis, this is set to `ci`[contracts/.github/workflows/test.yml#8-9](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L8-L9)

Typical CI profile settings might include:

- Reduced optimizer runs for faster compilation
- Specific Solidity version constraints
- Increased verbosity for debugging
- Custom test flags

### Submodule HandlingLink copied!

All workflows use `actions/checkout@v4` with `submodules: recursive` to ensure dependencies are cloned [contracts/.github/workflows/test.yml#16-18](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L16-L18):

```
- uses: actions/checkout@v4
  with:
    submodules: recursive
```

This is critical because Aegis depends on:

- `lib/forge-std` (testing framework)
- `lib/uniswap-hooks` (Uniswap V4 interfaces)
- `lib/system-smart-contracts` (Reactive Network contracts)

Without recursive submodule checkout, imports like `IHooks` and `AbstractReactive` would fail.

### Timeout ConfigurationLink copied!

The forge-std CI workflow sets explicit timeouts [contracts/lib/forge-std/.github/workflows/ci.yml#14](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L14-L14):

```
timeout-minutes: 10
```

The Aegis workflow does not specify timeouts, using GitHub Actions' default (360 minutes). Consider adding a timeout to prevent hung builds.

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)[contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

---

## Trigger PatternsLink copied!

### Current StateLink copied!

WorkflowManualPushPull RequestReleaseAegis `test.yml`✅❌ (commented)❌ (commented)❌forge-std `ci.yml`✅✅ (master only)✅❌forge-std `sync.yml`❌❌❌✅

The Aegis workflow is intentionally limited to manual triggers, likely due to:

1. Testnet Instability: The hybrid relayer documentation mentions testnet connectivity issues
2. Development Phase: The project is still in active development
3. Cost Concerns: Automated CI runs consume GitHub Actions minutes

### Recommended Production ConfigurationLink copied!

For production readiness, enable automated triggers [contracts/.github/workflows/test.yml#3-6](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L3-L6):

```
on:
  workflow_dispatch:
  push:
    branches:
      - main
      - develop
  pull_request:
    branches:
      - main
```

This ensures:

- All PRs are tested before merge
- Main branch integrity is validated on every push
- Manual triggers remain available for ad-hoc testing

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)[contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

---

## CI/CD Workflow Execution FlowLink copied!

The following diagram illustrates the complete execution flow when a developer triggers the Aegis test workflow:

#mermaid-zmb2qj3ixn{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-zmb2qj3ixn .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-zmb2qj3ixn .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-zmb2qj3ixn .error-icon{fill:#a44141;}#mermaid-zmb2qj3ixn .error-text{fill:#ddd;stroke:#ddd;}#mermaid-zmb2qj3ixn .edge-thickness-normal{stroke-width:1px;}#mermaid-zmb2qj3ixn .edge-thickness-thick{stroke-width:3.5px;}#mermaid-zmb2qj3ixn .edge-pattern-solid{stroke-dasharray:0;}#mermaid-zmb2qj3ixn .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-zmb2qj3ixn .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-zmb2qj3ixn .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-zmb2qj3ixn .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-zmb2qj3ixn .marker.cross{stroke:lightgrey;}#mermaid-zmb2qj3ixn svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-zmb2qj3ixn p{margin:0;}#mermaid-zmb2qj3ixn .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-zmb2qj3ixn .cluster-label text{fill:#F9FFFE;}#mermaid-zmb2qj3ixn .cluster-label span{color:#F9FFFE;}#mermaid-zmb2qj3ixn .cluster-label span p{background-color:transparent;}#mermaid-zmb2qj3ixn .label text,#mermaid-zmb2qj3ixn span{fill:#ccc;color:#ccc;}#mermaid-zmb2qj3ixn .node rect,#mermaid-zmb2qj3ixn .node circle,#mermaid-zmb2qj3ixn .node ellipse,#mermaid-zmb2qj3ixn .node polygon,#mermaid-zmb2qj3ixn .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-zmb2qj3ixn .rough-node .label text,#mermaid-zmb2qj3ixn .node .label text,#mermaid-zmb2qj3ixn .image-shape .label,#mermaid-zmb2qj3ixn .icon-shape .label{text-anchor:middle;}#mermaid-zmb2qj3ixn .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-zmb2qj3ixn .rough-node .label,#mermaid-zmb2qj3ixn .node .label,#mermaid-zmb2qj3ixn .image-shape .label,#mermaid-zmb2qj3ixn .icon-shape .label{text-align:center;}#mermaid-zmb2qj3ixn .node.clickable{cursor:pointer;}#mermaid-zmb2qj3ixn .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-zmb2qj3ixn .arrowheadPath{fill:lightgrey;}#mermaid-zmb2qj3ixn .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-zmb2qj3ixn .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-zmb2qj3ixn .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-zmb2qj3ixn .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-zmb2qj3ixn .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-zmb2qj3ixn .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-zmb2qj3ixn .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-zmb2qj3ixn .cluster text{fill:#F9FFFE;}#mermaid-zmb2qj3ixn .cluster span{color:#F9FFFE;}#mermaid-zmb2qj3ixn div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-zmb2qj3ixn .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-zmb2qj3ixn rect.text{fill:none;stroke-width:0;}#mermaid-zmb2qj3ixn .icon-shape,#mermaid-zmb2qj3ixn .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-zmb2qj3ixn .icon-shape p,#mermaid-zmb2qj3ixn .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-zmb2qj3ixn .icon-shape rect,#mermaid-zmb2qj3ixn .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-zmb2qj3ixn .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-zmb2qj3ixn .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-zmb2qj3ixn :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Yes

No

Yes

No

Yes

No

Developer triggers workflow_dispatch

GitHub Actions allocates ubuntu-latest runner

actions/checkout@v4 Clone repo + submodules

Submodules cloned?

foundry-rs/foundry-toolchain@v1 Install Foundry stable

forge --version Display version

forge build --sizes Compile contracts

Build successful?

forge test -vvv Execute test suite

Tests passed?

Report SUCCESS to GitHub

Report FAILURE to GitHub

Workflow complete

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)

---

## Integration with Development WorkflowLink copied!

### Local Development vs CILink copied!

Developers should replicate CI behavior locally before pushing:

1. Profile Consistency: Run `FOUNDRY_PROFILE=ci forge build` locally
2. Verbose Testing: Use `forge test -vvv` to match CI verbosity
3. Formatting: Run `forge fmt` before committing (if format checks are added)
4. Size Analysis: Review `forge build --sizes` output to catch bloated contracts

### CI Feedback LoopLink copied!

When a workflow fails:

1. Check the Build step output for compilation errors (import failures, syntax errors)
2. Check the Test step output for failing assertions
3. Review contract size warnings if deployment gas limits are approached
4. Examine verbose traces (`-vvv`) for low-level call failures

### Future EnhancementsLink copied!

Potential CI/CD improvements for Aegis:

EnhancementPurposeAdd `forge fmt --check` jobEnforce code formatting standardsAdd `forge snapshot` jobTrack gas usage changes in PRsAdd deployment dry-runValidate deployment scripts compileEnable `pull_request` triggerAutomate PR validationAdd coverage reportingTrack test coverage metricsAdd slither/mythril scansSecurity vulnerability detectionAdd multi-network testsValidate cross-chain scenarios

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)[contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

---

## Dependency CI IntegrationLink copied!

### Why Dependency Workflows MatterLink copied!

Although forge-std maintains its own CI, Aegis indirectly benefits from these checks:

1. Compatibility Validation: Ensures forge-std works with Aegis's Solidity versions
2. Stability Guarantees: Tests run on nightly Foundry builds catch breaking changes early
3. Formatting Standards: Forge-std's formatting rules propagate to Aegis via inheritance

### Monitoring Dependency HealthLink copied!

To monitor forge-std CI status:

1. Check the [forge-std GitHub Actions page](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/forge-std GitHub Actions page)
2. Review the `ci-success` job for aggregate status
3. Pin to specific forge-std commit hashes if nightly builds break

### Updating DependenciesLink copied!

When updating forge-std:

```
cd contracts
git submodule update --remote lib/forge-std
forge build
forge test
```

If tests fail, the forge-std CI likely caught breaking changes that Aegis needs to address.

Sources: [contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)

---

## SummaryLink copied!

The Aegis CI/CD infrastructure consists of:

1. Aegis Test Workflow: Manual-trigger workflow that builds and tests contracts using Foundry
2. Forge-std CI: Comprehensive multi-version compatibility testing for the core dependency
3. Forge-std Sync: Automated release branch management (non-critical for Aegis)

Key Characteristics:

- Currently manual-trigger only (automated triggers commented out)
- Uses Foundry toolchain exclusively (forge, anvil, cast)
- Leverages matrix strategies in dependencies for version compatibility
- Executes on ubuntu-latest runners
- Requires recursive submodule checkout for dependency resolution

Recommended Next Steps:

1. Enable `pull_request` trigger once testnet stability improves
2. Add formatting checks (`forge fmt --check`)
3. Add gas snapshot tracking (`forge snapshot`)
4. Configure branch protection rules requiring CI success

Sources: [contracts/.github/workflows/test.yml#1-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.github/workflows/test.yml#L1-L35)[contracts/lib/forge-std/.github/workflows/ci.yml#1-83](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/ci.yml#L1-L83)[contracts/lib/forge-std/.github/workflows/sync.yml#1-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/.github/workflows/sync.yml#L1-L32)

---

# Forge-Standard-Library

# Forge Standard LibraryLink copied!
Relevant source files
- [contracts/.gitmodules](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules)
- [contracts/lib/forge-std/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md)

## Purpose and ScopeLink copied!

This page provides reference documentation for the Forge Standard Library (`forge-std`), a foundational dependency used throughout the Aegis codebase for testing, scripting, and development workflows. The library is maintained by the Foundry team and provides testing utilities, cheatcode wrappers, base contracts, and console logging functionality that simplify smart contract development.

For detailed information about specific utilities within forge-std, see:

- Testing utilities (stdError, stdStorage, stdCheats, console): [Testing Utilities](#7.1)
- Base contracts (Test, Script, CommonBase): [Base Contracts](#7.2)
- Cheatcode generation system: [Cheatcode Generation](#7.3)

For the broader dependency management strategy, see [Dependencies](#4.3).

---

## OverviewLink copied!

The Forge Standard Library is integrated into Aegis as a git submodule at `lib/forge-std`, as specified in [contracts/.gitmodules#1-3](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L1-L3) It serves as the foundation for all test contracts and deployment scripts in the Aegis system. The library leverages Foundry's VM cheatcodes to enable advanced testing patterns such as state manipulation, impersonation, and storage introspection without requiring forked networks or complex test fixtures.

Key characteristics:

- Submodule-based: Managed via git submodules, allowing version pinning
- Dual-licensed: Available under MIT or Apache 2.0 licenses
- Cheatcode-centric: Wraps Foundry's `vm` interface for improved developer experience
- Type-safe: Provides strongly-typed error codes and utility functions

Sources: [contracts/.gitmodules#1-3](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L1-L3)[contracts/lib/forge-std/README.md#1-5](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L1-L5)

---

## Integration in AegisLink copied!

The following diagram illustrates how forge-std integrates into the Aegis contract architecture:

#mermaid-084fh6qc71lg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-084fh6qc71lg .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-084fh6qc71lg .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-084fh6qc71lg .error-icon{fill:#a44141;}#mermaid-084fh6qc71lg .error-text{fill:#ddd;stroke:#ddd;}#mermaid-084fh6qc71lg .edge-thickness-normal{stroke-width:1px;}#mermaid-084fh6qc71lg .edge-thickness-thick{stroke-width:3.5px;}#mermaid-084fh6qc71lg .edge-pattern-solid{stroke-dasharray:0;}#mermaid-084fh6qc71lg .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-084fh6qc71lg .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-084fh6qc71lg .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-084fh6qc71lg .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-084fh6qc71lg .marker.cross{stroke:lightgrey;}#mermaid-084fh6qc71lg svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-084fh6qc71lg p{margin:0;}#mermaid-084fh6qc71lg .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-084fh6qc71lg .cluster-label text{fill:#F9FFFE;}#mermaid-084fh6qc71lg .cluster-label span{color:#F9FFFE;}#mermaid-084fh6qc71lg .cluster-label span p{background-color:transparent;}#mermaid-084fh6qc71lg .label text,#mermaid-084fh6qc71lg span{fill:#ccc;color:#ccc;}#mermaid-084fh6qc71lg .node rect,#mermaid-084fh6qc71lg .node circle,#mermaid-084fh6qc71lg .node ellipse,#mermaid-084fh6qc71lg .node polygon,#mermaid-084fh6qc71lg .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-084fh6qc71lg .rough-node .label text,#mermaid-084fh6qc71lg .node .label text,#mermaid-084fh6qc71lg .image-shape .label,#mermaid-084fh6qc71lg .icon-shape .label{text-anchor:middle;}#mermaid-084fh6qc71lg .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-084fh6qc71lg .rough-node .label,#mermaid-084fh6qc71lg .node .label,#mermaid-084fh6qc71lg .image-shape .label,#mermaid-084fh6qc71lg .icon-shape .label{text-align:center;}#mermaid-084fh6qc71lg .node.clickable{cursor:pointer;}#mermaid-084fh6qc71lg .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-084fh6qc71lg .arrowheadPath{fill:lightgrey;}#mermaid-084fh6qc71lg .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-084fh6qc71lg .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-084fh6qc71lg .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-084fh6qc71lg .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-084fh6qc71lg .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-084fh6qc71lg .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-084fh6qc71lg .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-084fh6qc71lg .cluster text{fill:#F9FFFE;}#mermaid-084fh6qc71lg .cluster span{color:#F9FFFE;}#mermaid-084fh6qc71lg div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-084fh6qc71lg .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-084fh6qc71lg rect.text{fill:none;stroke-width:0;}#mermaid-084fh6qc71lg .icon-shape,#mermaid-084fh6qc71lg .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-084fh6qc71lg .icon-shape p,#mermaid-084fh6qc71lg .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-084fh6qc71lg .icon-shape rect,#mermaid-084fh6qc71lg .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-084fh6qc71lg .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-084fh6qc71lg .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-084fh6qc71lg :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Aegis Deployment Scripts

Aegis Test Contracts

forge-std Library

Inherited via Test.sol

Inherited via Test.sol

Inherited via Test.sol

Imported directly

Uses vm.expectRevert

Uses hoax/prank

Uses console2.log

stdError.sol (Compiler Error Codes)

stdStorage.sol (Storage Manipulation)

stdCheats.sol (Prank/Hoax Wrappers)

console2.sol (Logging)

Test.sol (Base Test Contract)

Script.sol (Base Deploy Script)

AegisHook.t.sol

AegisSentinel.t.sol

MockOracle.t.sol

04_DeployOracle.s.sol

05_DeploySentinel.s.sol

06_DeployHook.s.sol

Analysis: All Aegis test contracts inherit from `Test.sol`, which transitively imports `stdError`, `stdStorage`, `stdCheats`, and other utilities. Deployment scripts inherit from `Script.sol` and typically import `console2.sol` directly for logging deployment progress. This inheritance pattern ensures consistent testing patterns across the codebase.

Sources: [contracts/lib/forge-std/README.md#14-44](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L14-L44)[contracts/.gitmodules#1-3](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L1-L3)

---

## Core ComponentsLink copied!

### Component ArchitectureLink copied!

The following diagram maps forge-std components to their primary use cases in Aegis:

#mermaid-3wn4j5xywiq{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-3wn4j5xywiq .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-3wn4j5xywiq .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-3wn4j5xywiq .error-icon{fill:#a44141;}#mermaid-3wn4j5xywiq .error-text{fill:#ddd;stroke:#ddd;}#mermaid-3wn4j5xywiq .edge-thickness-normal{stroke-width:1px;}#mermaid-3wn4j5xywiq .edge-thickness-thick{stroke-width:3.5px;}#mermaid-3wn4j5xywiq .edge-pattern-solid{stroke-dasharray:0;}#mermaid-3wn4j5xywiq .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-3wn4j5xywiq .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-3wn4j5xywiq .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-3wn4j5xywiq .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-3wn4j5xywiq .marker.cross{stroke:lightgrey;}#mermaid-3wn4j5xywiq svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-3wn4j5xywiq p{margin:0;}#mermaid-3wn4j5xywiq .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-3wn4j5xywiq .cluster-label text{fill:#F9FFFE;}#mermaid-3wn4j5xywiq .cluster-label span{color:#F9FFFE;}#mermaid-3wn4j5xywiq .cluster-label span p{background-color:transparent;}#mermaid-3wn4j5xywiq .label text,#mermaid-3wn4j5xywiq span{fill:#ccc;color:#ccc;}#mermaid-3wn4j5xywiq .node rect,#mermaid-3wn4j5xywiq .node circle,#mermaid-3wn4j5xywiq .node ellipse,#mermaid-3wn4j5xywiq .node polygon,#mermaid-3wn4j5xywiq .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-3wn4j5xywiq .rough-node .label text,#mermaid-3wn4j5xywiq .node .label text,#mermaid-3wn4j5xywiq .image-shape .label,#mermaid-3wn4j5xywiq .icon-shape .label{text-anchor:middle;}#mermaid-3wn4j5xywiq .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-3wn4j5xywiq .rough-node .label,#mermaid-3wn4j5xywiq .node .label,#mermaid-3wn4j5xywiq .image-shape .label,#mermaid-3wn4j5xywiq .icon-shape .label{text-align:center;}#mermaid-3wn4j5xywiq .node.clickable{cursor:pointer;}#mermaid-3wn4j5xywiq .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-3wn4j5xywiq .arrowheadPath{fill:lightgrey;}#mermaid-3wn4j5xywiq .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-3wn4j5xywiq .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-3wn4j5xywiq .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-3wn4j5xywiq .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-3wn4j5xywiq .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-3wn4j5xywiq .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-3wn4j5xywiq .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-3wn4j5xywiq .cluster text{fill:#F9FFFE;}#mermaid-3wn4j5xywiq .cluster span{color:#F9FFFE;}#mermaid-3wn4j5xywiq div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-3wn4j5xywiq .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-3wn4j5xywiq rect.text{fill:none;stroke-width:0;}#mermaid-3wn4j5xywiq .icon-shape,#mermaid-3wn4j5xywiq .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-3wn4j5xywiq .icon-shape p,#mermaid-3wn4j5xywiq .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-3wn4j5xywiq .icon-shape rect,#mermaid-3wn4j5xywiq .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-3wn4j5xywiq .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-3wn4j5xywiq .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-3wn4j5xywiq :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Deployment Phase

forge-std Components

Testing Phase

Uses

Uses

Uses

Uses

Uses

References

Uses vm.record/accesses

Uses vm.prank/deal

Uses

vm.expectRevert (Error Assertion)

Storage Introspection (Find Slots)

Storage Manipulation (Overwrite State)

Account Impersonation (Prank/Hoax)

stdError

stdStorage

stdCheats

Vm.sol (Cheatcodes Interface)

Console Logging (Progress Tracking)

Transaction Broadcasting (vm.broadcast)

console2.sol

Analysis: The forge-std library acts as a higher-level abstraction over Foundry's raw cheatcode interface (`Vm.sol`). Each component targets a specific testing or scripting need: `stdError` for revert assertions, `stdStorage` for state manipulation, `stdCheats` for impersonation, and `console2` for deployment visibility.

Sources: [contracts/lib/forge-std/README.md#14-216](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L14-L216)

---

## Key UtilitiesLink copied!

### stdError: Compiler Error CodesLink copied!

The `stdError` contract provides constants for all Solidity compiler built-in errors, enabling type-safe revert assertions. This is particularly useful for testing arithmetic overflow, array access violations, and other low-level errors.

Common error codes:

Error ConstantDescriptionExample Use Case`arithmeticError`Integer overflow/underflowTesting unchecked math operations`assertionError`Failed `assert()` statementTesting invariant violations`divisionError`Division by zeroTesting edge cases in calculations`enumConversionError`Invalid enum conversionTesting type safety`indexOOBError`Array index out of boundsTesting array access`zeroVarError`Zero-initialized function pointerTesting function pointer usage

Usage pattern in Aegis tests:

```
// Example pattern from test contracts
vm.expectRevert(stdError.arithmeticError);
contractUnderTest.functionThatOverflows();
```

Sources: [contracts/lib/forge-std/README.md#14-44](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L14-L44)

---

### stdStorage: Storage Slot ManipulationLink copied!

The `stdStorage` library enables finding and writing to arbitrary storage slots without knowing the contract's storage layout. This is achieved by recording all `SLOAD` and `SSTORE` operations during a function call, then identifying which slots correspond to specific variables.

Key operations:

MethodPurposeReturn Value`.target(address)`Set target contractFluent interface`.sig(bytes4)` or `.sig(string)`Specify function selectorFluent interface`.with_key(type)`Provide mapping key(s)Fluent interface`.depth(uint256)`Specify struct field depthFluent interface`.find()`Locate storage slot`uint256` slot number`.checked_write(type)`Write to storage slotNone (reverts on packed slots)

Important limitations:

- Cannot safely write to packed storage slots (e.g., multiple `uint128` in one slot)
- Requires the variable to be accessible via a public getter or view function
- Struct field access requires explicit `depth` parameter (0 = first field, 1 = second field, etc.)

Example workflow:

```
// 1. Find the slot
uint256 slot = stdstore
    .target(address(contractInstance))
    .sig("myPublicVariable()")
    .find();
 
// 2. Write to the slot
stdstore
    .target(address(contractInstance))
    .sig("myPublicVariable()")
    .checked_write(newValue);
```

Sources: [contracts/lib/forge-std/README.md#46-164](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L46-L164)

---

### stdCheats: Prank and Hoax WrappersLink copied!

The `stdCheats` contract provides developer-friendly wrappers around Foundry's `prank` and `deal` cheatcodes. The primary additions are the `hoax` functions, which combine ETH allocation with account impersonation in a single call.

Function variants:

FunctionBehaviorUse Case`hoax(address)`Sets `msg.sender` to address, gives 2^128 weiSingle-call impersonation with default balance`hoax(address, uint256)`Sets `msg.sender` to address, gives specified weiSingle-call impersonation with custom balance`startHoax(address)`Persistent `msg.sender` change + default balanceMulti-call impersonation`startHoax(address, uint256)`Persistent `msg.sender` change + custom balanceMulti-call impersonation with custom balance

Safety note: The `hoax` functions use `vm.deal`, which overwrites the target address's existing ETH balance. If the address already has a balance that should be preserved, use `vm.prank` directly instead.

Sources: [contracts/lib/forge-std/README.md#166-216](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L166-L216)

---

### Console LoggingLink copied!

Forge-std provides two console logging libraries: `console.sol` (Hardhat-compatible) and `console2.sol` (Forge-optimized).

Comparison:

Featureconsole.solconsole2.solHardhat compatibility✅ Full❌ NoneForge trace decoding⚠️ Broken for uint256/int256✅ Full supportRecommended for Aegis❌ No✅ Yes

Import patterns:

```
// Recommended: Import via Test.sol for tests
import "forge-std/Test.sol";
 
// Alternative: Direct import for scripts
import "forge-std/console2.sol";
```

Usage in deployment scripts:

```
console2.log("Deploying MockOracle to Sepolia...");
console2.log("Oracle address:", address(oracle));
console2.log("Initial price:", initialPrice);
```

Sources: [contracts/lib/forge-std/README.md#222-246](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L222-L246)

---

## Base Contract HierarchyLink copied!

The following diagram shows the inheritance structure of forge-std base contracts:

#mermaid-bvszkysv55{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-bvszkysv55 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-bvszkysv55 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-bvszkysv55 .error-icon{fill:#a44141;}#mermaid-bvszkysv55 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-bvszkysv55 .edge-thickness-normal{stroke-width:1px;}#mermaid-bvszkysv55 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-bvszkysv55 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-bvszkysv55 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-bvszkysv55 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-bvszkysv55 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-bvszkysv55 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-bvszkysv55 .marker.cross{stroke:lightgrey;}#mermaid-bvszkysv55 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-bvszkysv55 p{margin:0;}#mermaid-bvszkysv55 .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-bvszkysv55 .cluster-label text{fill:#F9FFFE;}#mermaid-bvszkysv55 .cluster-label span{color:#F9FFFE;}#mermaid-bvszkysv55 .cluster-label span p{background-color:transparent;}#mermaid-bvszkysv55 .label text,#mermaid-bvszkysv55 span{fill:#ccc;color:#ccc;}#mermaid-bvszkysv55 .node rect,#mermaid-bvszkysv55 .node circle,#mermaid-bvszkysv55 .node ellipse,#mermaid-bvszkysv55 .node polygon,#mermaid-bvszkysv55 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-bvszkysv55 .rough-node .label text,#mermaid-bvszkysv55 .node .label text,#mermaid-bvszkysv55 .image-shape .label,#mermaid-bvszkysv55 .icon-shape .label{text-anchor:middle;}#mermaid-bvszkysv55 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-bvszkysv55 .rough-node .label,#mermaid-bvszkysv55 .node .label,#mermaid-bvszkysv55 .image-shape .label,#mermaid-bvszkysv55 .icon-shape .label{text-align:center;}#mermaid-bvszkysv55 .node.clickable{cursor:pointer;}#mermaid-bvszkysv55 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-bvszkysv55 .arrowheadPath{fill:lightgrey;}#mermaid-bvszkysv55 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-bvszkysv55 .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-bvszkysv55 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-bvszkysv55 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-bvszkysv55 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-bvszkysv55 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-bvszkysv55 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-bvszkysv55 .cluster text{fill:#F9FFFE;}#mermaid-bvszkysv55 .cluster span{color:#F9FFFE;}#mermaid-bvszkysv55 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-bvszkysv55 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-bvszkysv55 rect.text{fill:none;stroke-width:0;}#mermaid-bvszkysv55 .icon-shape,#mermaid-bvszkysv55 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-bvszkysv55 .icon-shape p,#mermaid-bvszkysv55 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-bvszkysv55 .icon-shape rect,#mermaid-bvszkysv55 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-bvszkysv55 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-bvszkysv55 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-bvszkysv55 :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Aegis Usage

Mixed into

Mixed into

Mixed into

Mixed into

Mixed into

Base class

Base class

CommonBase.sol - VM_ADDRESS constant - CONSOLE constant - vm interface - console2 interface

Script.sol - Inherits CommonBase - Used for deployment scripts

Test.sol - Inherits CommonBase - Inherits StdAssertions - Inherits StdChains - Inherits StdCheats - Inherits StdInvariant - Inherits StdUtils

StdAssertions (assertTrue, assertEq, etc.)

StdChains (Chain ID helpers)

StdCheats (hoax, prank wrappers)

StdInvariant (Fuzzing helpers)

StdUtils (Utility functions)

test/*.t.sol (Inherit Test.sol)

script/*.s.sol (Inherit Script.sol)

Analysis: `CommonBase` provides the foundational VM and console interfaces. `Test.sol` extends this with all testing utilities through multiple inheritance (mixins), while `Script.sol` provides a minimal base for deployment scripts. All Aegis test files inherit from `Test.sol`, giving them access to assertions, cheatcodes, and utilities automatically.

Sources: [contracts/lib/forge-std/README.md#1-267](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L1-L267)

---

## Version ManagementLink copied!

Forge-std is managed as a git submodule in the Aegis repository, allowing precise version control:

Submodule configuration:

- Path:`lib/forge-std`
- Remote:`https://github.com/foundry-rs/forge-std`
- Update strategy: Manual updates via `git submodule update`

Updating forge-std:

```
# Navigate to submodule directory
cd lib/forge-std
 
# Fetch latest changes
git fetch origin
 
# Check out desired version (tag or commit)
git checkout v1.7.0
 
# Return to project root and commit submodule pointer
cd ../..
git add lib/forge-std
git commit -m "Update forge-std to v1.7.0"
```

Version pinning rationale: Using a submodule instead of a package manager ensures that:

1. All developers use the exact same forge-std version
2. CI/CD pipelines have reproducible builds
3. Breaking changes in forge-std don't unexpectedly break Aegis tests

Sources: [contracts/.gitmodules#1-3](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/.gitmodules#L1-L3)

---

## Common Patterns in AegisLink copied!

The following table documents common forge-std usage patterns found throughout the Aegis codebase:

PatternDescriptionExample Location`vm.expectRevert(stdError.*)`Assert that next call reverts with specific errorTest files asserting panic mode blocks swaps`hoax(address(guardian), 1 ether)`Impersonate Guardian with ETH for payable callsGuardian Registry tests simulating LP actions`stdstore.target(...).sig(...).find()`Locate storage slot for state inspectionHook tests verifying internal state variables`console2.log("Step:", stepNumber)`Log deployment progressAll `script/*.s.sol` deployment scripts`vm.prank(sentinelAddress)`Impersonate Sentinel for cross-chain call testsHook tests simulating setPanicMode calls`vm.deal(address, amount)`Set exact ETH balance for test scenariosTests requiring specific balance states

---

## External ResourcesLink copied!

For comprehensive documentation on forge-std capabilities beyond what is used in Aegis:

- Official Documentation:[Foundry Book - Forge-Std Guide](https://book.getfoundry.sh/reference/forge-std/)
- Repository:[foundry-rs/forge-std on GitHub](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry-rs/forge-std on GitHub)
- Cheatcode Reference:[Foundry Cheatcodes](https://book.getfoundry.sh/cheatcodes/)

For troubleshooting and community support:

- Telegram:[Foundry Support Channel](https://t.me/foundry_support)
- Discussions:[GitHub Discussions](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/GitHub Discussions)

Sources: [contracts/lib/forge-std/README.md#252-262](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L252-L262)

---

## LicenseLink copied!

The Forge Standard Library is dual-licensed under MIT and Apache 2.0. When using forge-std in Aegis:

- Aegis license compatibility: Forge-std's permissive licenses allow unrestricted use in both open-source and proprietary projects
- No attribution required: Neither license requires specific attribution beyond preserving the original license files
- Redistribution: If redistributing Aegis with forge-std, include the forge-std license files from `lib/forge-std/LICENSE-MIT` and `lib/forge-std/LICENSE-APACHE`

Sources: [contracts/lib/forge-std/README.md#264-267](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L264-L267)

---

# Testing-Utilities

# Testing UtilitiesLink copied!
Relevant source files
- [contracts/lib/forge-std/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md)
- [contracts/lib/forge-std/src/Base.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol)
- [contracts/lib/forge-std/src/Script.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Script.sol)

## Purpose and ScopeLink copied!

This document covers the testing utility modules provided by the forge-std library that are used throughout the Aegis project for writing and executing tests. These utilities include helpers for error handling (`stdError`), storage manipulation (`stdStorage`), enhanced cheatcodes (`stdCheats`), and console logging facilities. For information about the base test contracts and constants, see [Base Contracts](#7.2). For details on the underlying cheatcode infrastructure, see [Cheatcode Generation](#7.3).

## OverviewLink copied!

The forge-std library provides a collection of testing utilities that enhance Foundry's native cheatcode functionality with improved developer experience. These utilities are accessed by inheriting from the `Test` contract, which aggregates all standard testing modules into a single convenient base class.

#mermaid-1jiz4jsgqsd{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-1jiz4jsgqsd .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-1jiz4jsgqsd .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-1jiz4jsgqsd .error-icon{fill:#a44141;}#mermaid-1jiz4jsgqsd .error-text{fill:#ddd;stroke:#ddd;}#mermaid-1jiz4jsgqsd .edge-thickness-normal{stroke-width:1px;}#mermaid-1jiz4jsgqsd .edge-thickness-thick{stroke-width:3.5px;}#mermaid-1jiz4jsgqsd .edge-pattern-solid{stroke-dasharray:0;}#mermaid-1jiz4jsgqsd .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-1jiz4jsgqsd .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-1jiz4jsgqsd .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-1jiz4jsgqsd .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-1jiz4jsgqsd .marker.cross{stroke:lightgrey;}#mermaid-1jiz4jsgqsd svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-1jiz4jsgqsd p{margin:0;}#mermaid-1jiz4jsgqsd .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-1jiz4jsgqsd .cluster-label text{fill:#F9FFFE;}#mermaid-1jiz4jsgqsd .cluster-label span{color:#F9FFFE;}#mermaid-1jiz4jsgqsd .cluster-label span p{background-color:transparent;}#mermaid-1jiz4jsgqsd .label text,#mermaid-1jiz4jsgqsd span{fill:#ccc;color:#ccc;}#mermaid-1jiz4jsgqsd .node rect,#mermaid-1jiz4jsgqsd .node circle,#mermaid-1jiz4jsgqsd .node ellipse,#mermaid-1jiz4jsgqsd .node polygon,#mermaid-1jiz4jsgqsd .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-1jiz4jsgqsd .rough-node .label text,#mermaid-1jiz4jsgqsd .node .label text,#mermaid-1jiz4jsgqsd .image-shape .label,#mermaid-1jiz4jsgqsd .icon-shape .label{text-anchor:middle;}#mermaid-1jiz4jsgqsd .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-1jiz4jsgqsd .rough-node .label,#mermaid-1jiz4jsgqsd .node .label,#mermaid-1jiz4jsgqsd .image-shape .label,#mermaid-1jiz4jsgqsd .icon-shape .label{text-align:center;}#mermaid-1jiz4jsgqsd .node.clickable{cursor:pointer;}#mermaid-1jiz4jsgqsd .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-1jiz4jsgqsd .arrowheadPath{fill:lightgrey;}#mermaid-1jiz4jsgqsd .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-1jiz4jsgqsd .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-1jiz4jsgqsd .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-1jiz4jsgqsd .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-1jiz4jsgqsd .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-1jiz4jsgqsd .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-1jiz4jsgqsd .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-1jiz4jsgqsd .cluster text{fill:#F9FFFE;}#mermaid-1jiz4jsgqsd .cluster span{color:#F9FFFE;}#mermaid-1jiz4jsgqsd div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-1jiz4jsgqsd .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-1jiz4jsgqsd rect.text{fill:none;stroke-width:0;}#mermaid-1jiz4jsgqsd .icon-shape,#mermaid-1jiz4jsgqsd .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-1jiz4jsgqsd .icon-shape p,#mermaid-1jiz4jsgqsd .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-1jiz4jsgqsd .icon-shape rect,#mermaid-1jiz4jsgqsd .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-1jiz4jsgqsd .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-1jiz4jsgqsd .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-1jiz4jsgqsd :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Supporting Infrastructure

Console Logging

Testing Utilities

Test Contract Hierarchy

Test.sol (Main Entry Point)

TestBase

CommonBase

stdError.sol Compiler Error Codes

StdStorage.sol Storage Manipulation

StdCheats.sol Enhanced Cheatcodes

StdUtils.sol Utility Functions

StdAssertions.sol Test Assertions

console.sol Hardhat Compatible

console2.sol Forge Native

Vm.sol Cheatcode Interface

StdConstants.sol Common Constants

Sources:[contracts/lib/forge-std/README.md#1-267](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L1-L267)[contracts/lib/forge-std/src/Base.sol#1-43](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L1-L43)[contracts/lib/forge-std/src/Script.sol#1-29](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Script.sol#L1-L29)

## stdErrorLink copied!

The `stdError` utility provides a comprehensive set of compiler-generated error codes for use with Foundry's `vm.expectRevert()` cheatcode. This allows tests to verify that contracts revert with specific error types without needing to know the exact revert reason string.

### Available Error CodesLink copied!

The `stdError` contract defines error codes for all Solidity compiler built-in errors, including:

Error TypeUsage Scenario`arithmeticError`Integer overflow/underflow`divisionError`Division or modulo by zero`enumConversionError`Invalid enum value conversion`encodeStorageError`Encoding error for storage array`popError`Pop on empty array`indexOOBError`Array index out of bounds`memOverflowError`Memory allocation overflow`zeroVarError`Zero-initialized function pointer call

### Usage PatternLink copied!

```
import "forge-std/Test.sol";
 
contract MyTest is Test {
    function testArithmeticOverflow() public {
        vm.expectRevert(stdError.arithmeticError);
        someContract.causeOverflow();
    }
    
    function testArrayOutOfBounds() public {
        vm.expectRevert(stdError.indexOOBError);
        someContract.accessInvalidIndex();
    }
}
```

This pattern is used throughout Aegis tests to verify that contracts correctly handle edge cases and invalid inputs.

Sources:[contracts/lib/forge-std/README.md#14-44](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L14-L44)

## stdStorageLink copied!

The `stdStorage` utility provides powerful functionality for finding and manipulating storage slots without requiring knowledge of the contract's storage layout. This is accomplished by recording all `SLOAD` and `SSTORE` operations during function execution and identifying the relevant storage slots.

### ArchitectureLink copied!

#mermaid-h0yompotlid{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-h0yompotlid .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-h0yompotlid .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-h0yompotlid .error-icon{fill:#a44141;}#mermaid-h0yompotlid .error-text{fill:#ddd;stroke:#ddd;}#mermaid-h0yompotlid .edge-thickness-normal{stroke-width:1px;}#mermaid-h0yompotlid .edge-thickness-thick{stroke-width:3.5px;}#mermaid-h0yompotlid .edge-pattern-solid{stroke-dasharray:0;}#mermaid-h0yompotlid .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-h0yompotlid .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-h0yompotlid .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-h0yompotlid .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-h0yompotlid .marker.cross{stroke:lightgrey;}#mermaid-h0yompotlid svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-h0yompotlid p{margin:0;}#mermaid-h0yompotlid .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-h0yompotlid .cluster-label text{fill:#F9FFFE;}#mermaid-h0yompotlid .cluster-label span{color:#F9FFFE;}#mermaid-h0yompotlid .cluster-label span p{background-color:transparent;}#mermaid-h0yompotlid .label text,#mermaid-h0yompotlid span{fill:#ccc;color:#ccc;}#mermaid-h0yompotlid .node rect,#mermaid-h0yompotlid .node circle,#mermaid-h0yompotlid .node ellipse,#mermaid-h0yompotlid .node polygon,#mermaid-h0yompotlid .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-h0yompotlid .rough-node .label text,#mermaid-h0yompotlid .node .label text,#mermaid-h0yompotlid .image-shape .label,#mermaid-h0yompotlid .icon-shape .label{text-anchor:middle;}#mermaid-h0yompotlid .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-h0yompotlid .rough-node .label,#mermaid-h0yompotlid .node .label,#mermaid-h0yompotlid .image-shape .label,#mermaid-h0yompotlid .icon-shape .label{text-align:center;}#mermaid-h0yompotlid .node.clickable{cursor:pointer;}#mermaid-h0yompotlid .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-h0yompotlid .arrowheadPath{fill:lightgrey;}#mermaid-h0yompotlid .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-h0yompotlid .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-h0yompotlid .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-h0yompotlid .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-h0yompotlid .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-h0yompotlid .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-h0yompotlid .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-h0yompotlid .cluster text{fill:#F9FFFE;}#mermaid-h0yompotlid .cluster span{color:#F9FFFE;}#mermaid-h0yompotlid div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-h0yompotlid .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-h0yompotlid rect.text{fill:none;stroke-width:0;}#mermaid-h0yompotlid .icon-shape,#mermaid-h0yompotlid .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-h0yompotlid .icon-shape p,#mermaid-h0yompotlid .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-h0yompotlid .icon-shape rect,#mermaid-h0yompotlid .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-h0yompotlid .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-h0yompotlid .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-h0yompotlid :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Storage Manipulation Flow

target() Set Target Contract

sig() Specify Function Selector

with_key() Add Mapping Keys

depth() Set Struct Field

find() Locate Storage Slot

checked_write() Write to Slot

### Core OperationsLink copied!

#### Finding Storage Slots

The `find()` method locates the storage slot for a variable by:

1. Recording all storage operations during a function call
2. Identifying which slot was accessed
3. Returning the slot number

#### Writing to Storage

The `checked_write()` method safely writes values to storage slots, with protection against accidentally overwriting packed storage variables.

### Usage ExamplesLink copied!

Simple Variable:

```
using stdStorage for StdStorage;
 
uint256 slot = stdstore
    .target(address(myContract))
    .sig("myVariable()")
    .find();
```

Mapping Access:

```
uint256 slot = stdstore
    .target(address(myContract))
    .sig("myMapping(address)")
    .with_key(msg.sender)
    .find();
```

Struct Field Access:

```
uint256 slot = stdstore
    .target(address(myContract))
    .sig("myStruct()")
    .depth(1)  // Access second field
    .find();
```

Direct Write:

```
stdstore
    .target(address(myContract))
    .sig("myVariable()")
    .checked_write(newValue);
```

### Safety MechanismsLink copied!

The `checked_write()` function includes safety checks:

- Prevents writing to packed storage slots (unless uninitialized)
- Validates that the target slot was correctly identified
- Throws execution errors on unsafe operations

This utility is particularly valuable for testing complex contracts where storage layout may change during development, as it eliminates the need to manually track storage slot positions.

Sources:[contracts/lib/forge-std/README.md#46-164](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L46-L164)

## stdCheatsLink copied!

The `stdCheats` module provides developer-friendly wrappers around Foundry's cheatcodes, improving the ergonomics of common testing operations. The primary functionality centers around the `prank` cheatcode and ETH balance management.

### Key FunctionsLink copied!

FunctionDescriptionUse Case`hoax(address)`Sets ETH balance and pranks callerOne-time impersonation with funds`hoax(address, uint256)`Sets specific ETH balance and pranksCustom balance control`startHoax(address)`Sets ETH balance and starts persistent prankMultiple calls as different address`startHoax(address, uint256)`Custom balance with persistent prankExtended impersonation with funds`deal(address, uint256)`Sets ETH balance without prankingBalance setup only

### Design RationaleLink copied!

The standard `vm.prank()` cheatcode does not automatically provide ETH to the impersonated address for security reasons. The `hoax` functions combine pranking with balance setting to streamline tests that require both operations.

### Usage PatternLink copied!

```
import "forge-std/Test.sol";
 
contract PaymentTest is Test {
    function testPayment() public {
        // Give address(1) 100 ETH and impersonate for next call
        hoax(address(1), 100 ether);
        paymentContract.pay{value: 50 ether}();
        
        // For multiple calls, use startHoax
        startHoax(address(2), 10 ether);
        paymentContract.pay{value: 1 ether}();
        paymentContract.pay{value: 1 ether}();
        vm.stopPrank();
    }
}
```

### Safety ConsiderationsLink copied!

Important: The `hoax` function overwrites existing ETH balances. If an address already has ETH that should be preserved, use `vm.prank()` directly. To modify balance without pranking, use `vm.deal()`.

Sources:[contracts/lib/forge-std/README.md#166-216](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L166-L216)

## Console LoggingLink copied!

Forge Standard Library provides two console logging implementations with different trade-offs for compatibility and functionality.

### Console ImplementationsLink copied!

#mermaid-2unjws48g3t{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-2unjws48g3t .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-2unjws48g3t .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-2unjws48g3t .error-icon{fill:#a44141;}#mermaid-2unjws48g3t .error-text{fill:#ddd;stroke:#ddd;}#mermaid-2unjws48g3t .edge-thickness-normal{stroke-width:1px;}#mermaid-2unjws48g3t .edge-thickness-thick{stroke-width:3.5px;}#mermaid-2unjws48g3t .edge-pattern-solid{stroke-dasharray:0;}#mermaid-2unjws48g3t .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-2unjws48g3t .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-2unjws48g3t .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-2unjws48g3t .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-2unjws48g3t .marker.cross{stroke:lightgrey;}#mermaid-2unjws48g3t svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-2unjws48g3t p{margin:0;}#mermaid-2unjws48g3t .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-2unjws48g3t .cluster-label text{fill:#F9FFFE;}#mermaid-2unjws48g3t .cluster-label span{color:#F9FFFE;}#mermaid-2unjws48g3t .cluster-label span p{background-color:transparent;}#mermaid-2unjws48g3t .label text,#mermaid-2unjws48g3t span{fill:#ccc;color:#ccc;}#mermaid-2unjws48g3t .node rect,#mermaid-2unjws48g3t .node circle,#mermaid-2unjws48g3t .node ellipse,#mermaid-2unjws48g3t .node polygon,#mermaid-2unjws48g3t .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-2unjws48g3t .rough-node .label text,#mermaid-2unjws48g3t .node .label text,#mermaid-2unjws48g3t .image-shape .label,#mermaid-2unjws48g3t .icon-shape .label{text-anchor:middle;}#mermaid-2unjws48g3t .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-2unjws48g3t .rough-node .label,#mermaid-2unjws48g3t .node .label,#mermaid-2unjws48g3t .image-shape .label,#mermaid-2unjws48g3t .icon-shape .label{text-align:center;}#mermaid-2unjws48g3t .node.clickable{cursor:pointer;}#mermaid-2unjws48g3t .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-2unjws48g3t .arrowheadPath{fill:lightgrey;}#mermaid-2unjws48g3t .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-2unjws48g3t .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-2unjws48g3t .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-2unjws48g3t .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-2unjws48g3t .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-2unjws48g3t .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-2unjws48g3t .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-2unjws48g3t .cluster text{fill:#F9FFFE;}#mermaid-2unjws48g3t .cluster span{color:#F9FFFE;}#mermaid-2unjws48g3t div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-2unjws48g3t .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-2unjws48g3t rect.text{fill:none;stroke-width:0;}#mermaid-2unjws48g3t .icon-shape,#mermaid-2unjws48g3t .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-2unjws48g3t .icon-shape p,#mermaid-2unjws48g3t .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-2unjws48g3t .icon-shape rect,#mermaid-2unjws48g3t .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-2unjws48g3t .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-2unjws48g3t .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-2unjws48g3t :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Implementation

console2.sol

console.sol

Hardhat Compatible Import: forge-std/console.sol

Known Bug: uint256/int256 not decoded

Forge Optimized Import: forge-std/console2.sol

Proper Trace Decoding All types supported

CONSOLE address 0x000...636F6e736F6c652e6c6f67

staticcall mechanism

### console.sol vs console2.solLink copied!

Featureconsole.solconsole2.solHardhat Compatibility✅ Full❌ NoneForge Trace Decoding⚠️ Broken for uint256/int256✅ All types workRecommended for AegisNoYes

### UsageLink copied!

Recommended (console2.sol):

```
import "forge-std/Test.sol";  // Includes console2
// or
import "forge-std/console2.sol";
 
contract MyTest is Test {
    function testWithLogging() public {
        console2.log("Value:", someValue);
        console2.log("Address:", msg.sender);
        console2.log("Boolean:", true);
    }
}
```

Legacy (console.sol):

```
import "forge-std/console.sol";
 
contract MyTest is Test {
    function testWithLogging() public {
        console.log("This works");
        console.log("But uint256 won't decode properly:", 12345);
    }
}
```

### Implementation DetailsLink copied!

Both console implementations work by executing a `staticcall` to the special address `0x000000000000000000636F6e736F6c652e6c6f67` (defined as `CONSOLE` in [contracts/lib/forge-std/src/Base.sol#13](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L13-L13)). Foundry's VM intercepts these calls and outputs the decoded logs.

### Aegis UsageLink copied!

The Aegis project uses `console2.sol` throughout its test suite to ensure proper trace decoding during test execution. This is particularly important for debugging complex cross-chain interactions where visibility into state changes is critical.

Sources:[contracts/lib/forge-std/README.md#218-246](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L218-L246)[contracts/lib/forge-std/src/Base.sol#11-13](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L11-L13)

## Testing Workflow IntegrationLink copied!

The testing utilities work together to provide a comprehensive testing environment for the Aegis contracts.

#mermaid-ua20t9z2ber{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-ua20t9z2ber .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-ua20t9z2ber .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-ua20t9z2ber .error-icon{fill:#a44141;}#mermaid-ua20t9z2ber .error-text{fill:#ddd;stroke:#ddd;}#mermaid-ua20t9z2ber .edge-thickness-normal{stroke-width:1px;}#mermaid-ua20t9z2ber .edge-thickness-thick{stroke-width:3.5px;}#mermaid-ua20t9z2ber .edge-pattern-solid{stroke-dasharray:0;}#mermaid-ua20t9z2ber .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-ua20t9z2ber .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-ua20t9z2ber .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-ua20t9z2ber .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-ua20t9z2ber .marker.cross{stroke:lightgrey;}#mermaid-ua20t9z2ber svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-ua20t9z2ber p{margin:0;}#mermaid-ua20t9z2ber .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-ua20t9z2ber .cluster-label text{fill:#F9FFFE;}#mermaid-ua20t9z2ber .cluster-label span{color:#F9FFFE;}#mermaid-ua20t9z2ber .cluster-label span p{background-color:transparent;}#mermaid-ua20t9z2ber .label text,#mermaid-ua20t9z2ber span{fill:#ccc;color:#ccc;}#mermaid-ua20t9z2ber .node rect,#mermaid-ua20t9z2ber .node circle,#mermaid-ua20t9z2ber .node ellipse,#mermaid-ua20t9z2ber .node polygon,#mermaid-ua20t9z2ber .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-ua20t9z2ber .rough-node .label text,#mermaid-ua20t9z2ber .node .label text,#mermaid-ua20t9z2ber .image-shape .label,#mermaid-ua20t9z2ber .icon-shape .label{text-anchor:middle;}#mermaid-ua20t9z2ber .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-ua20t9z2ber .rough-node .label,#mermaid-ua20t9z2ber .node .label,#mermaid-ua20t9z2ber .image-shape .label,#mermaid-ua20t9z2ber .icon-shape .label{text-align:center;}#mermaid-ua20t9z2ber .node.clickable{cursor:pointer;}#mermaid-ua20t9z2ber .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-ua20t9z2ber .arrowheadPath{fill:lightgrey;}#mermaid-ua20t9z2ber .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-ua20t9z2ber .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-ua20t9z2ber .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-ua20t9z2ber .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-ua20t9z2ber .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-ua20t9z2ber .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-ua20t9z2ber .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-ua20t9z2ber .cluster text{fill:#F9FFFE;}#mermaid-ua20t9z2ber .cluster span{color:#F9FFFE;}#mermaid-ua20t9z2ber div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-ua20t9z2ber .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-ua20t9z2ber rect.text{fill:none;stroke-width:0;}#mermaid-ua20t9z2ber .icon-shape,#mermaid-ua20t9z2ber .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-ua20t9z2ber .icon-shape p,#mermaid-ua20t9z2ber .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-ua20t9z2ber .icon-shape rect,#mermaid-ua20t9z2ber .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-ua20t9z2ber .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-ua20t9z2ber .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-ua20t9z2ber :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Verification Phase

Test Execution Phase

Test Setup Phase

Inherit from Test.sol

setUp() function

Deploy contracts

hoax() Setup test address

vm.prank() Impersonate caller

stdstore Modify state

console2.log Debug output

vm.expectRevert + stdError

assert* functions

Verify state changes

Verify events

Verify error handling

### Typical Aegis Test StructureLink copied!

```
import "forge-std/Test.sol";
 
contract AegisHookTest is Test {
    using stdStorage for StdStorage;
    
    AegisHook hook;
    
    function setUp() public {
        // Deploy contracts
        hook = new AegisHook(...);
        
        // Setup initial state with stdStorage
        stdstore
            .target(address(hook))
            .sig("panicMode()")
            .checked_write(false);
    }
    
    function testPanicModeActivation() public {
        // Setup test conditions with hoax
        hoax(AUTHORIZED_SENTINEL);
        
        // Log for debugging
        console2.log("Setting panic mode to true");
        
        // Execute state change
        hook.setPanicMode(true);
        
        // Verify state
        assertTrue(hook.panicMode());
        
        // Test that unauthorized users revert
        vm.expectRevert(stdError.accessControl);
        vm.prank(address(0xBEEF));
        hook.setPanicMode(false);
    }
}
```

### Common Testing Patterns in AegisLink copied!

1. Storage Slot Manipulation: Using `stdStorage` to set initial conditions without going through constructor logic
2. Address Impersonation: Using `hoax` to test behavior from different caller addresses with appropriate balances
3. Error Validation: Using `stdError` with `vm.expectRevert` to verify access control and input validation
4. Debug Logging: Using `console2.log` to trace execution flow during complex multi-contract interactions
5. State Verification: Using `stdStorage.find()` to verify that storage slots were correctly modified

Sources:[contracts/lib/forge-std/README.md#1-267](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L1-L267)[contracts/lib/forge-std/src/Base.sol#1-43](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L1-L43)

## Constants and AddressesLink copied!

The testing utilities rely on several well-known addresses defined in `CommonBase` (see [Base Contracts](#7.2) for full documentation):

ConstantValuePurpose`VM_ADDRESS``0x7109709ECfa91a80626fF3989D68f67F5b1DD12D`Cheatcode access point`CONSOLE``0x000000000000000000636F6e736F6c652e6c6f67`Console logging endpoint`DEFAULT_SENDER``0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38`Default tx.origin and msg.sender`DEFAULT_TEST_CONTRACT``0x5615dEB798BB3E4dFa0139dFa1b3D433Cc23b72f`First CREATE'd test contract address

These constants are available to all contracts that inherit from `CommonBase`, `TestBase`, or `ScriptBase`.

Sources:[contracts/lib/forge-std/src/Base.sol#7-36](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L7-L36)

## SummaryLink copied!

The forge-std testing utilities provide essential functionality for writing robust, maintainable tests in the Aegis project:

- stdError enables precise revert testing without hardcoded error messages
- stdStorage allows storage manipulation without knowledge of layout, improving test maintainability
- stdCheats simplifies common testing patterns like address impersonation with balance control
- console2.log provides debugging visibility with proper type decoding in Forge traces

These utilities are accessed by inheriting from `forge-std/Test.sol`, which aggregates all testing functionality into a single convenient base class. Understanding these utilities is essential for contributing tests to the Aegis project and debugging contract behavior during development.

Sources:[contracts/lib/forge-std/README.md#1-267](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L1-L267)

---

# Base-Contracts

# Base ContractsLink copied!
Relevant source files
- [contracts/lib/forge-std/src/Base.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol)
- [contracts/lib/forge-std/src/Script.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Script.sol)

## Purpose and ScopeLink copied!

This page documents the base contracts provided by the forge-std library: `CommonBase`, `TestBase`, and `ScriptBase`. These abstract contracts serve as foundational building blocks for all test and deployment scripts in the Aegis project, providing access to Foundry's cheatcode VM, standardized constants, and storage utilities.

For information about testing utilities built on top of these base contracts, see [Testing Utilities](#7.1). For details on the VM cheatcode interface itself, see [Cheatcode Generation](#7.3).

---

## Contract HierarchyLink copied!

The forge-std base contracts follow a simple inheritance pattern where `CommonBase` provides shared functionality, with specialized extensions for testing (`TestBase`) and deployment (`ScriptBase`).

Sources:[contracts/lib/forge-std/src/Base.sol#7-42](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L7-L42)

---

## CommonBase: The FoundationLink copied!

`CommonBase` is the root abstract contract that all forge-std contracts inherit from. It provides access to Foundry's cheatcode VM and defines standardized addresses used throughout the Ethereum testing ecosystem.

### Core PropertiesLink copied!

PropertyTypeDescription`vm``Vm`Instance of Foundry's cheatcode VM interface`stdstore``StdStorage`Storage manipulation utilities

The `vm` instance provides access to all Foundry cheatcodes for testing and scripting, while `stdstore` enables low-level storage slot manipulation.

Sources:[contracts/lib/forge-std/src/Base.sol#34-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L34-L35)

---

## Standard Address ConstantsLink copied!

`CommonBase` defines seven critical address constants that are deterministically derived and used consistently across all Foundry projects:

#mermaid-2ojbt8wyemd{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-2ojbt8wyemd .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-2ojbt8wyemd .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-2ojbt8wyemd .error-icon{fill:#a44141;}#mermaid-2ojbt8wyemd .error-text{fill:#ddd;stroke:#ddd;}#mermaid-2ojbt8wyemd .edge-thickness-normal{stroke-width:1px;}#mermaid-2ojbt8wyemd .edge-thickness-thick{stroke-width:3.5px;}#mermaid-2ojbt8wyemd .edge-pattern-solid{stroke-dasharray:0;}#mermaid-2ojbt8wyemd .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-2ojbt8wyemd .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-2ojbt8wyemd .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-2ojbt8wyemd .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-2ojbt8wyemd .marker.cross{stroke:lightgrey;}#mermaid-2ojbt8wyemd svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-2ojbt8wyemd p{margin:0;}#mermaid-2ojbt8wyemd .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-2ojbt8wyemd .cluster-label text{fill:#F9FFFE;}#mermaid-2ojbt8wyemd .cluster-label span{color:#F9FFFE;}#mermaid-2ojbt8wyemd .cluster-label span p{background-color:transparent;}#mermaid-2ojbt8wyemd .label text,#mermaid-2ojbt8wyemd span{fill:#ccc;color:#ccc;}#mermaid-2ojbt8wyemd .node rect,#mermaid-2ojbt8wyemd .node circle,#mermaid-2ojbt8wyemd .node ellipse,#mermaid-2ojbt8wyemd .node polygon,#mermaid-2ojbt8wyemd .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-2ojbt8wyemd .rough-node .label text,#mermaid-2ojbt8wyemd .node .label text,#mermaid-2ojbt8wyemd .image-shape .label,#mermaid-2ojbt8wyemd .icon-shape .label{text-anchor:middle;}#mermaid-2ojbt8wyemd .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-2ojbt8wyemd .rough-node .label,#mermaid-2ojbt8wyemd .node .label,#mermaid-2ojbt8wyemd .image-shape .label,#mermaid-2ojbt8wyemd .icon-shape .label{text-align:center;}#mermaid-2ojbt8wyemd .node.clickable{cursor:pointer;}#mermaid-2ojbt8wyemd .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-2ojbt8wyemd .arrowheadPath{fill:lightgrey;}#mermaid-2ojbt8wyemd .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-2ojbt8wyemd .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-2ojbt8wyemd .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-2ojbt8wyemd .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-2ojbt8wyemd .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-2ojbt8wyemd .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-2ojbt8wyemd .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-2ojbt8wyemd .cluster text{fill:#F9FFFE;}#mermaid-2ojbt8wyemd .cluster span{color:#F9FFFE;}#mermaid-2ojbt8wyemd div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-2ojbt8wyemd .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-2ojbt8wyemd rect.text{fill:none;stroke-width:0;}#mermaid-2ojbt8wyemd .icon-shape,#mermaid-2ojbt8wyemd .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-2ojbt8wyemd .icon-shape p,#mermaid-2ojbt8wyemd .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-2ojbt8wyemd .icon-shape rect,#mermaid-2ojbt8wyemd .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-2ojbt8wyemd .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-2ojbt8wyemd .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-2ojbt8wyemd :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Test Execution Addresses

keccak256('foundry default caller')

computed via CREATE nonces

DEFAULT_SENDER 0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38

DEFAULT_TEST_CONTRACT 0x5615dEB798BB3E4dFa0139dFa1b3D433Cc23b72f

Deployment Addresses

CREATE2_FACTORY 0x4e59b44847b379578588920cA78FbF26c0B4956C

MULTICALL3_ADDRESS 0xcA11bde05977b3631167028862bE2a173976CA11

Foundry Infrastructure Addresses

keccak256('hevm cheat code')

bytes11('console.log')

VM_ADDRESS 0x7109709ECfa91a80626fF3989D68f67F5b1DD12D

CONSOLE 0x000000000000000000636F6e736F6c652e6c6f67

### VM_ADDRESSLink copied!

```
address internal constant VM_ADDRESS = 0x7109709ECfa91a80626fF3989D68f67F5b1DD12D;
```

The cheatcode address where Foundry's VM interface is accessible. This address is deterministically calculated as `address(uint160(uint256(keccak256("hevm cheat code"))))`. All cheatcode operations (e.g., `vm.prank()`, `vm.expectRevert()`) target this address.

Sources:[contracts/lib/forge-std/src/Base.sol#8-10](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L8-L10)

### CONSOLELink copied!

```
address internal constant CONSOLE = 0x000000000000000000636F6e736F6c652e6c6f67;
```

The console logging address. Both `console.sol` and `console2.sol` work by executing a staticcall to this address. Derived from `address(uint160(uint88(bytes11("console.log"))))`.

Sources:[contracts/lib/forge-std/src/Base.sol#11-13](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L11-L13)

### CREATE2_FACTORYLink copied!

```
address internal constant CREATE2_FACTORY = 0x4e59b44847b379578588920cA78FbF26c0B4956C;
```

The canonical CREATE2 factory address used for deterministic contract deployment. This is the address of Nick Johnson's deterministic deployment proxy, available on all EVM chains.

Sources:[contracts/lib/forge-std/src/Base.sol#14-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L14-L16)

### DEFAULT_SENDERLink copied!

```
address internal constant DEFAULT_SENDER = 0x1804c8AB1F12E6bbf3894d4083f33e07309d1f38;
```

The default address for `tx.origin` and `msg.sender` in tests. Calculated as `address(uint160(uint256(keccak256("foundry default caller"))))`. Unless explicitly changed via `vm.prank()`, all test transactions originate from this address.

Sources:[contracts/lib/forge-std/src/Base.sol#17-19](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L17-L19)

### DEFAULT_TEST_CONTRACTLink copied!

```
address internal constant DEFAULT_TEST_CONTRACT = 0x5615dEB798BB3E4dFa0139dFa1b3D433Cc23b72f;
```

The address of the first contract `CREATE`d by a running test. When Foundry executes tests, each test contract is deployed by `DEFAULT_SENDER` with nonce 1. This constant represents the computed address at that nonce.

Sources:[contracts/lib/forge-std/src/Base.sol#20-23](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L20-L23)

### MULTICALL3_ADDRESSLink copied!

```
address internal constant MULTICALL3_ADDRESS = 0xcA11bde05977b3631167028862bE2a173976CA11;
```

The deterministic deployment address of the Multicall3 contract. Multicall3 is deployed at this address on all major EVM chains, enabling batch RPC calls.

Sources:[contracts/lib/forge-std/src/Base.sol#24-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L24-L26)

---

## Mathematical ConstantsLink copied!

`CommonBase` defines two fundamental cryptographic and arithmetic constants:

### SECP256K1_ORDERLink copied!

```
uint256 internal constant SECP256K1_ORDER = 
    115792089237316195423570985008687907852837564279074904382605163141518161494337;
```

The order of the secp256k1 elliptic curve used in Ethereum's signature scheme. This constant is essential for cryptographic operations involving ECDSA signatures and private key validation.

Sources:[contracts/lib/forge-std/src/Base.sol#28-29](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L28-L29)

### UINT256_MAXLink copied!

```
uint256 internal constant UINT256_MAX = 
    115792089237316195423570985008687907853269984665640564039457584007913129639935;
```

The maximum value representable by a `uint256` type (`2^256 - 1`). Commonly used in tests for boundary condition testing and approval operations.

Sources:[contracts/lib/forge-std/src/Base.sol#31-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L31-L32)

---

## TestBase vs ScriptBaseLink copied!

While `TestBase` is a simple alias for `CommonBase` with no additional functionality, `ScriptBase` introduces the `vmSafe` instance for restricted cheatcode access during deployment scripts.

#mermaid-j9c0lrwpcrj{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-j9c0lrwpcrj .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-j9c0lrwpcrj .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-j9c0lrwpcrj .error-icon{fill:#a44141;}#mermaid-j9c0lrwpcrj .error-text{fill:#ddd;stroke:#ddd;}#mermaid-j9c0lrwpcrj .edge-thickness-normal{stroke-width:1px;}#mermaid-j9c0lrwpcrj .edge-thickness-thick{stroke-width:3.5px;}#mermaid-j9c0lrwpcrj .edge-pattern-solid{stroke-dasharray:0;}#mermaid-j9c0lrwpcrj .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-j9c0lrwpcrj .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-j9c0lrwpcrj .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-j9c0lrwpcrj .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-j9c0lrwpcrj .marker.cross{stroke:lightgrey;}#mermaid-j9c0lrwpcrj svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-j9c0lrwpcrj p{margin:0;}#mermaid-j9c0lrwpcrj .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-j9c0lrwpcrj .cluster-label text{fill:#F9FFFE;}#mermaid-j9c0lrwpcrj .cluster-label span{color:#F9FFFE;}#mermaid-j9c0lrwpcrj .cluster-label span p{background-color:transparent;}#mermaid-j9c0lrwpcrj .label text,#mermaid-j9c0lrwpcrj span{fill:#ccc;color:#ccc;}#mermaid-j9c0lrwpcrj .node rect,#mermaid-j9c0lrwpcrj .node circle,#mermaid-j9c0lrwpcrj .node ellipse,#mermaid-j9c0lrwpcrj .node polygon,#mermaid-j9c0lrwpcrj .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-j9c0lrwpcrj .rough-node .label text,#mermaid-j9c0lrwpcrj .node .label text,#mermaid-j9c0lrwpcrj .image-shape .label,#mermaid-j9c0lrwpcrj .icon-shape .label{text-anchor:middle;}#mermaid-j9c0lrwpcrj .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-j9c0lrwpcrj .rough-node .label,#mermaid-j9c0lrwpcrj .node .label,#mermaid-j9c0lrwpcrj .image-shape .label,#mermaid-j9c0lrwpcrj .icon-shape .label{text-align:center;}#mermaid-j9c0lrwpcrj .node.clickable{cursor:pointer;}#mermaid-j9c0lrwpcrj .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-j9c0lrwpcrj .arrowheadPath{fill:lightgrey;}#mermaid-j9c0lrwpcrj .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-j9c0lrwpcrj .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-j9c0lrwpcrj .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-j9c0lrwpcrj .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-j9c0lrwpcrj .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-j9c0lrwpcrj .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-j9c0lrwpcrj .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-j9c0lrwpcrj .cluster text{fill:#F9FFFE;}#mermaid-j9c0lrwpcrj .cluster span{color:#F9FFFE;}#mermaid-j9c0lrwpcrj div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-j9c0lrwpcrj .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-j9c0lrwpcrj rect.text{fill:none;stroke-width:0;}#mermaid-j9c0lrwpcrj .icon-shape,#mermaid-j9c0lrwpcrj .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-j9c0lrwpcrj .icon-shape p,#mermaid-j9c0lrwpcrj .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-j9c0lrwpcrj .icon-shape rect,#mermaid-j9c0lrwpcrj .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-j9c0lrwpcrj .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-j9c0lrwpcrj .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-j9c0lrwpcrj :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

ScriptBase

Used in scripts

Broadcast-safe operations

vm (Vm) Full Cheatcode Access

vmSafe (VmSafe) Limited to Safe Operations

stdstore (StdStorage)

TestBase

Used in test contracts

vm (Vm) Full Cheatcode Access

stdstore (StdStorage)

### TestBaseLink copied!

```
abstract contract TestBase is CommonBase {}
```

`TestBase` is an empty extension of `CommonBase` used as the base class for test contracts. It inherits all constants and utilities from `CommonBase` without modification. This separation exists for semantic clarity and potential future extensions specific to testing.

Sources:[contracts/lib/forge-std/src/Base.sol#38](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L38-L38)

### ScriptBaseLink copied!

```
abstract contract ScriptBase is CommonBase {
    VmSafe internal constant vmSafe = VmSafe(VM_ADDRESS);
}
```

`ScriptBase` extends `CommonBase` with the `vmSafe` interface, which provides access to a restricted subset of cheatcodes that are safe to use during broadcast mode. This prevents accidental use of test-only cheatcodes (like `vm.prank()`) in production deployment scripts.

Key Distinction: Scripts inherit both `vm` (full access) and `vmSafe` (restricted access). When broadcasting transactions, only `vmSafe` operations are allowed to execute.

Sources:[contracts/lib/forge-std/src/Base.sol#40-42](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L40-L42)

---

## Usage in Aegis Deployment ScriptsLink copied!

The Aegis project's deployment scripts demonstrate typical usage of `ScriptBase` through the `Script` contract, which extends `ScriptBase` with additional utilities.

"CommonBase""ScriptBase""Script (forge-std)""04_DeployOracle.s.sol""Developer""CommonBase""ScriptBase""Script (forge-std)""04_DeployOracle.s.sol""Developer"#mermaid-5lgmpztpeuf{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-5lgmpztpeuf .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-5lgmpztpeuf .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-5lgmpztpeuf .error-icon{fill:#a44141;}#mermaid-5lgmpztpeuf .error-text{fill:#ddd;stroke:#ddd;}#mermaid-5lgmpztpeuf .edge-thickness-normal{stroke-width:1px;}#mermaid-5lgmpztpeuf .edge-thickness-thick{stroke-width:3.5px;}#mermaid-5lgmpztpeuf .edge-pattern-solid{stroke-dasharray:0;}#mermaid-5lgmpztpeuf .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-5lgmpztpeuf .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-5lgmpztpeuf .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-5lgmpztpeuf .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-5lgmpztpeuf .marker.cross{stroke:lightgrey;}#mermaid-5lgmpztpeuf svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-5lgmpztpeuf p{margin:0;}#mermaid-5lgmpztpeuf .actor{stroke:#ccc;fill:#1f2020;}#mermaid-5lgmpztpeuf text.actor>tspan{fill:lightgrey;stroke:none;}#mermaid-5lgmpztpeuf .actor-line{stroke:#ccc;}#mermaid-5lgmpztpeuf .innerArc{stroke-width:1.5;stroke-dasharray:none;}#mermaid-5lgmpztpeuf .messageLine0{stroke-width:1.5;stroke-dasharray:none;stroke:lightgrey;}#mermaid-5lgmpztpeuf .messageLine1{stroke-width:1.5;stroke-dasharray:2,2;stroke:lightgrey;}#mermaid-5lgmpztpeuf #arrowhead path{fill:lightgrey;stroke:lightgrey;}#mermaid-5lgmpztpeuf .sequenceNumber{fill:black;}#mermaid-5lgmpztpeuf #sequencenumber{fill:lightgrey;}#mermaid-5lgmpztpeuf #crosshead path{fill:lightgrey;stroke:lightgrey;}#mermaid-5lgmpztpeuf .messageText{fill:lightgrey;stroke:none;}#mermaid-5lgmpztpeuf .labelBox{stroke:#ccc;fill:#1f2020;}#mermaid-5lgmpztpeuf .labelText,#mermaid-5lgmpztpeuf .labelText>tspan{fill:lightgrey;stroke:none;}#mermaid-5lgmpztpeuf .loopText,#mermaid-5lgmpztpeuf .loopText>tspan{fill:lightgrey;stroke:none;}#mermaid-5lgmpztpeuf .loopLine{stroke-width:2px;stroke-dasharray:2,2;stroke:#ccc;fill:#ccc;}#mermaid-5lgmpztpeuf .note{stroke:hsl(180, 0%, 18.3529411765%);fill:hsl(180, 1.5873015873%, 28.3529411765%);}#mermaid-5lgmpztpeuf .noteText,#mermaid-5lgmpztpeuf .noteText>tspan{fill:rgb(183.8476190475, 181.5523809523, 181.5523809523);stroke:none;}#mermaid-5lgmpztpeuf .activation0{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-5lgmpztpeuf .activation1{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-5lgmpztpeuf .activation2{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:#ccc;}#mermaid-5lgmpztpeuf .actorPopupMenu{position:absolute;}#mermaid-5lgmpztpeuf .actorPopupMenuPanel{position:absolute;fill:#1f2020;box-shadow:0px 8px 16px 0px rgba(0,0,0,0.2);filter:drop-shadow(3px 5px 2px rgb(0 0 0 / 0.4));}#mermaid-5lgmpztpeuf .actor-man line{stroke:#ccc;fill:#1f2020;}#mermaid-5lgmpztpeuf .actor-man circle,#mermaid-5lgmpztpeuf line{stroke:#ccc;fill:#1f2020;stroke-width:2px;}#mermaid-5lgmpztpeuf :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}"forge script 04_DeployOracle.s.sol""inherits from Script""inherits ScriptBase""inherits CommonBase""access vm cheatcodes""vm.startBroadcast()""access constants""DEFAULT_SENDER, CREATE2_FACTORY""use vmSafe for reads""vmSafe.envAddress()"

### Example: DeployOracle.s.solLink copied!

Aegis deployment scripts (located in `script/`) inherit from `Script`, which itself inherits from `ScriptBase`:

```
contract DeployOracle is Script {
    function run() external {
        // Access vm from CommonBase
        vm.startBroadcast();
        
        // Access vmSafe from ScriptBase for safe environment reads
        address deployer = vmSafe.envAddress("DEPLOYER_ADDRESS");
        
        // Use CREATE2_FACTORY constant from CommonBase
        // for deterministic deployments
        
        MockOracle oracle = new MockOracle(...);
        
        vm.stopBroadcast();
    }
}
```

Sources:[contracts/lib/forge-std/src/Script.sol#1-28](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Script.sol#L1-L28)[contracts/lib/forge-std/src/Base.sol#40-42](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L40-L42)

---

## Relationship with StdStorage and VmLink copied!

The base contracts provide initialized instances of two critical forge-std components:

InstanceTypeSource ContractPurpose`vm``Vm``CommonBase`Full cheatcode access (prank, warp, expectRevert, etc.)`vmSafe``VmSafe``ScriptBase`Broadcast-safe cheatcodes only (envAddress, rpc, etc.)`stdstore``StdStorage``CommonBase`Storage slot manipulation utilities

#mermaid-e6qp4fvfp4{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-e6qp4fvfp4 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-e6qp4fvfp4 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-e6qp4fvfp4 .error-icon{fill:#a44141;}#mermaid-e6qp4fvfp4 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-e6qp4fvfp4 .edge-thickness-normal{stroke-width:1px;}#mermaid-e6qp4fvfp4 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-e6qp4fvfp4 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-e6qp4fvfp4 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-e6qp4fvfp4 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-e6qp4fvfp4 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-e6qp4fvfp4 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-e6qp4fvfp4 .marker.cross{stroke:lightgrey;}#mermaid-e6qp4fvfp4 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-e6qp4fvfp4 p{margin:0;}#mermaid-e6qp4fvfp4 .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-e6qp4fvfp4 .cluster-label text{fill:#F9FFFE;}#mermaid-e6qp4fvfp4 .cluster-label span{color:#F9FFFE;}#mermaid-e6qp4fvfp4 .cluster-label span p{background-color:transparent;}#mermaid-e6qp4fvfp4 .label text,#mermaid-e6qp4fvfp4 span{fill:#ccc;color:#ccc;}#mermaid-e6qp4fvfp4 .node rect,#mermaid-e6qp4fvfp4 .node circle,#mermaid-e6qp4fvfp4 .node ellipse,#mermaid-e6qp4fvfp4 .node polygon,#mermaid-e6qp4fvfp4 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-e6qp4fvfp4 .rough-node .label text,#mermaid-e6qp4fvfp4 .node .label text,#mermaid-e6qp4fvfp4 .image-shape .label,#mermaid-e6qp4fvfp4 .icon-shape .label{text-anchor:middle;}#mermaid-e6qp4fvfp4 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-e6qp4fvfp4 .rough-node .label,#mermaid-e6qp4fvfp4 .node .label,#mermaid-e6qp4fvfp4 .image-shape .label,#mermaid-e6qp4fvfp4 .icon-shape .label{text-align:center;}#mermaid-e6qp4fvfp4 .node.clickable{cursor:pointer;}#mermaid-e6qp4fvfp4 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-e6qp4fvfp4 .arrowheadPath{fill:lightgrey;}#mermaid-e6qp4fvfp4 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-e6qp4fvfp4 .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-e6qp4fvfp4 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-e6qp4fvfp4 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-e6qp4fvfp4 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-e6qp4fvfp4 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-e6qp4fvfp4 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-e6qp4fvfp4 .cluster text{fill:#F9FFFE;}#mermaid-e6qp4fvfp4 .cluster span{color:#F9FFFE;}#mermaid-e6qp4fvfp4 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-e6qp4fvfp4 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-e6qp4fvfp4 rect.text{fill:none;stroke-width:0;}#mermaid-e6qp4fvfp4 .icon-shape,#mermaid-e6qp4fvfp4 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-e6qp4fvfp4 .icon-shape p,#mermaid-e6qp4fvfp4 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-e6qp4fvfp4 .icon-shape rect,#mermaid-e6qp4fvfp4 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-e6qp4fvfp4 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-e6qp4fvfp4 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-e6qp4fvfp4 :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

instantiates vm

declares stdstore

instantiates vmSafe

extends

CommonBase

Vm interface contracts/lib/forge-std/src/Vm.sol

VmSafe interface contracts/lib/forge-std/src/Vm.sol

StdStorage library contracts/lib/forge-std/src/StdStorage.sol

ScriptBase

Sources:[contracts/lib/forge-std/src/Base.sol#4-5](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L4-L5)[contracts/lib/forge-std/src/Base.sol#34-35](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L34-L35)[contracts/lib/forge-std/src/Base.sol#41](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L41-L41)

---

## Constants Usage TableLink copied!

ConstantUsed In Aegis ForExample Context`VM_ADDRESS`Accessing cheatcodes in testsTest contract initialization`CONSOLE`Debug logging during developmentConsole output in test failures`CREATE2_FACTORY`Deterministic hook address deploymentMining Uniswap v4 hook addresses`DEFAULT_SENDER`Default test transaction senderIdentifying test originator in logs`DEFAULT_TEST_CONTRACT`Test contract address expectationsVerifying deployment addresses`MULTICALL3_ADDRESS`Batch RPC operations (future)Not currently used in Aegis`SECP256K1_ORDER`Private key validationGuardian NFT signature verification`UINT256_MAX`Token approval operationsInfinite approval patterns

Sources:[contracts/lib/forge-std/src/Base.sol#7-36](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L7-L36)

---

## SummaryLink copied!

The forge-std base contracts provide a standardized foundation for Aegis's testing and deployment infrastructure. By inheriting from `CommonBase`, `TestBase`, or `ScriptBase`, all Aegis contracts gain access to:

1. Cheatcode VM Access: Through the `vm` and `vmSafe` instances
2. Standard Addresses: Deterministic addresses for testing and deployment
3. Mathematical Constants: Cryptographic and arithmetic primitives
4. Storage Utilities: Low-level storage manipulation via `stdstore`

This abstraction ensures consistency across all Aegis scripts and tests, enabling reliable multi-chain deployment and comprehensive testing coverage.

Sources:[contracts/lib/forge-std/src/Base.sol#1-43](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Base.sol#L1-L43)[contracts/lib/forge-std/src/Script.sol#1-29](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/src/Script.sol#L1-L29)

---

# Cheatcode-Generation

# Cheatcode GenerationLink copied!
Relevant source files
- [contracts/lib/forge-std/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md)
- [contracts/lib/forge-std/scripts/vm.py](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py)

This page documents the automated code generation system that produces the `Vm.sol` interface file from Foundry's cheatcodes specification. The `vm.py` script downloads or reads a JSON definition of all available Foundry cheatcodes and generates type-safe Solidity interfaces that forge-std tests and scripts can use.

For information about how to use the generated cheatcodes in tests, see [Testing Utilities](#7.1). For information about the base contracts that import these interfaces, see [Base Contracts](#7.2).

---

## OverviewLink copied!

The [contracts/lib/forge-std/scripts/vm.py#1-647](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L1-L647) script is a Python-based code generator that transforms Foundry's canonical cheatcode definitions into Solidity interface files. This automation ensures that forge-std's cheatcode interfaces remain synchronized with the Foundry toolchain without manual maintenance.

Key Components:

- Input: `cheatcodes.json` from Foundry's repository (or local file)
- Output: `src/Vm.sol` containing `VmSafe` and `Vm` interfaces
- Processing: Parsing, filtering, sorting, and code generation
- Post-processing: Automatic formatting via `forge fmt`

---

## System ArchitectureLink copied!

#mermaid-hecaohmipev{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-hecaohmipev .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-hecaohmipev .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-hecaohmipev .error-icon{fill:#a44141;}#mermaid-hecaohmipev .error-text{fill:#ddd;stroke:#ddd;}#mermaid-hecaohmipev .edge-thickness-normal{stroke-width:1px;}#mermaid-hecaohmipev .edge-thickness-thick{stroke-width:3.5px;}#mermaid-hecaohmipev .edge-pattern-solid{stroke-dasharray:0;}#mermaid-hecaohmipev .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-hecaohmipev .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-hecaohmipev .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-hecaohmipev .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-hecaohmipev .marker.cross{stroke:lightgrey;}#mermaid-hecaohmipev svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-hecaohmipev p{margin:0;}#mermaid-hecaohmipev .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-hecaohmipev .cluster-label text{fill:#F9FFFE;}#mermaid-hecaohmipev .cluster-label span{color:#F9FFFE;}#mermaid-hecaohmipev .cluster-label span p{background-color:transparent;}#mermaid-hecaohmipev .label text,#mermaid-hecaohmipev span{fill:#ccc;color:#ccc;}#mermaid-hecaohmipev .node rect,#mermaid-hecaohmipev .node circle,#mermaid-hecaohmipev .node ellipse,#mermaid-hecaohmipev .node polygon,#mermaid-hecaohmipev .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-hecaohmipev .rough-node .label text,#mermaid-hecaohmipev .node .label text,#mermaid-hecaohmipev .image-shape .label,#mermaid-hecaohmipev .icon-shape .label{text-anchor:middle;}#mermaid-hecaohmipev .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-hecaohmipev .rough-node .label,#mermaid-hecaohmipev .node .label,#mermaid-hecaohmipev .image-shape .label,#mermaid-hecaohmipev .icon-shape .label{text-align:center;}#mermaid-hecaohmipev .node.clickable{cursor:pointer;}#mermaid-hecaohmipev .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-hecaohmipev .arrowheadPath{fill:lightgrey;}#mermaid-hecaohmipev .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-hecaohmipev .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-hecaohmipev .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-hecaohmipev .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-hecaohmipev .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-hecaohmipev .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-hecaohmipev .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-hecaohmipev .cluster text{fill:#F9FFFE;}#mermaid-hecaohmipev .cluster span{color:#F9FFFE;}#mermaid-hecaohmipev div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-hecaohmipev .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-hecaohmipev rect.text{fill:none;stroke-width:0;}#mermaid-hecaohmipev .icon-shape,#mermaid-hecaohmipev .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-hecaohmipev .icon-shape p,#mermaid-hecaohmipev .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-hecaohmipev .icon-shape rect,#mermaid-hecaohmipev .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-hecaohmipev .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-hecaohmipev .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-hecaohmipev :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Output

vm.py Script

Input Sources

URL fetch

--from arg

Foundry Repository cheatcodes.json (GitHub Raw URL)

Local File cheatcodes.json (--from PATH)

main() Entry Point

Cheatcodes.from_json() JSON Parser

Filter & Sort safe vs unsafe

CheatcodesPrinter Code Generator

src/Vm.sol Generated Interface

Formatted Output (forge fmt)

Generation Workflow

Sources: [contracts/lib/forge-std/scripts/vm.py#30-108](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L30-L108)

---

## Data ModelLink copied!

The script uses Python dataclasses to model the JSON structure. These classes provide type safety during code generation and correspond directly to the cheatcodes JSON schema.

#mermaid-u77ddfbmgib{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-u77ddfbmgib .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-u77ddfbmgib .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-u77ddfbmgib .error-icon{fill:#a44141;}#mermaid-u77ddfbmgib .error-text{fill:#ddd;stroke:#ddd;}#mermaid-u77ddfbmgib .edge-thickness-normal{stroke-width:1px;}#mermaid-u77ddfbmgib .edge-thickness-thick{stroke-width:3.5px;}#mermaid-u77ddfbmgib .edge-pattern-solid{stroke-dasharray:0;}#mermaid-u77ddfbmgib .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-u77ddfbmgib .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-u77ddfbmgib .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-u77ddfbmgib .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-u77ddfbmgib .marker.cross{stroke:lightgrey;}#mermaid-u77ddfbmgib svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-u77ddfbmgib p{margin:0;}#mermaid-u77ddfbmgib g.classGroup text{fill:#ccc;stroke:none;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:10px;}#mermaid-u77ddfbmgib g.classGroup text .title{font-weight:bolder;}#mermaid-u77ddfbmgib .nodeLabel,#mermaid-u77ddfbmgib .edgeLabel{color:#e0dfdf;}#mermaid-u77ddfbmgib .edgeLabel .label rect{fill:#1f2020;}#mermaid-u77ddfbmgib .label text{fill:#e0dfdf;}#mermaid-u77ddfbmgib .labelBkg{background:#1f2020;}#mermaid-u77ddfbmgib .edgeLabel .label span{background:#1f2020;}#mermaid-u77ddfbmgib .classTitle{font-weight:bolder;}#mermaid-u77ddfbmgib .node rect,#mermaid-u77ddfbmgib .node circle,#mermaid-u77ddfbmgib .node ellipse,#mermaid-u77ddfbmgib .node polygon,#mermaid-u77ddfbmgib .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-u77ddfbmgib .divider{stroke:#ccc;stroke-width:1;}#mermaid-u77ddfbmgib g.clickable{cursor:pointer;}#mermaid-u77ddfbmgib g.classGroup rect{fill:#1f2020;stroke:#ccc;}#mermaid-u77ddfbmgib g.classGroup line{stroke:#ccc;stroke-width:1;}#mermaid-u77ddfbmgib .classLabel .box{stroke:none;stroke-width:0;fill:#1f2020;opacity:0.5;}#mermaid-u77ddfbmgib .classLabel .label{fill:#ccc;font-size:10px;}#mermaid-u77ddfbmgib .relation{stroke:lightgrey;stroke-width:1;fill:none;}#mermaid-u77ddfbmgib .dashed-line{stroke-dasharray:3;}#mermaid-u77ddfbmgib .dotted-line{stroke-dasharray:1 2;}#mermaid-u77ddfbmgib #compositionStart,#mermaid-u77ddfbmgib .composition{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #compositionEnd,#mermaid-u77ddfbmgib .composition{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #dependencyStart,#mermaid-u77ddfbmgib .dependency{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #dependencyStart,#mermaid-u77ddfbmgib .dependency{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #extensionStart,#mermaid-u77ddfbmgib .extension{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #extensionEnd,#mermaid-u77ddfbmgib .extension{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #aggregationStart,#mermaid-u77ddfbmgib .aggregation{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #aggregationEnd,#mermaid-u77ddfbmgib .aggregation{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #lollipopStart,#mermaid-u77ddfbmgib .lollipop{fill:#1f2020!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #lollipopEnd,#mermaid-u77ddfbmgib .lollipop{fill:#1f2020!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib .edgeTerminals{font-size:11px;line-height:initial;}#mermaid-u77ddfbmgib .classTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-u77ddfbmgib .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-u77ddfbmgib .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-u77ddfbmgib :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Cheatcodes

+list<Error> errors

+list<Event> events

+list<Enum> enums

+list<Struct> structs

+list<Cheatcode> cheatcodes

+from_json(str) : Cheatcodes

+from_dict(dict) : Cheatcodes

Cheatcode

+Function func

+str group

+str status

+str safety

+from_dict(dict) : Cheatcode

Function

+str id

+str description

+str declaration

+Visibility visibility

+Mutability mutability

+str signature

+str selector

+bytes selector_bytes

+from_dict(dict) : Function

Error

+str name

+str description

+str declaration

Event

+str name

+str description

+str declaration

Enum

+str name

+str description

+list<EnumVariant> variants

Struct

+str name

+str description

+list<StructField> fields

Core Data Classes

ClassPurposeKey Fields`Cheatcodes`Root container`cheatcodes`, `errors`, `events`, `enums`, `structs``Cheatcode`Single cheatcode definition`func`, `group`, `status`, `safety``Function`Function signature details`declaration`, `signature`, `selector``Error`Custom error definition`name`, `declaration``Event`Event definition`name`, `declaration``Enum`Enum type definition`name`, `variants``Struct`Struct type definition`name`, `fields`

Sources: [contracts/lib/forge-std/scripts/vm.py#181-374](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L181-L374)

---

## Code Generation ProcessLink copied!

The `CheatcodesPrinter` class is responsible for transforming the parsed data model into valid Solidity code. It maintains state for indentation, formatting preferences, and output buffering.

#mermaid-9t44y8e1135{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-9t44y8e1135 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-9t44y8e1135 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-9t44y8e1135 .error-icon{fill:#a44141;}#mermaid-9t44y8e1135 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-9t44y8e1135 .edge-thickness-normal{stroke-width:1px;}#mermaid-9t44y8e1135 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-9t44y8e1135 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-9t44y8e1135 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-9t44y8e1135 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-9t44y8e1135 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-9t44y8e1135 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-9t44y8e1135 .marker.cross{stroke:lightgrey;}#mermaid-9t44y8e1135 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-9t44y8e1135 p{margin:0;}#mermaid-9t44y8e1135 .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-9t44y8e1135 .cluster-label text{fill:#F9FFFE;}#mermaid-9t44y8e1135 .cluster-label span{color:#F9FFFE;}#mermaid-9t44y8e1135 .cluster-label span p{background-color:transparent;}#mermaid-9t44y8e1135 .label text,#mermaid-9t44y8e1135 span{fill:#ccc;color:#ccc;}#mermaid-9t44y8e1135 .node rect,#mermaid-9t44y8e1135 .node circle,#mermaid-9t44y8e1135 .node ellipse,#mermaid-9t44y8e1135 .node polygon,#mermaid-9t44y8e1135 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-9t44y8e1135 .rough-node .label text,#mermaid-9t44y8e1135 .node .label text,#mermaid-9t44y8e1135 .image-shape .label,#mermaid-9t44y8e1135 .icon-shape .label{text-anchor:middle;}#mermaid-9t44y8e1135 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-9t44y8e1135 .rough-node .label,#mermaid-9t44y8e1135 .node .label,#mermaid-9t44y8e1135 .image-shape .label,#mermaid-9t44y8e1135 .icon-shape .label{text-align:center;}#mermaid-9t44y8e1135 .node.clickable{cursor:pointer;}#mermaid-9t44y8e1135 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-9t44y8e1135 .arrowheadPath{fill:lightgrey;}#mermaid-9t44y8e1135 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-9t44y8e1135 .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-9t44y8e1135 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-9t44y8e1135 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-9t44y8e1135 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-9t44y8e1135 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-9t44y8e1135 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-9t44y8e1135 .cluster text{fill:#F9FFFE;}#mermaid-9t44y8e1135 .cluster span{color:#F9FFFE;}#mermaid-9t44y8e1135 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-9t44y8e1135 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-9t44y8e1135 rect.text{fill:none;stroke-width:0;}#mermaid-9t44y8e1135 .icon-shape,#mermaid-9t44y8e1135 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-9t44y8e1135 .icon-shape p,#mermaid-9t44y8e1135 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-9t44y8e1135 .icon-shape rect,#mermaid-9t44y8e1135 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-9t44y8e1135 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-9t44y8e1135 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-9t44y8e1135 :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Post-Processing

Item Rendering

Generation Phases

CheatcodesPrinter Configuration

Input Processing

cheatcodes.json

Cheatcodes Object Tree

Filtered Lists safe[] & unsafe[]

Printer Config spdx_identifier solidity_requirement abicoder_pragma indent_level

p_prelude() License & Pragma

p_contract(VmSafe) Safe Cheatcodes

p_contract(Vm) Unsafe Cheatcodes inherits VmSafe

p_errors()

p_events()

p_enums()

p_structs()

p_functions()

memory → calldata Compatibility Fix

forge fmt Code Formatting

Code Generation Algorithm

Sources: [contracts/lib/forge-std/scripts/vm.py#409-643](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L409-L643)

### Filtering and SortingLink copied!

The script applies several filters and sorts to organize cheatcodes:

```
# Filter out experimental and internal cheatcodes
ccs = list(filter(lambda cc: cc.status not in ["experimental", "internal"], ccs))
 
# Sort by function ID
ccs.sort(key=lambda cc: cc.func.id)
 
# Separate by safety classification
safe = list(filter(lambda cc: cc.safety == "safe", ccs))
unsafe = list(filter(lambda cc: cc.safety == "unsafe", ccs))
```

Sources: [contracts/lib/forge-std/scripts/vm.py#43-51](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L43-L51)

### Output StructureLink copied!

The generator produces two interfaces:

InterfaceInheritancePurposeCheatcodes Included`VmSafe`NoneSafe operations only`safety == "safe"``Vm``VmSafe`Full test capabilities`safety == "unsafe"`

VmSafe Interface: Contains cheatcodes that do not manipulate EVM state in ways that could cause script simulations to differ from on-chain execution. Recommended for deployment scripts.

Vm Interface: Inherits from `VmSafe` and adds state-manipulating cheatcodes like `prank`, `roll`, `warp`, etc. Intended for testing only.

Sources: [contracts/lib/forge-std/scripts/vm.py#18-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L18-L27)[contracts/lib/forge-std/scripts/vm.py#69-92](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L69-L92)

---

## Printer ArchitectureLink copied!

The `CheatcodesPrinter` class uses a state machine pattern with an internal buffer and indentation tracking.

#mermaid-x8tqxuhq1if{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-x8tqxuhq1if .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-x8tqxuhq1if .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-x8tqxuhq1if .error-icon{fill:#a44141;}#mermaid-x8tqxuhq1if .error-text{fill:#ddd;stroke:#ddd;}#mermaid-x8tqxuhq1if .edge-thickness-normal{stroke-width:1px;}#mermaid-x8tqxuhq1if .edge-thickness-thick{stroke-width:3.5px;}#mermaid-x8tqxuhq1if .edge-pattern-solid{stroke-dasharray:0;}#mermaid-x8tqxuhq1if .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-x8tqxuhq1if .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-x8tqxuhq1if .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-x8tqxuhq1if .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-x8tqxuhq1if .marker.cross{stroke:lightgrey;}#mermaid-x8tqxuhq1if svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-x8tqxuhq1if p{margin:0;}#mermaid-x8tqxuhq1if .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-x8tqxuhq1if .cluster-label text{fill:#F9FFFE;}#mermaid-x8tqxuhq1if .cluster-label span{color:#F9FFFE;}#mermaid-x8tqxuhq1if .cluster-label span p{background-color:transparent;}#mermaid-x8tqxuhq1if .label text,#mermaid-x8tqxuhq1if span{fill:#ccc;color:#ccc;}#mermaid-x8tqxuhq1if .node rect,#mermaid-x8tqxuhq1if .node circle,#mermaid-x8tqxuhq1if .node ellipse,#mermaid-x8tqxuhq1if .node polygon,#mermaid-x8tqxuhq1if .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-x8tqxuhq1if .rough-node .label text,#mermaid-x8tqxuhq1if .node .label text,#mermaid-x8tqxuhq1if .image-shape .label,#mermaid-x8tqxuhq1if .icon-shape .label{text-anchor:middle;}#mermaid-x8tqxuhq1if .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-x8tqxuhq1if .rough-node .label,#mermaid-x8tqxuhq1if .node .label,#mermaid-x8tqxuhq1if .image-shape .label,#mermaid-x8tqxuhq1if .icon-shape .label{text-align:center;}#mermaid-x8tqxuhq1if .node.clickable{cursor:pointer;}#mermaid-x8tqxuhq1if .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-x8tqxuhq1if .arrowheadPath{fill:lightgrey;}#mermaid-x8tqxuhq1if .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-x8tqxuhq1if .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-x8tqxuhq1if .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-x8tqxuhq1if .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-x8tqxuhq1if .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-x8tqxuhq1if .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-x8tqxuhq1if .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-x8tqxuhq1if .cluster text{fill:#F9FFFE;}#mermaid-x8tqxuhq1if .cluster span{color:#F9FFFE;}#mermaid-x8tqxuhq1if div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-x8tqxuhq1if .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-x8tqxuhq1if rect.text{fill:none;stroke-width:0;}#mermaid-x8tqxuhq1if .icon-shape,#mermaid-x8tqxuhq1if .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-x8tqxuhq1if .icon-shape p,#mermaid-x8tqxuhq1if .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-x8tqxuhq1if .icon-shape rect,#mermaid-x8tqxuhq1if .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-x8tqxuhq1if .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-x8tqxuhq1if .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-x8tqxuhq1if :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

High-Level Methods

Output Methods

CheatcodesPrinter State

buffer: str Accumulated Output

indent_level: int Current Nesting

_indent_str: str Whitespace Unit

_p_str(txt) Append Text

_p_nl() Newline

_p_indent() Add Indentation

_p_line(fn) Indent + fn + Newline

p_contract() Interface Generation

p_function() Function Declaration

_p_comment() NatSpec Comments

Key Printer Methods

MethodPurposeUsage`p_contract()`Generate interface definitionCalled for `VmSafe` and `Vm``p_function()`Generate function declarationCalled for each cheatcode`p_structs()`Generate struct definitionsShared types like `Rpc`, `FsMetadata``p_enums()`Generate enum definitionsTypes like `ForgeContext``_p_comment()`Generate NatSpec documentationFunction descriptions`_with_indent()`Execute with increased indentationBlocks and nested items`finish()`Return buffer and resetCalled after each interface

Sources: [contracts/lib/forge-std/scripts/vm.py#409-643](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L409-L643)

---

## Item OrderingLink copied!

The `ItemOrder` class controls the sequence in which interface members are generated:

```
ItemOrder.default() = [
    Item.ERROR,    # Custom error definitions
    Item.EVENT,    # Event definitions
    Item.ENUM,     # Enum type definitions
    Item.STRUCT,   # Struct type definitions
    Item.FUNCTION, # Function declarations
]
```

This ordering ensures that types are declared before they are referenced in function signatures, satisfying Solidity's forward reference requirements.

Sources: [contracts/lib/forge-std/scripts/vm.py#376-406](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L376-L406)

---

## Group HeadersLink copied!

Cheatcodes are organized by functional group (e.g., "evm", "testing", "json"). The script injects comment headers to visually separate groups:

```
// ======== EVM ========
function roll(uint256 blockNumber) external;
function warp(uint256 timestamp) external;
 
// ======== Testing ========
function expectRevert() external;
function expectEmit() external;
```

This is implemented via the `prefix_with_group_headers()` function, which inserts synthetic cheatcodes with group headers as their declarations.

Sources: [contracts/lib/forge-std/scripts/vm.py#138-160](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L138-L160)

---

## Cheatcode ComparisonLink copied!

The `CmpCheatcode` class defines a total ordering for cheatcodes based on multiple criteria:

```
def cmp_cheatcode(a: Cheatcode, b: Cheatcode) -> int:
    if a.group != b.group:
        return -1 if a.group < b.group else 1
    if a.status != b.status:
        return -1 if a.status < b.status else 1
    if a.safety != b.safety:
        return -1 if a.safety < b.safety else 1
    if a.func.id != b.func.id:
        return -1 if a.func.id < b.func.id else 1
    return 0
```

Sorting Priority:

1. Group (alphabetical)
2. Status (e.g., "stable" before "deprecated")
3. Safety ("safe" before "unsafe")
4. Function ID (lexicographic)

Sources: [contracts/lib/forge-std/scripts/vm.py#110-136](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L110-L136)

---

## Running the ScriptLink copied!

### Basic UsageLink copied!

```
# Download cheatcodes.json from Foundry repository and generate Vm.sol
python3 contracts/lib/forge-std/scripts/vm.py
```

### Using Local Cheatcodes FileLink copied!

```
# Generate from a local cheatcodes.json file
python3 contracts/lib/forge-std/scripts/vm.py --from /path/to/cheatcodes.json
```

### Output LocationLink copied!

The generated file is always written to `src/Vm.sol` relative to the forge-std root.

Sources: [contracts/lib/forge-std/scripts/vm.py#30-41](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L30-L41)[contracts/lib/forge-std/scripts/vm.py#100-107](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L100-L107)

---

## Compatibility TransformationsLink copied!

The script applies post-generation transformations to ensure compatibility with older Solidity versions:

### Memory to Calldata ConversionLink copied!

For Solidity versions `<0.8.0`, the script converts `memory` to `calldata` for function parameters using a regex transformation:

```
def memory_to_calldata(m: re.Match) -> str:
    return " calldata " + m.group(1)
 
out = re.sub(r" memory (.*returns)", memory_to_calldata, out)
```

This allows the generated interfaces to support a wide range of Solidity compiler versions specified in the pragma: `>=0.6.2 <0.9.0`.

Sources: [contracts/lib/forge-std/scripts/vm.py#94-98](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L94-L98)

---

## Configuration OptionsLink copied!

The `CheatcodesPrinter` constructor accepts multiple configuration parameters:

ParameterTypeDefaultPurpose`spdx_identifier``str``"UNLICENSED"`SPDX license header`solidity_requirement``str``""`Pragma solidity version`abicoder_pragma``bool``False`Enable `ABIEncoderV2` pragma`block_doc_style``bool``False`Use `/* */` vs `//` comments`indent_with``int | str``4`Spaces per indent level`items_order``ItemOrder``default()`Order of interface members

For Aegis, the generator uses:

- `spdx_identifier = "MIT OR Apache-2.0"`
- `solidity_requirement = ">=0.6.2 <0.9.0"`
- `abicoder_pragma = True`

Sources: [contracts/lib/forge-std/scripts/vm.py#60-66](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L60-L66)[contracts/lib/forge-std/scripts/vm.py#426-456](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L426-L456)

---

## Error HandlingLink copied!

The script validates that cheatcodes are correctly classified and that the forge formatter runs successfully:

```
# Ensure safe + unsafe covers all cheatcodes
assert len(safe) + len(unsafe) == len(ccs)
 
# Ensure forge fmt succeeds
forge_fmt = ["forge", "fmt", OUT_PATH]
res = subprocess.run(forge_fmt)
assert res.returncode == 0, f"command failed: {forge_fmt}"
```

If forge formatting fails, the script exits with an error rather than producing malformed output.

Sources: [contracts/lib/forge-std/scripts/vm.py#51](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L51-L51)[contracts/lib/forge-std/scripts/vm.py#103-105](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L103-L105)

---

## Integration with Forge-StdLink copied!

The generated `Vm.sol` file is imported by the base test and script contracts:

- Test.sol: Imports `Vm` (full cheatcode access)
- Script.sol: Imports `VmSafe` (safe cheatcodes only)
- StdCheats.sol: Uses `Vm` interface for cheatcode wrappers

This separation enforces best practices: scripts should not use state-manipulating cheatcodes that could cause deployment simulations to diverge from actual on-chain behavior.

Sources: [contracts/lib/forge-std/README.md#1-267](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L1-L267)

---

## Generated Interface ExampleLink copied!

The output structure follows this pattern:

```
// Automatically @generated by scripts/vm.py. Do not modify manually.
 
// SPDX-License-Identifier: MIT OR Apache-2.0
pragma solidity >=0.6.2 <0.9.0;
pragma experimental ABIEncoderV2;
 
interface VmSafe {
    // Events, enums, structs...
    
    // ======== Testing ========
    /// Description of cheatcode
    function expectRevert() external;
    
    // ======== JSON ========
    function parseJson(string calldata json) external returns (bytes memory);
}
 
interface Vm is VmSafe {
    // ======== EVM ========
    /// Set block.timestamp
    function warp(uint256 timestamp) external;
    
    // ======== Pranks ========
    /// Set msg.sender for next call
    function prank(address msgSender) external;
}
```

The actual generated file contains hundreds of cheatcodes organized into functional groups.

Sources: [contracts/lib/forge-std/scripts/vm.py#56-92](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L56-L92)

---

## Maintenance and UpdatesLink copied!

When Foundry adds new cheatcodes or modifies existing ones:

1. Run `vm.py` to regenerate `Vm.sol`
2. The script automatically fetches the latest `cheatcodes.json` from Foundry's repository
3. Forge formatter ensures consistent style
4. Git diff shows exactly what changed

This automation eliminates manual synchronization errors and keeps forge-std aligned with Foundry's capabilities.

Sources: [contracts/lib/forge-std/scripts/vm.py#15-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L15-L16)

---

# Cheatcode-Generation-1

# Cheatcode GenerationLink copied!
Relevant source files
- [contracts/lib/forge-std/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md)
- [contracts/lib/forge-std/scripts/vm.py](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py)

This page documents the automated code generation system that produces the `Vm.sol` interface file from Foundry's cheatcodes specification. The `vm.py` script downloads or reads a JSON definition of all available Foundry cheatcodes and generates type-safe Solidity interfaces that forge-std tests and scripts can use.

For information about how to use the generated cheatcodes in tests, see [Testing Utilities](#7.1). For information about the base contracts that import these interfaces, see [Base Contracts](#7.2).

---

## OverviewLink copied!

The [contracts/lib/forge-std/scripts/vm.py#1-647](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L1-L647) script is a Python-based code generator that transforms Foundry's canonical cheatcode definitions into Solidity interface files. This automation ensures that forge-std's cheatcode interfaces remain synchronized with the Foundry toolchain without manual maintenance.

Key Components:

- Input: `cheatcodes.json` from Foundry's repository (or local file)
- Output: `src/Vm.sol` containing `VmSafe` and `Vm` interfaces
- Processing: Parsing, filtering, sorting, and code generation
- Post-processing: Automatic formatting via `forge fmt`

---

## System ArchitectureLink copied!

#mermaid-hecaohmipev{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-hecaohmipev .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-hecaohmipev .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-hecaohmipev .error-icon{fill:#a44141;}#mermaid-hecaohmipev .error-text{fill:#ddd;stroke:#ddd;}#mermaid-hecaohmipev .edge-thickness-normal{stroke-width:1px;}#mermaid-hecaohmipev .edge-thickness-thick{stroke-width:3.5px;}#mermaid-hecaohmipev .edge-pattern-solid{stroke-dasharray:0;}#mermaid-hecaohmipev .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-hecaohmipev .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-hecaohmipev .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-hecaohmipev .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-hecaohmipev .marker.cross{stroke:lightgrey;}#mermaid-hecaohmipev svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-hecaohmipev p{margin:0;}#mermaid-hecaohmipev .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-hecaohmipev .cluster-label text{fill:#F9FFFE;}#mermaid-hecaohmipev .cluster-label span{color:#F9FFFE;}#mermaid-hecaohmipev .cluster-label span p{background-color:transparent;}#mermaid-hecaohmipev .label text,#mermaid-hecaohmipev span{fill:#ccc;color:#ccc;}#mermaid-hecaohmipev .node rect,#mermaid-hecaohmipev .node circle,#mermaid-hecaohmipev .node ellipse,#mermaid-hecaohmipev .node polygon,#mermaid-hecaohmipev .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-hecaohmipev .rough-node .label text,#mermaid-hecaohmipev .node .label text,#mermaid-hecaohmipev .image-shape .label,#mermaid-hecaohmipev .icon-shape .label{text-anchor:middle;}#mermaid-hecaohmipev .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-hecaohmipev .rough-node .label,#mermaid-hecaohmipev .node .label,#mermaid-hecaohmipev .image-shape .label,#mermaid-hecaohmipev .icon-shape .label{text-align:center;}#mermaid-hecaohmipev .node.clickable{cursor:pointer;}#mermaid-hecaohmipev .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-hecaohmipev .arrowheadPath{fill:lightgrey;}#mermaid-hecaohmipev .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-hecaohmipev .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-hecaohmipev .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-hecaohmipev .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-hecaohmipev .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-hecaohmipev .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-hecaohmipev .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-hecaohmipev .cluster text{fill:#F9FFFE;}#mermaid-hecaohmipev .cluster span{color:#F9FFFE;}#mermaid-hecaohmipev div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-hecaohmipev .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-hecaohmipev rect.text{fill:none;stroke-width:0;}#mermaid-hecaohmipev .icon-shape,#mermaid-hecaohmipev .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-hecaohmipev .icon-shape p,#mermaid-hecaohmipev .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-hecaohmipev .icon-shape rect,#mermaid-hecaohmipev .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-hecaohmipev .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-hecaohmipev .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-hecaohmipev :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Output

vm.py Script

Input Sources

URL fetch

--from arg

Foundry Repository cheatcodes.json (GitHub Raw URL)

Local File cheatcodes.json (--from PATH)

main() Entry Point

Cheatcodes.from_json() JSON Parser

Filter & Sort safe vs unsafe

CheatcodesPrinter Code Generator

src/Vm.sol Generated Interface

Formatted Output (forge fmt)

Generation Workflow

Sources: [contracts/lib/forge-std/scripts/vm.py#30-108](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L30-L108)

---

## Data ModelLink copied!

The script uses Python dataclasses to model the JSON structure. These classes provide type safety during code generation and correspond directly to the cheatcodes JSON schema.

#mermaid-u77ddfbmgib{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-u77ddfbmgib .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-u77ddfbmgib .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-u77ddfbmgib .error-icon{fill:#a44141;}#mermaid-u77ddfbmgib .error-text{fill:#ddd;stroke:#ddd;}#mermaid-u77ddfbmgib .edge-thickness-normal{stroke-width:1px;}#mermaid-u77ddfbmgib .edge-thickness-thick{stroke-width:3.5px;}#mermaid-u77ddfbmgib .edge-pattern-solid{stroke-dasharray:0;}#mermaid-u77ddfbmgib .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-u77ddfbmgib .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-u77ddfbmgib .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-u77ddfbmgib .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-u77ddfbmgib .marker.cross{stroke:lightgrey;}#mermaid-u77ddfbmgib svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-u77ddfbmgib p{margin:0;}#mermaid-u77ddfbmgib g.classGroup text{fill:#ccc;stroke:none;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:10px;}#mermaid-u77ddfbmgib g.classGroup text .title{font-weight:bolder;}#mermaid-u77ddfbmgib .nodeLabel,#mermaid-u77ddfbmgib .edgeLabel{color:#e0dfdf;}#mermaid-u77ddfbmgib .edgeLabel .label rect{fill:#1f2020;}#mermaid-u77ddfbmgib .label text{fill:#e0dfdf;}#mermaid-u77ddfbmgib .labelBkg{background:#1f2020;}#mermaid-u77ddfbmgib .edgeLabel .label span{background:#1f2020;}#mermaid-u77ddfbmgib .classTitle{font-weight:bolder;}#mermaid-u77ddfbmgib .node rect,#mermaid-u77ddfbmgib .node circle,#mermaid-u77ddfbmgib .node ellipse,#mermaid-u77ddfbmgib .node polygon,#mermaid-u77ddfbmgib .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-u77ddfbmgib .divider{stroke:#ccc;stroke-width:1;}#mermaid-u77ddfbmgib g.clickable{cursor:pointer;}#mermaid-u77ddfbmgib g.classGroup rect{fill:#1f2020;stroke:#ccc;}#mermaid-u77ddfbmgib g.classGroup line{stroke:#ccc;stroke-width:1;}#mermaid-u77ddfbmgib .classLabel .box{stroke:none;stroke-width:0;fill:#1f2020;opacity:0.5;}#mermaid-u77ddfbmgib .classLabel .label{fill:#ccc;font-size:10px;}#mermaid-u77ddfbmgib .relation{stroke:lightgrey;stroke-width:1;fill:none;}#mermaid-u77ddfbmgib .dashed-line{stroke-dasharray:3;}#mermaid-u77ddfbmgib .dotted-line{stroke-dasharray:1 2;}#mermaid-u77ddfbmgib #compositionStart,#mermaid-u77ddfbmgib .composition{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #compositionEnd,#mermaid-u77ddfbmgib .composition{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #dependencyStart,#mermaid-u77ddfbmgib .dependency{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #dependencyStart,#mermaid-u77ddfbmgib .dependency{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #extensionStart,#mermaid-u77ddfbmgib .extension{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #extensionEnd,#mermaid-u77ddfbmgib .extension{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #aggregationStart,#mermaid-u77ddfbmgib .aggregation{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #aggregationEnd,#mermaid-u77ddfbmgib .aggregation{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #lollipopStart,#mermaid-u77ddfbmgib .lollipop{fill:#1f2020!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #lollipopEnd,#mermaid-u77ddfbmgib .lollipop{fill:#1f2020!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib .edgeTerminals{font-size:11px;line-height:initial;}#mermaid-u77ddfbmgib .classTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-u77ddfbmgib .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-u77ddfbmgib .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-u77ddfbmgib :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Cheatcodes

+list<Error> errors

+list<Event> events

+list<Enum> enums

+list<Struct> structs

+list<Cheatcode> cheatcodes

+from_json(str) : Cheatcodes

+from_dict(dict) : Cheatcodes

Cheatcode

+Function func

+str group

+str status

+str safety

+from_dict(dict) : Cheatcode

Function

+str id

+str description

+str declaration

+Visibility visibility

+Mutability mutability

+str signature

+str selector

+bytes selector_bytes

+from_dict(dict) : Function

Error

+str name

+str description

+str declaration

Event

+str name

+str description

+str declaration

Enum

+str name

+str description

+list<EnumVariant> variants

Struct

+str name

+str description

+list<StructField> fields

Core Data Classes

ClassPurposeKey Fields`Cheatcodes`Root container`cheatcodes`, `errors`, `events`, `enums`, `structs``Cheatcode`Single cheatcode definition`func`, `group`, `status`, `safety``Function`Function signature details`declaration`, `signature`, `selector``Error`Custom error definition`name`, `declaration``Event`Event definition`name`, `declaration``Enum`Enum type definition`name`, `variants``Struct`Struct type definition`name`, `fields`

Sources: [contracts/lib/forge-std/scripts/vm.py#181-374](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L181-L374)

---

## Code Generation ProcessLink copied!

The `CheatcodesPrinter` class is responsible for transforming the parsed data model into valid Solidity code. It maintains state for indentation, formatting preferences, and output buffering.

#mermaid-9t44y8e1135{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-9t44y8e1135 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-9t44y8e1135 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-9t44y8e1135 .error-icon{fill:#a44141;}#mermaid-9t44y8e1135 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-9t44y8e1135 .edge-thickness-normal{stroke-width:1px;}#mermaid-9t44y8e1135 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-9t44y8e1135 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-9t44y8e1135 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-9t44y8e1135 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-9t44y8e1135 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-9t44y8e1135 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-9t44y8e1135 .marker.cross{stroke:lightgrey;}#mermaid-9t44y8e1135 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-9t44y8e1135 p{margin:0;}#mermaid-9t44y8e1135 .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-9t44y8e1135 .cluster-label text{fill:#F9FFFE;}#mermaid-9t44y8e1135 .cluster-label span{color:#F9FFFE;}#mermaid-9t44y8e1135 .cluster-label span p{background-color:transparent;}#mermaid-9t44y8e1135 .label text,#mermaid-9t44y8e1135 span{fill:#ccc;color:#ccc;}#mermaid-9t44y8e1135 .node rect,#mermaid-9t44y8e1135 .node circle,#mermaid-9t44y8e1135 .node ellipse,#mermaid-9t44y8e1135 .node polygon,#mermaid-9t44y8e1135 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-9t44y8e1135 .rough-node .label text,#mermaid-9t44y8e1135 .node .label text,#mermaid-9t44y8e1135 .image-shape .label,#mermaid-9t44y8e1135 .icon-shape .label{text-anchor:middle;}#mermaid-9t44y8e1135 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-9t44y8e1135 .rough-node .label,#mermaid-9t44y8e1135 .node .label,#mermaid-9t44y8e1135 .image-shape .label,#mermaid-9t44y8e1135 .icon-shape .label{text-align:center;}#mermaid-9t44y8e1135 .node.clickable{cursor:pointer;}#mermaid-9t44y8e1135 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-9t44y8e1135 .arrowheadPath{fill:lightgrey;}#mermaid-9t44y8e1135 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-9t44y8e1135 .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-9t44y8e1135 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-9t44y8e1135 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-9t44y8e1135 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-9t44y8e1135 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-9t44y8e1135 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-9t44y8e1135 .cluster text{fill:#F9FFFE;}#mermaid-9t44y8e1135 .cluster span{color:#F9FFFE;}#mermaid-9t44y8e1135 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-9t44y8e1135 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-9t44y8e1135 rect.text{fill:none;stroke-width:0;}#mermaid-9t44y8e1135 .icon-shape,#mermaid-9t44y8e1135 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-9t44y8e1135 .icon-shape p,#mermaid-9t44y8e1135 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-9t44y8e1135 .icon-shape rect,#mermaid-9t44y8e1135 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-9t44y8e1135 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-9t44y8e1135 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-9t44y8e1135 :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Post-Processing

Item Rendering

Generation Phases

CheatcodesPrinter Configuration

Input Processing

cheatcodes.json

Cheatcodes Object Tree

Filtered Lists safe[] & unsafe[]

Printer Config spdx_identifier solidity_requirement abicoder_pragma indent_level

p_prelude() License & Pragma

p_contract(VmSafe) Safe Cheatcodes

p_contract(Vm) Unsafe Cheatcodes inherits VmSafe

p_errors()

p_events()

p_enums()

p_structs()

p_functions()

memory → calldata Compatibility Fix

forge fmt Code Formatting

Code Generation Algorithm

Sources: [contracts/lib/forge-std/scripts/vm.py#409-643](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L409-L643)

### Filtering and SortingLink copied!

The script applies several filters and sorts to organize cheatcodes:

```
# Filter out experimental and internal cheatcodes
ccs = list(filter(lambda cc: cc.status not in ["experimental", "internal"], ccs))
 
# Sort by function ID
ccs.sort(key=lambda cc: cc.func.id)
 
# Separate by safety classification
safe = list(filter(lambda cc: cc.safety == "safe", ccs))
unsafe = list(filter(lambda cc: cc.safety == "unsafe", ccs))
```

Sources: [contracts/lib/forge-std/scripts/vm.py#43-51](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L43-L51)

### Output StructureLink copied!

The generator produces two interfaces:

InterfaceInheritancePurposeCheatcodes Included`VmSafe`NoneSafe operations only`safety == "safe"``Vm``VmSafe`Full test capabilities`safety == "unsafe"`

VmSafe Interface: Contains cheatcodes that do not manipulate EVM state in ways that could cause script simulations to differ from on-chain execution. Recommended for deployment scripts.

Vm Interface: Inherits from `VmSafe` and adds state-manipulating cheatcodes like `prank`, `roll`, `warp`, etc. Intended for testing only.

Sources: [contracts/lib/forge-std/scripts/vm.py#18-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L18-L27)[contracts/lib/forge-std/scripts/vm.py#69-92](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L69-L92)

---

## Printer ArchitectureLink copied!

The `CheatcodesPrinter` class uses a state machine pattern with an internal buffer and indentation tracking.

#mermaid-x8tqxuhq1if{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-x8tqxuhq1if .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-x8tqxuhq1if .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-x8tqxuhq1if .error-icon{fill:#a44141;}#mermaid-x8tqxuhq1if .error-text{fill:#ddd;stroke:#ddd;}#mermaid-x8tqxuhq1if .edge-thickness-normal{stroke-width:1px;}#mermaid-x8tqxuhq1if .edge-thickness-thick{stroke-width:3.5px;}#mermaid-x8tqxuhq1if .edge-pattern-solid{stroke-dasharray:0;}#mermaid-x8tqxuhq1if .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-x8tqxuhq1if .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-x8tqxuhq1if .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-x8tqxuhq1if .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-x8tqxuhq1if .marker.cross{stroke:lightgrey;}#mermaid-x8tqxuhq1if svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-x8tqxuhq1if p{margin:0;}#mermaid-x8tqxuhq1if .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-x8tqxuhq1if .cluster-label text{fill:#F9FFFE;}#mermaid-x8tqxuhq1if .cluster-label span{color:#F9FFFE;}#mermaid-x8tqxuhq1if .cluster-label span p{background-color:transparent;}#mermaid-x8tqxuhq1if .label text,#mermaid-x8tqxuhq1if span{fill:#ccc;color:#ccc;}#mermaid-x8tqxuhq1if .node rect,#mermaid-x8tqxuhq1if .node circle,#mermaid-x8tqxuhq1if .node ellipse,#mermaid-x8tqxuhq1if .node polygon,#mermaid-x8tqxuhq1if .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-x8tqxuhq1if .rough-node .label text,#mermaid-x8tqxuhq1if .node .label text,#mermaid-x8tqxuhq1if .image-shape .label,#mermaid-x8tqxuhq1if .icon-shape .label{text-anchor:middle;}#mermaid-x8tqxuhq1if .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-x8tqxuhq1if .rough-node .label,#mermaid-x8tqxuhq1if .node .label,#mermaid-x8tqxuhq1if .image-shape .label,#mermaid-x8tqxuhq1if .icon-shape .label{text-align:center;}#mermaid-x8tqxuhq1if .node.clickable{cursor:pointer;}#mermaid-x8tqxuhq1if .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-x8tqxuhq1if .arrowheadPath{fill:lightgrey;}#mermaid-x8tqxuhq1if .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-x8tqxuhq1if .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-x8tqxuhq1if .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-x8tqxuhq1if .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-x8tqxuhq1if .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-x8tqxuhq1if .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-x8tqxuhq1if .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-x8tqxuhq1if .cluster text{fill:#F9FFFE;}#mermaid-x8tqxuhq1if .cluster span{color:#F9FFFE;}#mermaid-x8tqxuhq1if div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-x8tqxuhq1if .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-x8tqxuhq1if rect.text{fill:none;stroke-width:0;}#mermaid-x8tqxuhq1if .icon-shape,#mermaid-x8tqxuhq1if .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-x8tqxuhq1if .icon-shape p,#mermaid-x8tqxuhq1if .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-x8tqxuhq1if .icon-shape rect,#mermaid-x8tqxuhq1if .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-x8tqxuhq1if .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-x8tqxuhq1if .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-x8tqxuhq1if :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

High-Level Methods

Output Methods

CheatcodesPrinter State

buffer: str Accumulated Output

indent_level: int Current Nesting

_indent_str: str Whitespace Unit

_p_str(txt) Append Text

_p_nl() Newline

_p_indent() Add Indentation

_p_line(fn) Indent + fn + Newline

p_contract() Interface Generation

p_function() Function Declaration

_p_comment() NatSpec Comments

Key Printer Methods

MethodPurposeUsage`p_contract()`Generate interface definitionCalled for `VmSafe` and `Vm``p_function()`Generate function declarationCalled for each cheatcode`p_structs()`Generate struct definitionsShared types like `Rpc`, `FsMetadata``p_enums()`Generate enum definitionsTypes like `ForgeContext``_p_comment()`Generate NatSpec documentationFunction descriptions`_with_indent()`Execute with increased indentationBlocks and nested items`finish()`Return buffer and resetCalled after each interface

Sources: [contracts/lib/forge-std/scripts/vm.py#409-643](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L409-L643)

---

## Item OrderingLink copied!

The `ItemOrder` class controls the sequence in which interface members are generated:

```
ItemOrder.default() = [
    Item.ERROR,    # Custom error definitions
    Item.EVENT,    # Event definitions
    Item.ENUM,     # Enum type definitions
    Item.STRUCT,   # Struct type definitions
    Item.FUNCTION, # Function declarations
]
```

This ordering ensures that types are declared before they are referenced in function signatures, satisfying Solidity's forward reference requirements.

Sources: [contracts/lib/forge-std/scripts/vm.py#376-406](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L376-L406)

---

## Group HeadersLink copied!

Cheatcodes are organized by functional group (e.g., "evm", "testing", "json"). The script injects comment headers to visually separate groups:

```
// ======== EVM ========
function roll(uint256 blockNumber) external;
function warp(uint256 timestamp) external;
 
// ======== Testing ========
function expectRevert() external;
function expectEmit() external;
```

This is implemented via the `prefix_with_group_headers()` function, which inserts synthetic cheatcodes with group headers as their declarations.

Sources: [contracts/lib/forge-std/scripts/vm.py#138-160](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L138-L160)

---

## Cheatcode ComparisonLink copied!

The `CmpCheatcode` class defines a total ordering for cheatcodes based on multiple criteria:

```
def cmp_cheatcode(a: Cheatcode, b: Cheatcode) -> int:
    if a.group != b.group:
        return -1 if a.group < b.group else 1
    if a.status != b.status:
        return -1 if a.status < b.status else 1
    if a.safety != b.safety:
        return -1 if a.safety < b.safety else 1
    if a.func.id != b.func.id:
        return -1 if a.func.id < b.func.id else 1
    return 0
```

Sorting Priority:

1. Group (alphabetical)
2. Status (e.g., "stable" before "deprecated")
3. Safety ("safe" before "unsafe")
4. Function ID (lexicographic)

Sources: [contracts/lib/forge-std/scripts/vm.py#110-136](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L110-L136)

---

## Running the ScriptLink copied!

### Basic UsageLink copied!

```
# Download cheatcodes.json from Foundry repository and generate Vm.sol
python3 contracts/lib/forge-std/scripts/vm.py
```

### Using Local Cheatcodes FileLink copied!

```
# Generate from a local cheatcodes.json file
python3 contracts/lib/forge-std/scripts/vm.py --from /path/to/cheatcodes.json
```

### Output LocationLink copied!

The generated file is always written to `src/Vm.sol` relative to the forge-std root.

Sources: [contracts/lib/forge-std/scripts/vm.py#30-41](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L30-L41)[contracts/lib/forge-std/scripts/vm.py#100-107](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L100-L107)

---

## Compatibility TransformationsLink copied!

The script applies post-generation transformations to ensure compatibility with older Solidity versions:

### Memory to Calldata ConversionLink copied!

For Solidity versions `<0.8.0`, the script converts `memory` to `calldata` for function parameters using a regex transformation:

```
def memory_to_calldata(m: re.Match) -> str:
    return " calldata " + m.group(1)
 
out = re.sub(r" memory (.*returns)", memory_to_calldata, out)
```

This allows the generated interfaces to support a wide range of Solidity compiler versions specified in the pragma: `>=0.6.2 <0.9.0`.

Sources: [contracts/lib/forge-std/scripts/vm.py#94-98](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L94-L98)

---

## Configuration OptionsLink copied!

The `CheatcodesPrinter` constructor accepts multiple configuration parameters:

ParameterTypeDefaultPurpose`spdx_identifier``str``"UNLICENSED"`SPDX license header`solidity_requirement``str``""`Pragma solidity version`abicoder_pragma``bool``False`Enable `ABIEncoderV2` pragma`block_doc_style``bool``False`Use `/* */` vs `//` comments`indent_with``int | str``4`Spaces per indent level`items_order``ItemOrder``default()`Order of interface members

For Aegis, the generator uses:

- `spdx_identifier = "MIT OR Apache-2.0"`
- `solidity_requirement = ">=0.6.2 <0.9.0"`
- `abicoder_pragma = True`

Sources: [contracts/lib/forge-std/scripts/vm.py#60-66](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L60-L66)[contracts/lib/forge-std/scripts/vm.py#426-456](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L426-L456)

---

## Error HandlingLink copied!

The script validates that cheatcodes are correctly classified and that the forge formatter runs successfully:

```
# Ensure safe + unsafe covers all cheatcodes
assert len(safe) + len(unsafe) == len(ccs)
 
# Ensure forge fmt succeeds
forge_fmt = ["forge", "fmt", OUT_PATH]
res = subprocess.run(forge_fmt)
assert res.returncode == 0, f"command failed: {forge_fmt}"
```

If forge formatting fails, the script exits with an error rather than producing malformed output.

Sources: [contracts/lib/forge-std/scripts/vm.py#51](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L51-L51)[contracts/lib/forge-std/scripts/vm.py#103-105](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L103-L105)

---

## Integration with Forge-StdLink copied!

The generated `Vm.sol` file is imported by the base test and script contracts:

- Test.sol: Imports `Vm` (full cheatcode access)
- Script.sol: Imports `VmSafe` (safe cheatcodes only)
- StdCheats.sol: Uses `Vm` interface for cheatcode wrappers

This separation enforces best practices: scripts should not use state-manipulating cheatcodes that could cause deployment simulations to diverge from actual on-chain behavior.

Sources: [contracts/lib/forge-std/README.md#1-267](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L1-L267)

---

## Generated Interface ExampleLink copied!

The output structure follows this pattern:

```
// Automatically @generated by scripts/vm.py. Do not modify manually.
 
// SPDX-License-Identifier: MIT OR Apache-2.0
pragma solidity >=0.6.2 <0.9.0;
pragma experimental ABIEncoderV2;
 
interface VmSafe {
    // Events, enums, structs...
    
    // ======== Testing ========
    /// Description of cheatcode
    function expectRevert() external;
    
    // ======== JSON ========
    function parseJson(string calldata json) external returns (bytes memory);
}
 
interface Vm is VmSafe {
    // ======== EVM ========
    /// Set block.timestamp
    function warp(uint256 timestamp) external;
    
    // ======== Pranks ========
    /// Set msg.sender for next call
    function prank(address msgSender) external;
}
```

The actual generated file contains hundreds of cheatcodes organized into functional groups.

Sources: [contracts/lib/forge-std/scripts/vm.py#56-92](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L56-L92)

---

## Maintenance and UpdatesLink copied!

When Foundry adds new cheatcodes or modifies existing ones:

1. Run `vm.py` to regenerate `Vm.sol`
2. The script automatically fetches the latest `cheatcodes.json` from Foundry's repository
3. Forge formatter ensures consistent style
4. Git diff shows exactly what changed

This automation eliminates manual synchronization errors and keeps forge-std aligned with Foundry's capabilities.

Sources: [contracts/lib/forge-std/scripts/vm.py#15-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L15-L16)

---

# Cheatcode-Generation-2

# Cheatcode GenerationLink copied!
Relevant source files
- [contracts/lib/forge-std/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md)
- [contracts/lib/forge-std/scripts/vm.py](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py)

This page documents the automated code generation system that produces the `Vm.sol` interface file from Foundry's cheatcodes specification. The `vm.py` script downloads or reads a JSON definition of all available Foundry cheatcodes and generates type-safe Solidity interfaces that forge-std tests and scripts can use.

For information about how to use the generated cheatcodes in tests, see [Testing Utilities](#7.1). For information about the base contracts that import these interfaces, see [Base Contracts](#7.2).

---

## OverviewLink copied!

The [contracts/lib/forge-std/scripts/vm.py#1-647](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L1-L647) script is a Python-based code generator that transforms Foundry's canonical cheatcode definitions into Solidity interface files. This automation ensures that forge-std's cheatcode interfaces remain synchronized with the Foundry toolchain without manual maintenance.

Key Components:

- Input: `cheatcodes.json` from Foundry's repository (or local file)
- Output: `src/Vm.sol` containing `VmSafe` and `Vm` interfaces
- Processing: Parsing, filtering, sorting, and code generation
- Post-processing: Automatic formatting via `forge fmt`

---

## System ArchitectureLink copied!

#mermaid-hecaohmipev{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-hecaohmipev .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-hecaohmipev .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-hecaohmipev .error-icon{fill:#a44141;}#mermaid-hecaohmipev .error-text{fill:#ddd;stroke:#ddd;}#mermaid-hecaohmipev .edge-thickness-normal{stroke-width:1px;}#mermaid-hecaohmipev .edge-thickness-thick{stroke-width:3.5px;}#mermaid-hecaohmipev .edge-pattern-solid{stroke-dasharray:0;}#mermaid-hecaohmipev .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-hecaohmipev .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-hecaohmipev .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-hecaohmipev .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-hecaohmipev .marker.cross{stroke:lightgrey;}#mermaid-hecaohmipev svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-hecaohmipev p{margin:0;}#mermaid-hecaohmipev .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-hecaohmipev .cluster-label text{fill:#F9FFFE;}#mermaid-hecaohmipev .cluster-label span{color:#F9FFFE;}#mermaid-hecaohmipev .cluster-label span p{background-color:transparent;}#mermaid-hecaohmipev .label text,#mermaid-hecaohmipev span{fill:#ccc;color:#ccc;}#mermaid-hecaohmipev .node rect,#mermaid-hecaohmipev .node circle,#mermaid-hecaohmipev .node ellipse,#mermaid-hecaohmipev .node polygon,#mermaid-hecaohmipev .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-hecaohmipev .rough-node .label text,#mermaid-hecaohmipev .node .label text,#mermaid-hecaohmipev .image-shape .label,#mermaid-hecaohmipev .icon-shape .label{text-anchor:middle;}#mermaid-hecaohmipev .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-hecaohmipev .rough-node .label,#mermaid-hecaohmipev .node .label,#mermaid-hecaohmipev .image-shape .label,#mermaid-hecaohmipev .icon-shape .label{text-align:center;}#mermaid-hecaohmipev .node.clickable{cursor:pointer;}#mermaid-hecaohmipev .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-hecaohmipev .arrowheadPath{fill:lightgrey;}#mermaid-hecaohmipev .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-hecaohmipev .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-hecaohmipev .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-hecaohmipev .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-hecaohmipev .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-hecaohmipev .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-hecaohmipev .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-hecaohmipev .cluster text{fill:#F9FFFE;}#mermaid-hecaohmipev .cluster span{color:#F9FFFE;}#mermaid-hecaohmipev div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-hecaohmipev .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-hecaohmipev rect.text{fill:none;stroke-width:0;}#mermaid-hecaohmipev .icon-shape,#mermaid-hecaohmipev .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-hecaohmipev .icon-shape p,#mermaid-hecaohmipev .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-hecaohmipev .icon-shape rect,#mermaid-hecaohmipev .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-hecaohmipev .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-hecaohmipev .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-hecaohmipev :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Output

vm.py Script

Input Sources

URL fetch

--from arg

Foundry Repository cheatcodes.json (GitHub Raw URL)

Local File cheatcodes.json (--from PATH)

main() Entry Point

Cheatcodes.from_json() JSON Parser

Filter & Sort safe vs unsafe

CheatcodesPrinter Code Generator

src/Vm.sol Generated Interface

Formatted Output (forge fmt)

Generation Workflow

Sources: [contracts/lib/forge-std/scripts/vm.py#30-108](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L30-L108)

---

## Data ModelLink copied!

The script uses Python dataclasses to model the JSON structure. These classes provide type safety during code generation and correspond directly to the cheatcodes JSON schema.

#mermaid-u77ddfbmgib{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-u77ddfbmgib .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-u77ddfbmgib .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-u77ddfbmgib .error-icon{fill:#a44141;}#mermaid-u77ddfbmgib .error-text{fill:#ddd;stroke:#ddd;}#mermaid-u77ddfbmgib .edge-thickness-normal{stroke-width:1px;}#mermaid-u77ddfbmgib .edge-thickness-thick{stroke-width:3.5px;}#mermaid-u77ddfbmgib .edge-pattern-solid{stroke-dasharray:0;}#mermaid-u77ddfbmgib .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-u77ddfbmgib .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-u77ddfbmgib .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-u77ddfbmgib .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-u77ddfbmgib .marker.cross{stroke:lightgrey;}#mermaid-u77ddfbmgib svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-u77ddfbmgib p{margin:0;}#mermaid-u77ddfbmgib g.classGroup text{fill:#ccc;stroke:none;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:10px;}#mermaid-u77ddfbmgib g.classGroup text .title{font-weight:bolder;}#mermaid-u77ddfbmgib .nodeLabel,#mermaid-u77ddfbmgib .edgeLabel{color:#e0dfdf;}#mermaid-u77ddfbmgib .edgeLabel .label rect{fill:#1f2020;}#mermaid-u77ddfbmgib .label text{fill:#e0dfdf;}#mermaid-u77ddfbmgib .labelBkg{background:#1f2020;}#mermaid-u77ddfbmgib .edgeLabel .label span{background:#1f2020;}#mermaid-u77ddfbmgib .classTitle{font-weight:bolder;}#mermaid-u77ddfbmgib .node rect,#mermaid-u77ddfbmgib .node circle,#mermaid-u77ddfbmgib .node ellipse,#mermaid-u77ddfbmgib .node polygon,#mermaid-u77ddfbmgib .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-u77ddfbmgib .divider{stroke:#ccc;stroke-width:1;}#mermaid-u77ddfbmgib g.clickable{cursor:pointer;}#mermaid-u77ddfbmgib g.classGroup rect{fill:#1f2020;stroke:#ccc;}#mermaid-u77ddfbmgib g.classGroup line{stroke:#ccc;stroke-width:1;}#mermaid-u77ddfbmgib .classLabel .box{stroke:none;stroke-width:0;fill:#1f2020;opacity:0.5;}#mermaid-u77ddfbmgib .classLabel .label{fill:#ccc;font-size:10px;}#mermaid-u77ddfbmgib .relation{stroke:lightgrey;stroke-width:1;fill:none;}#mermaid-u77ddfbmgib .dashed-line{stroke-dasharray:3;}#mermaid-u77ddfbmgib .dotted-line{stroke-dasharray:1 2;}#mermaid-u77ddfbmgib #compositionStart,#mermaid-u77ddfbmgib .composition{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #compositionEnd,#mermaid-u77ddfbmgib .composition{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #dependencyStart,#mermaid-u77ddfbmgib .dependency{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #dependencyStart,#mermaid-u77ddfbmgib .dependency{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #extensionStart,#mermaid-u77ddfbmgib .extension{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #extensionEnd,#mermaid-u77ddfbmgib .extension{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #aggregationStart,#mermaid-u77ddfbmgib .aggregation{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #aggregationEnd,#mermaid-u77ddfbmgib .aggregation{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #lollipopStart,#mermaid-u77ddfbmgib .lollipop{fill:#1f2020!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #lollipopEnd,#mermaid-u77ddfbmgib .lollipop{fill:#1f2020!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib .edgeTerminals{font-size:11px;line-height:initial;}#mermaid-u77ddfbmgib .classTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-u77ddfbmgib .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-u77ddfbmgib .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-u77ddfbmgib :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Cheatcodes

+list<Error> errors

+list<Event> events

+list<Enum> enums

+list<Struct> structs

+list<Cheatcode> cheatcodes

+from_json(str) : Cheatcodes

+from_dict(dict) : Cheatcodes

Cheatcode

+Function func

+str group

+str status

+str safety

+from_dict(dict) : Cheatcode

Function

+str id

+str description

+str declaration

+Visibility visibility

+Mutability mutability

+str signature

+str selector

+bytes selector_bytes

+from_dict(dict) : Function

Error

+str name

+str description

+str declaration

Event

+str name

+str description

+str declaration

Enum

+str name

+str description

+list<EnumVariant> variants

Struct

+str name

+str description

+list<StructField> fields

Core Data Classes

ClassPurposeKey Fields`Cheatcodes`Root container`cheatcodes`, `errors`, `events`, `enums`, `structs``Cheatcode`Single cheatcode definition`func`, `group`, `status`, `safety``Function`Function signature details`declaration`, `signature`, `selector``Error`Custom error definition`name`, `declaration``Event`Event definition`name`, `declaration``Enum`Enum type definition`name`, `variants``Struct`Struct type definition`name`, `fields`

Sources: [contracts/lib/forge-std/scripts/vm.py#181-374](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L181-L374)

---

## Code Generation ProcessLink copied!

The `CheatcodesPrinter` class is responsible for transforming the parsed data model into valid Solidity code. It maintains state for indentation, formatting preferences, and output buffering.

#mermaid-9t44y8e1135{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-9t44y8e1135 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-9t44y8e1135 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-9t44y8e1135 .error-icon{fill:#a44141;}#mermaid-9t44y8e1135 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-9t44y8e1135 .edge-thickness-normal{stroke-width:1px;}#mermaid-9t44y8e1135 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-9t44y8e1135 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-9t44y8e1135 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-9t44y8e1135 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-9t44y8e1135 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-9t44y8e1135 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-9t44y8e1135 .marker.cross{stroke:lightgrey;}#mermaid-9t44y8e1135 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-9t44y8e1135 p{margin:0;}#mermaid-9t44y8e1135 .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-9t44y8e1135 .cluster-label text{fill:#F9FFFE;}#mermaid-9t44y8e1135 .cluster-label span{color:#F9FFFE;}#mermaid-9t44y8e1135 .cluster-label span p{background-color:transparent;}#mermaid-9t44y8e1135 .label text,#mermaid-9t44y8e1135 span{fill:#ccc;color:#ccc;}#mermaid-9t44y8e1135 .node rect,#mermaid-9t44y8e1135 .node circle,#mermaid-9t44y8e1135 .node ellipse,#mermaid-9t44y8e1135 .node polygon,#mermaid-9t44y8e1135 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-9t44y8e1135 .rough-node .label text,#mermaid-9t44y8e1135 .node .label text,#mermaid-9t44y8e1135 .image-shape .label,#mermaid-9t44y8e1135 .icon-shape .label{text-anchor:middle;}#mermaid-9t44y8e1135 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-9t44y8e1135 .rough-node .label,#mermaid-9t44y8e1135 .node .label,#mermaid-9t44y8e1135 .image-shape .label,#mermaid-9t44y8e1135 .icon-shape .label{text-align:center;}#mermaid-9t44y8e1135 .node.clickable{cursor:pointer;}#mermaid-9t44y8e1135 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-9t44y8e1135 .arrowheadPath{fill:lightgrey;}#mermaid-9t44y8e1135 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-9t44y8e1135 .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-9t44y8e1135 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-9t44y8e1135 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-9t44y8e1135 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-9t44y8e1135 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-9t44y8e1135 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-9t44y8e1135 .cluster text{fill:#F9FFFE;}#mermaid-9t44y8e1135 .cluster span{color:#F9FFFE;}#mermaid-9t44y8e1135 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-9t44y8e1135 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-9t44y8e1135 rect.text{fill:none;stroke-width:0;}#mermaid-9t44y8e1135 .icon-shape,#mermaid-9t44y8e1135 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-9t44y8e1135 .icon-shape p,#mermaid-9t44y8e1135 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-9t44y8e1135 .icon-shape rect,#mermaid-9t44y8e1135 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-9t44y8e1135 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-9t44y8e1135 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-9t44y8e1135 :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Post-Processing

Item Rendering

Generation Phases

CheatcodesPrinter Configuration

Input Processing

cheatcodes.json

Cheatcodes Object Tree

Filtered Lists safe[] & unsafe[]

Printer Config spdx_identifier solidity_requirement abicoder_pragma indent_level

p_prelude() License & Pragma

p_contract(VmSafe) Safe Cheatcodes

p_contract(Vm) Unsafe Cheatcodes inherits VmSafe

p_errors()

p_events()

p_enums()

p_structs()

p_functions()

memory → calldata Compatibility Fix

forge fmt Code Formatting

Code Generation Algorithm

Sources: [contracts/lib/forge-std/scripts/vm.py#409-643](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L409-L643)

### Filtering and SortingLink copied!

The script applies several filters and sorts to organize cheatcodes:

```
# Filter out experimental and internal cheatcodes
ccs = list(filter(lambda cc: cc.status not in ["experimental", "internal"], ccs))
 
# Sort by function ID
ccs.sort(key=lambda cc: cc.func.id)
 
# Separate by safety classification
safe = list(filter(lambda cc: cc.safety == "safe", ccs))
unsafe = list(filter(lambda cc: cc.safety == "unsafe", ccs))
```

Sources: [contracts/lib/forge-std/scripts/vm.py#43-51](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L43-L51)

### Output StructureLink copied!

The generator produces two interfaces:

InterfaceInheritancePurposeCheatcodes Included`VmSafe`NoneSafe operations only`safety == "safe"``Vm``VmSafe`Full test capabilities`safety == "unsafe"`

VmSafe Interface: Contains cheatcodes that do not manipulate EVM state in ways that could cause script simulations to differ from on-chain execution. Recommended for deployment scripts.

Vm Interface: Inherits from `VmSafe` and adds state-manipulating cheatcodes like `prank`, `roll`, `warp`, etc. Intended for testing only.

Sources: [contracts/lib/forge-std/scripts/vm.py#18-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L18-L27)[contracts/lib/forge-std/scripts/vm.py#69-92](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L69-L92)

---

## Printer ArchitectureLink copied!

The `CheatcodesPrinter` class uses a state machine pattern with an internal buffer and indentation tracking.

#mermaid-x8tqxuhq1if{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-x8tqxuhq1if .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-x8tqxuhq1if .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-x8tqxuhq1if .error-icon{fill:#a44141;}#mermaid-x8tqxuhq1if .error-text{fill:#ddd;stroke:#ddd;}#mermaid-x8tqxuhq1if .edge-thickness-normal{stroke-width:1px;}#mermaid-x8tqxuhq1if .edge-thickness-thick{stroke-width:3.5px;}#mermaid-x8tqxuhq1if .edge-pattern-solid{stroke-dasharray:0;}#mermaid-x8tqxuhq1if .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-x8tqxuhq1if .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-x8tqxuhq1if .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-x8tqxuhq1if .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-x8tqxuhq1if .marker.cross{stroke:lightgrey;}#mermaid-x8tqxuhq1if svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-x8tqxuhq1if p{margin:0;}#mermaid-x8tqxuhq1if .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-x8tqxuhq1if .cluster-label text{fill:#F9FFFE;}#mermaid-x8tqxuhq1if .cluster-label span{color:#F9FFFE;}#mermaid-x8tqxuhq1if .cluster-label span p{background-color:transparent;}#mermaid-x8tqxuhq1if .label text,#mermaid-x8tqxuhq1if span{fill:#ccc;color:#ccc;}#mermaid-x8tqxuhq1if .node rect,#mermaid-x8tqxuhq1if .node circle,#mermaid-x8tqxuhq1if .node ellipse,#mermaid-x8tqxuhq1if .node polygon,#mermaid-x8tqxuhq1if .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-x8tqxuhq1if .rough-node .label text,#mermaid-x8tqxuhq1if .node .label text,#mermaid-x8tqxuhq1if .image-shape .label,#mermaid-x8tqxuhq1if .icon-shape .label{text-anchor:middle;}#mermaid-x8tqxuhq1if .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-x8tqxuhq1if .rough-node .label,#mermaid-x8tqxuhq1if .node .label,#mermaid-x8tqxuhq1if .image-shape .label,#mermaid-x8tqxuhq1if .icon-shape .label{text-align:center;}#mermaid-x8tqxuhq1if .node.clickable{cursor:pointer;}#mermaid-x8tqxuhq1if .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-x8tqxuhq1if .arrowheadPath{fill:lightgrey;}#mermaid-x8tqxuhq1if .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-x8tqxuhq1if .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-x8tqxuhq1if .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-x8tqxuhq1if .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-x8tqxuhq1if .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-x8tqxuhq1if .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-x8tqxuhq1if .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-x8tqxuhq1if .cluster text{fill:#F9FFFE;}#mermaid-x8tqxuhq1if .cluster span{color:#F9FFFE;}#mermaid-x8tqxuhq1if div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-x8tqxuhq1if .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-x8tqxuhq1if rect.text{fill:none;stroke-width:0;}#mermaid-x8tqxuhq1if .icon-shape,#mermaid-x8tqxuhq1if .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-x8tqxuhq1if .icon-shape p,#mermaid-x8tqxuhq1if .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-x8tqxuhq1if .icon-shape rect,#mermaid-x8tqxuhq1if .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-x8tqxuhq1if .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-x8tqxuhq1if .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-x8tqxuhq1if :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

High-Level Methods

Output Methods

CheatcodesPrinter State

buffer: str Accumulated Output

indent_level: int Current Nesting

_indent_str: str Whitespace Unit

_p_str(txt) Append Text

_p_nl() Newline

_p_indent() Add Indentation

_p_line(fn) Indent + fn + Newline

p_contract() Interface Generation

p_function() Function Declaration

_p_comment() NatSpec Comments

Key Printer Methods

MethodPurposeUsage`p_contract()`Generate interface definitionCalled for `VmSafe` and `Vm``p_function()`Generate function declarationCalled for each cheatcode`p_structs()`Generate struct definitionsShared types like `Rpc`, `FsMetadata``p_enums()`Generate enum definitionsTypes like `ForgeContext``_p_comment()`Generate NatSpec documentationFunction descriptions`_with_indent()`Execute with increased indentationBlocks and nested items`finish()`Return buffer and resetCalled after each interface

Sources: [contracts/lib/forge-std/scripts/vm.py#409-643](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L409-L643)

---

## Item OrderingLink copied!

The `ItemOrder` class controls the sequence in which interface members are generated:

```
ItemOrder.default() = [
    Item.ERROR,    # Custom error definitions
    Item.EVENT,    # Event definitions
    Item.ENUM,     # Enum type definitions
    Item.STRUCT,   # Struct type definitions
    Item.FUNCTION, # Function declarations
]
```

This ordering ensures that types are declared before they are referenced in function signatures, satisfying Solidity's forward reference requirements.

Sources: [contracts/lib/forge-std/scripts/vm.py#376-406](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L376-L406)

---

## Group HeadersLink copied!

Cheatcodes are organized by functional group (e.g., "evm", "testing", "json"). The script injects comment headers to visually separate groups:

```
// ======== EVM ========
function roll(uint256 blockNumber) external;
function warp(uint256 timestamp) external;
 
// ======== Testing ========
function expectRevert() external;
function expectEmit() external;
```

This is implemented via the `prefix_with_group_headers()` function, which inserts synthetic cheatcodes with group headers as their declarations.

Sources: [contracts/lib/forge-std/scripts/vm.py#138-160](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L138-L160)

---

## Cheatcode ComparisonLink copied!

The `CmpCheatcode` class defines a total ordering for cheatcodes based on multiple criteria:

```
def cmp_cheatcode(a: Cheatcode, b: Cheatcode) -> int:
    if a.group != b.group:
        return -1 if a.group < b.group else 1
    if a.status != b.status:
        return -1 if a.status < b.status else 1
    if a.safety != b.safety:
        return -1 if a.safety < b.safety else 1
    if a.func.id != b.func.id:
        return -1 if a.func.id < b.func.id else 1
    return 0
```

Sorting Priority:

1. Group (alphabetical)
2. Status (e.g., "stable" before "deprecated")
3. Safety ("safe" before "unsafe")
4. Function ID (lexicographic)

Sources: [contracts/lib/forge-std/scripts/vm.py#110-136](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L110-L136)

---

## Running the ScriptLink copied!

### Basic UsageLink copied!

```
# Download cheatcodes.json from Foundry repository and generate Vm.sol
python3 contracts/lib/forge-std/scripts/vm.py
```

### Using Local Cheatcodes FileLink copied!

```
# Generate from a local cheatcodes.json file
python3 contracts/lib/forge-std/scripts/vm.py --from /path/to/cheatcodes.json
```

### Output LocationLink copied!

The generated file is always written to `src/Vm.sol` relative to the forge-std root.

Sources: [contracts/lib/forge-std/scripts/vm.py#30-41](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L30-L41)[contracts/lib/forge-std/scripts/vm.py#100-107](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L100-L107)

---

## Compatibility TransformationsLink copied!

The script applies post-generation transformations to ensure compatibility with older Solidity versions:

### Memory to Calldata ConversionLink copied!

For Solidity versions `<0.8.0`, the script converts `memory` to `calldata` for function parameters using a regex transformation:

```
def memory_to_calldata(m: re.Match) -> str:
    return " calldata " + m.group(1)
 
out = re.sub(r" memory (.*returns)", memory_to_calldata, out)
```

This allows the generated interfaces to support a wide range of Solidity compiler versions specified in the pragma: `>=0.6.2 <0.9.0`.

Sources: [contracts/lib/forge-std/scripts/vm.py#94-98](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L94-L98)

---

## Configuration OptionsLink copied!

The `CheatcodesPrinter` constructor accepts multiple configuration parameters:

ParameterTypeDefaultPurpose`spdx_identifier``str``"UNLICENSED"`SPDX license header`solidity_requirement``str``""`Pragma solidity version`abicoder_pragma``bool``False`Enable `ABIEncoderV2` pragma`block_doc_style``bool``False`Use `/* */` vs `//` comments`indent_with``int | str``4`Spaces per indent level`items_order``ItemOrder``default()`Order of interface members

For Aegis, the generator uses:

- `spdx_identifier = "MIT OR Apache-2.0"`
- `solidity_requirement = ">=0.6.2 <0.9.0"`
- `abicoder_pragma = True`

Sources: [contracts/lib/forge-std/scripts/vm.py#60-66](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L60-L66)[contracts/lib/forge-std/scripts/vm.py#426-456](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L426-L456)

---

## Error HandlingLink copied!

The script validates that cheatcodes are correctly classified and that the forge formatter runs successfully:

```
# Ensure safe + unsafe covers all cheatcodes
assert len(safe) + len(unsafe) == len(ccs)
 
# Ensure forge fmt succeeds
forge_fmt = ["forge", "fmt", OUT_PATH]
res = subprocess.run(forge_fmt)
assert res.returncode == 0, f"command failed: {forge_fmt}"
```

If forge formatting fails, the script exits with an error rather than producing malformed output.

Sources: [contracts/lib/forge-std/scripts/vm.py#51](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L51-L51)[contracts/lib/forge-std/scripts/vm.py#103-105](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L103-L105)

---

## Integration with Forge-StdLink copied!

The generated `Vm.sol` file is imported by the base test and script contracts:

- Test.sol: Imports `Vm` (full cheatcode access)
- Script.sol: Imports `VmSafe` (safe cheatcodes only)
- StdCheats.sol: Uses `Vm` interface for cheatcode wrappers

This separation enforces best practices: scripts should not use state-manipulating cheatcodes that could cause deployment simulations to diverge from actual on-chain behavior.

Sources: [contracts/lib/forge-std/README.md#1-267](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L1-L267)

---

## Generated Interface ExampleLink copied!

The output structure follows this pattern:

```
// Automatically @generated by scripts/vm.py. Do not modify manually.
 
// SPDX-License-Identifier: MIT OR Apache-2.0
pragma solidity >=0.6.2 <0.9.0;
pragma experimental ABIEncoderV2;
 
interface VmSafe {
    // Events, enums, structs...
    
    // ======== Testing ========
    /// Description of cheatcode
    function expectRevert() external;
    
    // ======== JSON ========
    function parseJson(string calldata json) external returns (bytes memory);
}
 
interface Vm is VmSafe {
    // ======== EVM ========
    /// Set block.timestamp
    function warp(uint256 timestamp) external;
    
    // ======== Pranks ========
    /// Set msg.sender for next call
    function prank(address msgSender) external;
}
```

The actual generated file contains hundreds of cheatcodes organized into functional groups.

Sources: [contracts/lib/forge-std/scripts/vm.py#56-92](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L56-L92)

---

## Maintenance and UpdatesLink copied!

When Foundry adds new cheatcodes or modifies existing ones:

1. Run `vm.py` to regenerate `Vm.sol`
2. The script automatically fetches the latest `cheatcodes.json` from Foundry's repository
3. Forge formatter ensures consistent style
4. Git diff shows exactly what changed

This automation eliminates manual synchronization errors and keeps forge-std aligned with Foundry's capabilities.

Sources: [contracts/lib/forge-std/scripts/vm.py#15-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L15-L16)

---

# Cheatcode-Generation-3

# Cheatcode GenerationLink copied!
Relevant source files
- [contracts/lib/forge-std/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md)
- [contracts/lib/forge-std/scripts/vm.py](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py)

This page documents the automated code generation system that produces the `Vm.sol` interface file from Foundry's cheatcodes specification. The `vm.py` script downloads or reads a JSON definition of all available Foundry cheatcodes and generates type-safe Solidity interfaces that forge-std tests and scripts can use.

For information about how to use the generated cheatcodes in tests, see [Testing Utilities](#7.1). For information about the base contracts that import these interfaces, see [Base Contracts](#7.2).

---

## OverviewLink copied!

The [contracts/lib/forge-std/scripts/vm.py#1-647](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L1-L647) script is a Python-based code generator that transforms Foundry's canonical cheatcode definitions into Solidity interface files. This automation ensures that forge-std's cheatcode interfaces remain synchronized with the Foundry toolchain without manual maintenance.

Key Components:

- Input: `cheatcodes.json` from Foundry's repository (or local file)
- Output: `src/Vm.sol` containing `VmSafe` and `Vm` interfaces
- Processing: Parsing, filtering, sorting, and code generation
- Post-processing: Automatic formatting via `forge fmt`

---

## System ArchitectureLink copied!

#mermaid-hecaohmipev{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-hecaohmipev .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-hecaohmipev .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-hecaohmipev .error-icon{fill:#a44141;}#mermaid-hecaohmipev .error-text{fill:#ddd;stroke:#ddd;}#mermaid-hecaohmipev .edge-thickness-normal{stroke-width:1px;}#mermaid-hecaohmipev .edge-thickness-thick{stroke-width:3.5px;}#mermaid-hecaohmipev .edge-pattern-solid{stroke-dasharray:0;}#mermaid-hecaohmipev .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-hecaohmipev .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-hecaohmipev .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-hecaohmipev .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-hecaohmipev .marker.cross{stroke:lightgrey;}#mermaid-hecaohmipev svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-hecaohmipev p{margin:0;}#mermaid-hecaohmipev .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-hecaohmipev .cluster-label text{fill:#F9FFFE;}#mermaid-hecaohmipev .cluster-label span{color:#F9FFFE;}#mermaid-hecaohmipev .cluster-label span p{background-color:transparent;}#mermaid-hecaohmipev .label text,#mermaid-hecaohmipev span{fill:#ccc;color:#ccc;}#mermaid-hecaohmipev .node rect,#mermaid-hecaohmipev .node circle,#mermaid-hecaohmipev .node ellipse,#mermaid-hecaohmipev .node polygon,#mermaid-hecaohmipev .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-hecaohmipev .rough-node .label text,#mermaid-hecaohmipev .node .label text,#mermaid-hecaohmipev .image-shape .label,#mermaid-hecaohmipev .icon-shape .label{text-anchor:middle;}#mermaid-hecaohmipev .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-hecaohmipev .rough-node .label,#mermaid-hecaohmipev .node .label,#mermaid-hecaohmipev .image-shape .label,#mermaid-hecaohmipev .icon-shape .label{text-align:center;}#mermaid-hecaohmipev .node.clickable{cursor:pointer;}#mermaid-hecaohmipev .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-hecaohmipev .arrowheadPath{fill:lightgrey;}#mermaid-hecaohmipev .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-hecaohmipev .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-hecaohmipev .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-hecaohmipev .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-hecaohmipev .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-hecaohmipev .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-hecaohmipev .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-hecaohmipev .cluster text{fill:#F9FFFE;}#mermaid-hecaohmipev .cluster span{color:#F9FFFE;}#mermaid-hecaohmipev div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-hecaohmipev .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-hecaohmipev rect.text{fill:none;stroke-width:0;}#mermaid-hecaohmipev .icon-shape,#mermaid-hecaohmipev .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-hecaohmipev .icon-shape p,#mermaid-hecaohmipev .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-hecaohmipev .icon-shape rect,#mermaid-hecaohmipev .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-hecaohmipev .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-hecaohmipev .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-hecaohmipev :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Output

vm.py Script

Input Sources

URL fetch

--from arg

Foundry Repository cheatcodes.json (GitHub Raw URL)

Local File cheatcodes.json (--from PATH)

main() Entry Point

Cheatcodes.from_json() JSON Parser

Filter & Sort safe vs unsafe

CheatcodesPrinter Code Generator

src/Vm.sol Generated Interface

Formatted Output (forge fmt)

Generation Workflow

Sources: [contracts/lib/forge-std/scripts/vm.py#30-108](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L30-L108)

---

## Data ModelLink copied!

The script uses Python dataclasses to model the JSON structure. These classes provide type safety during code generation and correspond directly to the cheatcodes JSON schema.

#mermaid-u77ddfbmgib{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-u77ddfbmgib .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-u77ddfbmgib .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-u77ddfbmgib .error-icon{fill:#a44141;}#mermaid-u77ddfbmgib .error-text{fill:#ddd;stroke:#ddd;}#mermaid-u77ddfbmgib .edge-thickness-normal{stroke-width:1px;}#mermaid-u77ddfbmgib .edge-thickness-thick{stroke-width:3.5px;}#mermaid-u77ddfbmgib .edge-pattern-solid{stroke-dasharray:0;}#mermaid-u77ddfbmgib .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-u77ddfbmgib .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-u77ddfbmgib .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-u77ddfbmgib .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-u77ddfbmgib .marker.cross{stroke:lightgrey;}#mermaid-u77ddfbmgib svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-u77ddfbmgib p{margin:0;}#mermaid-u77ddfbmgib g.classGroup text{fill:#ccc;stroke:none;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:10px;}#mermaid-u77ddfbmgib g.classGroup text .title{font-weight:bolder;}#mermaid-u77ddfbmgib .nodeLabel,#mermaid-u77ddfbmgib .edgeLabel{color:#e0dfdf;}#mermaid-u77ddfbmgib .edgeLabel .label rect{fill:#1f2020;}#mermaid-u77ddfbmgib .label text{fill:#e0dfdf;}#mermaid-u77ddfbmgib .labelBkg{background:#1f2020;}#mermaid-u77ddfbmgib .edgeLabel .label span{background:#1f2020;}#mermaid-u77ddfbmgib .classTitle{font-weight:bolder;}#mermaid-u77ddfbmgib .node rect,#mermaid-u77ddfbmgib .node circle,#mermaid-u77ddfbmgib .node ellipse,#mermaid-u77ddfbmgib .node polygon,#mermaid-u77ddfbmgib .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-u77ddfbmgib .divider{stroke:#ccc;stroke-width:1;}#mermaid-u77ddfbmgib g.clickable{cursor:pointer;}#mermaid-u77ddfbmgib g.classGroup rect{fill:#1f2020;stroke:#ccc;}#mermaid-u77ddfbmgib g.classGroup line{stroke:#ccc;stroke-width:1;}#mermaid-u77ddfbmgib .classLabel .box{stroke:none;stroke-width:0;fill:#1f2020;opacity:0.5;}#mermaid-u77ddfbmgib .classLabel .label{fill:#ccc;font-size:10px;}#mermaid-u77ddfbmgib .relation{stroke:lightgrey;stroke-width:1;fill:none;}#mermaid-u77ddfbmgib .dashed-line{stroke-dasharray:3;}#mermaid-u77ddfbmgib .dotted-line{stroke-dasharray:1 2;}#mermaid-u77ddfbmgib #compositionStart,#mermaid-u77ddfbmgib .composition{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #compositionEnd,#mermaid-u77ddfbmgib .composition{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #dependencyStart,#mermaid-u77ddfbmgib .dependency{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #dependencyStart,#mermaid-u77ddfbmgib .dependency{fill:lightgrey!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #extensionStart,#mermaid-u77ddfbmgib .extension{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #extensionEnd,#mermaid-u77ddfbmgib .extension{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #aggregationStart,#mermaid-u77ddfbmgib .aggregation{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #aggregationEnd,#mermaid-u77ddfbmgib .aggregation{fill:transparent!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #lollipopStart,#mermaid-u77ddfbmgib .lollipop{fill:#1f2020!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib #lollipopEnd,#mermaid-u77ddfbmgib .lollipop{fill:#1f2020!important;stroke:lightgrey!important;stroke-width:1;}#mermaid-u77ddfbmgib .edgeTerminals{font-size:11px;line-height:initial;}#mermaid-u77ddfbmgib .classTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-u77ddfbmgib .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-u77ddfbmgib .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-u77ddfbmgib :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Cheatcodes

+list<Error> errors

+list<Event> events

+list<Enum> enums

+list<Struct> structs

+list<Cheatcode> cheatcodes

+from_json(str) : Cheatcodes

+from_dict(dict) : Cheatcodes

Cheatcode

+Function func

+str group

+str status

+str safety

+from_dict(dict) : Cheatcode

Function

+str id

+str description

+str declaration

+Visibility visibility

+Mutability mutability

+str signature

+str selector

+bytes selector_bytes

+from_dict(dict) : Function

Error

+str name

+str description

+str declaration

Event

+str name

+str description

+str declaration

Enum

+str name

+str description

+list<EnumVariant> variants

Struct

+str name

+str description

+list<StructField> fields

Core Data Classes

ClassPurposeKey Fields`Cheatcodes`Root container`cheatcodes`, `errors`, `events`, `enums`, `structs``Cheatcode`Single cheatcode definition`func`, `group`, `status`, `safety``Function`Function signature details`declaration`, `signature`, `selector``Error`Custom error definition`name`, `declaration``Event`Event definition`name`, `declaration``Enum`Enum type definition`name`, `variants``Struct`Struct type definition`name`, `fields`

Sources: [contracts/lib/forge-std/scripts/vm.py#181-374](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L181-L374)

---

## Code Generation ProcessLink copied!

The `CheatcodesPrinter` class is responsible for transforming the parsed data model into valid Solidity code. It maintains state for indentation, formatting preferences, and output buffering.

#mermaid-9t44y8e1135{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-9t44y8e1135 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-9t44y8e1135 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-9t44y8e1135 .error-icon{fill:#a44141;}#mermaid-9t44y8e1135 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-9t44y8e1135 .edge-thickness-normal{stroke-width:1px;}#mermaid-9t44y8e1135 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-9t44y8e1135 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-9t44y8e1135 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-9t44y8e1135 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-9t44y8e1135 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-9t44y8e1135 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-9t44y8e1135 .marker.cross{stroke:lightgrey;}#mermaid-9t44y8e1135 svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-9t44y8e1135 p{margin:0;}#mermaid-9t44y8e1135 .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-9t44y8e1135 .cluster-label text{fill:#F9FFFE;}#mermaid-9t44y8e1135 .cluster-label span{color:#F9FFFE;}#mermaid-9t44y8e1135 .cluster-label span p{background-color:transparent;}#mermaid-9t44y8e1135 .label text,#mermaid-9t44y8e1135 span{fill:#ccc;color:#ccc;}#mermaid-9t44y8e1135 .node rect,#mermaid-9t44y8e1135 .node circle,#mermaid-9t44y8e1135 .node ellipse,#mermaid-9t44y8e1135 .node polygon,#mermaid-9t44y8e1135 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-9t44y8e1135 .rough-node .label text,#mermaid-9t44y8e1135 .node .label text,#mermaid-9t44y8e1135 .image-shape .label,#mermaid-9t44y8e1135 .icon-shape .label{text-anchor:middle;}#mermaid-9t44y8e1135 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-9t44y8e1135 .rough-node .label,#mermaid-9t44y8e1135 .node .label,#mermaid-9t44y8e1135 .image-shape .label,#mermaid-9t44y8e1135 .icon-shape .label{text-align:center;}#mermaid-9t44y8e1135 .node.clickable{cursor:pointer;}#mermaid-9t44y8e1135 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-9t44y8e1135 .arrowheadPath{fill:lightgrey;}#mermaid-9t44y8e1135 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-9t44y8e1135 .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-9t44y8e1135 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-9t44y8e1135 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-9t44y8e1135 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-9t44y8e1135 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-9t44y8e1135 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-9t44y8e1135 .cluster text{fill:#F9FFFE;}#mermaid-9t44y8e1135 .cluster span{color:#F9FFFE;}#mermaid-9t44y8e1135 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-9t44y8e1135 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-9t44y8e1135 rect.text{fill:none;stroke-width:0;}#mermaid-9t44y8e1135 .icon-shape,#mermaid-9t44y8e1135 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-9t44y8e1135 .icon-shape p,#mermaid-9t44y8e1135 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-9t44y8e1135 .icon-shape rect,#mermaid-9t44y8e1135 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-9t44y8e1135 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-9t44y8e1135 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-9t44y8e1135 :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Post-Processing

Item Rendering

Generation Phases

CheatcodesPrinter Configuration

Input Processing

cheatcodes.json

Cheatcodes Object Tree

Filtered Lists safe[] & unsafe[]

Printer Config spdx_identifier solidity_requirement abicoder_pragma indent_level

p_prelude() License & Pragma

p_contract(VmSafe) Safe Cheatcodes

p_contract(Vm) Unsafe Cheatcodes inherits VmSafe

p_errors()

p_events()

p_enums()

p_structs()

p_functions()

memory → calldata Compatibility Fix

forge fmt Code Formatting

Code Generation Algorithm

Sources: [contracts/lib/forge-std/scripts/vm.py#409-643](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L409-L643)

### Filtering and SortingLink copied!

The script applies several filters and sorts to organize cheatcodes:

```
# Filter out experimental and internal cheatcodes
ccs = list(filter(lambda cc: cc.status not in ["experimental", "internal"], ccs))
 
# Sort by function ID
ccs.sort(key=lambda cc: cc.func.id)
 
# Separate by safety classification
safe = list(filter(lambda cc: cc.safety == "safe", ccs))
unsafe = list(filter(lambda cc: cc.safety == "unsafe", ccs))
```

Sources: [contracts/lib/forge-std/scripts/vm.py#43-51](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L43-L51)

### Output StructureLink copied!

The generator produces two interfaces:

InterfaceInheritancePurposeCheatcodes Included`VmSafe`NoneSafe operations only`safety == "safe"``Vm``VmSafe`Full test capabilities`safety == "unsafe"`

VmSafe Interface: Contains cheatcodes that do not manipulate EVM state in ways that could cause script simulations to differ from on-chain execution. Recommended for deployment scripts.

Vm Interface: Inherits from `VmSafe` and adds state-manipulating cheatcodes like `prank`, `roll`, `warp`, etc. Intended for testing only.

Sources: [contracts/lib/forge-std/scripts/vm.py#18-27](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L18-L27)[contracts/lib/forge-std/scripts/vm.py#69-92](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L69-L92)

---

## Printer ArchitectureLink copied!

The `CheatcodesPrinter` class uses a state machine pattern with an internal buffer and indentation tracking.

#mermaid-x8tqxuhq1if{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-x8tqxuhq1if .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-x8tqxuhq1if .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-x8tqxuhq1if .error-icon{fill:#a44141;}#mermaid-x8tqxuhq1if .error-text{fill:#ddd;stroke:#ddd;}#mermaid-x8tqxuhq1if .edge-thickness-normal{stroke-width:1px;}#mermaid-x8tqxuhq1if .edge-thickness-thick{stroke-width:3.5px;}#mermaid-x8tqxuhq1if .edge-pattern-solid{stroke-dasharray:0;}#mermaid-x8tqxuhq1if .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-x8tqxuhq1if .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-x8tqxuhq1if .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-x8tqxuhq1if .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-x8tqxuhq1if .marker.cross{stroke:lightgrey;}#mermaid-x8tqxuhq1if svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-x8tqxuhq1if p{margin:0;}#mermaid-x8tqxuhq1if .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-x8tqxuhq1if .cluster-label text{fill:#F9FFFE;}#mermaid-x8tqxuhq1if .cluster-label span{color:#F9FFFE;}#mermaid-x8tqxuhq1if .cluster-label span p{background-color:transparent;}#mermaid-x8tqxuhq1if .label text,#mermaid-x8tqxuhq1if span{fill:#ccc;color:#ccc;}#mermaid-x8tqxuhq1if .node rect,#mermaid-x8tqxuhq1if .node circle,#mermaid-x8tqxuhq1if .node ellipse,#mermaid-x8tqxuhq1if .node polygon,#mermaid-x8tqxuhq1if .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-x8tqxuhq1if .rough-node .label text,#mermaid-x8tqxuhq1if .node .label text,#mermaid-x8tqxuhq1if .image-shape .label,#mermaid-x8tqxuhq1if .icon-shape .label{text-anchor:middle;}#mermaid-x8tqxuhq1if .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-x8tqxuhq1if .rough-node .label,#mermaid-x8tqxuhq1if .node .label,#mermaid-x8tqxuhq1if .image-shape .label,#mermaid-x8tqxuhq1if .icon-shape .label{text-align:center;}#mermaid-x8tqxuhq1if .node.clickable{cursor:pointer;}#mermaid-x8tqxuhq1if .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-x8tqxuhq1if .arrowheadPath{fill:lightgrey;}#mermaid-x8tqxuhq1if .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-x8tqxuhq1if .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-x8tqxuhq1if .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-x8tqxuhq1if .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-x8tqxuhq1if .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-x8tqxuhq1if .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-x8tqxuhq1if .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-x8tqxuhq1if .cluster text{fill:#F9FFFE;}#mermaid-x8tqxuhq1if .cluster span{color:#F9FFFE;}#mermaid-x8tqxuhq1if div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-x8tqxuhq1if .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-x8tqxuhq1if rect.text{fill:none;stroke-width:0;}#mermaid-x8tqxuhq1if .icon-shape,#mermaid-x8tqxuhq1if .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-x8tqxuhq1if .icon-shape p,#mermaid-x8tqxuhq1if .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-x8tqxuhq1if .icon-shape rect,#mermaid-x8tqxuhq1if .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-x8tqxuhq1if .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-x8tqxuhq1if .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-x8tqxuhq1if :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

High-Level Methods

Output Methods

CheatcodesPrinter State

buffer: str Accumulated Output

indent_level: int Current Nesting

_indent_str: str Whitespace Unit

_p_str(txt) Append Text

_p_nl() Newline

_p_indent() Add Indentation

_p_line(fn) Indent + fn + Newline

p_contract() Interface Generation

p_function() Function Declaration

_p_comment() NatSpec Comments

Key Printer Methods

MethodPurposeUsage`p_contract()`Generate interface definitionCalled for `VmSafe` and `Vm``p_function()`Generate function declarationCalled for each cheatcode`p_structs()`Generate struct definitionsShared types like `Rpc`, `FsMetadata``p_enums()`Generate enum definitionsTypes like `ForgeContext``_p_comment()`Generate NatSpec documentationFunction descriptions`_with_indent()`Execute with increased indentationBlocks and nested items`finish()`Return buffer and resetCalled after each interface

Sources: [contracts/lib/forge-std/scripts/vm.py#409-643](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L409-L643)

---

## Item OrderingLink copied!

The `ItemOrder` class controls the sequence in which interface members are generated:

```
ItemOrder.default() = [
    Item.ERROR,    # Custom error definitions
    Item.EVENT,    # Event definitions
    Item.ENUM,     # Enum type definitions
    Item.STRUCT,   # Struct type definitions
    Item.FUNCTION, # Function declarations
]
```

This ordering ensures that types are declared before they are referenced in function signatures, satisfying Solidity's forward reference requirements.

Sources: [contracts/lib/forge-std/scripts/vm.py#376-406](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L376-L406)

---

## Group HeadersLink copied!

Cheatcodes are organized by functional group (e.g., "evm", "testing", "json"). The script injects comment headers to visually separate groups:

```
// ======== EVM ========
function roll(uint256 blockNumber) external;
function warp(uint256 timestamp) external;
 
// ======== Testing ========
function expectRevert() external;
function expectEmit() external;
```

This is implemented via the `prefix_with_group_headers()` function, which inserts synthetic cheatcodes with group headers as their declarations.

Sources: [contracts/lib/forge-std/scripts/vm.py#138-160](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L138-L160)

---

## Cheatcode ComparisonLink copied!

The `CmpCheatcode` class defines a total ordering for cheatcodes based on multiple criteria:

```
def cmp_cheatcode(a: Cheatcode, b: Cheatcode) -> int:
    if a.group != b.group:
        return -1 if a.group < b.group else 1
    if a.status != b.status:
        return -1 if a.status < b.status else 1
    if a.safety != b.safety:
        return -1 if a.safety < b.safety else 1
    if a.func.id != b.func.id:
        return -1 if a.func.id < b.func.id else 1
    return 0
```

Sorting Priority:

1. Group (alphabetical)
2. Status (e.g., "stable" before "deprecated")
3. Safety ("safe" before "unsafe")
4. Function ID (lexicographic)

Sources: [contracts/lib/forge-std/scripts/vm.py#110-136](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L110-L136)

---

## Running the ScriptLink copied!

### Basic UsageLink copied!

```
# Download cheatcodes.json from Foundry repository and generate Vm.sol
python3 contracts/lib/forge-std/scripts/vm.py
```

### Using Local Cheatcodes FileLink copied!

```
# Generate from a local cheatcodes.json file
python3 contracts/lib/forge-std/scripts/vm.py --from /path/to/cheatcodes.json
```

### Output LocationLink copied!

The generated file is always written to `src/Vm.sol` relative to the forge-std root.

Sources: [contracts/lib/forge-std/scripts/vm.py#30-41](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L30-L41)[contracts/lib/forge-std/scripts/vm.py#100-107](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L100-L107)

---

## Compatibility TransformationsLink copied!

The script applies post-generation transformations to ensure compatibility with older Solidity versions:

### Memory to Calldata ConversionLink copied!

For Solidity versions `<0.8.0`, the script converts `memory` to `calldata` for function parameters using a regex transformation:

```
def memory_to_calldata(m: re.Match) -> str:
    return " calldata " + m.group(1)
 
out = re.sub(r" memory (.*returns)", memory_to_calldata, out)
```

This allows the generated interfaces to support a wide range of Solidity compiler versions specified in the pragma: `>=0.6.2 <0.9.0`.

Sources: [contracts/lib/forge-std/scripts/vm.py#94-98](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L94-L98)

---

## Configuration OptionsLink copied!

The `CheatcodesPrinter` constructor accepts multiple configuration parameters:

ParameterTypeDefaultPurpose`spdx_identifier``str``"UNLICENSED"`SPDX license header`solidity_requirement``str``""`Pragma solidity version`abicoder_pragma``bool``False`Enable `ABIEncoderV2` pragma`block_doc_style``bool``False`Use `/* */` vs `//` comments`indent_with``int | str``4`Spaces per indent level`items_order``ItemOrder``default()`Order of interface members

For Aegis, the generator uses:

- `spdx_identifier = "MIT OR Apache-2.0"`
- `solidity_requirement = ">=0.6.2 <0.9.0"`
- `abicoder_pragma = True`

Sources: [contracts/lib/forge-std/scripts/vm.py#60-66](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L60-L66)[contracts/lib/forge-std/scripts/vm.py#426-456](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L426-L456)

---

## Error HandlingLink copied!

The script validates that cheatcodes are correctly classified and that the forge formatter runs successfully:

```
# Ensure safe + unsafe covers all cheatcodes
assert len(safe) + len(unsafe) == len(ccs)
 
# Ensure forge fmt succeeds
forge_fmt = ["forge", "fmt", OUT_PATH]
res = subprocess.run(forge_fmt)
assert res.returncode == 0, f"command failed: {forge_fmt}"
```

If forge formatting fails, the script exits with an error rather than producing malformed output.

Sources: [contracts/lib/forge-std/scripts/vm.py#51](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L51-L51)[contracts/lib/forge-std/scripts/vm.py#103-105](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L103-L105)

---

## Integration with Forge-StdLink copied!

The generated `Vm.sol` file is imported by the base test and script contracts:

- Test.sol: Imports `Vm` (full cheatcode access)
- Script.sol: Imports `VmSafe` (safe cheatcodes only)
- StdCheats.sol: Uses `Vm` interface for cheatcode wrappers

This separation enforces best practices: scripts should not use state-manipulating cheatcodes that could cause deployment simulations to diverge from actual on-chain behavior.

Sources: [contracts/lib/forge-std/README.md#1-267](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/README.md#L1-L267)

---

## Generated Interface ExampleLink copied!

The output structure follows this pattern:

```
// Automatically @generated by scripts/vm.py. Do not modify manually.
 
// SPDX-License-Identifier: MIT OR Apache-2.0
pragma solidity >=0.6.2 <0.9.0;
pragma experimental ABIEncoderV2;
 
interface VmSafe {
    // Events, enums, structs...
    
    // ======== Testing ========
    /// Description of cheatcode
    function expectRevert() external;
    
    // ======== JSON ========
    function parseJson(string calldata json) external returns (bytes memory);
}
 
interface Vm is VmSafe {
    // ======== EVM ========
    /// Set block.timestamp
    function warp(uint256 timestamp) external;
    
    // ======== Pranks ========
    /// Set msg.sender for next call
    function prank(address msgSender) external;
}
```

The actual generated file contains hundreds of cheatcodes organized into functional groups.

Sources: [contracts/lib/forge-std/scripts/vm.py#56-92](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L56-L92)

---

## Maintenance and UpdatesLink copied!

When Foundry adds new cheatcodes or modifies existing ones:

1. Run `vm.py` to regenerate `Vm.sol`
2. The script automatically fetches the latest `cheatcodes.json` from Foundry's repository
3. Forge formatter ensures consistent style
4. Git diff shows exactly what changed

This automation eliminates manual synchronization errors and keeps forge-std aligned with Foundry's capabilities.

Sources: [contracts/lib/forge-std/scripts/vm.py#15-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/scripts/vm.py#L15-L16)

---

# Contributing

# ContributingLink copied!
Relevant source files
- [contracts/lib/forge-std/CONTRIBUTING.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md)

This document provides guidelines for contributing to the Aegis cross-chain circuit breaker system. It covers the development workflow, pull request process, code standards, and testing requirements for the project.

For information about initial environment setup, see [Environment Setup](#4.1). For details on building and testing the codebase, see [Building and Testing](#4.2). For code formatting and development conventions, see [Code Standards](#4.4).

---

## Purpose and ScopeLink copied!

The Aegis project welcomes contributions from developers interested in improving cross-chain DeFi security infrastructure. This guide outlines the processes for submitting bug reports, feature requests, and code changes. It applies to contributions to the smart contracts in [src/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/) deployment scripts in [script/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/) test suites in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) and supporting infrastructure in [relayer/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/relayer/)

---

## Code of ConductLink copied!

Contributors to the Aegis project are expected to adhere to professional standards of conduct when interacting with the community. All interactions should be respectful and constructive, focused on improving the codebase and advancing the project's technical goals.

Violations can be reported to the project maintainers through GitHub issue tracker or direct communication.

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#12-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L12-L16)

---

## Ways to ContributeLink copied!

There are four primary ways to contribute to Aegis:

### 1. Opening IssuesLink copied!

Submit bug reports or feature requests through the GitHub issue tracker. Include:

- Aegis version and commit hash
- Network(s) affected (Sepolia, Reactive Network, Unichain)
- Contract addresses if applicable
- Concrete steps to reproduce the issue
- Expected vs. actual behavior

### 2. Adding ContextLink copied!

Enhance existing issues by providing:

- Transaction hashes demonstrating the problem
- Logs from `forge test` or deployment scripts
- Screenshots of cross-chain behavior
- Analysis of gas consumption or latency

### 3. Resolving IssuesLink copied!

Submit pull requests that:

- Fix bugs in contracts ([src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol)[src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol)[src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol)[src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol))
- Improve deployment scripts ([script/04_DeployOracle.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/04_DeployOracle.s.sol)[script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol)[script/06_DeployHook.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/06_DeployHook.s.sol))
- Enhance test coverage in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/)
- Update documentation

### 4. Code ReviewLink copied!

Review pull requests by:

- Testing changes locally using `forge test`
- Verifying cross-chain behavior on testnets
- Checking for gas optimizations
- Ensuring compatibility with Uniswap v4 hook interface

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#18-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L18-L32)

---

## Development WorkflowLink copied!

The following diagram illustrates the complete contribution workflow from fork to merge, referencing specific files and commands used in the process.

### Contribution Workflow DiagramLink copied!

#mermaid-pdit5v2rjt{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-pdit5v2rjt .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-pdit5v2rjt .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-pdit5v2rjt .error-icon{fill:#a44141;}#mermaid-pdit5v2rjt .error-text{fill:#ddd;stroke:#ddd;}#mermaid-pdit5v2rjt .edge-thickness-normal{stroke-width:1px;}#mermaid-pdit5v2rjt .edge-thickness-thick{stroke-width:3.5px;}#mermaid-pdit5v2rjt .edge-pattern-solid{stroke-dasharray:0;}#mermaid-pdit5v2rjt .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-pdit5v2rjt .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-pdit5v2rjt .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-pdit5v2rjt .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-pdit5v2rjt .marker.cross{stroke:lightgrey;}#mermaid-pdit5v2rjt svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-pdit5v2rjt p{margin:0;}#mermaid-pdit5v2rjt .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-pdit5v2rjt .cluster-label text{fill:#F9FFFE;}#mermaid-pdit5v2rjt .cluster-label span{color:#F9FFFE;}#mermaid-pdit5v2rjt .cluster-label span p{background-color:transparent;}#mermaid-pdit5v2rjt .label text,#mermaid-pdit5v2rjt span{fill:#ccc;color:#ccc;}#mermaid-pdit5v2rjt .node rect,#mermaid-pdit5v2rjt .node circle,#mermaid-pdit5v2rjt .node ellipse,#mermaid-pdit5v2rjt .node polygon,#mermaid-pdit5v2rjt .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-pdit5v2rjt .rough-node .label text,#mermaid-pdit5v2rjt .node .label text,#mermaid-pdit5v2rjt .image-shape .label,#mermaid-pdit5v2rjt .icon-shape .label{text-anchor:middle;}#mermaid-pdit5v2rjt .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-pdit5v2rjt .rough-node .label,#mermaid-pdit5v2rjt .node .label,#mermaid-pdit5v2rjt .image-shape .label,#mermaid-pdit5v2rjt .icon-shape .label{text-align:center;}#mermaid-pdit5v2rjt .node.clickable{cursor:pointer;}#mermaid-pdit5v2rjt .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-pdit5v2rjt .arrowheadPath{fill:lightgrey;}#mermaid-pdit5v2rjt .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-pdit5v2rjt .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-pdit5v2rjt .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-pdit5v2rjt .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-pdit5v2rjt .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-pdit5v2rjt .cluster text{fill:#F9FFFE;}#mermaid-pdit5v2rjt .cluster span{color:#F9FFFE;}#mermaid-pdit5v2rjt div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-pdit5v2rjt .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-pdit5v2rjt rect.text{fill:none;stroke-width:0;}#mermaid-pdit5v2rjt .icon-shape,#mermaid-pdit5v2rjt .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-pdit5v2rjt .icon-shape p,#mermaid-pdit5v2rjt .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-pdit5v2rjt .icon-shape rect,#mermaid-pdit5v2rjt .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-pdit5v2rjt .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-pdit5v2rjt :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Changes requested

Approved

Fail

Pass

Fork github.com/HACK3R-CRYPTO/Aegis

git clone <your-fork>

forge install Install dependencies

git checkout -b feature/your-change

Modify source files: src/*.sol script/*.s.sol test/*.t.sol

forge fmt Format code

forge build Compile contracts

forge test -vvv Run test suite

git commit -m 'description'

git push origin feature/your-change

Open Pull Request on GitHub

Code Review Process

Address feedback: git commit --amend or new commits

CI Checks Pass?

Merged by maintainer

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#77-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L77-L101)[contracts/lib/forge-std/CONTRIBUTING.md#116-134](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L116-L134)

---

## Pre-Submission ChecklistLink copied!

Before submitting a pull request, ensure the following commands pass:

### Code FormattingLink copied!

```
forge fmt --check
```

All Solidity files must conform to the project's formatting standards as defined in [foundry.toml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml) The formatter enforces consistent line length, indentation, and spacing.

### CompilationLink copied!

```
forge build
```

All contracts must compile without errors. The build process includes:

- [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol) - Uniswap v4 hook implementation
- [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) - Reactive Network contract
- [src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol) - L1 price oracle
- [src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol) - ERC-721/ERC-8004 registry

### Test ExecutionLink copied!

```
forge test -vvv
```

All existing tests in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) must pass. Tests verify:

- Hook panic mode activation/deactivation
- Cross-chain message handling
- Guardian reputation mechanics
- VIP lane fee calculations

### Solidity Version CompatibilityLink copied!

If modifying core contracts, verify compatibility across Solidity versions:

```
forge build --skip test --use solc:0.8.0
forge build --skip test --use solc:0.8.20
```

The project primarily targets Solidity 0.8.24 but should maintain backward compatibility where possible.

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-100](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L100)

---

## Pull Request ProcessLink copied!

The pull request lifecycle involves several stages from opening to merge. The following diagram shows the detailed review and merge process with specific file artifacts.

### Pull Request Review PipelineLink copied!

#mermaid-87ombf2dott{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-87ombf2dott .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-87ombf2dott .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-87ombf2dott .error-icon{fill:#a44141;}#mermaid-87ombf2dott .error-text{fill:#ddd;stroke:#ddd;}#mermaid-87ombf2dott .edge-thickness-normal{stroke-width:1px;}#mermaid-87ombf2dott .edge-thickness-thick{stroke-width:3.5px;}#mermaid-87ombf2dott .edge-pattern-solid{stroke-dasharray:0;}#mermaid-87ombf2dott .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-87ombf2dott .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-87ombf2dott .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-87ombf2dott .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-87ombf2dott .marker.cross{stroke:lightgrey;}#mermaid-87ombf2dott svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-87ombf2dott p{margin:0;}#mermaid-87ombf2dott .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-87ombf2dott .cluster-label text{fill:#F9FFFE;}#mermaid-87ombf2dott .cluster-label span{color:#F9FFFE;}#mermaid-87ombf2dott .cluster-label span p{background-color:transparent;}#mermaid-87ombf2dott .label text,#mermaid-87ombf2dott span{fill:#ccc;color:#ccc;}#mermaid-87ombf2dott .node rect,#mermaid-87ombf2dott .node circle,#mermaid-87ombf2dott .node ellipse,#mermaid-87ombf2dott .node polygon,#mermaid-87ombf2dott .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-87ombf2dott .rough-node .label text,#mermaid-87ombf2dott .node .label text,#mermaid-87ombf2dott .image-shape .label,#mermaid-87ombf2dott .icon-shape .label{text-anchor:middle;}#mermaid-87ombf2dott .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-87ombf2dott .rough-node .label,#mermaid-87ombf2dott .node .label,#mermaid-87ombf2dott .image-shape .label,#mermaid-87ombf2dott .icon-shape .label{text-align:center;}#mermaid-87ombf2dott .node.clickable{cursor:pointer;}#mermaid-87ombf2dott .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-87ombf2dott .arrowheadPath{fill:lightgrey;}#mermaid-87ombf2dott .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-87ombf2dott .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-87ombf2dott .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-87ombf2dott .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-87ombf2dott .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-87ombf2dott .cluster text{fill:#F9FFFE;}#mermaid-87ombf2dott .cluster span{color:#F9FFFE;}#mermaid-87ombf2dott div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-87ombf2dott .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-87ombf2dott rect.text{fill:none;stroke-width:0;}#mermaid-87ombf2dott .icon-shape,#mermaid-87ombf2dott .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-87ombf2dott .icon-shape p,#mermaid-87ombf2dott .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-87ombf2dott .icon-shape rect,#mermaid-87ombf2dott .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-87ombf2dott .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-87ombf2dott :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Merge

Verification

Manual Review

Automated Checks

Submission

Open PR with description

Fill PR template: - What changed - Why changed - How tested

GitHub Actions: forge fmt --check

GitHub Actions: forge build

GitHub Actions: forge test

Review code changes: src/*.sol test/*.t.sol

Verify test coverage: new tests added?

Check docs: comments updated?

Reviewer runs: forge test locally

Deploy to testnet: using script/*.s.sol

Test cross-chain flow: Oracle → Sentinel → Hook

Maintainer approval

Squash and merge to main branch

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#122-134](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L122-L134)[contracts/lib/forge-std/CONTRIBUTING.md#135-174](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L135-L174)

---

## Code StandardsLink copied!

### Solidity ConventionsLink copied!

All Solidity code must adhere to the following standards:

StandardRequirementExampleContract namingPascalCase`AegisHook`, `AegisSentinel`Function namingcamelCase`setPanicMode()`, `beforeSwap()`Variable namingcamelCase with underscore prefix for private`_panicMode`, `hookRegistry`Event namingPascalCase`PanicModeChanged`, `PriceUpdate`Error namingPascalCase`PoolPaused`, `UnauthorizedCaller`Constant namingUPPER_SNAKE_CASE`CRASH_THRESHOLD`, `VIP_FEE`

### Documentation RequirementsLink copied!

All public functions must include NatSpec comments:

```
/// @notice Sets the panic mode state for the hook
/// @dev Only callable by the AegisSentinel on Reactive Network
/// @param isPanic True to activate circuit breaker, false to deactivate
function setPanicMode(bool isPanic) external;
```

### File OrganizationLink copied!

Files should follow this structure:

1. SPDX license identifier
2. Pragma statement
3. Import statements (external libraries first, then local imports)
4. Contract declaration
5. State variables
6. Events
7. Errors
8. Modifiers
9. Constructor
10. External functions
11. Public functions
12. Internal functions
13. Private functions

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Testing RequirementsLink copied!

### Test StructureLink copied!

Tests must be organized in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) with the following naming convention:

Test TypeFile PatternExampleUnit tests`{Contract}.t.sol``AegisHook.t.sol`Integration tests`{Feature}Integration.t.sol``CrossChainIntegration.t.sol`Deployment tests`Deploy{Contract}.t.sol``DeployAegisHook.t.sol`

### Test Coverage RequirementsLink copied!

New features require:

1. Unit Tests: Test individual functions in isolation

- Happy path scenarios
- Edge cases (zero values, maximum values)
- Revert conditions
2. Integration Tests: Test cross-contract interactions

- Oracle → Sentinel message flow
- Sentinel → Hook panic mode activation
- Hook → Registry reputation updates
3. Invariant Tests: Test system-wide properties

- Panic mode can only be set by authorized sentinel
- VIP lane only accessible with reputation > 90
- Guardian NFTs are non-transferable during active interventions

### Running Specific Test SuitesLink copied!

```
# Run all tests
forge test
 
# Run specific contract tests
forge test --match-contract AegisHookTest
 
# Run specific test function
forge test --match-test testSetPanicMode
 
# Run with verbose output
forge test -vvv
 
# Run with gas reporting
forge test --gas-report
```

### Test UtilitiesLink copied!

Tests leverage [forge-std](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/forge-std) utilities:

- `vm.prank(address)` - Simulate calls from specific addresses
- `vm.expectRevert(bytes4)` - Assert function reverts with error
- `vm.expectEmit()` - Assert events are emitted correctly
- `vm.warp(uint256)` - Manipulate block timestamp
- `vm.roll(uint256)` - Manipulate block number

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Deployment Script StandardsLink copied!

When modifying deployment scripts in [script/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/) ensure:

1. Idempotency: Scripts should be runnable multiple times without errors
2. Verification: Include contract verification steps
3. Logging: Output deployed addresses to console and broadcast logs
4. Error Handling: Check for deployment failures and provide clear error messages

Deployment scripts follow this naming pattern:

- [script/04_DeployOracle.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/04_DeployOracle.s.sol) - Deploy MockOracle to Sepolia
- [script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol) - Deploy AegisSentinel to Reactive Network
- [script/06_DeployHook.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/06_DeployHook.s.sol) - Deploy AegisHook to Unichain

Each script must:

- Inherit from `forge-std/Script.sol`
- Implement `run()` function as entry point
- Use `vm.broadcast()` to sign transactions
- Store deployment artifacts in [broadcast/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/) directory

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#77-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L77-L101)

---

## Commit GuidelinesLink copied!

### Commit Message FormatLink copied!

Commits should follow this structure:

```
<type>(<scope>): <subject>
 
<body>
 
<footer>
```

Types:

- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation changes
- `test`: Test additions or modifications
- `refactor`: Code refactoring without behavior change
- `chore`: Build process or auxiliary tool changes

Examples:

```
feat(hook): add VIP lane bypass for high-reputation guardians
 
Implements the VIP lane mechanism that allows guardians with
reputation > 90 to bypass panic mode restrictions with reduced
fees (0.01% instead of 0.30%).
 
Refs: #42
```

```
fix(sentinel): correct price threshold comparison logic
 
The sentinel was using >= instead of > when comparing prices
against CRASH_THRESHOLD, causing false positives at exactly
1500 ETH. Updated to use strict greater-than comparison.
 
Fixes: #58
```

### Commit GranularityLink copied!

Commits should be logically grouped:

- Each commit should represent a single logical change
- Avoid "WIP" or "checkpoint" commits in final PR
- Squash fixup commits before requesting review
- Use `git commit --amend` for small corrections

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#116-121](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L116-L121)

---

## Review ProcessLink copied!

### For ContributorsLink copied!

When your PR is under review:

1. Respond Promptly: Address reviewer feedback within 48 hours when possible
2. Explain Decisions: If disagreeing with feedback, provide technical rationale
3. Update Documentation: Keep PR description current as code evolves
4. Test Changes: Re-run test suite after addressing feedback

### For ReviewersLink copied!

When reviewing PRs:

1. Review Incrementally: Focus on high-level concerns before nits
2. Test Locally: Clone branch and run `forge test` to verify claims
3. Check Cross-Chain Behavior: For changes affecting cross-chain flow, test on testnets
4. Distinguish Blocking vs. Non-Blocking: Clearly mark suggestions as "nit" if non-critical

Priority review checklist:

PriorityQuestionHighDoes this improve security of the circuit breaker mechanism?HighDoes this maintain compatibility with Uniswap v4 hook interface?HighDoes this preserve cross-chain message integrity?MediumAre tests comprehensive and passing?MediumIs gas consumption reasonable?LowAre variable names clear?LowAre comments accurate?

### Abandoned PRsLink copied!

If a PR has no activity for 30 days:

1. Maintainer will comment asking for status
2. After 14 additional days, PR may be closed with "stale" label
3. Contributor can reopen by commenting when ready to resume

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#135-176](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L135-L176)

---

## Cross-Chain Testing ProtocolLink copied!

Changes affecting cross-chain interactions require specific testing:

### Local TestingLink copied!

```
# Test individual components
forge test --match-contract MockOracleTest
forge test --match-contract AegisSentinelTest
forge test --match-contract AegisHookTest
```

### Testnet DeploymentLink copied!

Follow deployment sequence in order:

1. Deploy Oracle (Sepolia L1)

```
forge script script/04_DeployOracle.s.sol --rpc-url sepolia --broadcast
```
2. Deploy Sentinel (Reactive Network)

```
forge script script/05_DeploySentinel.s.sol --rpc-url reactive --broadcast
```
3. Deploy Hook (Unichain L2)

```
forge script script/06_DeployHook.s.sol --rpc-url unichain --broadcast
```

### End-to-End VerificationLink copied!

After deployment, verify the complete flow:

1. Call `updatePrice()` on MockOracle with crash price (< 1500 ETH)
2. Monitor Sentinel logs for `react()` function execution
3. Verify Hook receives `setPanicMode(true)` call
4. Test swap on Uniswap v4 pool - should revert with `PoolPaused` error
5. Call `updatePrice()` with recovery price (> 1500 ETH)
6. Verify Hook receives `setPanicMode(false)` call
7. Test swap again - should succeed

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Communication ChannelsLink copied!

### Issue TrackerLink copied!

Use GitHub Issues for:

- Bug reports
- Feature requests
- Technical discussions
- Deployment questions

### Pull Request DiscussionsLink copied!

Use PR comment threads for:

- Code review feedback
- Implementation alternatives
- Test coverage discussions

### Commit MessagesLink copied!

Use Git commit messages for:

- Explaining "why" behind changes
- Linking to related issues
- Documenting breaking changes

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#39-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L39-L47)

---

## Dependency ManagementLink copied!

Aegis uses git submodules for dependency management. When adding or updating dependencies:

### Adding a New DependencyLink copied!

```
forge install <org>/<repo>
```

This updates [.gitmodules](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.gitmodules) and [contracts/lib/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/) directory.

### Updating Existing DependenciesLink copied!

```
forge update <dependency-name>
```

Update specific dependencies:

- `forge-std` - Testing and scripting utilities
- `uniswap-hooks` - Uniswap v4 hook interfaces
- `system-smart-contracts` - Reactive Network base contracts

### Dependency ConsiderationsLink copied!

When proposing dependency changes:

1. Justify the need for the new dependency
2. Verify license compatibility
3. Check for security audits
4. Assess maintenance status of upstream repository
5. Consider impact on compilation time and contract size

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L101)

---

## Release ProcessLink copied!

Releases are tagged when significant milestones are reached:

Release TypeVersion BumpExampleMajorBreaking changes to contract interfaces1.0.0 → 2.0.0MinorNew features without breaking changes1.0.0 → 1.1.0PatchBug fixes and optimizations1.0.0 → 1.0.1

### Pre-Release ChecklistLink copied!

Before tagging a release:

1. Update deployment addresses in [README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md)
2. Run full test suite: `forge test`
3. Verify testnet deployments are functional
4. Update documentation for new features
5. Review broadcast logs in [broadcast/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/) for accuracy

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#180-187](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L180-L187)

---

## Special ConsiderationsLink copied!

### Uniswap v4 Hook CompatibilityLink copied!

Changes to [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol) must maintain compatibility with:

- `IHooks` interface from `v4-core/src/interfaces/IHooks.sol`
- Hook flag requirements (beforeSwap enabled)
- PoolManager callback expectations

Verify hook compatibility by checking:

```
forge test --match-contract AegisHookTest
```

### Reactive Network ConstraintsLink copied!

Changes to [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) must:

- Inherit from `AbstractReactive` contract
- Implement `react()` function for event handling
- Use correct cross-chain RPC methods from `IReactive`
- Handle event subscription properly in constructor

### Guardian Registry StandardsLink copied!

Changes to [src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol) must:

- Maintain ERC-721 compliance
- Preserve ERC-8004 reputation interface
- Ensure non-transferability during active interventions
- Update reputation atomically to prevent race conditions

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#102-114](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L102-L114)

---

## Getting HelpLink copied!

If you encounter issues during contribution:

1. Search existing issues: Your question may already be answered
2. Review documentation: Check [Getting Started](#1.1) and [Development Guide](#4)
3. Open a discussion: Use GitHub Discussions for general questions
4. Open an issue: For bugs or feature requests, create a detailed issue

When asking for help, include:

- Steps you've already tried
- Full error messages or logs
- Output of `forge --version`
- Network(s) affected (if applicable)
- Relevant contract addresses (if deployed)

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#39-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L39-L47)

---

# Contributing-1

# ContributingLink copied!
Relevant source files
- [contracts/lib/forge-std/CONTRIBUTING.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md)

This document provides guidelines for contributing to the Aegis cross-chain circuit breaker system. It covers the development workflow, pull request process, code standards, and testing requirements for the project.

For information about initial environment setup, see [Environment Setup](#4.1). For details on building and testing the codebase, see [Building and Testing](#4.2). For code formatting and development conventions, see [Code Standards](#4.4).

---

## Purpose and ScopeLink copied!

The Aegis project welcomes contributions from developers interested in improving cross-chain DeFi security infrastructure. This guide outlines the processes for submitting bug reports, feature requests, and code changes. It applies to contributions to the smart contracts in [src/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/) deployment scripts in [script/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/) test suites in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) and supporting infrastructure in [relayer/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/relayer/)

---

## Code of ConductLink copied!

Contributors to the Aegis project are expected to adhere to professional standards of conduct when interacting with the community. All interactions should be respectful and constructive, focused on improving the codebase and advancing the project's technical goals.

Violations can be reported to the project maintainers through GitHub issue tracker or direct communication.

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#12-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L12-L16)

---

## Ways to ContributeLink copied!

There are four primary ways to contribute to Aegis:

### 1. Opening IssuesLink copied!

Submit bug reports or feature requests through the GitHub issue tracker. Include:

- Aegis version and commit hash
- Network(s) affected (Sepolia, Reactive Network, Unichain)
- Contract addresses if applicable
- Concrete steps to reproduce the issue
- Expected vs. actual behavior

### 2. Adding ContextLink copied!

Enhance existing issues by providing:

- Transaction hashes demonstrating the problem
- Logs from `forge test` or deployment scripts
- Screenshots of cross-chain behavior
- Analysis of gas consumption or latency

### 3. Resolving IssuesLink copied!

Submit pull requests that:

- Fix bugs in contracts ([src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol)[src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol)[src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol)[src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol))
- Improve deployment scripts ([script/04_DeployOracle.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/04_DeployOracle.s.sol)[script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol)[script/06_DeployHook.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/06_DeployHook.s.sol))
- Enhance test coverage in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/)
- Update documentation

### 4. Code ReviewLink copied!

Review pull requests by:

- Testing changes locally using `forge test`
- Verifying cross-chain behavior on testnets
- Checking for gas optimizations
- Ensuring compatibility with Uniswap v4 hook interface

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#18-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L18-L32)

---

## Development WorkflowLink copied!

The following diagram illustrates the complete contribution workflow from fork to merge, referencing specific files and commands used in the process.

### Contribution Workflow DiagramLink copied!

#mermaid-pdit5v2rjt{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-pdit5v2rjt .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-pdit5v2rjt .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-pdit5v2rjt .error-icon{fill:#a44141;}#mermaid-pdit5v2rjt .error-text{fill:#ddd;stroke:#ddd;}#mermaid-pdit5v2rjt .edge-thickness-normal{stroke-width:1px;}#mermaid-pdit5v2rjt .edge-thickness-thick{stroke-width:3.5px;}#mermaid-pdit5v2rjt .edge-pattern-solid{stroke-dasharray:0;}#mermaid-pdit5v2rjt .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-pdit5v2rjt .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-pdit5v2rjt .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-pdit5v2rjt .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-pdit5v2rjt .marker.cross{stroke:lightgrey;}#mermaid-pdit5v2rjt svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-pdit5v2rjt p{margin:0;}#mermaid-pdit5v2rjt .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-pdit5v2rjt .cluster-label text{fill:#F9FFFE;}#mermaid-pdit5v2rjt .cluster-label span{color:#F9FFFE;}#mermaid-pdit5v2rjt .cluster-label span p{background-color:transparent;}#mermaid-pdit5v2rjt .label text,#mermaid-pdit5v2rjt span{fill:#ccc;color:#ccc;}#mermaid-pdit5v2rjt .node rect,#mermaid-pdit5v2rjt .node circle,#mermaid-pdit5v2rjt .node ellipse,#mermaid-pdit5v2rjt .node polygon,#mermaid-pdit5v2rjt .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-pdit5v2rjt .rough-node .label text,#mermaid-pdit5v2rjt .node .label text,#mermaid-pdit5v2rjt .image-shape .label,#mermaid-pdit5v2rjt .icon-shape .label{text-anchor:middle;}#mermaid-pdit5v2rjt .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-pdit5v2rjt .rough-node .label,#mermaid-pdit5v2rjt .node .label,#mermaid-pdit5v2rjt .image-shape .label,#mermaid-pdit5v2rjt .icon-shape .label{text-align:center;}#mermaid-pdit5v2rjt .node.clickable{cursor:pointer;}#mermaid-pdit5v2rjt .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-pdit5v2rjt .arrowheadPath{fill:lightgrey;}#mermaid-pdit5v2rjt .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-pdit5v2rjt .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-pdit5v2rjt .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-pdit5v2rjt .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-pdit5v2rjt .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-pdit5v2rjt .cluster text{fill:#F9FFFE;}#mermaid-pdit5v2rjt .cluster span{color:#F9FFFE;}#mermaid-pdit5v2rjt div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-pdit5v2rjt .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-pdit5v2rjt rect.text{fill:none;stroke-width:0;}#mermaid-pdit5v2rjt .icon-shape,#mermaid-pdit5v2rjt .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-pdit5v2rjt .icon-shape p,#mermaid-pdit5v2rjt .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-pdit5v2rjt .icon-shape rect,#mermaid-pdit5v2rjt .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-pdit5v2rjt .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-pdit5v2rjt :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Changes requested

Approved

Fail

Pass

Fork github.com/HACK3R-CRYPTO/Aegis

git clone <your-fork>

forge install Install dependencies

git checkout -b feature/your-change

Modify source files: src/*.sol script/*.s.sol test/*.t.sol

forge fmt Format code

forge build Compile contracts

forge test -vvv Run test suite

git commit -m 'description'

git push origin feature/your-change

Open Pull Request on GitHub

Code Review Process

Address feedback: git commit --amend or new commits

CI Checks Pass?

Merged by maintainer

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#77-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L77-L101)[contracts/lib/forge-std/CONTRIBUTING.md#116-134](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L116-L134)

---

## Pre-Submission ChecklistLink copied!

Before submitting a pull request, ensure the following commands pass:

### Code FormattingLink copied!

```
forge fmt --check
```

All Solidity files must conform to the project's formatting standards as defined in [foundry.toml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml) The formatter enforces consistent line length, indentation, and spacing.

### CompilationLink copied!

```
forge build
```

All contracts must compile without errors. The build process includes:

- [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol) - Uniswap v4 hook implementation
- [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) - Reactive Network contract
- [src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol) - L1 price oracle
- [src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol) - ERC-721/ERC-8004 registry

### Test ExecutionLink copied!

```
forge test -vvv
```

All existing tests in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) must pass. Tests verify:

- Hook panic mode activation/deactivation
- Cross-chain message handling
- Guardian reputation mechanics
- VIP lane fee calculations

### Solidity Version CompatibilityLink copied!

If modifying core contracts, verify compatibility across Solidity versions:

```
forge build --skip test --use solc:0.8.0
forge build --skip test --use solc:0.8.20
```

The project primarily targets Solidity 0.8.24 but should maintain backward compatibility where possible.

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-100](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L100)

---

## Pull Request ProcessLink copied!

The pull request lifecycle involves several stages from opening to merge. The following diagram shows the detailed review and merge process with specific file artifacts.

### Pull Request Review PipelineLink copied!

#mermaid-87ombf2dott{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-87ombf2dott .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-87ombf2dott .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-87ombf2dott .error-icon{fill:#a44141;}#mermaid-87ombf2dott .error-text{fill:#ddd;stroke:#ddd;}#mermaid-87ombf2dott .edge-thickness-normal{stroke-width:1px;}#mermaid-87ombf2dott .edge-thickness-thick{stroke-width:3.5px;}#mermaid-87ombf2dott .edge-pattern-solid{stroke-dasharray:0;}#mermaid-87ombf2dott .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-87ombf2dott .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-87ombf2dott .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-87ombf2dott .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-87ombf2dott .marker.cross{stroke:lightgrey;}#mermaid-87ombf2dott svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-87ombf2dott p{margin:0;}#mermaid-87ombf2dott .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-87ombf2dott .cluster-label text{fill:#F9FFFE;}#mermaid-87ombf2dott .cluster-label span{color:#F9FFFE;}#mermaid-87ombf2dott .cluster-label span p{background-color:transparent;}#mermaid-87ombf2dott .label text,#mermaid-87ombf2dott span{fill:#ccc;color:#ccc;}#mermaid-87ombf2dott .node rect,#mermaid-87ombf2dott .node circle,#mermaid-87ombf2dott .node ellipse,#mermaid-87ombf2dott .node polygon,#mermaid-87ombf2dott .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-87ombf2dott .rough-node .label text,#mermaid-87ombf2dott .node .label text,#mermaid-87ombf2dott .image-shape .label,#mermaid-87ombf2dott .icon-shape .label{text-anchor:middle;}#mermaid-87ombf2dott .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-87ombf2dott .rough-node .label,#mermaid-87ombf2dott .node .label,#mermaid-87ombf2dott .image-shape .label,#mermaid-87ombf2dott .icon-shape .label{text-align:center;}#mermaid-87ombf2dott .node.clickable{cursor:pointer;}#mermaid-87ombf2dott .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-87ombf2dott .arrowheadPath{fill:lightgrey;}#mermaid-87ombf2dott .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-87ombf2dott .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-87ombf2dott .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-87ombf2dott .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-87ombf2dott .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-87ombf2dott .cluster text{fill:#F9FFFE;}#mermaid-87ombf2dott .cluster span{color:#F9FFFE;}#mermaid-87ombf2dott div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-87ombf2dott .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-87ombf2dott rect.text{fill:none;stroke-width:0;}#mermaid-87ombf2dott .icon-shape,#mermaid-87ombf2dott .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-87ombf2dott .icon-shape p,#mermaid-87ombf2dott .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-87ombf2dott .icon-shape rect,#mermaid-87ombf2dott .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-87ombf2dott .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-87ombf2dott :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Merge

Verification

Manual Review

Automated Checks

Submission

Open PR with description

Fill PR template: - What changed - Why changed - How tested

GitHub Actions: forge fmt --check

GitHub Actions: forge build

GitHub Actions: forge test

Review code changes: src/*.sol test/*.t.sol

Verify test coverage: new tests added?

Check docs: comments updated?

Reviewer runs: forge test locally

Deploy to testnet: using script/*.s.sol

Test cross-chain flow: Oracle → Sentinel → Hook

Maintainer approval

Squash and merge to main branch

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#122-134](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L122-L134)[contracts/lib/forge-std/CONTRIBUTING.md#135-174](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L135-L174)

---

## Code StandardsLink copied!

### Solidity ConventionsLink copied!

All Solidity code must adhere to the following standards:

StandardRequirementExampleContract namingPascalCase`AegisHook`, `AegisSentinel`Function namingcamelCase`setPanicMode()`, `beforeSwap()`Variable namingcamelCase with underscore prefix for private`_panicMode`, `hookRegistry`Event namingPascalCase`PanicModeChanged`, `PriceUpdate`Error namingPascalCase`PoolPaused`, `UnauthorizedCaller`Constant namingUPPER_SNAKE_CASE`CRASH_THRESHOLD`, `VIP_FEE`

### Documentation RequirementsLink copied!

All public functions must include NatSpec comments:

```
/// @notice Sets the panic mode state for the hook
/// @dev Only callable by the AegisSentinel on Reactive Network
/// @param isPanic True to activate circuit breaker, false to deactivate
function setPanicMode(bool isPanic) external;
```

### File OrganizationLink copied!

Files should follow this structure:

1. SPDX license identifier
2. Pragma statement
3. Import statements (external libraries first, then local imports)
4. Contract declaration
5. State variables
6. Events
7. Errors
8. Modifiers
9. Constructor
10. External functions
11. Public functions
12. Internal functions
13. Private functions

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Testing RequirementsLink copied!

### Test StructureLink copied!

Tests must be organized in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) with the following naming convention:

Test TypeFile PatternExampleUnit tests`{Contract}.t.sol``AegisHook.t.sol`Integration tests`{Feature}Integration.t.sol``CrossChainIntegration.t.sol`Deployment tests`Deploy{Contract}.t.sol``DeployAegisHook.t.sol`

### Test Coverage RequirementsLink copied!

New features require:

1. Unit Tests: Test individual functions in isolation

- Happy path scenarios
- Edge cases (zero values, maximum values)
- Revert conditions
2. Integration Tests: Test cross-contract interactions

- Oracle → Sentinel message flow
- Sentinel → Hook panic mode activation
- Hook → Registry reputation updates
3. Invariant Tests: Test system-wide properties

- Panic mode can only be set by authorized sentinel
- VIP lane only accessible with reputation > 90
- Guardian NFTs are non-transferable during active interventions

### Running Specific Test SuitesLink copied!

```
# Run all tests
forge test
 
# Run specific contract tests
forge test --match-contract AegisHookTest
 
# Run specific test function
forge test --match-test testSetPanicMode
 
# Run with verbose output
forge test -vvv
 
# Run with gas reporting
forge test --gas-report
```

### Test UtilitiesLink copied!

Tests leverage [forge-std](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/forge-std) utilities:

- `vm.prank(address)` - Simulate calls from specific addresses
- `vm.expectRevert(bytes4)` - Assert function reverts with error
- `vm.expectEmit()` - Assert events are emitted correctly
- `vm.warp(uint256)` - Manipulate block timestamp
- `vm.roll(uint256)` - Manipulate block number

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Deployment Script StandardsLink copied!

When modifying deployment scripts in [script/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/) ensure:

1. Idempotency: Scripts should be runnable multiple times without errors
2. Verification: Include contract verification steps
3. Logging: Output deployed addresses to console and broadcast logs
4. Error Handling: Check for deployment failures and provide clear error messages

Deployment scripts follow this naming pattern:

- [script/04_DeployOracle.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/04_DeployOracle.s.sol) - Deploy MockOracle to Sepolia
- [script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol) - Deploy AegisSentinel to Reactive Network
- [script/06_DeployHook.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/06_DeployHook.s.sol) - Deploy AegisHook to Unichain

Each script must:

- Inherit from `forge-std/Script.sol`
- Implement `run()` function as entry point
- Use `vm.broadcast()` to sign transactions
- Store deployment artifacts in [broadcast/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/) directory

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#77-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L77-L101)

---

## Commit GuidelinesLink copied!

### Commit Message FormatLink copied!

Commits should follow this structure:

```
<type>(<scope>): <subject>
 
<body>
 
<footer>
```

Types:

- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation changes
- `test`: Test additions or modifications
- `refactor`: Code refactoring without behavior change
- `chore`: Build process or auxiliary tool changes

Examples:

```
feat(hook): add VIP lane bypass for high-reputation guardians
 
Implements the VIP lane mechanism that allows guardians with
reputation > 90 to bypass panic mode restrictions with reduced
fees (0.01% instead of 0.30%).
 
Refs: #42
```

```
fix(sentinel): correct price threshold comparison logic
 
The sentinel was using >= instead of > when comparing prices
against CRASH_THRESHOLD, causing false positives at exactly
1500 ETH. Updated to use strict greater-than comparison.
 
Fixes: #58
```

### Commit GranularityLink copied!

Commits should be logically grouped:

- Each commit should represent a single logical change
- Avoid "WIP" or "checkpoint" commits in final PR
- Squash fixup commits before requesting review
- Use `git commit --amend` for small corrections

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#116-121](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L116-L121)

---

## Review ProcessLink copied!

### For ContributorsLink copied!

When your PR is under review:

1. Respond Promptly: Address reviewer feedback within 48 hours when possible
2. Explain Decisions: If disagreeing with feedback, provide technical rationale
3. Update Documentation: Keep PR description current as code evolves
4. Test Changes: Re-run test suite after addressing feedback

### For ReviewersLink copied!

When reviewing PRs:

1. Review Incrementally: Focus on high-level concerns before nits
2. Test Locally: Clone branch and run `forge test` to verify claims
3. Check Cross-Chain Behavior: For changes affecting cross-chain flow, test on testnets
4. Distinguish Blocking vs. Non-Blocking: Clearly mark suggestions as "nit" if non-critical

Priority review checklist:

PriorityQuestionHighDoes this improve security of the circuit breaker mechanism?HighDoes this maintain compatibility with Uniswap v4 hook interface?HighDoes this preserve cross-chain message integrity?MediumAre tests comprehensive and passing?MediumIs gas consumption reasonable?LowAre variable names clear?LowAre comments accurate?

### Abandoned PRsLink copied!

If a PR has no activity for 30 days:

1. Maintainer will comment asking for status
2. After 14 additional days, PR may be closed with "stale" label
3. Contributor can reopen by commenting when ready to resume

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#135-176](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L135-L176)

---

## Cross-Chain Testing ProtocolLink copied!

Changes affecting cross-chain interactions require specific testing:

### Local TestingLink copied!

```
# Test individual components
forge test --match-contract MockOracleTest
forge test --match-contract AegisSentinelTest
forge test --match-contract AegisHookTest
```

### Testnet DeploymentLink copied!

Follow deployment sequence in order:

1. Deploy Oracle (Sepolia L1)

```
forge script script/04_DeployOracle.s.sol --rpc-url sepolia --broadcast
```
2. Deploy Sentinel (Reactive Network)

```
forge script script/05_DeploySentinel.s.sol --rpc-url reactive --broadcast
```
3. Deploy Hook (Unichain L2)

```
forge script script/06_DeployHook.s.sol --rpc-url unichain --broadcast
```

### End-to-End VerificationLink copied!

After deployment, verify the complete flow:

1. Call `updatePrice()` on MockOracle with crash price (< 1500 ETH)
2. Monitor Sentinel logs for `react()` function execution
3. Verify Hook receives `setPanicMode(true)` call
4. Test swap on Uniswap v4 pool - should revert with `PoolPaused` error
5. Call `updatePrice()` with recovery price (> 1500 ETH)
6. Verify Hook receives `setPanicMode(false)` call
7. Test swap again - should succeed

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Communication ChannelsLink copied!

### Issue TrackerLink copied!

Use GitHub Issues for:

- Bug reports
- Feature requests
- Technical discussions
- Deployment questions

### Pull Request DiscussionsLink copied!

Use PR comment threads for:

- Code review feedback
- Implementation alternatives
- Test coverage discussions

### Commit MessagesLink copied!

Use Git commit messages for:

- Explaining "why" behind changes
- Linking to related issues
- Documenting breaking changes

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#39-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L39-L47)

---

## Dependency ManagementLink copied!

Aegis uses git submodules for dependency management. When adding or updating dependencies:

### Adding a New DependencyLink copied!

```
forge install <org>/<repo>
```

This updates [.gitmodules](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.gitmodules) and [contracts/lib/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/) directory.

### Updating Existing DependenciesLink copied!

```
forge update <dependency-name>
```

Update specific dependencies:

- `forge-std` - Testing and scripting utilities
- `uniswap-hooks` - Uniswap v4 hook interfaces
- `system-smart-contracts` - Reactive Network base contracts

### Dependency ConsiderationsLink copied!

When proposing dependency changes:

1. Justify the need for the new dependency
2. Verify license compatibility
3. Check for security audits
4. Assess maintenance status of upstream repository
5. Consider impact on compilation time and contract size

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L101)

---

## Release ProcessLink copied!

Releases are tagged when significant milestones are reached:

Release TypeVersion BumpExampleMajorBreaking changes to contract interfaces1.0.0 → 2.0.0MinorNew features without breaking changes1.0.0 → 1.1.0PatchBug fixes and optimizations1.0.0 → 1.0.1

### Pre-Release ChecklistLink copied!

Before tagging a release:

1. Update deployment addresses in [README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md)
2. Run full test suite: `forge test`
3. Verify testnet deployments are functional
4. Update documentation for new features
5. Review broadcast logs in [broadcast/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/) for accuracy

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#180-187](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L180-L187)

---

## Special ConsiderationsLink copied!

### Uniswap v4 Hook CompatibilityLink copied!

Changes to [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol) must maintain compatibility with:

- `IHooks` interface from `v4-core/src/interfaces/IHooks.sol`
- Hook flag requirements (beforeSwap enabled)
- PoolManager callback expectations

Verify hook compatibility by checking:

```
forge test --match-contract AegisHookTest
```

### Reactive Network ConstraintsLink copied!

Changes to [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) must:

- Inherit from `AbstractReactive` contract
- Implement `react()` function for event handling
- Use correct cross-chain RPC methods from `IReactive`
- Handle event subscription properly in constructor

### Guardian Registry StandardsLink copied!

Changes to [src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol) must:

- Maintain ERC-721 compliance
- Preserve ERC-8004 reputation interface
- Ensure non-transferability during active interventions
- Update reputation atomically to prevent race conditions

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#102-114](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L102-L114)

---

## Getting HelpLink copied!

If you encounter issues during contribution:

1. Search existing issues: Your question may already be answered
2. Review documentation: Check [Getting Started](#1.1) and [Development Guide](#4)
3. Open a discussion: Use GitHub Discussions for general questions
4. Open an issue: For bugs or feature requests, create a detailed issue

When asking for help, include:

- Steps you've already tried
- Full error messages or logs
- Output of `forge --version`
- Network(s) affected (if applicable)
- Relevant contract addresses (if deployed)

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#39-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L39-L47)

---

# Contributing-2

# ContributingLink copied!
Relevant source files
- [contracts/lib/forge-std/CONTRIBUTING.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md)

This document provides guidelines for contributing to the Aegis cross-chain circuit breaker system. It covers the development workflow, pull request process, code standards, and testing requirements for the project.

For information about initial environment setup, see [Environment Setup](#4.1). For details on building and testing the codebase, see [Building and Testing](#4.2). For code formatting and development conventions, see [Code Standards](#4.4).

---

## Purpose and ScopeLink copied!

The Aegis project welcomes contributions from developers interested in improving cross-chain DeFi security infrastructure. This guide outlines the processes for submitting bug reports, feature requests, and code changes. It applies to contributions to the smart contracts in [src/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/) deployment scripts in [script/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/) test suites in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) and supporting infrastructure in [relayer/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/relayer/)

---

## Code of ConductLink copied!

Contributors to the Aegis project are expected to adhere to professional standards of conduct when interacting with the community. All interactions should be respectful and constructive, focused on improving the codebase and advancing the project's technical goals.

Violations can be reported to the project maintainers through GitHub issue tracker or direct communication.

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#12-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L12-L16)

---

## Ways to ContributeLink copied!

There are four primary ways to contribute to Aegis:

### 1. Opening IssuesLink copied!

Submit bug reports or feature requests through the GitHub issue tracker. Include:

- Aegis version and commit hash
- Network(s) affected (Sepolia, Reactive Network, Unichain)
- Contract addresses if applicable
- Concrete steps to reproduce the issue
- Expected vs. actual behavior

### 2. Adding ContextLink copied!

Enhance existing issues by providing:

- Transaction hashes demonstrating the problem
- Logs from `forge test` or deployment scripts
- Screenshots of cross-chain behavior
- Analysis of gas consumption or latency

### 3. Resolving IssuesLink copied!

Submit pull requests that:

- Fix bugs in contracts ([src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol)[src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol)[src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol)[src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol))
- Improve deployment scripts ([script/04_DeployOracle.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/04_DeployOracle.s.sol)[script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol)[script/06_DeployHook.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/06_DeployHook.s.sol))
- Enhance test coverage in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/)
- Update documentation

### 4. Code ReviewLink copied!

Review pull requests by:

- Testing changes locally using `forge test`
- Verifying cross-chain behavior on testnets
- Checking for gas optimizations
- Ensuring compatibility with Uniswap v4 hook interface

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#18-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L18-L32)

---

## Development WorkflowLink copied!

The following diagram illustrates the complete contribution workflow from fork to merge, referencing specific files and commands used in the process.

### Contribution Workflow DiagramLink copied!

#mermaid-pdit5v2rjt{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-pdit5v2rjt .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-pdit5v2rjt .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-pdit5v2rjt .error-icon{fill:#a44141;}#mermaid-pdit5v2rjt .error-text{fill:#ddd;stroke:#ddd;}#mermaid-pdit5v2rjt .edge-thickness-normal{stroke-width:1px;}#mermaid-pdit5v2rjt .edge-thickness-thick{stroke-width:3.5px;}#mermaid-pdit5v2rjt .edge-pattern-solid{stroke-dasharray:0;}#mermaid-pdit5v2rjt .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-pdit5v2rjt .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-pdit5v2rjt .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-pdit5v2rjt .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-pdit5v2rjt .marker.cross{stroke:lightgrey;}#mermaid-pdit5v2rjt svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-pdit5v2rjt p{margin:0;}#mermaid-pdit5v2rjt .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-pdit5v2rjt .cluster-label text{fill:#F9FFFE;}#mermaid-pdit5v2rjt .cluster-label span{color:#F9FFFE;}#mermaid-pdit5v2rjt .cluster-label span p{background-color:transparent;}#mermaid-pdit5v2rjt .label text,#mermaid-pdit5v2rjt span{fill:#ccc;color:#ccc;}#mermaid-pdit5v2rjt .node rect,#mermaid-pdit5v2rjt .node circle,#mermaid-pdit5v2rjt .node ellipse,#mermaid-pdit5v2rjt .node polygon,#mermaid-pdit5v2rjt .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-pdit5v2rjt .rough-node .label text,#mermaid-pdit5v2rjt .node .label text,#mermaid-pdit5v2rjt .image-shape .label,#mermaid-pdit5v2rjt .icon-shape .label{text-anchor:middle;}#mermaid-pdit5v2rjt .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-pdit5v2rjt .rough-node .label,#mermaid-pdit5v2rjt .node .label,#mermaid-pdit5v2rjt .image-shape .label,#mermaid-pdit5v2rjt .icon-shape .label{text-align:center;}#mermaid-pdit5v2rjt .node.clickable{cursor:pointer;}#mermaid-pdit5v2rjt .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-pdit5v2rjt .arrowheadPath{fill:lightgrey;}#mermaid-pdit5v2rjt .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-pdit5v2rjt .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-pdit5v2rjt .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-pdit5v2rjt .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-pdit5v2rjt .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-pdit5v2rjt .cluster text{fill:#F9FFFE;}#mermaid-pdit5v2rjt .cluster span{color:#F9FFFE;}#mermaid-pdit5v2rjt div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-pdit5v2rjt .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-pdit5v2rjt rect.text{fill:none;stroke-width:0;}#mermaid-pdit5v2rjt .icon-shape,#mermaid-pdit5v2rjt .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-pdit5v2rjt .icon-shape p,#mermaid-pdit5v2rjt .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-pdit5v2rjt .icon-shape rect,#mermaid-pdit5v2rjt .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-pdit5v2rjt .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-pdit5v2rjt :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Changes requested

Approved

Fail

Pass

Fork github.com/HACK3R-CRYPTO/Aegis

git clone <your-fork>

forge install Install dependencies

git checkout -b feature/your-change

Modify source files: src/*.sol script/*.s.sol test/*.t.sol

forge fmt Format code

forge build Compile contracts

forge test -vvv Run test suite

git commit -m 'description'

git push origin feature/your-change

Open Pull Request on GitHub

Code Review Process

Address feedback: git commit --amend or new commits

CI Checks Pass?

Merged by maintainer

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#77-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L77-L101)[contracts/lib/forge-std/CONTRIBUTING.md#116-134](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L116-L134)

---

## Pre-Submission ChecklistLink copied!

Before submitting a pull request, ensure the following commands pass:

### Code FormattingLink copied!

```
forge fmt --check
```

All Solidity files must conform to the project's formatting standards as defined in [foundry.toml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml) The formatter enforces consistent line length, indentation, and spacing.

### CompilationLink copied!

```
forge build
```

All contracts must compile without errors. The build process includes:

- [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol) - Uniswap v4 hook implementation
- [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) - Reactive Network contract
- [src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol) - L1 price oracle
- [src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol) - ERC-721/ERC-8004 registry

### Test ExecutionLink copied!

```
forge test -vvv
```

All existing tests in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) must pass. Tests verify:

- Hook panic mode activation/deactivation
- Cross-chain message handling
- Guardian reputation mechanics
- VIP lane fee calculations

### Solidity Version CompatibilityLink copied!

If modifying core contracts, verify compatibility across Solidity versions:

```
forge build --skip test --use solc:0.8.0
forge build --skip test --use solc:0.8.20
```

The project primarily targets Solidity 0.8.24 but should maintain backward compatibility where possible.

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-100](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L100)

---

## Pull Request ProcessLink copied!

The pull request lifecycle involves several stages from opening to merge. The following diagram shows the detailed review and merge process with specific file artifacts.

### Pull Request Review PipelineLink copied!

#mermaid-87ombf2dott{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-87ombf2dott .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-87ombf2dott .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-87ombf2dott .error-icon{fill:#a44141;}#mermaid-87ombf2dott .error-text{fill:#ddd;stroke:#ddd;}#mermaid-87ombf2dott .edge-thickness-normal{stroke-width:1px;}#mermaid-87ombf2dott .edge-thickness-thick{stroke-width:3.5px;}#mermaid-87ombf2dott .edge-pattern-solid{stroke-dasharray:0;}#mermaid-87ombf2dott .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-87ombf2dott .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-87ombf2dott .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-87ombf2dott .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-87ombf2dott .marker.cross{stroke:lightgrey;}#mermaid-87ombf2dott svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-87ombf2dott p{margin:0;}#mermaid-87ombf2dott .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-87ombf2dott .cluster-label text{fill:#F9FFFE;}#mermaid-87ombf2dott .cluster-label span{color:#F9FFFE;}#mermaid-87ombf2dott .cluster-label span p{background-color:transparent;}#mermaid-87ombf2dott .label text,#mermaid-87ombf2dott span{fill:#ccc;color:#ccc;}#mermaid-87ombf2dott .node rect,#mermaid-87ombf2dott .node circle,#mermaid-87ombf2dott .node ellipse,#mermaid-87ombf2dott .node polygon,#mermaid-87ombf2dott .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-87ombf2dott .rough-node .label text,#mermaid-87ombf2dott .node .label text,#mermaid-87ombf2dott .image-shape .label,#mermaid-87ombf2dott .icon-shape .label{text-anchor:middle;}#mermaid-87ombf2dott .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-87ombf2dott .rough-node .label,#mermaid-87ombf2dott .node .label,#mermaid-87ombf2dott .image-shape .label,#mermaid-87ombf2dott .icon-shape .label{text-align:center;}#mermaid-87ombf2dott .node.clickable{cursor:pointer;}#mermaid-87ombf2dott .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-87ombf2dott .arrowheadPath{fill:lightgrey;}#mermaid-87ombf2dott .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-87ombf2dott .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-87ombf2dott .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-87ombf2dott .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-87ombf2dott .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-87ombf2dott .cluster text{fill:#F9FFFE;}#mermaid-87ombf2dott .cluster span{color:#F9FFFE;}#mermaid-87ombf2dott div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-87ombf2dott .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-87ombf2dott rect.text{fill:none;stroke-width:0;}#mermaid-87ombf2dott .icon-shape,#mermaid-87ombf2dott .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-87ombf2dott .icon-shape p,#mermaid-87ombf2dott .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-87ombf2dott .icon-shape rect,#mermaid-87ombf2dott .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-87ombf2dott .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-87ombf2dott :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Merge

Verification

Manual Review

Automated Checks

Submission

Open PR with description

Fill PR template: - What changed - Why changed - How tested

GitHub Actions: forge fmt --check

GitHub Actions: forge build

GitHub Actions: forge test

Review code changes: src/*.sol test/*.t.sol

Verify test coverage: new tests added?

Check docs: comments updated?

Reviewer runs: forge test locally

Deploy to testnet: using script/*.s.sol

Test cross-chain flow: Oracle → Sentinel → Hook

Maintainer approval

Squash and merge to main branch

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#122-134](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L122-L134)[contracts/lib/forge-std/CONTRIBUTING.md#135-174](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L135-L174)

---

## Code StandardsLink copied!

### Solidity ConventionsLink copied!

All Solidity code must adhere to the following standards:

StandardRequirementExampleContract namingPascalCase`AegisHook`, `AegisSentinel`Function namingcamelCase`setPanicMode()`, `beforeSwap()`Variable namingcamelCase with underscore prefix for private`_panicMode`, `hookRegistry`Event namingPascalCase`PanicModeChanged`, `PriceUpdate`Error namingPascalCase`PoolPaused`, `UnauthorizedCaller`Constant namingUPPER_SNAKE_CASE`CRASH_THRESHOLD`, `VIP_FEE`

### Documentation RequirementsLink copied!

All public functions must include NatSpec comments:

```
/// @notice Sets the panic mode state for the hook
/// @dev Only callable by the AegisSentinel on Reactive Network
/// @param isPanic True to activate circuit breaker, false to deactivate
function setPanicMode(bool isPanic) external;
```

### File OrganizationLink copied!

Files should follow this structure:

1. SPDX license identifier
2. Pragma statement
3. Import statements (external libraries first, then local imports)
4. Contract declaration
5. State variables
6. Events
7. Errors
8. Modifiers
9. Constructor
10. External functions
11. Public functions
12. Internal functions
13. Private functions

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Testing RequirementsLink copied!

### Test StructureLink copied!

Tests must be organized in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) with the following naming convention:

Test TypeFile PatternExampleUnit tests`{Contract}.t.sol``AegisHook.t.sol`Integration tests`{Feature}Integration.t.sol``CrossChainIntegration.t.sol`Deployment tests`Deploy{Contract}.t.sol``DeployAegisHook.t.sol`

### Test Coverage RequirementsLink copied!

New features require:

1. Unit Tests: Test individual functions in isolation

- Happy path scenarios
- Edge cases (zero values, maximum values)
- Revert conditions
2. Integration Tests: Test cross-contract interactions

- Oracle → Sentinel message flow
- Sentinel → Hook panic mode activation
- Hook → Registry reputation updates
3. Invariant Tests: Test system-wide properties

- Panic mode can only be set by authorized sentinel
- VIP lane only accessible with reputation > 90
- Guardian NFTs are non-transferable during active interventions

### Running Specific Test SuitesLink copied!

```
# Run all tests
forge test
 
# Run specific contract tests
forge test --match-contract AegisHookTest
 
# Run specific test function
forge test --match-test testSetPanicMode
 
# Run with verbose output
forge test -vvv
 
# Run with gas reporting
forge test --gas-report
```

### Test UtilitiesLink copied!

Tests leverage [forge-std](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/forge-std) utilities:

- `vm.prank(address)` - Simulate calls from specific addresses
- `vm.expectRevert(bytes4)` - Assert function reverts with error
- `vm.expectEmit()` - Assert events are emitted correctly
- `vm.warp(uint256)` - Manipulate block timestamp
- `vm.roll(uint256)` - Manipulate block number

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Deployment Script StandardsLink copied!

When modifying deployment scripts in [script/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/) ensure:

1. Idempotency: Scripts should be runnable multiple times without errors
2. Verification: Include contract verification steps
3. Logging: Output deployed addresses to console and broadcast logs
4. Error Handling: Check for deployment failures and provide clear error messages

Deployment scripts follow this naming pattern:

- [script/04_DeployOracle.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/04_DeployOracle.s.sol) - Deploy MockOracle to Sepolia
- [script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol) - Deploy AegisSentinel to Reactive Network
- [script/06_DeployHook.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/06_DeployHook.s.sol) - Deploy AegisHook to Unichain

Each script must:

- Inherit from `forge-std/Script.sol`
- Implement `run()` function as entry point
- Use `vm.broadcast()` to sign transactions
- Store deployment artifacts in [broadcast/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/) directory

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#77-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L77-L101)

---

## Commit GuidelinesLink copied!

### Commit Message FormatLink copied!

Commits should follow this structure:

```
<type>(<scope>): <subject>
 
<body>
 
<footer>
```

Types:

- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation changes
- `test`: Test additions or modifications
- `refactor`: Code refactoring without behavior change
- `chore`: Build process or auxiliary tool changes

Examples:

```
feat(hook): add VIP lane bypass for high-reputation guardians
 
Implements the VIP lane mechanism that allows guardians with
reputation > 90 to bypass panic mode restrictions with reduced
fees (0.01% instead of 0.30%).
 
Refs: #42
```

```
fix(sentinel): correct price threshold comparison logic
 
The sentinel was using >= instead of > when comparing prices
against CRASH_THRESHOLD, causing false positives at exactly
1500 ETH. Updated to use strict greater-than comparison.
 
Fixes: #58
```

### Commit GranularityLink copied!

Commits should be logically grouped:

- Each commit should represent a single logical change
- Avoid "WIP" or "checkpoint" commits in final PR
- Squash fixup commits before requesting review
- Use `git commit --amend` for small corrections

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#116-121](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L116-L121)

---

## Review ProcessLink copied!

### For ContributorsLink copied!

When your PR is under review:

1. Respond Promptly: Address reviewer feedback within 48 hours when possible
2. Explain Decisions: If disagreeing with feedback, provide technical rationale
3. Update Documentation: Keep PR description current as code evolves
4. Test Changes: Re-run test suite after addressing feedback

### For ReviewersLink copied!

When reviewing PRs:

1. Review Incrementally: Focus on high-level concerns before nits
2. Test Locally: Clone branch and run `forge test` to verify claims
3. Check Cross-Chain Behavior: For changes affecting cross-chain flow, test on testnets
4. Distinguish Blocking vs. Non-Blocking: Clearly mark suggestions as "nit" if non-critical

Priority review checklist:

PriorityQuestionHighDoes this improve security of the circuit breaker mechanism?HighDoes this maintain compatibility with Uniswap v4 hook interface?HighDoes this preserve cross-chain message integrity?MediumAre tests comprehensive and passing?MediumIs gas consumption reasonable?LowAre variable names clear?LowAre comments accurate?

### Abandoned PRsLink copied!

If a PR has no activity for 30 days:

1. Maintainer will comment asking for status
2. After 14 additional days, PR may be closed with "stale" label
3. Contributor can reopen by commenting when ready to resume

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#135-176](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L135-L176)

---

## Cross-Chain Testing ProtocolLink copied!

Changes affecting cross-chain interactions require specific testing:

### Local TestingLink copied!

```
# Test individual components
forge test --match-contract MockOracleTest
forge test --match-contract AegisSentinelTest
forge test --match-contract AegisHookTest
```

### Testnet DeploymentLink copied!

Follow deployment sequence in order:

1. Deploy Oracle (Sepolia L1)

```
forge script script/04_DeployOracle.s.sol --rpc-url sepolia --broadcast
```
2. Deploy Sentinel (Reactive Network)

```
forge script script/05_DeploySentinel.s.sol --rpc-url reactive --broadcast
```
3. Deploy Hook (Unichain L2)

```
forge script script/06_DeployHook.s.sol --rpc-url unichain --broadcast
```

### End-to-End VerificationLink copied!

After deployment, verify the complete flow:

1. Call `updatePrice()` on MockOracle with crash price (< 1500 ETH)
2. Monitor Sentinel logs for `react()` function execution
3. Verify Hook receives `setPanicMode(true)` call
4. Test swap on Uniswap v4 pool - should revert with `PoolPaused` error
5. Call `updatePrice()` with recovery price (> 1500 ETH)
6. Verify Hook receives `setPanicMode(false)` call
7. Test swap again - should succeed

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Communication ChannelsLink copied!

### Issue TrackerLink copied!

Use GitHub Issues for:

- Bug reports
- Feature requests
- Technical discussions
- Deployment questions

### Pull Request DiscussionsLink copied!

Use PR comment threads for:

- Code review feedback
- Implementation alternatives
- Test coverage discussions

### Commit MessagesLink copied!

Use Git commit messages for:

- Explaining "why" behind changes
- Linking to related issues
- Documenting breaking changes

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#39-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L39-L47)

---

## Dependency ManagementLink copied!

Aegis uses git submodules for dependency management. When adding or updating dependencies:

### Adding a New DependencyLink copied!

```
forge install <org>/<repo>
```

This updates [.gitmodules](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.gitmodules) and [contracts/lib/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/) directory.

### Updating Existing DependenciesLink copied!

```
forge update <dependency-name>
```

Update specific dependencies:

- `forge-std` - Testing and scripting utilities
- `uniswap-hooks` - Uniswap v4 hook interfaces
- `system-smart-contracts` - Reactive Network base contracts

### Dependency ConsiderationsLink copied!

When proposing dependency changes:

1. Justify the need for the new dependency
2. Verify license compatibility
3. Check for security audits
4. Assess maintenance status of upstream repository
5. Consider impact on compilation time and contract size

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L101)

---

## Release ProcessLink copied!

Releases are tagged when significant milestones are reached:

Release TypeVersion BumpExampleMajorBreaking changes to contract interfaces1.0.0 → 2.0.0MinorNew features without breaking changes1.0.0 → 1.1.0PatchBug fixes and optimizations1.0.0 → 1.0.1

### Pre-Release ChecklistLink copied!

Before tagging a release:

1. Update deployment addresses in [README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md)
2. Run full test suite: `forge test`
3. Verify testnet deployments are functional
4. Update documentation for new features
5. Review broadcast logs in [broadcast/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/) for accuracy

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#180-187](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L180-L187)

---

## Special ConsiderationsLink copied!

### Uniswap v4 Hook CompatibilityLink copied!

Changes to [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol) must maintain compatibility with:

- `IHooks` interface from `v4-core/src/interfaces/IHooks.sol`
- Hook flag requirements (beforeSwap enabled)
- PoolManager callback expectations

Verify hook compatibility by checking:

```
forge test --match-contract AegisHookTest
```

### Reactive Network ConstraintsLink copied!

Changes to [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) must:

- Inherit from `AbstractReactive` contract
- Implement `react()` function for event handling
- Use correct cross-chain RPC methods from `IReactive`
- Handle event subscription properly in constructor

### Guardian Registry StandardsLink copied!

Changes to [src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol) must:

- Maintain ERC-721 compliance
- Preserve ERC-8004 reputation interface
- Ensure non-transferability during active interventions
- Update reputation atomically to prevent race conditions

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#102-114](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L102-L114)

---

## Getting HelpLink copied!

If you encounter issues during contribution:

1. Search existing issues: Your question may already be answered
2. Review documentation: Check [Getting Started](#1.1) and [Development Guide](#4)
3. Open a discussion: Use GitHub Discussions for general questions
4. Open an issue: For bugs or feature requests, create a detailed issue

When asking for help, include:

- Steps you've already tried
- Full error messages or logs
- Output of `forge --version`
- Network(s) affected (if applicable)
- Relevant contract addresses (if deployed)

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#39-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L39-L47)

---

# Contributing-3

# ContributingLink copied!
Relevant source files
- [contracts/lib/forge-std/CONTRIBUTING.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md)

This document provides guidelines for contributing to the Aegis cross-chain circuit breaker system. It covers the development workflow, pull request process, code standards, and testing requirements for the project.

For information about initial environment setup, see [Environment Setup](#4.1). For details on building and testing the codebase, see [Building and Testing](#4.2). For code formatting and development conventions, see [Code Standards](#4.4).

---

## Purpose and ScopeLink copied!

The Aegis project welcomes contributions from developers interested in improving cross-chain DeFi security infrastructure. This guide outlines the processes for submitting bug reports, feature requests, and code changes. It applies to contributions to the smart contracts in [src/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/) deployment scripts in [script/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/) test suites in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) and supporting infrastructure in [relayer/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/relayer/)

---

## Code of ConductLink copied!

Contributors to the Aegis project are expected to adhere to professional standards of conduct when interacting with the community. All interactions should be respectful and constructive, focused on improving the codebase and advancing the project's technical goals.

Violations can be reported to the project maintainers through GitHub issue tracker or direct communication.

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#12-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L12-L16)

---

## Ways to ContributeLink copied!

There are four primary ways to contribute to Aegis:

### 1. Opening IssuesLink copied!

Submit bug reports or feature requests through the GitHub issue tracker. Include:

- Aegis version and commit hash
- Network(s) affected (Sepolia, Reactive Network, Unichain)
- Contract addresses if applicable
- Concrete steps to reproduce the issue
- Expected vs. actual behavior

### 2. Adding ContextLink copied!

Enhance existing issues by providing:

- Transaction hashes demonstrating the problem
- Logs from `forge test` or deployment scripts
- Screenshots of cross-chain behavior
- Analysis of gas consumption or latency

### 3. Resolving IssuesLink copied!

Submit pull requests that:

- Fix bugs in contracts ([src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol)[src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol)[src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol)[src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol))
- Improve deployment scripts ([script/04_DeployOracle.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/04_DeployOracle.s.sol)[script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol)[script/06_DeployHook.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/06_DeployHook.s.sol))
- Enhance test coverage in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/)
- Update documentation

### 4. Code ReviewLink copied!

Review pull requests by:

- Testing changes locally using `forge test`
- Verifying cross-chain behavior on testnets
- Checking for gas optimizations
- Ensuring compatibility with Uniswap v4 hook interface

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#18-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L18-L32)

---

## Development WorkflowLink copied!

The following diagram illustrates the complete contribution workflow from fork to merge, referencing specific files and commands used in the process.

### Contribution Workflow DiagramLink copied!

#mermaid-pdit5v2rjt{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-pdit5v2rjt .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-pdit5v2rjt .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-pdit5v2rjt .error-icon{fill:#a44141;}#mermaid-pdit5v2rjt .error-text{fill:#ddd;stroke:#ddd;}#mermaid-pdit5v2rjt .edge-thickness-normal{stroke-width:1px;}#mermaid-pdit5v2rjt .edge-thickness-thick{stroke-width:3.5px;}#mermaid-pdit5v2rjt .edge-pattern-solid{stroke-dasharray:0;}#mermaid-pdit5v2rjt .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-pdit5v2rjt .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-pdit5v2rjt .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-pdit5v2rjt .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-pdit5v2rjt .marker.cross{stroke:lightgrey;}#mermaid-pdit5v2rjt svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-pdit5v2rjt p{margin:0;}#mermaid-pdit5v2rjt .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-pdit5v2rjt .cluster-label text{fill:#F9FFFE;}#mermaid-pdit5v2rjt .cluster-label span{color:#F9FFFE;}#mermaid-pdit5v2rjt .cluster-label span p{background-color:transparent;}#mermaid-pdit5v2rjt .label text,#mermaid-pdit5v2rjt span{fill:#ccc;color:#ccc;}#mermaid-pdit5v2rjt .node rect,#mermaid-pdit5v2rjt .node circle,#mermaid-pdit5v2rjt .node ellipse,#mermaid-pdit5v2rjt .node polygon,#mermaid-pdit5v2rjt .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-pdit5v2rjt .rough-node .label text,#mermaid-pdit5v2rjt .node .label text,#mermaid-pdit5v2rjt .image-shape .label,#mermaid-pdit5v2rjt .icon-shape .label{text-anchor:middle;}#mermaid-pdit5v2rjt .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-pdit5v2rjt .rough-node .label,#mermaid-pdit5v2rjt .node .label,#mermaid-pdit5v2rjt .image-shape .label,#mermaid-pdit5v2rjt .icon-shape .label{text-align:center;}#mermaid-pdit5v2rjt .node.clickable{cursor:pointer;}#mermaid-pdit5v2rjt .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-pdit5v2rjt .arrowheadPath{fill:lightgrey;}#mermaid-pdit5v2rjt .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-pdit5v2rjt .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-pdit5v2rjt .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-pdit5v2rjt .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-pdit5v2rjt .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-pdit5v2rjt .cluster text{fill:#F9FFFE;}#mermaid-pdit5v2rjt .cluster span{color:#F9FFFE;}#mermaid-pdit5v2rjt div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-pdit5v2rjt .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-pdit5v2rjt rect.text{fill:none;stroke-width:0;}#mermaid-pdit5v2rjt .icon-shape,#mermaid-pdit5v2rjt .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-pdit5v2rjt .icon-shape p,#mermaid-pdit5v2rjt .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-pdit5v2rjt .icon-shape rect,#mermaid-pdit5v2rjt .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-pdit5v2rjt .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-pdit5v2rjt :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Changes requested

Approved

Fail

Pass

Fork github.com/HACK3R-CRYPTO/Aegis

git clone <your-fork>

forge install Install dependencies

git checkout -b feature/your-change

Modify source files: src/*.sol script/*.s.sol test/*.t.sol

forge fmt Format code

forge build Compile contracts

forge test -vvv Run test suite

git commit -m 'description'

git push origin feature/your-change

Open Pull Request on GitHub

Code Review Process

Address feedback: git commit --amend or new commits

CI Checks Pass?

Merged by maintainer

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#77-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L77-L101)[contracts/lib/forge-std/CONTRIBUTING.md#116-134](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L116-L134)

---

## Pre-Submission ChecklistLink copied!

Before submitting a pull request, ensure the following commands pass:

### Code FormattingLink copied!

```
forge fmt --check
```

All Solidity files must conform to the project's formatting standards as defined in [foundry.toml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml) The formatter enforces consistent line length, indentation, and spacing.

### CompilationLink copied!

```
forge build
```

All contracts must compile without errors. The build process includes:

- [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol) - Uniswap v4 hook implementation
- [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) - Reactive Network contract
- [src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol) - L1 price oracle
- [src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol) - ERC-721/ERC-8004 registry

### Test ExecutionLink copied!

```
forge test -vvv
```

All existing tests in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) must pass. Tests verify:

- Hook panic mode activation/deactivation
- Cross-chain message handling
- Guardian reputation mechanics
- VIP lane fee calculations

### Solidity Version CompatibilityLink copied!

If modifying core contracts, verify compatibility across Solidity versions:

```
forge build --skip test --use solc:0.8.0
forge build --skip test --use solc:0.8.20
```

The project primarily targets Solidity 0.8.24 but should maintain backward compatibility where possible.

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-100](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L100)

---

## Pull Request ProcessLink copied!

The pull request lifecycle involves several stages from opening to merge. The following diagram shows the detailed review and merge process with specific file artifacts.

### Pull Request Review PipelineLink copied!

#mermaid-87ombf2dott{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-87ombf2dott .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-87ombf2dott .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-87ombf2dott .error-icon{fill:#a44141;}#mermaid-87ombf2dott .error-text{fill:#ddd;stroke:#ddd;}#mermaid-87ombf2dott .edge-thickness-normal{stroke-width:1px;}#mermaid-87ombf2dott .edge-thickness-thick{stroke-width:3.5px;}#mermaid-87ombf2dott .edge-pattern-solid{stroke-dasharray:0;}#mermaid-87ombf2dott .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-87ombf2dott .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-87ombf2dott .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-87ombf2dott .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-87ombf2dott .marker.cross{stroke:lightgrey;}#mermaid-87ombf2dott svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-87ombf2dott p{margin:0;}#mermaid-87ombf2dott .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-87ombf2dott .cluster-label text{fill:#F9FFFE;}#mermaid-87ombf2dott .cluster-label span{color:#F9FFFE;}#mermaid-87ombf2dott .cluster-label span p{background-color:transparent;}#mermaid-87ombf2dott .label text,#mermaid-87ombf2dott span{fill:#ccc;color:#ccc;}#mermaid-87ombf2dott .node rect,#mermaid-87ombf2dott .node circle,#mermaid-87ombf2dott .node ellipse,#mermaid-87ombf2dott .node polygon,#mermaid-87ombf2dott .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-87ombf2dott .rough-node .label text,#mermaid-87ombf2dott .node .label text,#mermaid-87ombf2dott .image-shape .label,#mermaid-87ombf2dott .icon-shape .label{text-anchor:middle;}#mermaid-87ombf2dott .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-87ombf2dott .rough-node .label,#mermaid-87ombf2dott .node .label,#mermaid-87ombf2dott .image-shape .label,#mermaid-87ombf2dott .icon-shape .label{text-align:center;}#mermaid-87ombf2dott .node.clickable{cursor:pointer;}#mermaid-87ombf2dott .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-87ombf2dott .arrowheadPath{fill:lightgrey;}#mermaid-87ombf2dott .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-87ombf2dott .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-87ombf2dott .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-87ombf2dott .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-87ombf2dott .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-87ombf2dott .cluster text{fill:#F9FFFE;}#mermaid-87ombf2dott .cluster span{color:#F9FFFE;}#mermaid-87ombf2dott div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-87ombf2dott .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-87ombf2dott rect.text{fill:none;stroke-width:0;}#mermaid-87ombf2dott .icon-shape,#mermaid-87ombf2dott .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-87ombf2dott .icon-shape p,#mermaid-87ombf2dott .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-87ombf2dott .icon-shape rect,#mermaid-87ombf2dott .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-87ombf2dott .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-87ombf2dott :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Merge

Verification

Manual Review

Automated Checks

Submission

Open PR with description

Fill PR template: - What changed - Why changed - How tested

GitHub Actions: forge fmt --check

GitHub Actions: forge build

GitHub Actions: forge test

Review code changes: src/*.sol test/*.t.sol

Verify test coverage: new tests added?

Check docs: comments updated?

Reviewer runs: forge test locally

Deploy to testnet: using script/*.s.sol

Test cross-chain flow: Oracle → Sentinel → Hook

Maintainer approval

Squash and merge to main branch

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#122-134](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L122-L134)[contracts/lib/forge-std/CONTRIBUTING.md#135-174](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L135-L174)

---

## Code StandardsLink copied!

### Solidity ConventionsLink copied!

All Solidity code must adhere to the following standards:

StandardRequirementExampleContract namingPascalCase`AegisHook`, `AegisSentinel`Function namingcamelCase`setPanicMode()`, `beforeSwap()`Variable namingcamelCase with underscore prefix for private`_panicMode`, `hookRegistry`Event namingPascalCase`PanicModeChanged`, `PriceUpdate`Error namingPascalCase`PoolPaused`, `UnauthorizedCaller`Constant namingUPPER_SNAKE_CASE`CRASH_THRESHOLD`, `VIP_FEE`

### Documentation RequirementsLink copied!

All public functions must include NatSpec comments:

```
/// @notice Sets the panic mode state for the hook
/// @dev Only callable by the AegisSentinel on Reactive Network
/// @param isPanic True to activate circuit breaker, false to deactivate
function setPanicMode(bool isPanic) external;
```

### File OrganizationLink copied!

Files should follow this structure:

1. SPDX license identifier
2. Pragma statement
3. Import statements (external libraries first, then local imports)
4. Contract declaration
5. State variables
6. Events
7. Errors
8. Modifiers
9. Constructor
10. External functions
11. Public functions
12. Internal functions
13. Private functions

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Testing RequirementsLink copied!

### Test StructureLink copied!

Tests must be organized in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) with the following naming convention:

Test TypeFile PatternExampleUnit tests`{Contract}.t.sol``AegisHook.t.sol`Integration tests`{Feature}Integration.t.sol``CrossChainIntegration.t.sol`Deployment tests`Deploy{Contract}.t.sol``DeployAegisHook.t.sol`

### Test Coverage RequirementsLink copied!

New features require:

1. Unit Tests: Test individual functions in isolation

- Happy path scenarios
- Edge cases (zero values, maximum values)
- Revert conditions
2. Integration Tests: Test cross-contract interactions

- Oracle → Sentinel message flow
- Sentinel → Hook panic mode activation
- Hook → Registry reputation updates
3. Invariant Tests: Test system-wide properties

- Panic mode can only be set by authorized sentinel
- VIP lane only accessible with reputation > 90
- Guardian NFTs are non-transferable during active interventions

### Running Specific Test SuitesLink copied!

```
# Run all tests
forge test
 
# Run specific contract tests
forge test --match-contract AegisHookTest
 
# Run specific test function
forge test --match-test testSetPanicMode
 
# Run with verbose output
forge test -vvv
 
# Run with gas reporting
forge test --gas-report
```

### Test UtilitiesLink copied!

Tests leverage [forge-std](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/forge-std) utilities:

- `vm.prank(address)` - Simulate calls from specific addresses
- `vm.expectRevert(bytes4)` - Assert function reverts with error
- `vm.expectEmit()` - Assert events are emitted correctly
- `vm.warp(uint256)` - Manipulate block timestamp
- `vm.roll(uint256)` - Manipulate block number

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Deployment Script StandardsLink copied!

When modifying deployment scripts in [script/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/) ensure:

1. Idempotency: Scripts should be runnable multiple times without errors
2. Verification: Include contract verification steps
3. Logging: Output deployed addresses to console and broadcast logs
4. Error Handling: Check for deployment failures and provide clear error messages

Deployment scripts follow this naming pattern:

- [script/04_DeployOracle.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/04_DeployOracle.s.sol) - Deploy MockOracle to Sepolia
- [script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol) - Deploy AegisSentinel to Reactive Network
- [script/06_DeployHook.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/06_DeployHook.s.sol) - Deploy AegisHook to Unichain

Each script must:

- Inherit from `forge-std/Script.sol`
- Implement `run()` function as entry point
- Use `vm.broadcast()` to sign transactions
- Store deployment artifacts in [broadcast/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/) directory

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#77-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L77-L101)

---

## Commit GuidelinesLink copied!

### Commit Message FormatLink copied!

Commits should follow this structure:

```
<type>(<scope>): <subject>
 
<body>
 
<footer>
```

Types:

- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation changes
- `test`: Test additions or modifications
- `refactor`: Code refactoring without behavior change
- `chore`: Build process or auxiliary tool changes

Examples:

```
feat(hook): add VIP lane bypass for high-reputation guardians
 
Implements the VIP lane mechanism that allows guardians with
reputation > 90 to bypass panic mode restrictions with reduced
fees (0.01% instead of 0.30%).
 
Refs: #42
```

```
fix(sentinel): correct price threshold comparison logic
 
The sentinel was using >= instead of > when comparing prices
against CRASH_THRESHOLD, causing false positives at exactly
1500 ETH. Updated to use strict greater-than comparison.
 
Fixes: #58
```

### Commit GranularityLink copied!

Commits should be logically grouped:

- Each commit should represent a single logical change
- Avoid "WIP" or "checkpoint" commits in final PR
- Squash fixup commits before requesting review
- Use `git commit --amend` for small corrections

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#116-121](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L116-L121)

---

## Review ProcessLink copied!

### For ContributorsLink copied!

When your PR is under review:

1. Respond Promptly: Address reviewer feedback within 48 hours when possible
2. Explain Decisions: If disagreeing with feedback, provide technical rationale
3. Update Documentation: Keep PR description current as code evolves
4. Test Changes: Re-run test suite after addressing feedback

### For ReviewersLink copied!

When reviewing PRs:

1. Review Incrementally: Focus on high-level concerns before nits
2. Test Locally: Clone branch and run `forge test` to verify claims
3. Check Cross-Chain Behavior: For changes affecting cross-chain flow, test on testnets
4. Distinguish Blocking vs. Non-Blocking: Clearly mark suggestions as "nit" if non-critical

Priority review checklist:

PriorityQuestionHighDoes this improve security of the circuit breaker mechanism?HighDoes this maintain compatibility with Uniswap v4 hook interface?HighDoes this preserve cross-chain message integrity?MediumAre tests comprehensive and passing?MediumIs gas consumption reasonable?LowAre variable names clear?LowAre comments accurate?

### Abandoned PRsLink copied!

If a PR has no activity for 30 days:

1. Maintainer will comment asking for status
2. After 14 additional days, PR may be closed with "stale" label
3. Contributor can reopen by commenting when ready to resume

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#135-176](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L135-L176)

---

## Cross-Chain Testing ProtocolLink copied!

Changes affecting cross-chain interactions require specific testing:

### Local TestingLink copied!

```
# Test individual components
forge test --match-contract MockOracleTest
forge test --match-contract AegisSentinelTest
forge test --match-contract AegisHookTest
```

### Testnet DeploymentLink copied!

Follow deployment sequence in order:

1. Deploy Oracle (Sepolia L1)

```
forge script script/04_DeployOracle.s.sol --rpc-url sepolia --broadcast
```
2. Deploy Sentinel (Reactive Network)

```
forge script script/05_DeploySentinel.s.sol --rpc-url reactive --broadcast
```
3. Deploy Hook (Unichain L2)

```
forge script script/06_DeployHook.s.sol --rpc-url unichain --broadcast
```

### End-to-End VerificationLink copied!

After deployment, verify the complete flow:

1. Call `updatePrice()` on MockOracle with crash price (< 1500 ETH)
2. Monitor Sentinel logs for `react()` function execution
3. Verify Hook receives `setPanicMode(true)` call
4. Test swap on Uniswap v4 pool - should revert with `PoolPaused` error
5. Call `updatePrice()` with recovery price (> 1500 ETH)
6. Verify Hook receives `setPanicMode(false)` call
7. Test swap again - should succeed

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Communication ChannelsLink copied!

### Issue TrackerLink copied!

Use GitHub Issues for:

- Bug reports
- Feature requests
- Technical discussions
- Deployment questions

### Pull Request DiscussionsLink copied!

Use PR comment threads for:

- Code review feedback
- Implementation alternatives
- Test coverage discussions

### Commit MessagesLink copied!

Use Git commit messages for:

- Explaining "why" behind changes
- Linking to related issues
- Documenting breaking changes

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#39-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L39-L47)

---

## Dependency ManagementLink copied!

Aegis uses git submodules for dependency management. When adding or updating dependencies:

### Adding a New DependencyLink copied!

```
forge install <org>/<repo>
```

This updates [.gitmodules](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.gitmodules) and [contracts/lib/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/) directory.

### Updating Existing DependenciesLink copied!

```
forge update <dependency-name>
```

Update specific dependencies:

- `forge-std` - Testing and scripting utilities
- `uniswap-hooks` - Uniswap v4 hook interfaces
- `system-smart-contracts` - Reactive Network base contracts

### Dependency ConsiderationsLink copied!

When proposing dependency changes:

1. Justify the need for the new dependency
2. Verify license compatibility
3. Check for security audits
4. Assess maintenance status of upstream repository
5. Consider impact on compilation time and contract size

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L101)

---

## Release ProcessLink copied!

Releases are tagged when significant milestones are reached:

Release TypeVersion BumpExampleMajorBreaking changes to contract interfaces1.0.0 → 2.0.0MinorNew features without breaking changes1.0.0 → 1.1.0PatchBug fixes and optimizations1.0.0 → 1.0.1

### Pre-Release ChecklistLink copied!

Before tagging a release:

1. Update deployment addresses in [README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md)
2. Run full test suite: `forge test`
3. Verify testnet deployments are functional
4. Update documentation for new features
5. Review broadcast logs in [broadcast/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/) for accuracy

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#180-187](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L180-L187)

---

## Special ConsiderationsLink copied!

### Uniswap v4 Hook CompatibilityLink copied!

Changes to [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol) must maintain compatibility with:

- `IHooks` interface from `v4-core/src/interfaces/IHooks.sol`
- Hook flag requirements (beforeSwap enabled)
- PoolManager callback expectations

Verify hook compatibility by checking:

```
forge test --match-contract AegisHookTest
```

### Reactive Network ConstraintsLink copied!

Changes to [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) must:

- Inherit from `AbstractReactive` contract
- Implement `react()` function for event handling
- Use correct cross-chain RPC methods from `IReactive`
- Handle event subscription properly in constructor

### Guardian Registry StandardsLink copied!

Changes to [src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol) must:

- Maintain ERC-721 compliance
- Preserve ERC-8004 reputation interface
- Ensure non-transferability during active interventions
- Update reputation atomically to prevent race conditions

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#102-114](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L102-L114)

---

## Getting HelpLink copied!

If you encounter issues during contribution:

1. Search existing issues: Your question may already be answered
2. Review documentation: Check [Getting Started](#1.1) and [Development Guide](#4)
3. Open a discussion: Use GitHub Discussions for general questions
4. Open an issue: For bugs or feature requests, create a detailed issue

When asking for help, include:

- Steps you've already tried
- Full error messages or logs
- Output of `forge --version`
- Network(s) affected (if applicable)
- Relevant contract addresses (if deployed)

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#39-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L39-L47)

---

# Contributing-4

# ContributingLink copied!
Relevant source files
- [contracts/lib/forge-std/CONTRIBUTING.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md)

This document provides guidelines for contributing to the Aegis cross-chain circuit breaker system. It covers the development workflow, pull request process, code standards, and testing requirements for the project.

For information about initial environment setup, see [Environment Setup](#4.1). For details on building and testing the codebase, see [Building and Testing](#4.2). For code formatting and development conventions, see [Code Standards](#4.4).

---

## Purpose and ScopeLink copied!

The Aegis project welcomes contributions from developers interested in improving cross-chain DeFi security infrastructure. This guide outlines the processes for submitting bug reports, feature requests, and code changes. It applies to contributions to the smart contracts in [src/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/) deployment scripts in [script/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/) test suites in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) and supporting infrastructure in [relayer/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/relayer/)

---

## Code of ConductLink copied!

Contributors to the Aegis project are expected to adhere to professional standards of conduct when interacting with the community. All interactions should be respectful and constructive, focused on improving the codebase and advancing the project's technical goals.

Violations can be reported to the project maintainers through GitHub issue tracker or direct communication.

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#12-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L12-L16)

---

## Ways to ContributeLink copied!

There are four primary ways to contribute to Aegis:

### 1. Opening IssuesLink copied!

Submit bug reports or feature requests through the GitHub issue tracker. Include:

- Aegis version and commit hash
- Network(s) affected (Sepolia, Reactive Network, Unichain)
- Contract addresses if applicable
- Concrete steps to reproduce the issue
- Expected vs. actual behavior

### 2. Adding ContextLink copied!

Enhance existing issues by providing:

- Transaction hashes demonstrating the problem
- Logs from `forge test` or deployment scripts
- Screenshots of cross-chain behavior
- Analysis of gas consumption or latency

### 3. Resolving IssuesLink copied!

Submit pull requests that:

- Fix bugs in contracts ([src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol)[src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol)[src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol)[src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol))
- Improve deployment scripts ([script/04_DeployOracle.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/04_DeployOracle.s.sol)[script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol)[script/06_DeployHook.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/06_DeployHook.s.sol))
- Enhance test coverage in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/)
- Update documentation

### 4. Code ReviewLink copied!

Review pull requests by:

- Testing changes locally using `forge test`
- Verifying cross-chain behavior on testnets
- Checking for gas optimizations
- Ensuring compatibility with Uniswap v4 hook interface

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#18-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L18-L32)

---

## Development WorkflowLink copied!

The following diagram illustrates the complete contribution workflow from fork to merge, referencing specific files and commands used in the process.

### Contribution Workflow DiagramLink copied!

#mermaid-pdit5v2rjt{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-pdit5v2rjt .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-pdit5v2rjt .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-pdit5v2rjt .error-icon{fill:#a44141;}#mermaid-pdit5v2rjt .error-text{fill:#ddd;stroke:#ddd;}#mermaid-pdit5v2rjt .edge-thickness-normal{stroke-width:1px;}#mermaid-pdit5v2rjt .edge-thickness-thick{stroke-width:3.5px;}#mermaid-pdit5v2rjt .edge-pattern-solid{stroke-dasharray:0;}#mermaid-pdit5v2rjt .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-pdit5v2rjt .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-pdit5v2rjt .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-pdit5v2rjt .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-pdit5v2rjt .marker.cross{stroke:lightgrey;}#mermaid-pdit5v2rjt svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-pdit5v2rjt p{margin:0;}#mermaid-pdit5v2rjt .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-pdit5v2rjt .cluster-label text{fill:#F9FFFE;}#mermaid-pdit5v2rjt .cluster-label span{color:#F9FFFE;}#mermaid-pdit5v2rjt .cluster-label span p{background-color:transparent;}#mermaid-pdit5v2rjt .label text,#mermaid-pdit5v2rjt span{fill:#ccc;color:#ccc;}#mermaid-pdit5v2rjt .node rect,#mermaid-pdit5v2rjt .node circle,#mermaid-pdit5v2rjt .node ellipse,#mermaid-pdit5v2rjt .node polygon,#mermaid-pdit5v2rjt .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-pdit5v2rjt .rough-node .label text,#mermaid-pdit5v2rjt .node .label text,#mermaid-pdit5v2rjt .image-shape .label,#mermaid-pdit5v2rjt .icon-shape .label{text-anchor:middle;}#mermaid-pdit5v2rjt .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-pdit5v2rjt .rough-node .label,#mermaid-pdit5v2rjt .node .label,#mermaid-pdit5v2rjt .image-shape .label,#mermaid-pdit5v2rjt .icon-shape .label{text-align:center;}#mermaid-pdit5v2rjt .node.clickable{cursor:pointer;}#mermaid-pdit5v2rjt .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-pdit5v2rjt .arrowheadPath{fill:lightgrey;}#mermaid-pdit5v2rjt .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-pdit5v2rjt .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-pdit5v2rjt .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-pdit5v2rjt .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-pdit5v2rjt .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-pdit5v2rjt .cluster text{fill:#F9FFFE;}#mermaid-pdit5v2rjt .cluster span{color:#F9FFFE;}#mermaid-pdit5v2rjt div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-pdit5v2rjt .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-pdit5v2rjt rect.text{fill:none;stroke-width:0;}#mermaid-pdit5v2rjt .icon-shape,#mermaid-pdit5v2rjt .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-pdit5v2rjt .icon-shape p,#mermaid-pdit5v2rjt .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-pdit5v2rjt .icon-shape rect,#mermaid-pdit5v2rjt .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-pdit5v2rjt .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-pdit5v2rjt :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Changes requested

Approved

Fail

Pass

Fork github.com/HACK3R-CRYPTO/Aegis

git clone <your-fork>

forge install Install dependencies

git checkout -b feature/your-change

Modify source files: src/*.sol script/*.s.sol test/*.t.sol

forge fmt Format code

forge build Compile contracts

forge test -vvv Run test suite

git commit -m 'description'

git push origin feature/your-change

Open Pull Request on GitHub

Code Review Process

Address feedback: git commit --amend or new commits

CI Checks Pass?

Merged by maintainer

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#77-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L77-L101)[contracts/lib/forge-std/CONTRIBUTING.md#116-134](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L116-L134)

---

## Pre-Submission ChecklistLink copied!

Before submitting a pull request, ensure the following commands pass:

### Code FormattingLink copied!

```
forge fmt --check
```

All Solidity files must conform to the project's formatting standards as defined in [foundry.toml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml) The formatter enforces consistent line length, indentation, and spacing.

### CompilationLink copied!

```
forge build
```

All contracts must compile without errors. The build process includes:

- [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol) - Uniswap v4 hook implementation
- [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) - Reactive Network contract
- [src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol) - L1 price oracle
- [src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol) - ERC-721/ERC-8004 registry

### Test ExecutionLink copied!

```
forge test -vvv
```

All existing tests in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) must pass. Tests verify:

- Hook panic mode activation/deactivation
- Cross-chain message handling
- Guardian reputation mechanics
- VIP lane fee calculations

### Solidity Version CompatibilityLink copied!

If modifying core contracts, verify compatibility across Solidity versions:

```
forge build --skip test --use solc:0.8.0
forge build --skip test --use solc:0.8.20
```

The project primarily targets Solidity 0.8.24 but should maintain backward compatibility where possible.

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-100](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L100)

---

## Pull Request ProcessLink copied!

The pull request lifecycle involves several stages from opening to merge. The following diagram shows the detailed review and merge process with specific file artifacts.

### Pull Request Review PipelineLink copied!

#mermaid-87ombf2dott{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-87ombf2dott .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-87ombf2dott .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-87ombf2dott .error-icon{fill:#a44141;}#mermaid-87ombf2dott .error-text{fill:#ddd;stroke:#ddd;}#mermaid-87ombf2dott .edge-thickness-normal{stroke-width:1px;}#mermaid-87ombf2dott .edge-thickness-thick{stroke-width:3.5px;}#mermaid-87ombf2dott .edge-pattern-solid{stroke-dasharray:0;}#mermaid-87ombf2dott .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-87ombf2dott .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-87ombf2dott .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-87ombf2dott .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-87ombf2dott .marker.cross{stroke:lightgrey;}#mermaid-87ombf2dott svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-87ombf2dott p{margin:0;}#mermaid-87ombf2dott .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-87ombf2dott .cluster-label text{fill:#F9FFFE;}#mermaid-87ombf2dott .cluster-label span{color:#F9FFFE;}#mermaid-87ombf2dott .cluster-label span p{background-color:transparent;}#mermaid-87ombf2dott .label text,#mermaid-87ombf2dott span{fill:#ccc;color:#ccc;}#mermaid-87ombf2dott .node rect,#mermaid-87ombf2dott .node circle,#mermaid-87ombf2dott .node ellipse,#mermaid-87ombf2dott .node polygon,#mermaid-87ombf2dott .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-87ombf2dott .rough-node .label text,#mermaid-87ombf2dott .node .label text,#mermaid-87ombf2dott .image-shape .label,#mermaid-87ombf2dott .icon-shape .label{text-anchor:middle;}#mermaid-87ombf2dott .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-87ombf2dott .rough-node .label,#mermaid-87ombf2dott .node .label,#mermaid-87ombf2dott .image-shape .label,#mermaid-87ombf2dott .icon-shape .label{text-align:center;}#mermaid-87ombf2dott .node.clickable{cursor:pointer;}#mermaid-87ombf2dott .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-87ombf2dott .arrowheadPath{fill:lightgrey;}#mermaid-87ombf2dott .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-87ombf2dott .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-87ombf2dott .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-87ombf2dott .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-87ombf2dott .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-87ombf2dott .cluster text{fill:#F9FFFE;}#mermaid-87ombf2dott .cluster span{color:#F9FFFE;}#mermaid-87ombf2dott div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-87ombf2dott .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-87ombf2dott rect.text{fill:none;stroke-width:0;}#mermaid-87ombf2dott .icon-shape,#mermaid-87ombf2dott .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-87ombf2dott .icon-shape p,#mermaid-87ombf2dott .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-87ombf2dott .icon-shape rect,#mermaid-87ombf2dott .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-87ombf2dott .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-87ombf2dott :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Merge

Verification

Manual Review

Automated Checks

Submission

Open PR with description

Fill PR template: - What changed - Why changed - How tested

GitHub Actions: forge fmt --check

GitHub Actions: forge build

GitHub Actions: forge test

Review code changes: src/*.sol test/*.t.sol

Verify test coverage: new tests added?

Check docs: comments updated?

Reviewer runs: forge test locally

Deploy to testnet: using script/*.s.sol

Test cross-chain flow: Oracle → Sentinel → Hook

Maintainer approval

Squash and merge to main branch

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#122-134](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L122-L134)[contracts/lib/forge-std/CONTRIBUTING.md#135-174](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L135-L174)

---

## Code StandardsLink copied!

### Solidity ConventionsLink copied!

All Solidity code must adhere to the following standards:

StandardRequirementExampleContract namingPascalCase`AegisHook`, `AegisSentinel`Function namingcamelCase`setPanicMode()`, `beforeSwap()`Variable namingcamelCase with underscore prefix for private`_panicMode`, `hookRegistry`Event namingPascalCase`PanicModeChanged`, `PriceUpdate`Error namingPascalCase`PoolPaused`, `UnauthorizedCaller`Constant namingUPPER_SNAKE_CASE`CRASH_THRESHOLD`, `VIP_FEE`

### Documentation RequirementsLink copied!

All public functions must include NatSpec comments:

```
/// @notice Sets the panic mode state for the hook
/// @dev Only callable by the AegisSentinel on Reactive Network
/// @param isPanic True to activate circuit breaker, false to deactivate
function setPanicMode(bool isPanic) external;
```

### File OrganizationLink copied!

Files should follow this structure:

1. SPDX license identifier
2. Pragma statement
3. Import statements (external libraries first, then local imports)
4. Contract declaration
5. State variables
6. Events
7. Errors
8. Modifiers
9. Constructor
10. External functions
11. Public functions
12. Internal functions
13. Private functions

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Testing RequirementsLink copied!

### Test StructureLink copied!

Tests must be organized in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) with the following naming convention:

Test TypeFile PatternExampleUnit tests`{Contract}.t.sol``AegisHook.t.sol`Integration tests`{Feature}Integration.t.sol``CrossChainIntegration.t.sol`Deployment tests`Deploy{Contract}.t.sol``DeployAegisHook.t.sol`

### Test Coverage RequirementsLink copied!

New features require:

1. Unit Tests: Test individual functions in isolation

- Happy path scenarios
- Edge cases (zero values, maximum values)
- Revert conditions
2. Integration Tests: Test cross-contract interactions

- Oracle → Sentinel message flow
- Sentinel → Hook panic mode activation
- Hook → Registry reputation updates
3. Invariant Tests: Test system-wide properties

- Panic mode can only be set by authorized sentinel
- VIP lane only accessible with reputation > 90
- Guardian NFTs are non-transferable during active interventions

### Running Specific Test SuitesLink copied!

```
# Run all tests
forge test
 
# Run specific contract tests
forge test --match-contract AegisHookTest
 
# Run specific test function
forge test --match-test testSetPanicMode
 
# Run with verbose output
forge test -vvv
 
# Run with gas reporting
forge test --gas-report
```

### Test UtilitiesLink copied!

Tests leverage [forge-std](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/forge-std) utilities:

- `vm.prank(address)` - Simulate calls from specific addresses
- `vm.expectRevert(bytes4)` - Assert function reverts with error
- `vm.expectEmit()` - Assert events are emitted correctly
- `vm.warp(uint256)` - Manipulate block timestamp
- `vm.roll(uint256)` - Manipulate block number

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Deployment Script StandardsLink copied!

When modifying deployment scripts in [script/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/) ensure:

1. Idempotency: Scripts should be runnable multiple times without errors
2. Verification: Include contract verification steps
3. Logging: Output deployed addresses to console and broadcast logs
4. Error Handling: Check for deployment failures and provide clear error messages

Deployment scripts follow this naming pattern:

- [script/04_DeployOracle.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/04_DeployOracle.s.sol) - Deploy MockOracle to Sepolia
- [script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol) - Deploy AegisSentinel to Reactive Network
- [script/06_DeployHook.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/06_DeployHook.s.sol) - Deploy AegisHook to Unichain

Each script must:

- Inherit from `forge-std/Script.sol`
- Implement `run()` function as entry point
- Use `vm.broadcast()` to sign transactions
- Store deployment artifacts in [broadcast/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/) directory

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#77-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L77-L101)

---

## Commit GuidelinesLink copied!

### Commit Message FormatLink copied!

Commits should follow this structure:

```
<type>(<scope>): <subject>
 
<body>
 
<footer>
```

Types:

- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation changes
- `test`: Test additions or modifications
- `refactor`: Code refactoring without behavior change
- `chore`: Build process or auxiliary tool changes

Examples:

```
feat(hook): add VIP lane bypass for high-reputation guardians
 
Implements the VIP lane mechanism that allows guardians with
reputation > 90 to bypass panic mode restrictions with reduced
fees (0.01% instead of 0.30%).
 
Refs: #42
```

```
fix(sentinel): correct price threshold comparison logic
 
The sentinel was using >= instead of > when comparing prices
against CRASH_THRESHOLD, causing false positives at exactly
1500 ETH. Updated to use strict greater-than comparison.
 
Fixes: #58
```

### Commit GranularityLink copied!

Commits should be logically grouped:

- Each commit should represent a single logical change
- Avoid "WIP" or "checkpoint" commits in final PR
- Squash fixup commits before requesting review
- Use `git commit --amend` for small corrections

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#116-121](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L116-L121)

---

## Review ProcessLink copied!

### For ContributorsLink copied!

When your PR is under review:

1. Respond Promptly: Address reviewer feedback within 48 hours when possible
2. Explain Decisions: If disagreeing with feedback, provide technical rationale
3. Update Documentation: Keep PR description current as code evolves
4. Test Changes: Re-run test suite after addressing feedback

### For ReviewersLink copied!

When reviewing PRs:

1. Review Incrementally: Focus on high-level concerns before nits
2. Test Locally: Clone branch and run `forge test` to verify claims
3. Check Cross-Chain Behavior: For changes affecting cross-chain flow, test on testnets
4. Distinguish Blocking vs. Non-Blocking: Clearly mark suggestions as "nit" if non-critical

Priority review checklist:

PriorityQuestionHighDoes this improve security of the circuit breaker mechanism?HighDoes this maintain compatibility with Uniswap v4 hook interface?HighDoes this preserve cross-chain message integrity?MediumAre tests comprehensive and passing?MediumIs gas consumption reasonable?LowAre variable names clear?LowAre comments accurate?

### Abandoned PRsLink copied!

If a PR has no activity for 30 days:

1. Maintainer will comment asking for status
2. After 14 additional days, PR may be closed with "stale" label
3. Contributor can reopen by commenting when ready to resume

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#135-176](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L135-L176)

---

## Cross-Chain Testing ProtocolLink copied!

Changes affecting cross-chain interactions require specific testing:

### Local TestingLink copied!

```
# Test individual components
forge test --match-contract MockOracleTest
forge test --match-contract AegisSentinelTest
forge test --match-contract AegisHookTest
```

### Testnet DeploymentLink copied!

Follow deployment sequence in order:

1. Deploy Oracle (Sepolia L1)

```
forge script script/04_DeployOracle.s.sol --rpc-url sepolia --broadcast
```
2. Deploy Sentinel (Reactive Network)

```
forge script script/05_DeploySentinel.s.sol --rpc-url reactive --broadcast
```
3. Deploy Hook (Unichain L2)

```
forge script script/06_DeployHook.s.sol --rpc-url unichain --broadcast
```

### End-to-End VerificationLink copied!

After deployment, verify the complete flow:

1. Call `updatePrice()` on MockOracle with crash price (< 1500 ETH)
2. Monitor Sentinel logs for `react()` function execution
3. Verify Hook receives `setPanicMode(true)` call
4. Test swap on Uniswap v4 pool - should revert with `PoolPaused` error
5. Call `updatePrice()` with recovery price (> 1500 ETH)
6. Verify Hook receives `setPanicMode(false)` call
7. Test swap again - should succeed

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Communication ChannelsLink copied!

### Issue TrackerLink copied!

Use GitHub Issues for:

- Bug reports
- Feature requests
- Technical discussions
- Deployment questions

### Pull Request DiscussionsLink copied!

Use PR comment threads for:

- Code review feedback
- Implementation alternatives
- Test coverage discussions

### Commit MessagesLink copied!

Use Git commit messages for:

- Explaining "why" behind changes
- Linking to related issues
- Documenting breaking changes

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#39-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L39-L47)

---

## Dependency ManagementLink copied!

Aegis uses git submodules for dependency management. When adding or updating dependencies:

### Adding a New DependencyLink copied!

```
forge install <org>/<repo>
```

This updates [.gitmodules](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.gitmodules) and [contracts/lib/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/) directory.

### Updating Existing DependenciesLink copied!

```
forge update <dependency-name>
```

Update specific dependencies:

- `forge-std` - Testing and scripting utilities
- `uniswap-hooks` - Uniswap v4 hook interfaces
- `system-smart-contracts` - Reactive Network base contracts

### Dependency ConsiderationsLink copied!

When proposing dependency changes:

1. Justify the need for the new dependency
2. Verify license compatibility
3. Check for security audits
4. Assess maintenance status of upstream repository
5. Consider impact on compilation time and contract size

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L101)

---

## Release ProcessLink copied!

Releases are tagged when significant milestones are reached:

Release TypeVersion BumpExampleMajorBreaking changes to contract interfaces1.0.0 → 2.0.0MinorNew features without breaking changes1.0.0 → 1.1.0PatchBug fixes and optimizations1.0.0 → 1.0.1

### Pre-Release ChecklistLink copied!

Before tagging a release:

1. Update deployment addresses in [README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md)
2. Run full test suite: `forge test`
3. Verify testnet deployments are functional
4. Update documentation for new features
5. Review broadcast logs in [broadcast/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/) for accuracy

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#180-187](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L180-L187)

---

## Special ConsiderationsLink copied!

### Uniswap v4 Hook CompatibilityLink copied!

Changes to [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol) must maintain compatibility with:

- `IHooks` interface from `v4-core/src/interfaces/IHooks.sol`
- Hook flag requirements (beforeSwap enabled)
- PoolManager callback expectations

Verify hook compatibility by checking:

```
forge test --match-contract AegisHookTest
```

### Reactive Network ConstraintsLink copied!

Changes to [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) must:

- Inherit from `AbstractReactive` contract
- Implement `react()` function for event handling
- Use correct cross-chain RPC methods from `IReactive`
- Handle event subscription properly in constructor

### Guardian Registry StandardsLink copied!

Changes to [src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol) must:

- Maintain ERC-721 compliance
- Preserve ERC-8004 reputation interface
- Ensure non-transferability during active interventions
- Update reputation atomically to prevent race conditions

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#102-114](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L102-L114)

---

## Getting HelpLink copied!

If you encounter issues during contribution:

1. Search existing issues: Your question may already be answered
2. Review documentation: Check [Getting Started](#1.1) and [Development Guide](#4)
3. Open a discussion: Use GitHub Discussions for general questions
4. Open an issue: For bugs or feature requests, create a detailed issue

When asking for help, include:

- Steps you've already tried
- Full error messages or logs
- Output of `forge --version`
- Network(s) affected (if applicable)
- Relevant contract addresses (if deployed)

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#39-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L39-L47)

---

# Contributing-5

# ContributingLink copied!
Relevant source files
- [contracts/lib/forge-std/CONTRIBUTING.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md)

This document provides guidelines for contributing to the Aegis cross-chain circuit breaker system. It covers the development workflow, pull request process, code standards, and testing requirements for the project.

For information about initial environment setup, see [Environment Setup](#4.1). For details on building and testing the codebase, see [Building and Testing](#4.2). For code formatting and development conventions, see [Code Standards](#4.4).

---

## Purpose and ScopeLink copied!

The Aegis project welcomes contributions from developers interested in improving cross-chain DeFi security infrastructure. This guide outlines the processes for submitting bug reports, feature requests, and code changes. It applies to contributions to the smart contracts in [src/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/) deployment scripts in [script/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/) test suites in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) and supporting infrastructure in [relayer/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/relayer/)

---

## Code of ConductLink copied!

Contributors to the Aegis project are expected to adhere to professional standards of conduct when interacting with the community. All interactions should be respectful and constructive, focused on improving the codebase and advancing the project's technical goals.

Violations can be reported to the project maintainers through GitHub issue tracker or direct communication.

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#12-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L12-L16)

---

## Ways to ContributeLink copied!

There are four primary ways to contribute to Aegis:

### 1. Opening IssuesLink copied!

Submit bug reports or feature requests through the GitHub issue tracker. Include:

- Aegis version and commit hash
- Network(s) affected (Sepolia, Reactive Network, Unichain)
- Contract addresses if applicable
- Concrete steps to reproduce the issue
- Expected vs. actual behavior

### 2. Adding ContextLink copied!

Enhance existing issues by providing:

- Transaction hashes demonstrating the problem
- Logs from `forge test` or deployment scripts
- Screenshots of cross-chain behavior
- Analysis of gas consumption or latency

### 3. Resolving IssuesLink copied!

Submit pull requests that:

- Fix bugs in contracts ([src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol)[src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol)[src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol)[src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol))
- Improve deployment scripts ([script/04_DeployOracle.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/04_DeployOracle.s.sol)[script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol)[script/06_DeployHook.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/06_DeployHook.s.sol))
- Enhance test coverage in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/)
- Update documentation

### 4. Code ReviewLink copied!

Review pull requests by:

- Testing changes locally using `forge test`
- Verifying cross-chain behavior on testnets
- Checking for gas optimizations
- Ensuring compatibility with Uniswap v4 hook interface

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#18-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L18-L32)

---

## Development WorkflowLink copied!

The following diagram illustrates the complete contribution workflow from fork to merge, referencing specific files and commands used in the process.

### Contribution Workflow DiagramLink copied!

#mermaid-pdit5v2rjt{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-pdit5v2rjt .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-pdit5v2rjt .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-pdit5v2rjt .error-icon{fill:#a44141;}#mermaid-pdit5v2rjt .error-text{fill:#ddd;stroke:#ddd;}#mermaid-pdit5v2rjt .edge-thickness-normal{stroke-width:1px;}#mermaid-pdit5v2rjt .edge-thickness-thick{stroke-width:3.5px;}#mermaid-pdit5v2rjt .edge-pattern-solid{stroke-dasharray:0;}#mermaid-pdit5v2rjt .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-pdit5v2rjt .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-pdit5v2rjt .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-pdit5v2rjt .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-pdit5v2rjt .marker.cross{stroke:lightgrey;}#mermaid-pdit5v2rjt svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-pdit5v2rjt p{margin:0;}#mermaid-pdit5v2rjt .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-pdit5v2rjt .cluster-label text{fill:#F9FFFE;}#mermaid-pdit5v2rjt .cluster-label span{color:#F9FFFE;}#mermaid-pdit5v2rjt .cluster-label span p{background-color:transparent;}#mermaid-pdit5v2rjt .label text,#mermaid-pdit5v2rjt span{fill:#ccc;color:#ccc;}#mermaid-pdit5v2rjt .node rect,#mermaid-pdit5v2rjt .node circle,#mermaid-pdit5v2rjt .node ellipse,#mermaid-pdit5v2rjt .node polygon,#mermaid-pdit5v2rjt .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-pdit5v2rjt .rough-node .label text,#mermaid-pdit5v2rjt .node .label text,#mermaid-pdit5v2rjt .image-shape .label,#mermaid-pdit5v2rjt .icon-shape .label{text-anchor:middle;}#mermaid-pdit5v2rjt .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-pdit5v2rjt .rough-node .label,#mermaid-pdit5v2rjt .node .label,#mermaid-pdit5v2rjt .image-shape .label,#mermaid-pdit5v2rjt .icon-shape .label{text-align:center;}#mermaid-pdit5v2rjt .node.clickable{cursor:pointer;}#mermaid-pdit5v2rjt .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-pdit5v2rjt .arrowheadPath{fill:lightgrey;}#mermaid-pdit5v2rjt .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-pdit5v2rjt .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-pdit5v2rjt .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-pdit5v2rjt .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-pdit5v2rjt .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-pdit5v2rjt .cluster text{fill:#F9FFFE;}#mermaid-pdit5v2rjt .cluster span{color:#F9FFFE;}#mermaid-pdit5v2rjt div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-pdit5v2rjt .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-pdit5v2rjt rect.text{fill:none;stroke-width:0;}#mermaid-pdit5v2rjt .icon-shape,#mermaid-pdit5v2rjt .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-pdit5v2rjt .icon-shape p,#mermaid-pdit5v2rjt .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-pdit5v2rjt .icon-shape rect,#mermaid-pdit5v2rjt .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-pdit5v2rjt .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-pdit5v2rjt :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Changes requested

Approved

Fail

Pass

Fork github.com/HACK3R-CRYPTO/Aegis

git clone <your-fork>

forge install Install dependencies

git checkout -b feature/your-change

Modify source files: src/*.sol script/*.s.sol test/*.t.sol

forge fmt Format code

forge build Compile contracts

forge test -vvv Run test suite

git commit -m 'description'

git push origin feature/your-change

Open Pull Request on GitHub

Code Review Process

Address feedback: git commit --amend or new commits

CI Checks Pass?

Merged by maintainer

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#77-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L77-L101)[contracts/lib/forge-std/CONTRIBUTING.md#116-134](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L116-L134)

---

## Pre-Submission ChecklistLink copied!

Before submitting a pull request, ensure the following commands pass:

### Code FormattingLink copied!

```
forge fmt --check
```

All Solidity files must conform to the project's formatting standards as defined in [foundry.toml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml) The formatter enforces consistent line length, indentation, and spacing.

### CompilationLink copied!

```
forge build
```

All contracts must compile without errors. The build process includes:

- [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol) - Uniswap v4 hook implementation
- [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) - Reactive Network contract
- [src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol) - L1 price oracle
- [src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol) - ERC-721/ERC-8004 registry

### Test ExecutionLink copied!

```
forge test -vvv
```

All existing tests in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) must pass. Tests verify:

- Hook panic mode activation/deactivation
- Cross-chain message handling
- Guardian reputation mechanics
- VIP lane fee calculations

### Solidity Version CompatibilityLink copied!

If modifying core contracts, verify compatibility across Solidity versions:

```
forge build --skip test --use solc:0.8.0
forge build --skip test --use solc:0.8.20
```

The project primarily targets Solidity 0.8.24 but should maintain backward compatibility where possible.

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-100](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L100)

---

## Pull Request ProcessLink copied!

The pull request lifecycle involves several stages from opening to merge. The following diagram shows the detailed review and merge process with specific file artifacts.

### Pull Request Review PipelineLink copied!

#mermaid-87ombf2dott{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-87ombf2dott .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-87ombf2dott .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-87ombf2dott .error-icon{fill:#a44141;}#mermaid-87ombf2dott .error-text{fill:#ddd;stroke:#ddd;}#mermaid-87ombf2dott .edge-thickness-normal{stroke-width:1px;}#mermaid-87ombf2dott .edge-thickness-thick{stroke-width:3.5px;}#mermaid-87ombf2dott .edge-pattern-solid{stroke-dasharray:0;}#mermaid-87ombf2dott .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-87ombf2dott .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-87ombf2dott .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-87ombf2dott .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-87ombf2dott .marker.cross{stroke:lightgrey;}#mermaid-87ombf2dott svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-87ombf2dott p{margin:0;}#mermaid-87ombf2dott .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-87ombf2dott .cluster-label text{fill:#F9FFFE;}#mermaid-87ombf2dott .cluster-label span{color:#F9FFFE;}#mermaid-87ombf2dott .cluster-label span p{background-color:transparent;}#mermaid-87ombf2dott .label text,#mermaid-87ombf2dott span{fill:#ccc;color:#ccc;}#mermaid-87ombf2dott .node rect,#mermaid-87ombf2dott .node circle,#mermaid-87ombf2dott .node ellipse,#mermaid-87ombf2dott .node polygon,#mermaid-87ombf2dott .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-87ombf2dott .rough-node .label text,#mermaid-87ombf2dott .node .label text,#mermaid-87ombf2dott .image-shape .label,#mermaid-87ombf2dott .icon-shape .label{text-anchor:middle;}#mermaid-87ombf2dott .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-87ombf2dott .rough-node .label,#mermaid-87ombf2dott .node .label,#mermaid-87ombf2dott .image-shape .label,#mermaid-87ombf2dott .icon-shape .label{text-align:center;}#mermaid-87ombf2dott .node.clickable{cursor:pointer;}#mermaid-87ombf2dott .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-87ombf2dott .arrowheadPath{fill:lightgrey;}#mermaid-87ombf2dott .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-87ombf2dott .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-87ombf2dott .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-87ombf2dott .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-87ombf2dott .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-87ombf2dott .cluster text{fill:#F9FFFE;}#mermaid-87ombf2dott .cluster span{color:#F9FFFE;}#mermaid-87ombf2dott div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-87ombf2dott .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-87ombf2dott rect.text{fill:none;stroke-width:0;}#mermaid-87ombf2dott .icon-shape,#mermaid-87ombf2dott .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-87ombf2dott .icon-shape p,#mermaid-87ombf2dott .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-87ombf2dott .icon-shape rect,#mermaid-87ombf2dott .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-87ombf2dott .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-87ombf2dott :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Merge

Verification

Manual Review

Automated Checks

Submission

Open PR with description

Fill PR template: - What changed - Why changed - How tested

GitHub Actions: forge fmt --check

GitHub Actions: forge build

GitHub Actions: forge test

Review code changes: src/*.sol test/*.t.sol

Verify test coverage: new tests added?

Check docs: comments updated?

Reviewer runs: forge test locally

Deploy to testnet: using script/*.s.sol

Test cross-chain flow: Oracle → Sentinel → Hook

Maintainer approval

Squash and merge to main branch

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#122-134](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L122-L134)[contracts/lib/forge-std/CONTRIBUTING.md#135-174](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L135-L174)

---

## Code StandardsLink copied!

### Solidity ConventionsLink copied!

All Solidity code must adhere to the following standards:

StandardRequirementExampleContract namingPascalCase`AegisHook`, `AegisSentinel`Function namingcamelCase`setPanicMode()`, `beforeSwap()`Variable namingcamelCase with underscore prefix for private`_panicMode`, `hookRegistry`Event namingPascalCase`PanicModeChanged`, `PriceUpdate`Error namingPascalCase`PoolPaused`, `UnauthorizedCaller`Constant namingUPPER_SNAKE_CASE`CRASH_THRESHOLD`, `VIP_FEE`

### Documentation RequirementsLink copied!

All public functions must include NatSpec comments:

```
/// @notice Sets the panic mode state for the hook
/// @dev Only callable by the AegisSentinel on Reactive Network
/// @param isPanic True to activate circuit breaker, false to deactivate
function setPanicMode(bool isPanic) external;
```

### File OrganizationLink copied!

Files should follow this structure:

1. SPDX license identifier
2. Pragma statement
3. Import statements (external libraries first, then local imports)
4. Contract declaration
5. State variables
6. Events
7. Errors
8. Modifiers
9. Constructor
10. External functions
11. Public functions
12. Internal functions
13. Private functions

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Testing RequirementsLink copied!

### Test StructureLink copied!

Tests must be organized in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) with the following naming convention:

Test TypeFile PatternExampleUnit tests`{Contract}.t.sol``AegisHook.t.sol`Integration tests`{Feature}Integration.t.sol``CrossChainIntegration.t.sol`Deployment tests`Deploy{Contract}.t.sol``DeployAegisHook.t.sol`

### Test Coverage RequirementsLink copied!

New features require:

1. Unit Tests: Test individual functions in isolation

- Happy path scenarios
- Edge cases (zero values, maximum values)
- Revert conditions
2. Integration Tests: Test cross-contract interactions

- Oracle → Sentinel message flow
- Sentinel → Hook panic mode activation
- Hook → Registry reputation updates
3. Invariant Tests: Test system-wide properties

- Panic mode can only be set by authorized sentinel
- VIP lane only accessible with reputation > 90
- Guardian NFTs are non-transferable during active interventions

### Running Specific Test SuitesLink copied!

```
# Run all tests
forge test
 
# Run specific contract tests
forge test --match-contract AegisHookTest
 
# Run specific test function
forge test --match-test testSetPanicMode
 
# Run with verbose output
forge test -vvv
 
# Run with gas reporting
forge test --gas-report
```

### Test UtilitiesLink copied!

Tests leverage [forge-std](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/forge-std) utilities:

- `vm.prank(address)` - Simulate calls from specific addresses
- `vm.expectRevert(bytes4)` - Assert function reverts with error
- `vm.expectEmit()` - Assert events are emitted correctly
- `vm.warp(uint256)` - Manipulate block timestamp
- `vm.roll(uint256)` - Manipulate block number

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Deployment Script StandardsLink copied!

When modifying deployment scripts in [script/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/) ensure:

1. Idempotency: Scripts should be runnable multiple times without errors
2. Verification: Include contract verification steps
3. Logging: Output deployed addresses to console and broadcast logs
4. Error Handling: Check for deployment failures and provide clear error messages

Deployment scripts follow this naming pattern:

- [script/04_DeployOracle.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/04_DeployOracle.s.sol) - Deploy MockOracle to Sepolia
- [script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol) - Deploy AegisSentinel to Reactive Network
- [script/06_DeployHook.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/06_DeployHook.s.sol) - Deploy AegisHook to Unichain

Each script must:

- Inherit from `forge-std/Script.sol`
- Implement `run()` function as entry point
- Use `vm.broadcast()` to sign transactions
- Store deployment artifacts in [broadcast/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/) directory

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#77-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L77-L101)

---

## Commit GuidelinesLink copied!

### Commit Message FormatLink copied!

Commits should follow this structure:

```
<type>(<scope>): <subject>
 
<body>
 
<footer>
```

Types:

- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation changes
- `test`: Test additions or modifications
- `refactor`: Code refactoring without behavior change
- `chore`: Build process or auxiliary tool changes

Examples:

```
feat(hook): add VIP lane bypass for high-reputation guardians
 
Implements the VIP lane mechanism that allows guardians with
reputation > 90 to bypass panic mode restrictions with reduced
fees (0.01% instead of 0.30%).
 
Refs: #42
```

```
fix(sentinel): correct price threshold comparison logic
 
The sentinel was using >= instead of > when comparing prices
against CRASH_THRESHOLD, causing false positives at exactly
1500 ETH. Updated to use strict greater-than comparison.
 
Fixes: #58
```

### Commit GranularityLink copied!

Commits should be logically grouped:

- Each commit should represent a single logical change
- Avoid "WIP" or "checkpoint" commits in final PR
- Squash fixup commits before requesting review
- Use `git commit --amend` for small corrections

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#116-121](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L116-L121)

---

## Review ProcessLink copied!

### For ContributorsLink copied!

When your PR is under review:

1. Respond Promptly: Address reviewer feedback within 48 hours when possible
2. Explain Decisions: If disagreeing with feedback, provide technical rationale
3. Update Documentation: Keep PR description current as code evolves
4. Test Changes: Re-run test suite after addressing feedback

### For ReviewersLink copied!

When reviewing PRs:

1. Review Incrementally: Focus on high-level concerns before nits
2. Test Locally: Clone branch and run `forge test` to verify claims
3. Check Cross-Chain Behavior: For changes affecting cross-chain flow, test on testnets
4. Distinguish Blocking vs. Non-Blocking: Clearly mark suggestions as "nit" if non-critical

Priority review checklist:

PriorityQuestionHighDoes this improve security of the circuit breaker mechanism?HighDoes this maintain compatibility with Uniswap v4 hook interface?HighDoes this preserve cross-chain message integrity?MediumAre tests comprehensive and passing?MediumIs gas consumption reasonable?LowAre variable names clear?LowAre comments accurate?

### Abandoned PRsLink copied!

If a PR has no activity for 30 days:

1. Maintainer will comment asking for status
2. After 14 additional days, PR may be closed with "stale" label
3. Contributor can reopen by commenting when ready to resume

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#135-176](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L135-L176)

---

## Cross-Chain Testing ProtocolLink copied!

Changes affecting cross-chain interactions require specific testing:

### Local TestingLink copied!

```
# Test individual components
forge test --match-contract MockOracleTest
forge test --match-contract AegisSentinelTest
forge test --match-contract AegisHookTest
```

### Testnet DeploymentLink copied!

Follow deployment sequence in order:

1. Deploy Oracle (Sepolia L1)

```
forge script script/04_DeployOracle.s.sol --rpc-url sepolia --broadcast
```
2. Deploy Sentinel (Reactive Network)

```
forge script script/05_DeploySentinel.s.sol --rpc-url reactive --broadcast
```
3. Deploy Hook (Unichain L2)

```
forge script script/06_DeployHook.s.sol --rpc-url unichain --broadcast
```

### End-to-End VerificationLink copied!

After deployment, verify the complete flow:

1. Call `updatePrice()` on MockOracle with crash price (< 1500 ETH)
2. Monitor Sentinel logs for `react()` function execution
3. Verify Hook receives `setPanicMode(true)` call
4. Test swap on Uniswap v4 pool - should revert with `PoolPaused` error
5. Call `updatePrice()` with recovery price (> 1500 ETH)
6. Verify Hook receives `setPanicMode(false)` call
7. Test swap again - should succeed

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Communication ChannelsLink copied!

### Issue TrackerLink copied!

Use GitHub Issues for:

- Bug reports
- Feature requests
- Technical discussions
- Deployment questions

### Pull Request DiscussionsLink copied!

Use PR comment threads for:

- Code review feedback
- Implementation alternatives
- Test coverage discussions

### Commit MessagesLink copied!

Use Git commit messages for:

- Explaining "why" behind changes
- Linking to related issues
- Documenting breaking changes

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#39-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L39-L47)

---

## Dependency ManagementLink copied!

Aegis uses git submodules for dependency management. When adding or updating dependencies:

### Adding a New DependencyLink copied!

```
forge install <org>/<repo>
```

This updates [.gitmodules](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.gitmodules) and [contracts/lib/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/) directory.

### Updating Existing DependenciesLink copied!

```
forge update <dependency-name>
```

Update specific dependencies:

- `forge-std` - Testing and scripting utilities
- `uniswap-hooks` - Uniswap v4 hook interfaces
- `system-smart-contracts` - Reactive Network base contracts

### Dependency ConsiderationsLink copied!

When proposing dependency changes:

1. Justify the need for the new dependency
2. Verify license compatibility
3. Check for security audits
4. Assess maintenance status of upstream repository
5. Consider impact on compilation time and contract size

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L101)

---

## Release ProcessLink copied!

Releases are tagged when significant milestones are reached:

Release TypeVersion BumpExampleMajorBreaking changes to contract interfaces1.0.0 → 2.0.0MinorNew features without breaking changes1.0.0 → 1.1.0PatchBug fixes and optimizations1.0.0 → 1.0.1

### Pre-Release ChecklistLink copied!

Before tagging a release:

1. Update deployment addresses in [README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md)
2. Run full test suite: `forge test`
3. Verify testnet deployments are functional
4. Update documentation for new features
5. Review broadcast logs in [broadcast/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/) for accuracy

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#180-187](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L180-L187)

---

## Special ConsiderationsLink copied!

### Uniswap v4 Hook CompatibilityLink copied!

Changes to [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol) must maintain compatibility with:

- `IHooks` interface from `v4-core/src/interfaces/IHooks.sol`
- Hook flag requirements (beforeSwap enabled)
- PoolManager callback expectations

Verify hook compatibility by checking:

```
forge test --match-contract AegisHookTest
```

### Reactive Network ConstraintsLink copied!

Changes to [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) must:

- Inherit from `AbstractReactive` contract
- Implement `react()` function for event handling
- Use correct cross-chain RPC methods from `IReactive`
- Handle event subscription properly in constructor

### Guardian Registry StandardsLink copied!

Changes to [src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol) must:

- Maintain ERC-721 compliance
- Preserve ERC-8004 reputation interface
- Ensure non-transferability during active interventions
- Update reputation atomically to prevent race conditions

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#102-114](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L102-L114)

---

## Getting HelpLink copied!

If you encounter issues during contribution:

1. Search existing issues: Your question may already be answered
2. Review documentation: Check [Getting Started](#1.1) and [Development Guide](#4)
3. Open a discussion: Use GitHub Discussions for general questions
4. Open an issue: For bugs or feature requests, create a detailed issue

When asking for help, include:

- Steps you've already tried
- Full error messages or logs
- Output of `forge --version`
- Network(s) affected (if applicable)
- Relevant contract addresses (if deployed)

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#39-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L39-L47)

---

# Contributing-6

# ContributingLink copied!
Relevant source files
- [contracts/lib/forge-std/CONTRIBUTING.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md)

This document provides guidelines for contributing to the Aegis cross-chain circuit breaker system. It covers the development workflow, pull request process, code standards, and testing requirements for the project.

For information about initial environment setup, see [Environment Setup](#4.1). For details on building and testing the codebase, see [Building and Testing](#4.2). For code formatting and development conventions, see [Code Standards](#4.4).

---

## Purpose and ScopeLink copied!

The Aegis project welcomes contributions from developers interested in improving cross-chain DeFi security infrastructure. This guide outlines the processes for submitting bug reports, feature requests, and code changes. It applies to contributions to the smart contracts in [src/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/) deployment scripts in [script/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/) test suites in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) and supporting infrastructure in [relayer/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/relayer/)

---

## Code of ConductLink copied!

Contributors to the Aegis project are expected to adhere to professional standards of conduct when interacting with the community. All interactions should be respectful and constructive, focused on improving the codebase and advancing the project's technical goals.

Violations can be reported to the project maintainers through GitHub issue tracker or direct communication.

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#12-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L12-L16)

---

## Ways to ContributeLink copied!

There are four primary ways to contribute to Aegis:

### 1. Opening IssuesLink copied!

Submit bug reports or feature requests through the GitHub issue tracker. Include:

- Aegis version and commit hash
- Network(s) affected (Sepolia, Reactive Network, Unichain)
- Contract addresses if applicable
- Concrete steps to reproduce the issue
- Expected vs. actual behavior

### 2. Adding ContextLink copied!

Enhance existing issues by providing:

- Transaction hashes demonstrating the problem
- Logs from `forge test` or deployment scripts
- Screenshots of cross-chain behavior
- Analysis of gas consumption or latency

### 3. Resolving IssuesLink copied!

Submit pull requests that:

- Fix bugs in contracts ([src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol)[src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol)[src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol)[src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol))
- Improve deployment scripts ([script/04_DeployOracle.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/04_DeployOracle.s.sol)[script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol)[script/06_DeployHook.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/06_DeployHook.s.sol))
- Enhance test coverage in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/)
- Update documentation

### 4. Code ReviewLink copied!

Review pull requests by:

- Testing changes locally using `forge test`
- Verifying cross-chain behavior on testnets
- Checking for gas optimizations
- Ensuring compatibility with Uniswap v4 hook interface

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#18-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L18-L32)

---

## Development WorkflowLink copied!

The following diagram illustrates the complete contribution workflow from fork to merge, referencing specific files and commands used in the process.

### Contribution Workflow DiagramLink copied!

#mermaid-pdit5v2rjt{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-pdit5v2rjt .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-pdit5v2rjt .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-pdit5v2rjt .error-icon{fill:#a44141;}#mermaid-pdit5v2rjt .error-text{fill:#ddd;stroke:#ddd;}#mermaid-pdit5v2rjt .edge-thickness-normal{stroke-width:1px;}#mermaid-pdit5v2rjt .edge-thickness-thick{stroke-width:3.5px;}#mermaid-pdit5v2rjt .edge-pattern-solid{stroke-dasharray:0;}#mermaid-pdit5v2rjt .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-pdit5v2rjt .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-pdit5v2rjt .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-pdit5v2rjt .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-pdit5v2rjt .marker.cross{stroke:lightgrey;}#mermaid-pdit5v2rjt svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-pdit5v2rjt p{margin:0;}#mermaid-pdit5v2rjt .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-pdit5v2rjt .cluster-label text{fill:#F9FFFE;}#mermaid-pdit5v2rjt .cluster-label span{color:#F9FFFE;}#mermaid-pdit5v2rjt .cluster-label span p{background-color:transparent;}#mermaid-pdit5v2rjt .label text,#mermaid-pdit5v2rjt span{fill:#ccc;color:#ccc;}#mermaid-pdit5v2rjt .node rect,#mermaid-pdit5v2rjt .node circle,#mermaid-pdit5v2rjt .node ellipse,#mermaid-pdit5v2rjt .node polygon,#mermaid-pdit5v2rjt .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-pdit5v2rjt .rough-node .label text,#mermaid-pdit5v2rjt .node .label text,#mermaid-pdit5v2rjt .image-shape .label,#mermaid-pdit5v2rjt .icon-shape .label{text-anchor:middle;}#mermaid-pdit5v2rjt .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-pdit5v2rjt .rough-node .label,#mermaid-pdit5v2rjt .node .label,#mermaid-pdit5v2rjt .image-shape .label,#mermaid-pdit5v2rjt .icon-shape .label{text-align:center;}#mermaid-pdit5v2rjt .node.clickable{cursor:pointer;}#mermaid-pdit5v2rjt .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-pdit5v2rjt .arrowheadPath{fill:lightgrey;}#mermaid-pdit5v2rjt .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-pdit5v2rjt .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-pdit5v2rjt .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-pdit5v2rjt .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-pdit5v2rjt .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-pdit5v2rjt .cluster text{fill:#F9FFFE;}#mermaid-pdit5v2rjt .cluster span{color:#F9FFFE;}#mermaid-pdit5v2rjt div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-pdit5v2rjt .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-pdit5v2rjt rect.text{fill:none;stroke-width:0;}#mermaid-pdit5v2rjt .icon-shape,#mermaid-pdit5v2rjt .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-pdit5v2rjt .icon-shape p,#mermaid-pdit5v2rjt .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-pdit5v2rjt .icon-shape rect,#mermaid-pdit5v2rjt .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-pdit5v2rjt .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-pdit5v2rjt :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Changes requested

Approved

Fail

Pass

Fork github.com/HACK3R-CRYPTO/Aegis

git clone <your-fork>

forge install Install dependencies

git checkout -b feature/your-change

Modify source files: src/*.sol script/*.s.sol test/*.t.sol

forge fmt Format code

forge build Compile contracts

forge test -vvv Run test suite

git commit -m 'description'

git push origin feature/your-change

Open Pull Request on GitHub

Code Review Process

Address feedback: git commit --amend or new commits

CI Checks Pass?

Merged by maintainer

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#77-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L77-L101)[contracts/lib/forge-std/CONTRIBUTING.md#116-134](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L116-L134)

---

## Pre-Submission ChecklistLink copied!

Before submitting a pull request, ensure the following commands pass:

### Code FormattingLink copied!

```
forge fmt --check
```

All Solidity files must conform to the project's formatting standards as defined in [foundry.toml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml) The formatter enforces consistent line length, indentation, and spacing.

### CompilationLink copied!

```
forge build
```

All contracts must compile without errors. The build process includes:

- [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol) - Uniswap v4 hook implementation
- [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) - Reactive Network contract
- [src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol) - L1 price oracle
- [src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol) - ERC-721/ERC-8004 registry

### Test ExecutionLink copied!

```
forge test -vvv
```

All existing tests in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) must pass. Tests verify:

- Hook panic mode activation/deactivation
- Cross-chain message handling
- Guardian reputation mechanics
- VIP lane fee calculations

### Solidity Version CompatibilityLink copied!

If modifying core contracts, verify compatibility across Solidity versions:

```
forge build --skip test --use solc:0.8.0
forge build --skip test --use solc:0.8.20
```

The project primarily targets Solidity 0.8.24 but should maintain backward compatibility where possible.

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-100](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L100)

---

## Pull Request ProcessLink copied!

The pull request lifecycle involves several stages from opening to merge. The following diagram shows the detailed review and merge process with specific file artifacts.

### Pull Request Review PipelineLink copied!

#mermaid-87ombf2dott{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-87ombf2dott .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-87ombf2dott .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-87ombf2dott .error-icon{fill:#a44141;}#mermaid-87ombf2dott .error-text{fill:#ddd;stroke:#ddd;}#mermaid-87ombf2dott .edge-thickness-normal{stroke-width:1px;}#mermaid-87ombf2dott .edge-thickness-thick{stroke-width:3.5px;}#mermaid-87ombf2dott .edge-pattern-solid{stroke-dasharray:0;}#mermaid-87ombf2dott .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-87ombf2dott .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-87ombf2dott .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-87ombf2dott .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-87ombf2dott .marker.cross{stroke:lightgrey;}#mermaid-87ombf2dott svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-87ombf2dott p{margin:0;}#mermaid-87ombf2dott .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-87ombf2dott .cluster-label text{fill:#F9FFFE;}#mermaid-87ombf2dott .cluster-label span{color:#F9FFFE;}#mermaid-87ombf2dott .cluster-label span p{background-color:transparent;}#mermaid-87ombf2dott .label text,#mermaid-87ombf2dott span{fill:#ccc;color:#ccc;}#mermaid-87ombf2dott .node rect,#mermaid-87ombf2dott .node circle,#mermaid-87ombf2dott .node ellipse,#mermaid-87ombf2dott .node polygon,#mermaid-87ombf2dott .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-87ombf2dott .rough-node .label text,#mermaid-87ombf2dott .node .label text,#mermaid-87ombf2dott .image-shape .label,#mermaid-87ombf2dott .icon-shape .label{text-anchor:middle;}#mermaid-87ombf2dott .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-87ombf2dott .rough-node .label,#mermaid-87ombf2dott .node .label,#mermaid-87ombf2dott .image-shape .label,#mermaid-87ombf2dott .icon-shape .label{text-align:center;}#mermaid-87ombf2dott .node.clickable{cursor:pointer;}#mermaid-87ombf2dott .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-87ombf2dott .arrowheadPath{fill:lightgrey;}#mermaid-87ombf2dott .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-87ombf2dott .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-87ombf2dott .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-87ombf2dott .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-87ombf2dott .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-87ombf2dott .cluster text{fill:#F9FFFE;}#mermaid-87ombf2dott .cluster span{color:#F9FFFE;}#mermaid-87ombf2dott div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-87ombf2dott .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-87ombf2dott rect.text{fill:none;stroke-width:0;}#mermaid-87ombf2dott .icon-shape,#mermaid-87ombf2dott .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-87ombf2dott .icon-shape p,#mermaid-87ombf2dott .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-87ombf2dott .icon-shape rect,#mermaid-87ombf2dott .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-87ombf2dott .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-87ombf2dott :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Merge

Verification

Manual Review

Automated Checks

Submission

Open PR with description

Fill PR template: - What changed - Why changed - How tested

GitHub Actions: forge fmt --check

GitHub Actions: forge build

GitHub Actions: forge test

Review code changes: src/*.sol test/*.t.sol

Verify test coverage: new tests added?

Check docs: comments updated?

Reviewer runs: forge test locally

Deploy to testnet: using script/*.s.sol

Test cross-chain flow: Oracle → Sentinel → Hook

Maintainer approval

Squash and merge to main branch

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#122-134](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L122-L134)[contracts/lib/forge-std/CONTRIBUTING.md#135-174](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L135-L174)

---

## Code StandardsLink copied!

### Solidity ConventionsLink copied!

All Solidity code must adhere to the following standards:

StandardRequirementExampleContract namingPascalCase`AegisHook`, `AegisSentinel`Function namingcamelCase`setPanicMode()`, `beforeSwap()`Variable namingcamelCase with underscore prefix for private`_panicMode`, `hookRegistry`Event namingPascalCase`PanicModeChanged`, `PriceUpdate`Error namingPascalCase`PoolPaused`, `UnauthorizedCaller`Constant namingUPPER_SNAKE_CASE`CRASH_THRESHOLD`, `VIP_FEE`

### Documentation RequirementsLink copied!

All public functions must include NatSpec comments:

```
/// @notice Sets the panic mode state for the hook
/// @dev Only callable by the AegisSentinel on Reactive Network
/// @param isPanic True to activate circuit breaker, false to deactivate
function setPanicMode(bool isPanic) external;
```

### File OrganizationLink copied!

Files should follow this structure:

1. SPDX license identifier
2. Pragma statement
3. Import statements (external libraries first, then local imports)
4. Contract declaration
5. State variables
6. Events
7. Errors
8. Modifiers
9. Constructor
10. External functions
11. Public functions
12. Internal functions
13. Private functions

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Testing RequirementsLink copied!

### Test StructureLink copied!

Tests must be organized in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) with the following naming convention:

Test TypeFile PatternExampleUnit tests`{Contract}.t.sol``AegisHook.t.sol`Integration tests`{Feature}Integration.t.sol``CrossChainIntegration.t.sol`Deployment tests`Deploy{Contract}.t.sol``DeployAegisHook.t.sol`

### Test Coverage RequirementsLink copied!

New features require:

1. Unit Tests: Test individual functions in isolation

- Happy path scenarios
- Edge cases (zero values, maximum values)
- Revert conditions
2. Integration Tests: Test cross-contract interactions

- Oracle → Sentinel message flow
- Sentinel → Hook panic mode activation
- Hook → Registry reputation updates
3. Invariant Tests: Test system-wide properties

- Panic mode can only be set by authorized sentinel
- VIP lane only accessible with reputation > 90
- Guardian NFTs are non-transferable during active interventions

### Running Specific Test SuitesLink copied!

```
# Run all tests
forge test
 
# Run specific contract tests
forge test --match-contract AegisHookTest
 
# Run specific test function
forge test --match-test testSetPanicMode
 
# Run with verbose output
forge test -vvv
 
# Run with gas reporting
forge test --gas-report
```

### Test UtilitiesLink copied!

Tests leverage [forge-std](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/forge-std) utilities:

- `vm.prank(address)` - Simulate calls from specific addresses
- `vm.expectRevert(bytes4)` - Assert function reverts with error
- `vm.expectEmit()` - Assert events are emitted correctly
- `vm.warp(uint256)` - Manipulate block timestamp
- `vm.roll(uint256)` - Manipulate block number

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Deployment Script StandardsLink copied!

When modifying deployment scripts in [script/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/) ensure:

1. Idempotency: Scripts should be runnable multiple times without errors
2. Verification: Include contract verification steps
3. Logging: Output deployed addresses to console and broadcast logs
4. Error Handling: Check for deployment failures and provide clear error messages

Deployment scripts follow this naming pattern:

- [script/04_DeployOracle.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/04_DeployOracle.s.sol) - Deploy MockOracle to Sepolia
- [script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol) - Deploy AegisSentinel to Reactive Network
- [script/06_DeployHook.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/06_DeployHook.s.sol) - Deploy AegisHook to Unichain

Each script must:

- Inherit from `forge-std/Script.sol`
- Implement `run()` function as entry point
- Use `vm.broadcast()` to sign transactions
- Store deployment artifacts in [broadcast/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/) directory

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#77-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L77-L101)

---

## Commit GuidelinesLink copied!

### Commit Message FormatLink copied!

Commits should follow this structure:

```
<type>(<scope>): <subject>
 
<body>
 
<footer>
```

Types:

- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation changes
- `test`: Test additions or modifications
- `refactor`: Code refactoring without behavior change
- `chore`: Build process or auxiliary tool changes

Examples:

```
feat(hook): add VIP lane bypass for high-reputation guardians
 
Implements the VIP lane mechanism that allows guardians with
reputation > 90 to bypass panic mode restrictions with reduced
fees (0.01% instead of 0.30%).
 
Refs: #42
```

```
fix(sentinel): correct price threshold comparison logic
 
The sentinel was using >= instead of > when comparing prices
against CRASH_THRESHOLD, causing false positives at exactly
1500 ETH. Updated to use strict greater-than comparison.
 
Fixes: #58
```

### Commit GranularityLink copied!

Commits should be logically grouped:

- Each commit should represent a single logical change
- Avoid "WIP" or "checkpoint" commits in final PR
- Squash fixup commits before requesting review
- Use `git commit --amend` for small corrections

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#116-121](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L116-L121)

---

## Review ProcessLink copied!

### For ContributorsLink copied!

When your PR is under review:

1. Respond Promptly: Address reviewer feedback within 48 hours when possible
2. Explain Decisions: If disagreeing with feedback, provide technical rationale
3. Update Documentation: Keep PR description current as code evolves
4. Test Changes: Re-run test suite after addressing feedback

### For ReviewersLink copied!

When reviewing PRs:

1. Review Incrementally: Focus on high-level concerns before nits
2. Test Locally: Clone branch and run `forge test` to verify claims
3. Check Cross-Chain Behavior: For changes affecting cross-chain flow, test on testnets
4. Distinguish Blocking vs. Non-Blocking: Clearly mark suggestions as "nit" if non-critical

Priority review checklist:

PriorityQuestionHighDoes this improve security of the circuit breaker mechanism?HighDoes this maintain compatibility with Uniswap v4 hook interface?HighDoes this preserve cross-chain message integrity?MediumAre tests comprehensive and passing?MediumIs gas consumption reasonable?LowAre variable names clear?LowAre comments accurate?

### Abandoned PRsLink copied!

If a PR has no activity for 30 days:

1. Maintainer will comment asking for status
2. After 14 additional days, PR may be closed with "stale" label
3. Contributor can reopen by commenting when ready to resume

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#135-176](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L135-L176)

---

## Cross-Chain Testing ProtocolLink copied!

Changes affecting cross-chain interactions require specific testing:

### Local TestingLink copied!

```
# Test individual components
forge test --match-contract MockOracleTest
forge test --match-contract AegisSentinelTest
forge test --match-contract AegisHookTest
```

### Testnet DeploymentLink copied!

Follow deployment sequence in order:

1. Deploy Oracle (Sepolia L1)

```
forge script script/04_DeployOracle.s.sol --rpc-url sepolia --broadcast
```
2. Deploy Sentinel (Reactive Network)

```
forge script script/05_DeploySentinel.s.sol --rpc-url reactive --broadcast
```
3. Deploy Hook (Unichain L2)

```
forge script script/06_DeployHook.s.sol --rpc-url unichain --broadcast
```

### End-to-End VerificationLink copied!

After deployment, verify the complete flow:

1. Call `updatePrice()` on MockOracle with crash price (< 1500 ETH)
2. Monitor Sentinel logs for `react()` function execution
3. Verify Hook receives `setPanicMode(true)` call
4. Test swap on Uniswap v4 pool - should revert with `PoolPaused` error
5. Call `updatePrice()` with recovery price (> 1500 ETH)
6. Verify Hook receives `setPanicMode(false)` call
7. Test swap again - should succeed

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Communication ChannelsLink copied!

### Issue TrackerLink copied!

Use GitHub Issues for:

- Bug reports
- Feature requests
- Technical discussions
- Deployment questions

### Pull Request DiscussionsLink copied!

Use PR comment threads for:

- Code review feedback
- Implementation alternatives
- Test coverage discussions

### Commit MessagesLink copied!

Use Git commit messages for:

- Explaining "why" behind changes
- Linking to related issues
- Documenting breaking changes

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#39-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L39-L47)

---

## Dependency ManagementLink copied!

Aegis uses git submodules for dependency management. When adding or updating dependencies:

### Adding a New DependencyLink copied!

```
forge install <org>/<repo>
```

This updates [.gitmodules](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.gitmodules) and [contracts/lib/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/) directory.

### Updating Existing DependenciesLink copied!

```
forge update <dependency-name>
```

Update specific dependencies:

- `forge-std` - Testing and scripting utilities
- `uniswap-hooks` - Uniswap v4 hook interfaces
- `system-smart-contracts` - Reactive Network base contracts

### Dependency ConsiderationsLink copied!

When proposing dependency changes:

1. Justify the need for the new dependency
2. Verify license compatibility
3. Check for security audits
4. Assess maintenance status of upstream repository
5. Consider impact on compilation time and contract size

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L101)

---

## Release ProcessLink copied!

Releases are tagged when significant milestones are reached:

Release TypeVersion BumpExampleMajorBreaking changes to contract interfaces1.0.0 → 2.0.0MinorNew features without breaking changes1.0.0 → 1.1.0PatchBug fixes and optimizations1.0.0 → 1.0.1

### Pre-Release ChecklistLink copied!

Before tagging a release:

1. Update deployment addresses in [README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md)
2. Run full test suite: `forge test`
3. Verify testnet deployments are functional
4. Update documentation for new features
5. Review broadcast logs in [broadcast/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/) for accuracy

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#180-187](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L180-L187)

---

## Special ConsiderationsLink copied!

### Uniswap v4 Hook CompatibilityLink copied!

Changes to [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol) must maintain compatibility with:

- `IHooks` interface from `v4-core/src/interfaces/IHooks.sol`
- Hook flag requirements (beforeSwap enabled)
- PoolManager callback expectations

Verify hook compatibility by checking:

```
forge test --match-contract AegisHookTest
```

### Reactive Network ConstraintsLink copied!

Changes to [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) must:

- Inherit from `AbstractReactive` contract
- Implement `react()` function for event handling
- Use correct cross-chain RPC methods from `IReactive`
- Handle event subscription properly in constructor

### Guardian Registry StandardsLink copied!

Changes to [src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol) must:

- Maintain ERC-721 compliance
- Preserve ERC-8004 reputation interface
- Ensure non-transferability during active interventions
- Update reputation atomically to prevent race conditions

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#102-114](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L102-L114)

---

## Getting HelpLink copied!

If you encounter issues during contribution:

1. Search existing issues: Your question may already be answered
2. Review documentation: Check [Getting Started](#1.1) and [Development Guide](#4)
3. Open a discussion: Use GitHub Discussions for general questions
4. Open an issue: For bugs or feature requests, create a detailed issue

When asking for help, include:

- Steps you've already tried
- Full error messages or logs
- Output of `forge --version`
- Network(s) affected (if applicable)
- Relevant contract addresses (if deployed)

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#39-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L39-L47)

---

# Contributing-7

# ContributingLink copied!
Relevant source files
- [contracts/lib/forge-std/CONTRIBUTING.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md)

This document provides guidelines for contributing to the Aegis cross-chain circuit breaker system. It covers the development workflow, pull request process, code standards, and testing requirements for the project.

For information about initial environment setup, see [Environment Setup](#4.1). For details on building and testing the codebase, see [Building and Testing](#4.2). For code formatting and development conventions, see [Code Standards](#4.4).

---

## Purpose and ScopeLink copied!

The Aegis project welcomes contributions from developers interested in improving cross-chain DeFi security infrastructure. This guide outlines the processes for submitting bug reports, feature requests, and code changes. It applies to contributions to the smart contracts in [src/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/) deployment scripts in [script/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/) test suites in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) and supporting infrastructure in [relayer/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/relayer/)

---

## Code of ConductLink copied!

Contributors to the Aegis project are expected to adhere to professional standards of conduct when interacting with the community. All interactions should be respectful and constructive, focused on improving the codebase and advancing the project's technical goals.

Violations can be reported to the project maintainers through GitHub issue tracker or direct communication.

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#12-16](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L12-L16)

---

## Ways to ContributeLink copied!

There are four primary ways to contribute to Aegis:

### 1. Opening IssuesLink copied!

Submit bug reports or feature requests through the GitHub issue tracker. Include:

- Aegis version and commit hash
- Network(s) affected (Sepolia, Reactive Network, Unichain)
- Contract addresses if applicable
- Concrete steps to reproduce the issue
- Expected vs. actual behavior

### 2. Adding ContextLink copied!

Enhance existing issues by providing:

- Transaction hashes demonstrating the problem
- Logs from `forge test` or deployment scripts
- Screenshots of cross-chain behavior
- Analysis of gas consumption or latency

### 3. Resolving IssuesLink copied!

Submit pull requests that:

- Fix bugs in contracts ([src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol)[src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol)[src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol)[src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol))
- Improve deployment scripts ([script/04_DeployOracle.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/04_DeployOracle.s.sol)[script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol)[script/06_DeployHook.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/06_DeployHook.s.sol))
- Enhance test coverage in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/)
- Update documentation

### 4. Code ReviewLink copied!

Review pull requests by:

- Testing changes locally using `forge test`
- Verifying cross-chain behavior on testnets
- Checking for gas optimizations
- Ensuring compatibility with Uniswap v4 hook interface

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#18-32](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L18-L32)

---

## Development WorkflowLink copied!

The following diagram illustrates the complete contribution workflow from fork to merge, referencing specific files and commands used in the process.

### Contribution Workflow DiagramLink copied!

#mermaid-pdit5v2rjt{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-pdit5v2rjt .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-pdit5v2rjt .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-pdit5v2rjt .error-icon{fill:#a44141;}#mermaid-pdit5v2rjt .error-text{fill:#ddd;stroke:#ddd;}#mermaid-pdit5v2rjt .edge-thickness-normal{stroke-width:1px;}#mermaid-pdit5v2rjt .edge-thickness-thick{stroke-width:3.5px;}#mermaid-pdit5v2rjt .edge-pattern-solid{stroke-dasharray:0;}#mermaid-pdit5v2rjt .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-pdit5v2rjt .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-pdit5v2rjt .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-pdit5v2rjt .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-pdit5v2rjt .marker.cross{stroke:lightgrey;}#mermaid-pdit5v2rjt svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-pdit5v2rjt p{margin:0;}#mermaid-pdit5v2rjt .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-pdit5v2rjt .cluster-label text{fill:#F9FFFE;}#mermaid-pdit5v2rjt .cluster-label span{color:#F9FFFE;}#mermaid-pdit5v2rjt .cluster-label span p{background-color:transparent;}#mermaid-pdit5v2rjt .label text,#mermaid-pdit5v2rjt span{fill:#ccc;color:#ccc;}#mermaid-pdit5v2rjt .node rect,#mermaid-pdit5v2rjt .node circle,#mermaid-pdit5v2rjt .node ellipse,#mermaid-pdit5v2rjt .node polygon,#mermaid-pdit5v2rjt .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-pdit5v2rjt .rough-node .label text,#mermaid-pdit5v2rjt .node .label text,#mermaid-pdit5v2rjt .image-shape .label,#mermaid-pdit5v2rjt .icon-shape .label{text-anchor:middle;}#mermaid-pdit5v2rjt .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-pdit5v2rjt .rough-node .label,#mermaid-pdit5v2rjt .node .label,#mermaid-pdit5v2rjt .image-shape .label,#mermaid-pdit5v2rjt .icon-shape .label{text-align:center;}#mermaid-pdit5v2rjt .node.clickable{cursor:pointer;}#mermaid-pdit5v2rjt .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-pdit5v2rjt .arrowheadPath{fill:lightgrey;}#mermaid-pdit5v2rjt .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-pdit5v2rjt .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-pdit5v2rjt .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-pdit5v2rjt .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-pdit5v2rjt .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-pdit5v2rjt .cluster text{fill:#F9FFFE;}#mermaid-pdit5v2rjt .cluster span{color:#F9FFFE;}#mermaid-pdit5v2rjt div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-pdit5v2rjt .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-pdit5v2rjt rect.text{fill:none;stroke-width:0;}#mermaid-pdit5v2rjt .icon-shape,#mermaid-pdit5v2rjt .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-pdit5v2rjt .icon-shape p,#mermaid-pdit5v2rjt .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-pdit5v2rjt .icon-shape rect,#mermaid-pdit5v2rjt .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-pdit5v2rjt .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-pdit5v2rjt .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-pdit5v2rjt :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Changes requested

Approved

Fail

Pass

Fork github.com/HACK3R-CRYPTO/Aegis

git clone <your-fork>

forge install Install dependencies

git checkout -b feature/your-change

Modify source files: src/*.sol script/*.s.sol test/*.t.sol

forge fmt Format code

forge build Compile contracts

forge test -vvv Run test suite

git commit -m 'description'

git push origin feature/your-change

Open Pull Request on GitHub

Code Review Process

Address feedback: git commit --amend or new commits

CI Checks Pass?

Merged by maintainer

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#77-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L77-L101)[contracts/lib/forge-std/CONTRIBUTING.md#116-134](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L116-L134)

---

## Pre-Submission ChecklistLink copied!

Before submitting a pull request, ensure the following commands pass:

### Code FormattingLink copied!

```
forge fmt --check
```

All Solidity files must conform to the project's formatting standards as defined in [foundry.toml](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/foundry.toml) The formatter enforces consistent line length, indentation, and spacing.

### CompilationLink copied!

```
forge build
```

All contracts must compile without errors. The build process includes:

- [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol) - Uniswap v4 hook implementation
- [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) - Reactive Network contract
- [src/MockOracle.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/MockOracle.sol) - L1 price oracle
- [src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol) - ERC-721/ERC-8004 registry

### Test ExecutionLink copied!

```
forge test -vvv
```

All existing tests in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) must pass. Tests verify:

- Hook panic mode activation/deactivation
- Cross-chain message handling
- Guardian reputation mechanics
- VIP lane fee calculations

### Solidity Version CompatibilityLink copied!

If modifying core contracts, verify compatibility across Solidity versions:

```
forge build --skip test --use solc:0.8.0
forge build --skip test --use solc:0.8.20
```

The project primarily targets Solidity 0.8.24 but should maintain backward compatibility where possible.

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-100](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L100)

---

## Pull Request ProcessLink copied!

The pull request lifecycle involves several stages from opening to merge. The following diagram shows the detailed review and merge process with specific file artifacts.

### Pull Request Review PipelineLink copied!

#mermaid-87ombf2dott{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-87ombf2dott .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-87ombf2dott .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-87ombf2dott .error-icon{fill:#a44141;}#mermaid-87ombf2dott .error-text{fill:#ddd;stroke:#ddd;}#mermaid-87ombf2dott .edge-thickness-normal{stroke-width:1px;}#mermaid-87ombf2dott .edge-thickness-thick{stroke-width:3.5px;}#mermaid-87ombf2dott .edge-pattern-solid{stroke-dasharray:0;}#mermaid-87ombf2dott .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-87ombf2dott .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-87ombf2dott .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-87ombf2dott .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-87ombf2dott .marker.cross{stroke:lightgrey;}#mermaid-87ombf2dott svg{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:16px;}#mermaid-87ombf2dott p{margin:0;}#mermaid-87ombf2dott .label{font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;color:#ccc;}#mermaid-87ombf2dott .cluster-label text{fill:#F9FFFE;}#mermaid-87ombf2dott .cluster-label span{color:#F9FFFE;}#mermaid-87ombf2dott .cluster-label span p{background-color:transparent;}#mermaid-87ombf2dott .label text,#mermaid-87ombf2dott span{fill:#ccc;color:#ccc;}#mermaid-87ombf2dott .node rect,#mermaid-87ombf2dott .node circle,#mermaid-87ombf2dott .node ellipse,#mermaid-87ombf2dott .node polygon,#mermaid-87ombf2dott .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-87ombf2dott .rough-node .label text,#mermaid-87ombf2dott .node .label text,#mermaid-87ombf2dott .image-shape .label,#mermaid-87ombf2dott .icon-shape .label{text-anchor:middle;}#mermaid-87ombf2dott .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-87ombf2dott .rough-node .label,#mermaid-87ombf2dott .node .label,#mermaid-87ombf2dott .image-shape .label,#mermaid-87ombf2dott .icon-shape .label{text-align:center;}#mermaid-87ombf2dott .node.clickable{cursor:pointer;}#mermaid-87ombf2dott .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-87ombf2dott .arrowheadPath{fill:lightgrey;}#mermaid-87ombf2dott .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-87ombf2dott .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-87ombf2dott .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-87ombf2dott .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-87ombf2dott .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-87ombf2dott .cluster text{fill:#F9FFFE;}#mermaid-87ombf2dott .cluster span{color:#F9FFFE;}#mermaid-87ombf2dott div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-87ombf2dott .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-87ombf2dott rect.text{fill:none;stroke-width:0;}#mermaid-87ombf2dott .icon-shape,#mermaid-87ombf2dott .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-87ombf2dott .icon-shape p,#mermaid-87ombf2dott .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-87ombf2dott .icon-shape rect,#mermaid-87ombf2dott .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-87ombf2dott .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-87ombf2dott .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-87ombf2dott :root{--mermaid-font-family:ui-sans-serif,-apple-system,system-ui,Segoe UI,Helvetica;}

Merge

Verification

Manual Review

Automated Checks

Submission

Open PR with description

Fill PR template: - What changed - Why changed - How tested

GitHub Actions: forge fmt --check

GitHub Actions: forge build

GitHub Actions: forge test

Review code changes: src/*.sol test/*.t.sol

Verify test coverage: new tests added?

Check docs: comments updated?

Reviewer runs: forge test locally

Deploy to testnet: using script/*.s.sol

Test cross-chain flow: Oracle → Sentinel → Hook

Maintainer approval

Squash and merge to main branch

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#122-134](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L122-L134)[contracts/lib/forge-std/CONTRIBUTING.md#135-174](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L135-L174)

---

## Code StandardsLink copied!

### Solidity ConventionsLink copied!

All Solidity code must adhere to the following standards:

StandardRequirementExampleContract namingPascalCase`AegisHook`, `AegisSentinel`Function namingcamelCase`setPanicMode()`, `beforeSwap()`Variable namingcamelCase with underscore prefix for private`_panicMode`, `hookRegistry`Event namingPascalCase`PanicModeChanged`, `PriceUpdate`Error namingPascalCase`PoolPaused`, `UnauthorizedCaller`Constant namingUPPER_SNAKE_CASE`CRASH_THRESHOLD`, `VIP_FEE`

### Documentation RequirementsLink copied!

All public functions must include NatSpec comments:

```
/// @notice Sets the panic mode state for the hook
/// @dev Only callable by the AegisSentinel on Reactive Network
/// @param isPanic True to activate circuit breaker, false to deactivate
function setPanicMode(bool isPanic) external;
```

### File OrganizationLink copied!

Files should follow this structure:

1. SPDX license identifier
2. Pragma statement
3. Import statements (external libraries first, then local imports)
4. Contract declaration
5. State variables
6. Events
7. Errors
8. Modifiers
9. Constructor
10. External functions
11. Public functions
12. Internal functions
13. Private functions

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Testing RequirementsLink copied!

### Test StructureLink copied!

Tests must be organized in [test/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/test/) with the following naming convention:

Test TypeFile PatternExampleUnit tests`{Contract}.t.sol``AegisHook.t.sol`Integration tests`{Feature}Integration.t.sol``CrossChainIntegration.t.sol`Deployment tests`Deploy{Contract}.t.sol``DeployAegisHook.t.sol`

### Test Coverage RequirementsLink copied!

New features require:

1. Unit Tests: Test individual functions in isolation

- Happy path scenarios
- Edge cases (zero values, maximum values)
- Revert conditions
2. Integration Tests: Test cross-contract interactions

- Oracle → Sentinel message flow
- Sentinel → Hook panic mode activation
- Hook → Registry reputation updates
3. Invariant Tests: Test system-wide properties

- Panic mode can only be set by authorized sentinel
- VIP lane only accessible with reputation > 90
- Guardian NFTs are non-transferable during active interventions

### Running Specific Test SuitesLink copied!

```
# Run all tests
forge test
 
# Run specific contract tests
forge test --match-contract AegisHookTest
 
# Run specific test function
forge test --match-test testSetPanicMode
 
# Run with verbose output
forge test -vvv
 
# Run with gas reporting
forge test --gas-report
```

### Test UtilitiesLink copied!

Tests leverage [forge-std](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/forge-std) utilities:

- `vm.prank(address)` - Simulate calls from specific addresses
- `vm.expectRevert(bytes4)` - Assert function reverts with error
- `vm.expectEmit()` - Assert events are emitted correctly
- `vm.warp(uint256)` - Manipulate block timestamp
- `vm.roll(uint256)` - Manipulate block number

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Deployment Script StandardsLink copied!

When modifying deployment scripts in [script/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/) ensure:

1. Idempotency: Scripts should be runnable multiple times without errors
2. Verification: Include contract verification steps
3. Logging: Output deployed addresses to console and broadcast logs
4. Error Handling: Check for deployment failures and provide clear error messages

Deployment scripts follow this naming pattern:

- [script/04_DeployOracle.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/04_DeployOracle.s.sol) - Deploy MockOracle to Sepolia
- [script/05_DeploySentinel.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/05_DeploySentinel.s.sol) - Deploy AegisSentinel to Reactive Network
- [script/06_DeployHook.s.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/script/06_DeployHook.s.sol) - Deploy AegisHook to Unichain

Each script must:

- Inherit from `forge-std/Script.sol`
- Implement `run()` function as entry point
- Use `vm.broadcast()` to sign transactions
- Store deployment artifacts in [broadcast/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/) directory

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#77-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L77-L101)

---

## Commit GuidelinesLink copied!

### Commit Message FormatLink copied!

Commits should follow this structure:

```
<type>(<scope>): <subject>
 
<body>
 
<footer>
```

Types:

- `feat`: New feature
- `fix`: Bug fix
- `docs`: Documentation changes
- `test`: Test additions or modifications
- `refactor`: Code refactoring without behavior change
- `chore`: Build process or auxiliary tool changes

Examples:

```
feat(hook): add VIP lane bypass for high-reputation guardians
 
Implements the VIP lane mechanism that allows guardians with
reputation > 90 to bypass panic mode restrictions with reduced
fees (0.01% instead of 0.30%).
 
Refs: #42
```

```
fix(sentinel): correct price threshold comparison logic
 
The sentinel was using >= instead of > when comparing prices
against CRASH_THRESHOLD, causing false positives at exactly
1500 ETH. Updated to use strict greater-than comparison.
 
Fixes: #58
```

### Commit GranularityLink copied!

Commits should be logically grouped:

- Each commit should represent a single logical change
- Avoid "WIP" or "checkpoint" commits in final PR
- Squash fixup commits before requesting review
- Use `git commit --amend` for small corrections

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#116-121](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L116-L121)

---

## Review ProcessLink copied!

### For ContributorsLink copied!

When your PR is under review:

1. Respond Promptly: Address reviewer feedback within 48 hours when possible
2. Explain Decisions: If disagreeing with feedback, provide technical rationale
3. Update Documentation: Keep PR description current as code evolves
4. Test Changes: Re-run test suite after addressing feedback

### For ReviewersLink copied!

When reviewing PRs:

1. Review Incrementally: Focus on high-level concerns before nits
2. Test Locally: Clone branch and run `forge test` to verify claims
3. Check Cross-Chain Behavior: For changes affecting cross-chain flow, test on testnets
4. Distinguish Blocking vs. Non-Blocking: Clearly mark suggestions as "nit" if non-critical

Priority review checklist:

PriorityQuestionHighDoes this improve security of the circuit breaker mechanism?HighDoes this maintain compatibility with Uniswap v4 hook interface?HighDoes this preserve cross-chain message integrity?MediumAre tests comprehensive and passing?MediumIs gas consumption reasonable?LowAre variable names clear?LowAre comments accurate?

### Abandoned PRsLink copied!

If a PR has no activity for 30 days:

1. Maintainer will comment asking for status
2. After 14 additional days, PR may be closed with "stale" label
3. Contributor can reopen by commenting when ready to resume

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#135-176](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L135-L176)

---

## Cross-Chain Testing ProtocolLink copied!

Changes affecting cross-chain interactions require specific testing:

### Local TestingLink copied!

```
# Test individual components
forge test --match-contract MockOracleTest
forge test --match-contract AegisSentinelTest
forge test --match-contract AegisHookTest
```

### Testnet DeploymentLink copied!

Follow deployment sequence in order:

1. Deploy Oracle (Sepolia L1)

```
forge script script/04_DeployOracle.s.sol --rpc-url sepolia --broadcast
```
2. Deploy Sentinel (Reactive Network)

```
forge script script/05_DeploySentinel.s.sol --rpc-url reactive --broadcast
```
3. Deploy Hook (Unichain L2)

```
forge script script/06_DeployHook.s.sol --rpc-url unichain --broadcast
```

### End-to-End VerificationLink copied!

After deployment, verify the complete flow:

1. Call `updatePrice()` on MockOracle with crash price (< 1500 ETH)
2. Monitor Sentinel logs for `react()` function execution
3. Verify Hook receives `setPanicMode(true)` call
4. Test swap on Uniswap v4 pool - should revert with `PoolPaused` error
5. Call `updatePrice()` with recovery price (> 1500 ETH)
6. Verify Hook receives `setPanicMode(false)` call
7. Test swap again - should succeed

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-88](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L88)

---

## Communication ChannelsLink copied!

### Issue TrackerLink copied!

Use GitHub Issues for:

- Bug reports
- Feature requests
- Technical discussions
- Deployment questions

### Pull Request DiscussionsLink copied!

Use PR comment threads for:

- Code review feedback
- Implementation alternatives
- Test coverage discussions

### Commit MessagesLink copied!

Use Git commit messages for:

- Explaining "why" behind changes
- Linking to related issues
- Documenting breaking changes

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#39-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L39-L47)

---

## Dependency ManagementLink copied!

Aegis uses git submodules for dependency management. When adding or updating dependencies:

### Adding a New DependencyLink copied!

```
forge install <org>/<repo>
```

This updates [.gitmodules](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/.gitmodules) and [contracts/lib/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/) directory.

### Updating Existing DependenciesLink copied!

```
forge update <dependency-name>
```

Update specific dependencies:

- `forge-std` - Testing and scripting utilities
- `uniswap-hooks` - Uniswap v4 hook interfaces
- `system-smart-contracts` - Reactive Network base contracts

### Dependency ConsiderationsLink copied!

When proposing dependency changes:

1. Justify the need for the new dependency
2. Verify license compatibility
3. Check for security audits
4. Assess maintenance status of upstream repository
5. Consider impact on compilation time and contract size

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#83-101](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L83-L101)

---

## Release ProcessLink copied!

Releases are tagged when significant milestones are reached:

Release TypeVersion BumpExampleMajorBreaking changes to contract interfaces1.0.0 → 2.0.0MinorNew features without breaking changes1.0.0 → 1.1.0PatchBug fixes and optimizations1.0.0 → 1.0.1

### Pre-Release ChecklistLink copied!

Before tagging a release:

1. Update deployment addresses in [README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/README.md)
2. Run full test suite: `forge test`
3. Verify testnet deployments are functional
4. Update documentation for new features
5. Review broadcast logs in [broadcast/](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/broadcast/) for accuracy

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#180-187](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L180-L187)

---

## Special ConsiderationsLink copied!

### Uniswap v4 Hook CompatibilityLink copied!

Changes to [src/AegisHook.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisHook.sol) must maintain compatibility with:

- `IHooks` interface from `v4-core/src/interfaces/IHooks.sol`
- Hook flag requirements (beforeSwap enabled)
- PoolManager callback expectations

Verify hook compatibility by checking:

```
forge test --match-contract AegisHookTest
```

### Reactive Network ConstraintsLink copied!

Changes to [src/AegisSentinel.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisSentinel.sol) must:

- Inherit from `AbstractReactive` contract
- Implement `react()` function for event handling
- Use correct cross-chain RPC methods from `IReactive`
- Handle event subscription properly in constructor

### Guardian Registry StandardsLink copied!

Changes to [src/AegisGuardianRegistry.sol](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/src/AegisGuardianRegistry.sol) must:

- Maintain ERC-721 compliance
- Preserve ERC-8004 reputation interface
- Ensure non-transferability during active interventions
- Update reputation atomically to prevent race conditions

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#102-114](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L102-L114)

---

## Getting HelpLink copied!

If you encounter issues during contribution:

1. Search existing issues: Your question may already be answered
2. Review documentation: Check [Getting Started](#1.1) and [Development Guide](#4)
3. Open a discussion: Use GitHub Discussions for general questions
4. Open an issue: For bugs or feature requests, create a detailed issue

When asking for help, include:

- Steps you've already tried
- Full error messages or logs
- Output of `forge --version`
- Network(s) affected (if applicable)
- Relevant contract addresses (if deployed)

Sources:[contracts/lib/forge-std/CONTRIBUTING.md#39-47](https://github.com/HACK3R-CRYPTO/Aegis/blob/c53e82a7/contracts/lib/forge-std/CONTRIBUTING.md#L39-L47)