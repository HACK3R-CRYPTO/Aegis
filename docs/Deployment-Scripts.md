# Deployment Scripts
Relevant source files
- [contracts/README.md](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/README.md)
- [contracts/broadcast/04_DeployOracle.s.sol/11155111/run-1769586193733.json](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/broadcast/04_DeployOracle.s.sol/11155111/run-1769586193733.json)
- [contracts/broadcast/05_DeploySentinel.s.sol/5318007/run-1769588622425.json](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/broadcast/05_DeploySentinel.s.sol/5318007/run-1769588622425.json)
- [contracts/broadcast/06_DeployHook.s.sol/1301/run-1769587735298.json](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/broadcast/06_DeployHook.s.sol/1301/run-1769587735298.json)

This document describes the numbered deployment scripts used to deploy the Aegis system across three blockchain networks. These scripts handle the sequential deployment of contracts to Ethereum Sepolia (L1), Reactive Network, and Unichain Sepolia (L2), managing network-specific requirements and inter-contract dependencies.

For information about network configuration details (RPC endpoints, chain IDs), see [Network Configuration](/HACK3R-CRYPTO/Aegis/3.2-network-configuration). For details about the hook mining process required before deploying `AegisHook`, see [Hook Mining](/HACK3R-CRYPTO/Aegis/3.4-hook-mining). For understanding the broadcast JSON logs generated by these scripts, see [Deployment Logs](/HACK3R-CRYPTO/Aegis/3.3-deployment-logs).

## Overview

The Aegis deployment process consists of three Foundry scripts located in the `contracts/script/` directory. These scripts must be executed in numerical order to satisfy cross-chain address dependencies:
ScriptNetworkContractPurpose`04_DeployOracle.s.sol`Ethereum Sepolia (11155111)`MockOracle`Price feed simulator that emits events monitored by the Sentinel`05_DeploySentinel.s.sol`Reactive Network (5318007)`AegisSentinel`Autonomous watcher that triggers cross-chain panic mode`06_DeployHook.s.sol`Unichain Sepolia (1301)`AegisHook`Uniswap v4 hook implementing circuit breaker logic
Sources: [contracts/README.md96-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/README.md#L96-L122)

## Deployment Architecture

```
"Unichain Sepolia
(Chain 1301)"
"06_DeployHook"
"Reactive Network
(Chain 5318007)"
"05_DeploySentinel"
"Ethereum Sepolia
(Chain 11155111)"
"04_DeployOracle"
"Developer"
"Unichain Sepolia
(Chain 1301)"
"06_DeployHook"
"Reactive Network
(Chain 5318007)"
"05_DeploySentinel"
"Ethereum Sepolia
(Chain 11155111)"
"04_DeployOracle"
"Developer"
"Copy Oracle address for Sentinel constructor"
"Hook address must be pre-calculated via CREATE2"
"forge script ... --rpc-url sepolia"
"Deploy MockOracle"
"0x29f8...BA3b"
"broadcast/04_DeployOracle.s.sol/11155111/run-*.json"
"forge script ... --rpc-url reactive --legacy"
"Deploy AegisSentinel
(oracle=0x29f8...BA3b, hook=0xBaa0...C080)"
"0x0f76...b482"
"broadcast/05_DeploySentinel.s.sol/5318007/run-*.json"
"forge script ... --rpc-url unichain_sepolia"
"Deploy AegisHook via CREATE2
(poolManager, owner)"
"0xBaa0...C080"
"broadcast/06_DeployHook.s.sol/1301/run-*.json"
```

**Deployment Flow Diagram**: The sequential deployment process showing how addresses from earlier deployments are passed to later ones.

Sources: [contracts/README.md10-26](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/README.md#L10-L26)[contracts/README.md105-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/README.md#L105-L122)

## Script 1: 04_DeployOracle.s.sol

The first deployment script deploys `MockOracle` to Ethereum Sepolia. This contract simulates a Chainlink price feed for testing purposes.

### Execution Command

```
forge script script/04_DeployOracle.s.sol --rpc-url sepolia --broadcast
```

### Deployment Details

- **Network**: Ethereum Sepolia (chain ID: 11155111)
- **Transaction Type**: `CREATE` (standard deployment)
- **Contract**: `MockOracle`
- **Constructor Arguments**: None (price initialized to 8000 * 10^18 in constructor)
- **Deployed Address**: `0x29f8f8d2A00330F9683e73a926F61AE7E91cBA3b`

### Transaction Parameters

From the broadcast log [contracts/broadcast/04_DeployOracle.s.sol/11155111/run-1769586193733.json10-17](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/broadcast/04_DeployOracle.s.sol/11155111/run-1769586193733.json#L10-L17):

- **Gas Limit**: 0x41bce (269,262 gas)
- **Gas Used**: 0x32915 (206,101 gas)
- **Transaction Type**: 0x2 (EIP-1559)
- **Chain ID**: 0xaa36a7 (11155111 decimal)

Sources: [contracts/README.md107-110](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/README.md#L107-L110)[contracts/broadcast/04_DeployOracle.s.sol/11155111/run-1769586193733.json1-46](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/broadcast/04_DeployOracle.s.sol/11155111/run-1769586193733.json#L1-L46)

## Script 2: 05_DeploySentinel.s.sol

The second deployment script deploys `AegisSentinel` to the Reactive Network. This script requires the Oracle address from Script 1 and the pre-calculated Hook address (see [Hook Mining](/HACK3R-CRYPTO/Aegis/3.4-hook-mining)).

### Execution Command

```
forge script script/05_DeploySentinel.s.sol --rpc-url reactive --broadcast --legacy
```

### Network-Specific Requirements

The `--legacy` flag is required for Reactive Network deployment to ensure EIP-155 compatibility with the testnet infrastructure.

Sources: [contracts/README.md113-116](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/README.md#L113-L116)

### Constructor Arguments

From the broadcast log [contracts/broadcast/05_DeploySentinel.s.sol/5318007/run-1769588622425.json9-13](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/broadcast/05_DeploySentinel.s.sol/5318007/run-1769588622425.json#L9-L13):

```
0x0000000000000000000000000000000000fffFfF  // Reactive Network system contract
0xBaa0573e3BE4291b58083e717E9EF5051772C080  // AegisHook address (pre-calculated)
0x29f8f8d2A00330F9683e73a926F61AE7E91cBA3b  // MockOracle address (from Script 1)

```

### Deployment Details

- **Network**: Reactive Network Kopli (chain ID: 5318007)
- **Transaction Type**: `CREATE` (standard deployment)
- **Contract**: `AegisSentinel`
- **Deployed Address**: `0x0f764437ffBE1fcd0d0d276a164610422710B482`
- **Gas Used**: 0x10e4f0 (1,107,184 gas)

### Post-Deployment Step

After deployment, a manual subscription call is required to register the Sentinel to listen for `PriceUpdate` events from the Oracle on Sepolia. This step activates the cross-chain monitoring.

Sources: [contracts/README.md113-116](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/README.md#L113-L116)[contracts/broadcast/05_DeploySentinel.s.sol/5318007/run-1769588622425.json1-50](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/broadcast/05_DeploySentinel.s.sol/5318007/run-1769588622425.json#L1-L50)

## Script 3: 06_DeployHook.s.sol

The final deployment script deploys `AegisHook` to Unichain using CREATE2 deployment to ensure the contract address starts with `0x80`, which is required for the `BEFORE_SWAP` permission flag in Uniswap v4.

### Execution Command

```
forge script script/06_DeployHook.s.sol --rpc-url unichain_sepolia --broadcast
```

### Deployment Details

- **Network**: Unichain Sepolia (chain ID: 1301)
- **Transaction Type**: `CREATE2` (deterministic deployment)
- **Contract**: `AegisHook`
- **Deployed Address**: `0xBaa0573e3BE4291b58083e717E9EF5051772C080`
- **Deployed To**: `0x4e59b44847b379578588920ca78fbf26c0b4956c` (CREATE2 factory)

### CREATE2 Deployment

From the broadcast log [contracts/broadcast/06_DeployHook.s.sol/1301/run-1769587735298.json13-21](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/broadcast/06_DeployHook.s.sol/1301/run-1769587735298.json#L13-L21):

The deployment uses CREATE2 with a pre-calculated salt (from the HookMiner script) to deploy to the canonical CREATE2 factory at `0x4e59b44847b379578588920ca78fbf26c0b4956c`.

### Constructor Arguments

```
0x00B036B58a818B1BC34d502D3fE730Db729e62AC  // Unichain Pool Manager address
0xd2df53D9791e98Db221842Dd085F4144014BBE2a  // Owner address (deployer)

```

### Transaction Costs

The Unichain deployment includes L2-specific gas accounting [contracts/broadcast/06_DeployHook.s.sol/1301/run-1769587735298.json43-49](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/broadcast/06_DeployHook.s.sol/1301/run-1769587735298.json#L43-L49):

- **Gas Used**: 0x15bd2f (1,425,711 gas)
- **L1 Fee**: 0x449aa04dabc (L1 data submission cost)
- **Blob Gas Used**: 0x1cafc0 (for data availability)

Sources: [contracts/README.md118-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/README.md#L118-L122)[contracts/broadcast/06_DeployHook.s.sol/1301/run-1769587735298.json1-58](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/broadcast/06_DeployHook.s.sol/1301/run-1769587735298.json#L1-L58)

## Dependency Graph

```
Post-Deployment

Step 3: L2 Hook

Step 2: Reactive Sentinel

Step 1: L1 Oracle

Pre-Deployment

Provides salt & address

Provides salt

Address required

Needs subscription

HookMiner Script
(Calculate CREATE2 salt)

04_DeployOracle.s.sol

MockOracle
0x29f8...BA3b

05_DeploySentinel.s.sol

AegisSentinel
0x0f76...b482

06_DeployHook.s.sol

AegisHook
0xBaa0...C080

Manual Subscription
(Sentinel â†’ Oracle events)
```

**Contract Dependency Graph**: Shows how addresses and salt values flow between deployment steps.

Sources: [contracts/README.md96-122](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/README.md#L96-L122)

## Broadcast Log Structure

Each deployment script generates a JSON broadcast log in `contracts/broadcast/{ScriptName}/{ChainID}/run-{timestamp}.json`. These logs contain:

### Transaction Array

The `transactions` array contains deployment transaction details:

- `hash`: Transaction hash on the target chain
- `transactionType`: `CREATE` or `CREATE2`
- `contractName`: Name of the deployed contract
- `contractAddress`: Deployed contract address (checksummed)
- `arguments`: Constructor arguments (if any)
- `transaction`: Full transaction object with gas, nonce, input bytecode

### Receipts Array

The `receipts` array contains transaction receipt details:

- `status`: `0x1` for success, `0x0` for failure
- `gasUsed`: Actual gas consumed
- `transactionHash`: Matches the transaction hash
- `blockNumber`: Block where transaction was included
- `contractAddress`: Deployed address (or null for CREATE2)

### Metadata Fields

- `timestamp`: Unix timestamp of deployment
- `chain`: Chain ID as decimal
- `commit`: Git commit hash at deployment time

Sources: [contracts/broadcast/04_DeployOracle.s.sol/11155111/run-1769586193733.json1-46](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/broadcast/04_DeployOracle.s.sol/11155111/run-1769586193733.json#L1-L46)[contracts/broadcast/05_DeploySentinel.s.sol/5318007/run-1769588622425.json1-50](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/broadcast/05_DeploySentinel.s.sol/5318007/run-1769588622425.json#L1-L50)[contracts/broadcast/06_DeployHook.s.sol/1301/run-1769587735298.json1-58](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/broadcast/06_DeployHook.s.sol/1301/run-1769587735298.json#L1-L58)

## Network-Specific Flags

Different networks require specific command-line flags for successful deployment:
NetworkFlagReasonSepoliaNoneStandard EIP-1559 compatibleReactive`--legacy`Requires legacy transaction format for EIP-155 compatibilityUnichainNoneStandard EIP-1559 compatible with L2 extensions
The Reactive Network's requirement for `--legacy` transactions is due to testnet infrastructure limitations and ensures proper signature verification.

Sources: [contracts/README.md112-116](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/README.md#L112-L116)

## Deployment Verification

After all three scripts execute successfully, the deployed addresses should match:

```
MockOracle:       0x29f8f8d2A00330F9683e73a926F61AE7E91cBA3b (Sepolia)
AegisHook:        0xBaa0573e3BE4291b58083e717E9EF5051772C080 (Unichain)
AegisSentinel:    0x0f764437ffBE1fcd0d0d276a164610422710B482 (Reactive Lasna)

```

These addresses are cross-referenced in the Sentinel constructor arguments and must be consistent across all deployments for the cross-chain system to function correctly.

Sources: [contracts/README.md99-104](https://github.com/HACK3R-CRYPTO/Aegis/blob/5ea5ecc2/contracts/README.md#L99-L104)